<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Farm - Jogo de Fazendinha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            transition: background-color 0.5s ease;
        }
        
        .farm-title {
            font-family: 'Fredoka One', cursive;
        }
        
        .rain-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: 
                radial-gradient(2px 10px at 20px 30px, #def, transparent),
                radial-gradient(2px 10px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 8px at 90px 40px, #def, transparent),
                radial-gradient(1px 12px at 60px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 8px at 130px 20px, #def, transparent),
                radial-gradient(1px 10px at 160px 60px, rgba(255,255,255,0.7), transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: rain 0.8s linear infinite;
        }
        
        @keyframes rain {
            0% { 
                transform: translateY(-100px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh);
                opacity: 0;
            }
        }
        
        .growing {
            animation: grow 0.3s ease-in-out;
        }
        
        @keyframes grow {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .coin-animation {
            animation: coinBounce 0.5s ease-in-out;
        }
        
        @keyframes coinBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-green-200 to-green-300 min-h-screen transition-all duration-500" id="gameBody">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="farm-title text-4xl text-green-800 mb-4">🚜 Real Farm 🌱</h1>
            
            <!-- Avatar do Fazendeiro -->
            <div class="bg-white rounded-lg p-4 shadow-lg mb-4">
                <div class="flex items-center justify-center gap-6">
                    <!-- Avatar -->
                    <div class="text-center">
                        <div class="text-6xl mb-2" id="farmerAvatar">👨‍🌾</div>
                        <div class="font-bold text-lg">Você</div>
                        <div class="text-sm" id="farmerStatus">Saudável</div>
                    </div>
                    
                    <!-- Barra de Energia -->
                    <div class="flex-1 max-w-md">
                        <div class="text-sm font-bold mb-2">Energia: <span id="energyText">200/200</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-green-500 h-4 rounded-full transition-all duration-300" id="energyBar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="flex flex-col gap-2">
                        <button onclick="restFarmer()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed" id="restButton">
                            😴 Descansar (5min)
                        </button>
                        <button onclick="showEatMenu()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed" id="eatButton">
                            🍽️ Comer
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center gap-8 bg-white rounded-lg p-4 shadow-lg">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">🪙</span>
                    <span class="font-bold text-lg" id="coins">200</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-2xl">💧</span>
                    <span class="font-bold text-lg" id="water">10</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-2xl">🍂</span>
                    <span class="font-bold text-lg" id="fertilizer">50</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-2xl" id="seasonEmoji">🌸</span>
                    <div class="text-center">
                        <div class="font-bold text-lg" id="seasonName">Primavera</div>
                        <div class="text-sm" id="seasonTimer">60:00</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-12 gap-4">
            <!-- Sementes (Coluna Esquerda) -->
            <div class="col-span-3">
                <div class="bg-white rounded-lg p-4 shadow-lg">
                    <h3 class="font-bold text-lg mb-3 text-center text-green-800">🌰 Sementes</h3>
                    <div class="grid grid-cols-2 gap-2" id="seedsContainer">
                        <!-- Sementes serão geradas aqui -->
                    </div>
                </div>

                <!-- Celeiro -->
                <div class="bg-white rounded-lg p-4 shadow-lg mt-4">
                    <h3 class="font-bold text-lg mb-3 text-center text-red-800">🏚️ Celeiro</h3>
                    <div class="grid grid-cols-4 gap-2 max-h-64 overflow-y-auto" id="barn">
                        <!-- Itens do celeiro aparecerão aqui -->
                    </div>
                </div>

                <!-- Mercadinho -->
                <div class="bg-white rounded-lg p-4 shadow-lg mt-4">
                    <h3 class="font-bold text-lg mb-3 text-center text-blue-800">🏪 Mercadinho</h3>
                    <div class="space-y-2" id="market">
                        <button onclick="buyWell()" class="w-full bg-blue-500 hover:bg-blue-600 text-white p-2 rounded text-sm" id="wellButton">🪣 Poço de Água - 100🪙</button>
                        <button onclick="buyGrassField()" class="w-full bg-green-500 hover:bg-green-600 text-white p-2 rounded text-sm" id="grassFieldButton">🌿 Campo de Grama - 200🪙</button>
                        <button onclick="buyDryer()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded text-sm" id="dryerButton">🌾 Secador/Feno - 250🪙</button>
                        <button onclick="buyForest()" class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded text-sm" id="forestButton">🌲 Bosque - 300🪙</button>
                        <button onclick="buyAxe()" class="w-full bg-brown-500 hover:bg-brown-600 text-white p-2 rounded text-sm hidden" id="axeButton" style="background-color: #8B4513;">🪓 Machado - 150🪙</button>
                        <button onclick="buyComposter()" class="w-full bg-green-700 hover:bg-green-800 text-white p-2 rounded text-sm" id="composterButton">🗂️ Composteira - 350🪙</button>
                        <button onclick="buyKitchen()" class="w-full bg-red-500 hover:bg-red-600 text-white p-2 rounded text-sm" id="kitchenButton">🔥 Fogão/Forno - 400🪙</button>
                        <button onclick="buyCheeseMaker()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-2 rounded text-sm" id="cheeseMakerButton">🧀 Queijeira - 300🪙</button>
                        <button onclick="buyCowPasture()" class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded text-sm" id="cowPastureButton">🐄 Pasto das Vacas - 500🪙</button>
                        <button onclick="buyCow()" class="w-full bg-brown-400 hover:bg-brown-500 text-white p-2 rounded text-sm" id="cowButton" style="display: none; background-color: #A0522D;">🐄 Vaca - 100🪙</button>
                    </div>
                </div>
            </div>

            <!-- Área Central (Canteiros + Poço + Quitanda) -->
            <div class="col-span-7">
                <!-- Canteiros -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4">
                    <h3 class="font-bold text-lg mb-3 text-center text-green-800">🌾 Fazenda</h3>
                    <div class="grid grid-cols-4 gap-4" id="farmPlots">
                        <!-- Canteiros serão gerados aqui -->
                    </div>
                </div>

                <!-- Poço de Água -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="wellContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-blue-800">🪣 Poço de Água</h3>
                    <div class="flex justify-center">
                        <button onclick="collectWater()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold text-lg">
                            💧 Coletar Água (4 baldes)
                        </button>
                    </div>
                </div>

                <!-- Campo de Flores (Primavera) -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4" id="flowerFieldContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-pink-800">🌸 Campo de Flores</h3>
                    <div class="grid grid-cols-3 gap-4" id="flowerField">
                        <!-- Slots de flores serão gerados aqui -->
                    </div>
                    <div class="text-center mt-2 text-sm text-gray-600">
                        Ervas coletadas: <span id="herbCount">0</span>/4 para próxima erva 🌿
                    </div>
                </div>

                <!-- Bosque -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="forestContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-green-800">🌲 Bosque</h3>
                    <div class="grid grid-cols-4 gap-4" id="forest">
                        <!-- Árvores serão geradas aqui -->
                    </div>
                    <div class="text-center mt-2 text-sm text-gray-600">
                        Troncos coletados: <span id="logCount">0</span>/3 para próximo galho 🪵
                    </div>
                </div>





                <!-- Campo de Grama -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="grassFieldContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-green-800">🌿 Campo de Grama</h3>
                    <div class="grid grid-cols-5 gap-2" id="grassField">
                        <!-- Slots de grama serão gerados aqui -->
                    </div>
                    <div class="text-center mt-2 text-sm text-gray-600">
                        Gramas coletadas: <span id="grassCount">0</span>/8 para próxima flor 🌸
                    </div>
                </div>



                <!-- Pasto das Vacas -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="cowPastureContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-brown-800">🐄 Pasto das Vacas</h3>
                    <div class="grid grid-cols-2 gap-4" id="cowPasture">
                        <!-- Slots das vacas serão gerados aqui -->
                    </div>
                </div>



                <!-- Quitanda -->
                <div class="bg-white rounded-lg p-4 shadow-lg">
                    <h3 class="font-bold text-lg mb-3 text-center text-yellow-800">🛒 Quitanda</h3>
                    <div class="grid grid-cols-10 gap-2 mb-4" id="shop">
                        <!-- Slots da quitanda -->
                    </div>
                    <button onclick="sellAll()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white p-3 rounded font-bold">💰 Vender Tudo</button>
                </div>
            </div>

            <!-- Coluna Direita (Composteira + Área de Cortar Lenha + Fogão/Forno + Secador/Feno + Queijeira) -->
            <div class="col-span-2">
                <!-- Área de Cortar Lenha -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="lumberContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-brown-800">🪓 Cortar Lenha</h3>
                    <div class="flex items-center justify-center gap-4">
                        <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="lumberSlot" onclick="addLogToLumber()">
                            <div class="text-xs text-gray-500">Vazio</div>
                        </div>
                        <div class="text-2xl">→</div>
                        <button onclick="cutLumber()" class="bg-brown-500 hover:bg-brown-600 text-white px-6 py-3 rounded-lg font-bold disabled:bg-gray-400 disabled:cursor-not-allowed" id="cutButton" disabled style="background-color: #8B4513;">
                            🪓 Cortar (3s)
                        </button>
                        <div class="text-2xl">→</div>
                        <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center">
                            <div class="text-2xl">🪵</div>
                            <div class="text-xs">4 Lenhas</div>
                        </div>
                    </div>
                    <div class="text-center mt-2 text-sm text-gray-600">
                        Usos do machado: <span id="axeUses">40</span>/40
                    </div>
                </div>

                <!-- Secador de Grama / Fazer Feno -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="dryerContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-yellow-800">🌾 Secador & Feno</h3>
                    
                    <!-- Secador de Grama -->
                    <div class="bg-yellow-50 rounded-lg p-3 mb-3">
                        <h4 class="font-bold text-sm mb-2 text-center text-yellow-700">☀️ Secador de Grama</h4>
                        <div class="flex items-center justify-center gap-2">
                            <div class="bg-green-100 border-2 border-green-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-green-200" id="dryerSlot" onclick="addGrassToDryer()">
                                <div class="text-xs text-gray-500">Vazio</div>
                                <div class="text-xs" id="dryerGrassCount">0/8</div>
                            </div>
                            <div class="text-lg">→</div>
                            <button onclick="startDrying()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed text-xs" id="dryButton" disabled>
                                ☀️ Secar
                            </button>
                            <div class="text-lg">→</div>
                            <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center">
                                <div class="text-lg">🌾</div>
                                <div class="text-xs">Seca</div>
                            </div>
                        </div>
                        <div class="text-center mt-1 text-xs" id="dryingStatus">Pronto</div>
                    </div>

                    <!-- Fazer Feno -->
                    <div class="bg-orange-50 rounded-lg p-3">
                        <h4 class="font-bold text-sm mb-2 text-center text-orange-700">🌾 Fazer Feno</h4>
                        <div class="flex items-center justify-center gap-2">
                            <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200" id="hayMakerSlot" onclick="addDriedGrassToHayMaker()">
                                <div class="text-xs text-gray-500">Vazio</div>
                                <div class="text-xs" id="hayMakerGrassCount">0/4</div>
                            </div>
                            <div class="text-lg">→</div>
                            <button onclick="startMakingHay()" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed text-xs" id="hayButton" disabled>
                                🌾 Fazer
                            </button>
                            <div class="text-lg">→</div>
                            <div class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center">
                                <div class="text-lg">🌾</div>
                                <div class="text-xs">Feno</div>
                            </div>
                        </div>
                        <div class="text-center mt-1 text-xs" id="hayMakingStatus">Pronto</div>
                    </div>
                </div>

                <!-- Fogão -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="kitchenContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-red-800">🔥 Fogão & Forno</h3>
                    <div class="flex items-center justify-center gap-3 mb-3">
                        <!-- Slot de Lenha -->
                        <div class="text-center">
                            <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200" id="stoveFuelSlot" onclick="addFuelToStove()">
                                <div class="text-xs text-gray-500">Lenha</div>
                                <div class="text-xs" id="stoveFuelCount">0/2</div>
                            </div>
                        </div>
                        
                        <!-- Slots de Ingredientes -->
                        <div class="grid grid-cols-2 gap-1">
                            <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="stoveSlot0" onclick="addIngredientToStove(0)">
                                <div class="text-xs text-gray-500">Vazio</div>
                            </div>
                            <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="stoveSlot1" onclick="addIngredientToStove(1)">
                                <div class="text-xs text-gray-500">Vazio</div>
                            </div>
                            <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="stoveSlot2" onclick="addIngredientToStove(2)">
                                <div class="text-xs text-gray-500">Vazio</div>
                            </div>
                            <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="stoveSlot3" onclick="addIngredientToStove(3)">
                                <div class="text-xs text-gray-500">Vazio</div>
                            </div>
                        </div>
                        
                        <!-- Botão de Cozinhar -->
                        <div class="text-center">
                            <button onclick="startCooking()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed text-xs" id="cookButton" disabled>
                                🍳 Cozinhar
                            </button>
                            <div class="text-xs mt-1" id="cookingStatus">Pronto</div>
                        </div>
                    </div>
                    
                    <!-- Forno -->
                    <div class="bg-orange-50 rounded-lg p-3 mt-3">
                        <h4 class="font-bold text-sm mb-2 text-center text-orange-800">🔥 Forno</h4>
                        <div class="flex items-center justify-center gap-3 mb-2">
                            <!-- Slot de Lenha do Forno -->
                            <div class="text-center">
                                <div class="bg-orange-100 border-2 border-orange-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200" id="ovenFuelSlot" onclick="addFuelToOven()">
                                    <div class="text-xs text-gray-500">Lenha</div>
                                    <div class="text-xs" id="ovenFuelCount">0/3</div>
                                </div>
                            </div>
                            
                            <!-- Slots de Ingredientes do Forno -->
                            <div class="grid grid-cols-2 gap-1">
                                <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="ovenSlot0" onclick="addIngredientToOven(0)">
                                    <div class="text-xs text-gray-500">Vazio</div>
                                </div>
                                <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="ovenSlot1" onclick="addIngredientToOven(1)">
                                    <div class="text-xs text-gray-500">Vazio</div>
                                </div>
                                <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="ovenSlot2" onclick="addIngredientToOven(2)">
                                    <div class="text-xs text-gray-500">Vazio</div>
                                </div>
                                <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-2 w-12 h-12 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200" id="ovenSlot3" onclick="addIngredientToOven(3)">
                                    <div class="text-xs text-gray-500">Vazio</div>
                                </div>
                            </div>
                            
                            <!-- Botão de Assar -->
                            <div class="text-center">
                                <button onclick="startBaking()" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed text-xs" id="bakeButton" disabled>
                                    🔥 Assar
                                </button>
                                <div class="text-xs mt-1" id="bakingStatus">Pronto</div>
                            </div>
                        </div>
                    </div>

                    <!-- Receitas -->
                    <div class="bg-gray-50 rounded-lg p-2 mt-3">
                        <h4 class="font-bold text-xs mb-1 text-center">📖 Receitas</h4>
                        <div class="grid grid-cols-2 gap-1 text-xs">
                            <div class="bg-blue-100 p-1 rounded">
                                <div class="font-bold text-xs">🍵 Chá</div>
                                <div class="text-xs">1 Água + 2 Ervas</div>
                            </div>
                            <div class="bg-green-100 p-1 rounded">
                                <div class="font-bold text-xs">🥗 Salada</div>
                                <div class="text-xs">1 Alface + 1 Tomate + 1 Cenoura</div>
                            </div>
                            <div class="bg-orange-100 p-1 rounded">
                                <div class="font-bold text-xs">🍲 Ensopado</div>
                                <div class="text-xs">1 Brócolis + 1 Abóbora + 2 Ovos</div>
                            </div>
                            <div class="bg-red-100 p-1 rounded">
                                <div class="font-bold text-xs">🥩 Bife</div>
                                <div class="text-xs">1 Carne</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Queijeira -->
                <div class="bg-white rounded-lg p-4 shadow-lg mb-4 hidden" id="cheeseMakerContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-yellow-800">🧀 Queijeira</h3>
                    <div class="flex items-center justify-center gap-3">
                        <div class="bg-blue-100 border-2 border-blue-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-blue-200" id="cheeseMakerSlot" onclick="addMilkToCheeseMaker()">
                            <div class="text-xs text-gray-500">Vazio</div>
                            <div class="text-xs" id="cheeseMakerMilkCount">0/2</div>
                        </div>
                        <div class="text-lg">→</div>
                        <button onclick="startCheesemaking()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded font-bold disabled:bg-gray-400 disabled:cursor-not-allowed text-xs" id="cheeseButton" disabled>
                            🧀 Curar
                        </button>
                        <div class="text-lg">→</div>
                        <div class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center">
                            <div class="text-lg">🧀</div>
                            <div class="text-xs">Queijo</div>
                        </div>
                    </div>
                    <div class="text-center mt-2 text-xs" id="cheesemakingStatus">Pronto</div>
                </div>

                <!-- Composteira -->
                <div class="bg-white rounded-lg p-4 shadow-lg hidden" id="composterContainer">
                    <h3 class="font-bold text-lg mb-3 text-center text-green-800">🗂️ Composteira</h3>
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <!-- Slot de Flores -->
                        <div class="text-center">
                            <div class="bg-pink-100 border-2 border-pink-300 rounded-lg p-3 w-full h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-pink-200" id="composterFlowerSlot" onclick="addFlowerToComposter()">
                                <div class="text-xs text-gray-500">Flores</div>
                                <div class="text-xs" id="composterFlowerCount">0/1</div>
                            </div>
                        </div>
                        
                        <!-- Slot de Galhos -->
                        <div class="text-center">
                            <div class="bg-brown-100 border-2 border-brown-300 rounded-lg p-3 w-full h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-brown-200" id="composterBranchSlot" onclick="addBranchToComposter()" style="background-color: #D2B48C;">
                                <div class="text-xs text-gray-500">Galhos</div>
                                <div class="text-xs" id="composterBranchCount">0/1</div>
                            </div>
                        </div>
                        
                        <!-- Slot de Esterco -->
                        <div class="text-center">
                            <div class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-3 w-full h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-200" id="composterManureSlot" onclick="addManureToComposter()">
                                <div class="text-xs text-gray-500">Esterco</div>
                                <div class="text-xs" id="composterManureCount">0/2</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botão de Fazer -->
                    <div class="text-center">
                        <button onclick="startComposting()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold disabled:bg-gray-400 disabled:cursor-not-allowed" id="compostButton" disabled>
                            🗂️ Fazer Adubo
                        </button>
                        <div class="text-xs mt-1" id="compostingStatus">Pronto</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Animação de Chuva -->
    <div id="rainOverlay" class="rain-animation hidden"></div>

    <script>
        // Estado do jogo
        let gameState = {
            coins: 200,
            water: 10,
            fertilizer: 50,
            harvestedPlots: 0,
            rainTimer: 900, // 15 minutos em segundos
            isRaining: false,
            selectedSeed: null,
            hasWell: false,
            hasAxe: false,
            axeUses: 40, // Usos restantes do machado
            hasGrassField: false,
            hasForest: false,
            hasKitchen: false,
            hasDryer: false,
            hasCowPasture: false,
            hasComposter: false,
            hasCheeseMaker: false,
            grassCollected: 0, // Contador para flores do campo de grama
            currentSeason: 0, // 0=Primavera, 1=Verão, 2=Outono, 3=Inverno
            seasonTimer: 3600, // 1 hora em segundos
            flowersCollected: 0, // Contador para ervas
            logsCollected: 0, // Contador para galhos
            lumberSlot: null, // Tronco na área de cortar lenha
            isCutting: false, // Se está cortando lenha
            farmer: {
                energy: 200,
                maxEnergy: 200,
                isSick: false,
                isResting: false,
                restTimer: null,
                sickTimer: null,
                energyBoost: 0, // Bônus temporário de energia
                boostTimer: null
            },
            stove: {
                fuel: 0, // Lenhas no fogão (máximo 2)
                ingredients: [null, null, null, null], // 4 slots de ingredientes
                isCooking: false,
                cookingTimer: null
            },
            oven: {
                fuel: 0, // Lenhas no forno (máximo 3)
                ingredients: [null, null, null, null], // 4 slots de ingredientes
                isBaking: false,
                bakingTimer: null
            },
            flowerField: {
                'Rosa': {available: 3, timers: []},
                'Girassol': {available: 3, timers: []},
                'Margarida': {available: 3, timers: []}
            },
            forest: {
                'Macieira': {available: 4},
                'Laranjeira': {available: 4},
                'Bananeira': {available: 4}
            },
            grassField: Array(20).fill().map(() => ({available: true, timer: null})),
            dryer: {
                grassSlot: 0, // Quantidade de grama no secador (máximo 8)
                isDrying: false,
                dryingTimer: null
            },
            hayMaker: {
                driedGrassSlot: 0, // Quantidade de grama seca (máximo 4)
                isMaking: false,
                makingTimer: null
            },
            cowPasture: {
                cows: [null, null, null, null], // 4 slots para vacas
                cowStates: [
                    {hasHay: false, hayAmount: 0, isEating: false, isProducing: false, isResting: false, restTimer: null, milk: 0, manure: 0},
                    {hasHay: false, hayAmount: 0, isEating: false, isProducing: false, isResting: false, restTimer: null, milk: 0, manure: 0},
                    {hasHay: false, hayAmount: 0, isEating: false, isProducing: false, isResting: false, restTimer: null, milk: 0, manure: 0},
                    {hasHay: false, hayAmount: 0, isEating: false, isProducing: false, isResting: false, restTimer: null, milk: 0, manure: 0}
                ]
            },
            composter: {
                flowers: 0, // Máximo 1
                branches: 0, // Máximo 1  
                manure: 0, // Máximo 2
                isComposting: false,
                compostingTimer: null
            },
            cheeseMaker: {
                milk: 0, // Máximo 2
                isMaking: false,
                makingTimer: null
            }
        };

        // Dados das sementes
        const seeds = [
            {name: 'Abóbora', emoji: '🎃', price: 10, sellPrice: 25, type: 'plant'},
            {name: 'Alface', emoji: '🥬', price: 10, sellPrice: 20, type: 'plant'},
            {name: 'Batata', emoji: '🥔', price: 10, sellPrice: 18, type: 'plant'},
            {name: 'Brócolis', emoji: '🥦', price: 10, sellPrice: 22, type: 'plant'},
            {name: 'Café', emoji: '🔴', price: 10, sellPrice: 30, type: 'plant'},
            {name: 'Cenoura', emoji: '🥕', price: 10, sellPrice: 15, type: 'plant'},
            {name: 'Milho', emoji: '🌽', price: 10, sellPrice: 20, type: 'plant'},
            {name: 'Tomate', emoji: '🍅', price: 10, sellPrice: 18, type: 'plant'},
            {name: 'Trigo', emoji: '🌾', price: 10, sellPrice: 16, type: 'plant'},
            {name: 'Uva', emoji: '🍇', price: 10, sellPrice: 28, type: 'plant'}
        ];

        // Dados das estações
        const seasons = [
            {name: 'Primavera', emoji: '🌸', color: 'from-pink-200 to-green-200'},
            {name: 'Verão', emoji: '☀️', color: 'from-yellow-200 to-orange-200'},
            {name: 'Outono', emoji: '🍂', color: 'from-orange-200 to-red-200'},
            {name: 'Inverno', emoji: '❄️', color: 'from-blue-200 to-gray-200'}
        ];

        // Dados das flores
        const flowers = [
            {name: 'Rosa', emoji: '🌹', color: 'bg-red-100'},
            {name: 'Girassol', emoji: '🌻', color: 'bg-yellow-100'},
            {name: 'Margarida', emoji: '🌼', color: 'bg-white'}
        ];

        // Dados das árvores
        const trees = [
            {name: 'Árvore', emoji: '🌳', type: 'wood', color: 'bg-green-100'},
            {name: 'Macieira', emoji: '🍎', type: 'fruit', fruit: 'Maçã', color: 'bg-red-100'},
            {name: 'Laranjeira', emoji: '🍊', type: 'fruit', fruit: 'Laranja', color: 'bg-orange-100'},
            {name: 'Bananeira', emoji: '🍌', type: 'fruit', fruit: 'Banana', color: 'bg-yellow-100'}
        ];

        // Inventários
        let barn = {};
        let shop = {}; // Mudança para objeto para agrupar itens iguais
        let plots = Array(8).fill({stage: 'empty', seed: null, timer: null});

        // Inicializar jogo
        function initGame() {
            createSeeds();
            createPlots();
            createShopSlots();
            createFlowerField();
            createForest();
            createGrassField();
            createCowPasture();
            updateLumberDisplay();
            updateStoveDisplay();
            updateOvenDisplay();
            updateDryerDisplay();
            updateHayMakerDisplay();
            updateComposterDisplay();
            updateCheeseMakerDisplay();
            updateFarmerDisplay();
            updateUI();
            startRainTimer();
            startSeasonTimer();
        }

        // Criar sementes
        function createSeedsContainer() {
            const container = document.getElementById('seedsContainer');
            container.innerHTML = '';
            
            seeds.forEach(seed => {
                const button = document.createElement('button');
                button.className = 'w-full bg-green-500 hover:bg-green-600 text-white p-2 rounded text-xs transition-all';
                button.innerHTML = `${seed.emoji}<br>${seed.name}<br>${seed.price}🪙`;
                button.onclick = () => selectSeed(seed);
                button.id = `seed-${seed.name}`;
                container.appendChild(button);
            });
        }

        function createSeeds() {
            createSeedsContainer();
        }

        // Criar canteiros
        function createPlots() {
            const container = document.getElementById('farmPlots');
            container.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const plot = document.createElement('div');
                plot.className = 'bg-amber-100 border-2 border-amber-300 rounded-lg p-2 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-amber-200 transition-all';
                plot.id = `plot-${i}`;
                plot.onclick = () => handlePlotClick(i);
                
                const content = document.createElement('div');
                content.className = 'text-center';
                content.innerHTML = '<div class="text-2xl">🌱</div><div class="text-xs mt-1">Vazio</div>';
                
                plot.appendChild(content);
                container.appendChild(plot);
            }
        }

        // Criar slots da quitanda
        function createShopSlots() {
            const container = document.getElementById('shop');
            container.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'bg-gray-100 border-2 border-gray-300 rounded p-2 h-16 flex flex-col items-center justify-center text-xs cursor-pointer hover:bg-gray-200';
                slot.id = `shop-${i}`;
                slot.onclick = () => removeFromShop(i);
                container.appendChild(slot);
            }
        }

        // Criar campo de flores
        function createFlowerField() {
            const container = document.getElementById('flowerField');
            container.innerHTML = '';
            
            flowers.forEach(flower => {
                const slot = document.createElement('div');
                slot.className = `${flower.color} border-2 border-pink-300 rounded-lg p-4 text-center cursor-pointer hover:bg-opacity-80 transition-all`;
                slot.id = `flower-${flower.name}`;
                slot.onclick = () => collectFlower(flower.name);
                
                slot.innerHTML = `
                    <div class="text-3xl mb-2">${flower.emoji}</div>
                    <div class="font-bold text-sm">${flower.name}</div>
                    <div class="text-xs mt-1" id="flower-count-${flower.name}">3/3</div>
                `;
                
                container.appendChild(slot);
            });
        }

        // Coletar flor
        function collectFlower(flowerType) {
            const flowerData = gameState.flowerField[flowerType];
            
            if (flowerData.available > 0) {
                flowerData.available--;
                gameState.flowersCollected++;
                
                // Adicionar flor ao celeiro
                addToBarn(flowerType, 1);
                
                // Verificar se deve gerar erva
                if (gameState.flowersCollected % 4 === 0) {
                    addToBarn('Erva', 1);
                    alert('🌿 Você ganhou uma erva!');
                }
                
                // Iniciar timer de regeneração (5 minutos)
                const timer = setTimeout(() => {
                    flowerData.available++;
                    updateFlowerDisplay(flowerType);
                    
                    // Remover timer da lista
                    const index = flowerData.timers.indexOf(timer);
                    if (index > -1) {
                        flowerData.timers.splice(index, 1);
                    }
                }, 300000); // 5 minutos
                
                flowerData.timers.push(timer);
                updateFlowerDisplay(flowerType);
                updateHerbCounter();
            }
        }

        // Atualizar display da flor
        function updateFlowerDisplay(flowerType) {
            const flowerData = gameState.flowerField[flowerType];
            const countElement = document.getElementById(`flower-count-${flowerType}`);
            countElement.textContent = `${flowerData.available}/3`;
            
            // Mudar opacidade se não há flores disponíveis
            const slotElement = document.getElementById(`flower-${flowerType}`);
            if (flowerData.available === 0) {
                slotElement.style.opacity = '0.5';
            } else {
                slotElement.style.opacity = '1';
            }
        }

        // Atualizar contador de ervas
        function updateHerbCounter() {
            const herbCount = gameState.flowersCollected % 4;
            document.getElementById('herbCount').textContent = herbCount;
        }

        // Criar campo de grama
        function createGrassField() {
            const container = document.getElementById('grassField');
            container.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'bg-green-100 border-2 border-green-300 rounded-lg p-3 text-center cursor-pointer hover:bg-green-200 transition-all';
                slot.id = `grass-${i}`;
                slot.onclick = () => collectGrass(i);
                
                slot.innerHTML = `
                    <div class="text-2xl mb-1">🌿</div>
                    <div class="text-xs">Grama</div>
                `;
                
                container.appendChild(slot);
            }
        }

        // Coletar grama
        function collectGrass(index) {
            const grassData = gameState.grassField[index];
            
            if (grassData.available) {
                grassData.available = false;
                gameState.grassCollected++;
                
                // Adicionar grama ao celeiro
                addToBarn('Grama', 1);
                
                // Verificar se deve gerar flor
                if (gameState.grassCollected % 8 === 0) {
                    addToBarn('Flor', 1);
                    alert('🌸 Você ganhou uma flor!');
                }
                
                // Iniciar timer de regeneração (1 minuto)
                grassData.timer = setTimeout(() => {
                    gameState.grassField[index].available = true;
                    updateGrassDisplay(index);
                }, 60000); // 1 minuto
                
                updateGrassDisplay(index);
                updateGrassCounter();
            }
        }

        // Atualizar display da grama
        function updateGrassDisplay(index) {
            const grassData = gameState.grassField[index];
            const slotElement = document.getElementById(`grass-${index}`);
            
            if (grassData.available) {
                slotElement.innerHTML = `
                    <div class="text-2xl mb-1">🌿</div>
                    <div class="text-xs">Grama</div>
                `;
                slotElement.style.opacity = '1';
            } else {
                slotElement.innerHTML = `
                    <div class="text-2xl mb-1">🌱</div>
                    <div class="text-xs">Crescendo...</div>
                `;
                slotElement.style.opacity = '0.5';
            }
        }

        // Atualizar contador de grama
        function updateGrassCounter() {
            const grassCount = gameState.grassCollected % 8;
            document.getElementById('grassCount').textContent = grassCount;
        }

        // Comprar campo de grama
        function buyGrassField() {
            if (gameState.hasGrassField) {
                alert('Você já tem um campo de grama!');
                return;
            }
            
            if (gameState.coins >= 200) {
                gameState.coins -= 200;
                gameState.hasGrassField = true;
                
                // Mostrar apenas o campo de grama
                document.getElementById('grassFieldContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('grassFieldButton').style.display = 'none';
                
                updateUI();
                alert('🌿 Campo de grama comprado! Agora você pode coletar grama!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Comprar secador/feno
        function buyDryer() {
            if (gameState.hasDryer) {
                alert('Você já tem um secador!');
                return;
            }
            
            if (gameState.coins >= 250) {
                gameState.coins -= 250;
                gameState.hasDryer = true;
                
                // Mostrar o secador
                document.getElementById('dryerContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('dryerButton').style.display = 'none';
                
                updateUI();
                alert('🌾 Secador e fazedor de feno comprados! Agora você pode secar grama e fazer feno!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Comprar bosque
        function buyForest() {
            if (gameState.hasForest) {
                alert('Você já tem um bosque!');
                return;
            }
            
            if (gameState.coins >= 300) {
                gameState.coins -= 300;
                gameState.hasForest = true;
                
                // Mostrar o bosque
                document.getElementById('forestContainer').classList.remove('hidden');
                
                // Mostrar o botão do machado no mercadinho
                document.getElementById('axeButton').classList.remove('hidden');
                
                // Esconder o botão de compra do bosque
                document.getElementById('forestButton').style.display = 'none';
                
                updateUI();
                alert('🌲 Bosque comprado! Agora você pode coletar frutas e madeira! O machado está disponível no mercadinho.');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Comprar cozinha (fogão + forno)
        function buyKitchen() {
            if (gameState.hasKitchen) {
                alert('Você já tem uma cozinha!');
                return;
            }
            
            if (!gameState.hasWell) {
                alert('Você precisa de um poço de água primeiro!');
                return;
            }
            
            if (gameState.coins >= 400) {
                gameState.coins -= 400;
                gameState.hasKitchen = true;
                
                // Mostrar a cozinha
                document.getElementById('kitchenContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('kitchenButton').style.display = 'none';
                
                updateUI();
                alert('🔥 Cozinha comprada! Agora você pode cozinhar e assar alimentos! Precisa de lenha e conexão com água.');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Criar bosque
        function createForest() {
            const container = document.getElementById('forest');
            container.innerHTML = '';
            
            trees.forEach(tree => {
                const slot = document.createElement('div');
                slot.className = `${tree.color} border-2 border-green-300 rounded-lg p-4 text-center cursor-pointer hover:bg-opacity-80 transition-all`;
                slot.id = `tree-${tree.name}`;
                slot.onclick = () => interactWithTree(tree);
                
                let content = `
                    <div class="text-3xl mb-2">${tree.emoji}</div>
                    <div class="font-bold text-sm">${tree.name}</div>
                `;
                
                if (tree.type === 'fruit') {
                    content += `<div class="text-xs mt-1" id="fruit-count-${tree.name}">${gameState.forest[tree.name].available}/4</div>`;
                } else {
                    content += `<div class="text-xs mt-1">Infinito</div>`;
                }
                
                slot.innerHTML = content;
                container.appendChild(slot);
            });
        }

        // Interagir com árvore
        function interactWithTree(tree) {
            if (tree.type === 'wood') {
                // Árvore comum - precisa de machado
                if (!gameState.hasAxe) {
                    alert('Você precisa de um machado para cortar madeira!');
                    return;
                }
                
                if (gameState.axeUses <= 0) {
                    alert('Seu machado quebrou! Compre outro no mercadinho.');
                    return;
                }
                
                // Usar o machado
                gameState.axeUses--;
                
                // Verificar se o machado quebrou
                if (gameState.axeUses <= 0) {
                    gameState.hasAxe = false;
                    document.getElementById('lumberContainer').classList.add('hidden');
                    document.getElementById('axeButton').style.display = 'block';
                    alert('💥 Seu machado quebrou! Você pode comprar outro no mercadinho.');
                }
                
                // Coletar tronco
                addToBarn('Tronco', 1);
                gameState.logsCollected++;
                
                // A cada 3 troncos, ganha um galho
                if (gameState.logsCollected % 3 === 0) {
                    addToBarn('Galho', 1);
                    alert('🪵 Você ganhou um galho!');
                }
                
                updateLogCounter();
                updateUI();
                
            } else if (tree.type === 'fruit') {
                // Árvore frutífera
                const treeData = gameState.forest[tree.name];
                
                if (treeData.available > 0) {
                    treeData.available--;
                    addToBarn(tree.fruit, 1);
                    
                    // Iniciar timer de regeneração (5 minutos)
                    setTimeout(() => {
                        gameState.forest[tree.name].available++;
                        updateTreeDisplay(tree.name);
                    }, 300000); // 5 minutos
                    
                    updateTreeDisplay(tree.name);
                } else {
                    alert('Esta árvore não tem mais frutas! Aguarde elas crescerem novamente.');
                }
            }
        }
        
        // Função para iniciar timers de regeneração de frutas
        function startFruitRegenerationTimers() {
            // Esta função é chamada quando as estações mudam para resetar os timers
            // Os timers individuais são criados quando as frutas são coletadas
        }

        // Atualizar display da árvore
        function updateTreeDisplay(treeName) {
            const treeData = gameState.forest[treeName];
            const countElement = document.getElementById(`fruit-count-${treeName}`);
            if (countElement) {
                countElement.textContent = `${treeData.available}/4`;
                
                // Mudar opacidade se não há frutas disponíveis
                const slotElement = document.getElementById(`tree-${treeName}`);
                if (treeData.available === 0) {
                    slotElement.style.opacity = '0.5';
                } else {
                    slotElement.style.opacity = '1';
                }
            }
        }

        // Atualizar contador de troncos
        function updateLogCounter() {
            const logCount = gameState.logsCollected % 3;
            document.getElementById('logCount').textContent = logCount;
        }

        // Adicionar tronco à área de cortar lenha
        function addLogToLumber() {
            if (gameState.lumberSlot !== null) {
                alert('Já há um tronco na área de corte!');
                return;
            }
            
            if (!barn['Tronco'] || barn['Tronco'] <= 0) {
                alert('Você não tem troncos no celeiro!');
                return;
            }
            
            // Mover tronco do celeiro para a área de corte
            barn['Tronco']--;
            if (barn['Tronco'] === 0) delete barn['Tronco'];
            
            gameState.lumberSlot = 'Tronco';
            updateLumberDisplay();
            updateBarnDisplay();
        }

        // Cortar lenha
        function cutLumber() {
            if (gameState.lumberSlot === null) {
                alert('Coloque um tronco na área de corte primeiro!');
                return;
            }
            
            if (gameState.isCutting) {
                return;
            }
            
            if (!gameState.hasAxe || gameState.axeUses <= 0) {
                alert('Você precisa de um machado para cortar lenha!');
                return;
            }
            
            gameState.isCutting = true;
            gameState.axeUses--;
            
            // Desabilitar botão e mostrar progresso
            const button = document.getElementById('cutButton');
            button.disabled = true;
            button.textContent = '🪓 Cortando... 3s';
            
            let countdown = 3;
            const timer = setInterval(() => {
                countdown--;
                button.textContent = `🪓 Cortando... ${countdown}s`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    
                    // Verificar se o machado quebrou
                    if (gameState.axeUses <= 0) {
                        gameState.hasAxe = false;
                        document.getElementById('lumberContainer').classList.add('hidden');
                        document.getElementById('axeButton').style.display = 'block';
                        alert('💥 Seu machado quebrou durante o corte! Você pode comprar outro no mercadinho.');
                    }
                    
                    // Produzir 4 lenhas
                    addToBarn('Lenha', 4);
                    gameState.lumberSlot = null;
                    gameState.isCutting = false;
                    
                    updateLumberDisplay();
                    updateUI();
                    
                    button.disabled = false;
                    button.textContent = '🪓 Cortar (3s)';
                    
                    alert('🪵 Você produziu 4 lenhas!');
                }
            }, 1000);
        }

        // Atualizar display da área de cortar lenha
        function updateLumberDisplay() {
            const slot = document.getElementById('lumberSlot');
            const button = document.getElementById('cutButton');
            
            if (gameState.lumberSlot) {
                slot.innerHTML = '<div class="text-2xl">🪵</div><div class="text-xs">Tronco</div>';
                slot.className = 'bg-brown-100 border-2 border-brown-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-brown-200';
                button.disabled = false;
            } else {
                slot.innerHTML = '<div class="text-xs text-gray-500">Vazio</div>';
                slot.className = 'bg-gray-100 border-2 border-gray-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200';
                button.disabled = true;
            }
        }

        // Comprar machado
        function buyAxe() {
            if (gameState.hasAxe) {
                alert('Você já tem um machado!');
                return;
            }
            
            if (gameState.coins >= 150) {
                gameState.coins -= 150;
                gameState.hasAxe = true;
                gameState.axeUses = 40;
                
                // Mostrar a área de cortar lenha
                document.getElementById('lumberContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('axeButton').style.display = 'none';
                
                updateUI();
                alert('🪓 Machado comprado! Agora você pode cortar madeira e fazer lenhas!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Selecionar semente
        function selectSeed(seed) {
            gameState.selectedSeed = seed;
            updateSeedSelection();
        }

        // Atualizar visual da seleção de semente
        function updateSeedSelection() {
            seeds.forEach(seed => {
                const button = document.getElementById(`seed-${seed.name}`);
                if (gameState.selectedSeed && seed.name === gameState.selectedSeed.name) {
                    button.className = 'w-full bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded text-xs transition-all border-2 border-yellow-300';
                } else {
                    button.className = 'w-full bg-green-500 hover:bg-green-600 text-white p-2 rounded text-xs transition-all';
                }
            });
        }

        // Lidar com clique no canteiro
        function handlePlotClick(plotIndex) {
            const plot = plots[plotIndex];
            
            switch(plot.stage) {
                case 'empty':
                    fertilizePlot(plotIndex);
                    break;
                case 'fertilized':
                    plantSeed(plotIndex);
                    break;
                case 'planted':
                    waterPlot(plotIndex);
                    break;
                case 'ready':
                    harvestPlot(plotIndex);
                    break;
            }
        }

        // Adubar canteiro
        function fertilizePlot(plotIndex) {
            if (gameState.fertilizer > 0) {
                gameState.fertilizer--;
                plots[plotIndex] = {stage: 'fertilized', seed: null, timer: null};
                updatePlotDisplay(plotIndex);
                updateUI();
            } else {
                alert('Adubo insuficiente!');
            }
        }

        // Plantar semente
        function plantSeed(plotIndex) {
            if (!gameState.selectedSeed) {
                alert('Selecione uma semente primeiro!');
                return;
            }
            
            if (gameState.coins < gameState.selectedSeed.price) {
                alert('Moedas insuficientes para comprar esta semente!');
                return;
            }
            
            // Comprar e plantar a semente selecionada
            gameState.coins -= gameState.selectedSeed.price;
            plots[plotIndex] = {stage: 'planted', seed: gameState.selectedSeed, timer: null};
            updatePlotDisplay(plotIndex);
            updateUI();
            
            // Animação de compra
            document.getElementById('coins').classList.add('coin-animation');
            setTimeout(() => {
                document.getElementById('coins').classList.remove('coin-animation');
            }, 500);
        }

        // Regar canteiro
        function waterPlot(plotIndex) {
            if (gameState.water > 0) {
                gameState.water--;
                const plot = plots[plotIndex];
                
                // Iniciar crescimento (30 segundos)
                plot.stage = 'growing';
                plot.timer = setTimeout(() => {
                    plots[plotIndex].stage = 'ready';
                    updatePlotDisplay(plotIndex);
                }, 30000);
                
                updatePlotDisplay(plotIndex);
                updateUI();
            } else {
                alert('Água insuficiente!');
            }
        }

        // Colher canteiro
        function harvestPlot(plotIndex) {
            const plot = plots[plotIndex];
            
            // No verão, cada canteiro dá 2 frutos
            const quantity = gameState.currentSeason === 1 ? 2 : 1;
            addToBarn(plot.seed.name, quantity);
            
            plots[plotIndex] = {stage: 'empty', seed: null, timer: null};
            gameState.harvestedPlots++;
            
            // A cada 2 canteiros colhidos, ganha uma minhoca
            if (gameState.harvestedPlots % 2 === 0) {
                addToBarn('Minhoca', 1);
                alert('🪱 Você ganhou uma minhoca!');
            }
            
            updatePlotDisplay(plotIndex);
            updateUI();
        }

        // Atualizar display do canteiro
        function updatePlotDisplay(plotIndex) {
            const plotElement = document.getElementById(`plot-${plotIndex}`);
            const plot = plots[plotIndex];
            
            let content = '';
            let bgColor = 'bg-amber-100';
            
            switch(plot.stage) {
                case 'empty':
                    content = '<div class="text-2xl">🌱</div><div class="text-xs mt-1">Vazio</div>';
                    bgColor = 'bg-amber-100';
                    break;
                case 'fertilized':
                    content = '<div class="text-2xl">🌱</div><div class="text-xs mt-1">Adubado</div>';
                    bgColor = 'bg-green-100';
                    break;
                case 'planted':
                    content = `<div class="text-2xl">${plot.seed.emoji}</div><div class="text-xs mt-1">Plantado</div>`;
                    bgColor = 'bg-yellow-100';
                    break;
                case 'growing':
                    content = `<div class="text-2xl growing">${plot.seed.emoji}</div><div class="text-xs mt-1">Crescendo...</div>`;
                    bgColor = 'bg-blue-100';
                    break;
                case 'ready':
                    content = `<div class="text-2xl">${plot.seed.emoji}</div><div class="text-xs mt-1">Pronto!</div>`;
                    bgColor = 'bg-green-200';
                    break;
            }
            
            plotElement.className = `${bgColor} border-2 border-amber-300 rounded-lg p-2 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-opacity-80 transition-all`;
            plotElement.innerHTML = `<div class="text-center">${content}</div>`;
        }

        // Adicionar ao celeiro
        function addToBarn(item, quantity) {
            if (barn[item]) {
                barn[item] += quantity;
            } else {
                barn[item] = quantity;
            }
            updateBarnDisplay();
        }

        // Atualizar display do celeiro
        function updateBarnDisplay() {
            const container = document.getElementById('barn');
            container.innerHTML = '';
            
            Object.keys(barn).forEach(item => {
                if (barn[item] > 0) {
                    const slot = document.createElement('div');
                    slot.className = 'bg-gray-100 border border-gray-300 rounded p-1 text-center cursor-pointer hover:bg-gray-200';
                    
                    let emoji = '📦';
                    const seed = seeds.find(s => s.name === item);
                    const flower = flowers.find(f => f.name === item);
                    
                    if (seed) emoji = seed.emoji;
                    else if (flower) emoji = flower.emoji;
                    else if (item === 'Minhoca') emoji = '🪱';
                    else if (item === 'Barro') emoji = '🟤';
                    else if (item === 'Erva') emoji = '🍃';
                    else if (item === 'Tronco') emoji = '🪵';
                    else if (item === 'Galho') emoji = '🌲';
                    else if (item === 'Lenha') emoji = '🪵';
                    else if (item === 'Grama') emoji = '🌿';
                    else if (item === 'Flor') emoji = '🌸';
                    else if (item === 'Maçã') emoji = '🍎';
                    else if (item === 'Laranja') emoji = '🍊';
                    else if (item === 'Banana') emoji = '🍌';
                    else if (item === 'Água') emoji = '💧';
                    else if (item === 'Ovo') emoji = '🥚';
                    else if (item === 'Carne') emoji = '🥩';
                    else if (item === 'Peixe') emoji = '🐟';
                    else if (item === 'Frango Cru') emoji = '🐔';
                    else if (item === 'Leite') emoji = '🥛';
                    else if (item === 'Farinha') emoji = '🌾';
                    else if (item === 'Chá') emoji = '🍵';
                    else if (item === 'Salada') emoji = '🥗';
                    else if (item === 'Ensopado') emoji = '🍲';
                    else if (item === 'Bife') emoji = '🥩';
                    else if (item === 'Peixe Assado') emoji = '🍤';
                    else if (item === 'Frango Assado') emoji = '🍗';
                    else if (item === 'Pão') emoji = '🍞';
                    else if (item === 'Esterco') emoji = '💩';
                    else if (item === 'Queijo') emoji = '🧀';
                    
                    slot.innerHTML = `<div class="text-lg">${emoji}</div><div class="text-xs">${barn[item]}</div>`;
                    slot.onclick = () => moveToShop(item);
                    container.appendChild(slot);
                }
            });
        }

        // Mover para quitanda
        function moveToShop(item) {
            // Não permitir vender minhocas, barro, ervas, troncos, galhos, lenhas, flores, grama, grama seca, feno e ingredientes especiais
            const nonSellableItems = ['Minhoca', 'Barro', 'Erva', 'Tronco', 'Galho', 'Lenha', 'Flor', 'Grama', 'Grama Seca', 'Feno', 'Água', 'Peixe', 'Frango Cru', 'Farinha'];
            
            if (nonSellableItems.includes(item)) {
                let itemName = item;
                if (item === 'Minhoca') itemName = 'Minhocas';
                else if (item === 'Erva') itemName = 'Ervas';
                else if (item === 'Tronco') itemName = 'Troncos';
                else if (item === 'Galho') itemName = 'Galhos';
                else if (item === 'Lenha') itemName = 'Lenhas';
                else if (item === 'Flor') itemName = 'Flores';
                else if (item === 'Grama') itemName = 'Gramas';
                else if (item === 'Grama Seca') itemName = 'Grama Seca';
                else if (item === 'Feno') itemName = 'Feno';
                else if (item === 'Água') itemName = 'Água';
                else if (item === 'Peixe') itemName = 'Peixes';
                else if (item === 'Frango Cru') itemName = 'Frango Cru';
                else if (item === 'Leite') itemName = 'Leite';
                else if (item === 'Farinha') itemName = 'Farinha';
                alert(`${itemName} não podem ser vendidos!`);
                return;
            }
            
            if (barn[item] > 0) {
                if (shop[item]) {
                    shop[item]++;
                } else {
                    shop[item] = 1;
                }
                
                barn[item]--;
                if (barn[item] === 0) delete barn[item];
                
                updateBarnDisplay();
                updateShopDisplay();
            }
        }

        // Remover da quitanda
        function removeFromShop(item) {
            if (shop[item] && shop[item] > 0) {
                addToBarn(item, 1);
                shop[item]--;
                if (shop[item] === 0) delete shop[item];
                updateShopDisplay();
            }
        }

        // Atualizar display da quitanda
        function updateShopDisplay() {
            const container = document.getElementById('shop');
            container.innerHTML = '';
            
            Object.keys(shop).forEach(item => {
                if (shop[item] > 0) {
                    const slot = document.createElement('div');
                    slot.className = 'bg-yellow-100 border-2 border-yellow-300 rounded p-2 h-16 flex flex-col items-center justify-center text-xs cursor-pointer hover:bg-yellow-200';
                    
                    const seed = seeds.find(s => s.name === item);
                    const flower = flowers.find(f => f.name === item);
                    let price = 0;
                    let emoji = '📦';
                    
                    if (seed) {
                        price = seed.sellPrice;
                        emoji = seed.emoji;
                        
                        // Aplicar bônus de estação para plantas
                        if (gameState.currentSeason === 0 && seed.type === 'plant') { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    } else if (flower) {
                        price = 15; // Preço base das flores
                        emoji = flower.emoji;
                        
                        // Aplicar bônus de estação para flores (são plantas)
                        if (gameState.currentSeason === 0) { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    } else if (item === 'Maçã' || item === 'Laranja' || item === 'Banana') {
                        price = 12; // Preço base das frutas
                        if (item === 'Maçã') emoji = '🍎';
                        else if (item === 'Laranja') emoji = '🍊';
                        else if (item === 'Banana') emoji = '🍌';
                        
                        // Aplicar bônus de estação para frutas (são plantas)
                        if (gameState.currentSeason === 0) { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    }
                    
                    // Aplicar outros bônus de estação
                    if (gameState.currentSeason === 2 && item === 'Minhoca') { // Outono - animais +15%
                        price = Math.floor(price * 1.15);
                    }
                    
                    slot.innerHTML = `<div class="text-lg">${emoji}</div><div class="text-xs">${shop[item]}x</div><div class="text-xs">${price}🪙</div>`;
                    slot.onclick = () => removeFromShop(item);
                    container.appendChild(slot);
                }
            });
            
            // Preencher slots vazios até 20
            const currentSlots = Object.keys(shop).length;
            for (let i = currentSlots; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'bg-gray-100 border-2 border-gray-300 rounded p-2 h-16 flex flex-col items-center justify-center text-xs cursor-pointer hover:bg-gray-200';
                container.appendChild(slot);
            }
        }

        // Vender tudo
        function sellAll() {
            let totalEarned = 0;
            
            Object.keys(shop).forEach(item => {
                if (shop[item] > 0) {
                    const seed = seeds.find(s => s.name === item);
                    const flower = flowers.find(f => f.name === item);
                    let price = 0;
                    
                    if (seed) {
                        price = seed.sellPrice;
                        
                        // Aplicar bônus de estação para plantas
                        if (gameState.currentSeason === 0 && seed.type === 'plant') { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    } else if (flower) {
                        price = 15; // Preço base das flores
                        
                        // Aplicar bônus de estação para flores (são plantas)
                        if (gameState.currentSeason === 0) { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    } else if (item === 'Maçã' || item === 'Laranja' || item === 'Banana') {
                        price = 12; // Preço base das frutas
                        
                        // Aplicar bônus de estação para frutas (são plantas)
                        if (gameState.currentSeason === 0) { // Primavera - plantas +10%
                            price = Math.floor(price * 1.1);
                        }
                    }
                    
                    // Aplicar outros bônus de estação
                    if (gameState.currentSeason === 2 && item === 'Minhoca') { // Outono - animais +15%
                        price = Math.floor(price * 1.15);
                    }
                    
                    totalEarned += price * shop[item];
                    delete shop[item];
                }
            });
            
            gameState.coins += totalEarned;
            updateShopDisplay();
            updateUI();
            
            if (totalEarned > 0) {
                alert(`Você vendeu tudo por ${totalEarned} moedas! 💰`);
            }
        }

        // Comprar poço
        function buyWell() {
            if (gameState.hasWell) {
                alert('Você já tem um poço!');
                return;
            }
            
            if (gameState.coins >= 100) {
                gameState.coins -= 100;
                gameState.hasWell = true;
                
                // Mostrar o poço
                document.getElementById('wellContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('wellButton').style.display = 'none';
                
                updateUI();
                alert('🪣 Poço de água comprado! Agora você tem água infinita!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        // Coletar água do poço
        function collectWater() {
            if (gameState.hasWell) {
                gameState.water += 4;
                updateUI();
                
                // Animação de coleta
                document.getElementById('water').classList.add('coin-animation');
                setTimeout(() => {
                    document.getElementById('water').classList.remove('coin-animation');
                }, 500);
            }
        }



        // Sistema de estações
        function startSeasonTimer() {
            setInterval(() => {
                gameState.seasonTimer--;
                
                if (gameState.seasonTimer <= 0) {
                    changeSeason();
                    gameState.seasonTimer = 3600; // Reset para 1 hora
                }
                
                updateSeasonDisplay();
            }, 1000);
        }

        function changeSeason() {
            gameState.currentSeason = (gameState.currentSeason + 1) % 4;
            const season = seasons[gameState.currentSeason];
            
            // Mudar cor de fundo baseado na estação
            const body = document.getElementById('gameBody');
            body.className = `bg-gradient-to-b ${season.color} min-h-screen transition-all duration-1000`;
            
            // Mostrar/esconder campo de flores baseado na estação
            const flowerField = document.getElementById('flowerFieldContainer');
            if (gameState.currentSeason === 0) { // Primavera
                flowerField.classList.remove('hidden');
            } else {
                flowerField.classList.add('hidden');
            }
            
            // Regenerar frutas das árvores a cada mudança de estação
            Object.keys(gameState.forest).forEach(treeName => {
                gameState.forest[treeName].available = 4;
                updateTreeDisplay(treeName);
            });
            
            // Iniciar timers de regeneração de frutas (5 minutos)
            startFruitRegenerationTimers();
            
            alert(`🌍 A estação mudou para ${season.name}! ${getSeasonBonus()}`);
        }

        function getSeasonBonus() {
            switch(gameState.currentSeason) {
                case 0: return 'Plantas valem 10% a mais!';
                case 1: return 'Canteiros dão 2 frutos!';
                case 2: return 'Produtos animais valem 15% a mais!';
                case 3: return 'Produtos fabricados valem 15% a mais!';
                default: return '';
            }
        }

        function updateSeasonDisplay() {
            const season = seasons[gameState.currentSeason];
            document.getElementById('seasonEmoji').textContent = season.emoji;
            document.getElementById('seasonName').textContent = season.name;
            
            const minutes = Math.floor(gameState.seasonTimer / 60);
            const seconds = gameState.seasonTimer % 60;
            document.getElementById('seasonTimer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Sistema de chuva
        function startRainTimer() {
            setInterval(() => {
                gameState.rainTimer--;
                
                if (gameState.rainTimer <= 0) {
                    startRain();
                    gameState.rainTimer = 900; // Reset para 15 minutos
                }
                
                updateRainTimer();
            }, 1000);
        }

        function startRain() {
            gameState.isRaining = true;
            const body = document.getElementById('gameBody');
            const rainOverlay = document.getElementById('rainOverlay');
            
            // Mudar fundo para cinza
            body.className = 'bg-gradient-to-b from-gray-400 to-gray-500 min-h-screen transition-all duration-500';
            rainOverlay.classList.remove('hidden');
            
            // Regar todos os canteiros plantados automaticamente
            plots.forEach((plot, index) => {
                if (plot.stage === 'planted') {
                    plot.stage = 'growing';
                    plot.timer = setTimeout(() => {
                        plots[index].stage = 'ready';
                        updatePlotDisplay(index);
                    }, 30000);
                    updatePlotDisplay(index);
                }
            });
            
            // Adicionar barro ao celeiro
            addToBarn('Barro', 1);
            
            // Parar chuva após 10 segundos
            setTimeout(() => {
                gameState.isRaining = false;
                body.className = 'bg-gradient-to-b from-green-200 to-green-300 min-h-screen transition-all duration-500';
                rainOverlay.classList.add('hidden');
                alert('🌧️ Choveu! Suas plantas foram regadas e você ganhou barro!');
            }, 10000);
        }

        function updateRainTimer() {
            // Timer removido - não há mais display
        }

        // Atualizar UI
        function updateUI() {
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('water').textContent = gameState.water;
            document.getElementById('fertilizer').textContent = gameState.fertilizer;
            updateSeasonDisplay();
            updateHerbCounter();
            updateLogCounter();
            updateGrassCounter();
            
            // Atualizar contador de usos do machado
            if (gameState.hasAxe) {
                document.getElementById('axeUses').textContent = gameState.axeUses;
            }
        }

        // Funções do Fogão
        function addFuelToStove() {
            if (gameState.stove.fuel >= 2) {
                alert('O fogão já está cheio de lenha!');
                return;
            }
            
            if (!barn['Lenha'] || barn['Lenha'] <= 0) {
                alert('Você não tem lenhas no celeiro!');
                return;
            }
            
            barn['Lenha']--;
            if (barn['Lenha'] === 0) delete barn['Lenha'];
            
            gameState.stove.fuel++;
            updateStoveDisplay();
            updateBarnDisplay();
        }

        // Função global para ser chamada pelo onclick
        window.addFuelToStove = addFuelToStove;

        function addIngredientToStove(slotIndex) {
            if (gameState.stove.ingredients[slotIndex] !== null) {
                // Remover ingrediente do slot
                const ingredient = gameState.stove.ingredients[slotIndex];
                addToBarn(ingredient.name, ingredient.quantity);
                gameState.stove.ingredients[slotIndex] = null;
                updateStoveDisplay();
                return;
            }
            
            // Mostrar seletor visual de ingredientes
            showStoveIngredientSelector(slotIndex);
        }

        // Função global para ser chamada pelo onclick
        window.addIngredientToStove = addIngredientToStove;

        function showStoveIngredientSelector(slotIndex) {
            const validIngredients = ['Água', 'Erva', 'Alface', 'Tomate', 'Cenoura', 'Brócolis', 'Abóbora', 'Ovo', 'Carne'];
            const availableIngredients = [];
            
            // Verificar ingredientes no celeiro
            Object.keys(barn).forEach(item => {
                if (barn[item] > 0 && validIngredients.includes(item)) {
                    availableIngredients.push(item);
                }
            });
            
            // Adicionar água se tem poço (conexão automática) - mas só se não estiver já na lista
            if (gameState.hasWell && !availableIngredients.includes('Água')) {
                availableIngredients.push('Água');
            }
            
            if (availableIngredients.length === 0) {
                alert('Você não tem ingredientes válidos no celeiro!');
                return;
            }
            
            // Criar modal de seleção
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const content = document.createElement('div');
            content.className = 'bg-white rounded-lg p-6 max-w-md w-full mx-4';
            content.innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-center">Selecionar Ingrediente</h3>
                <div class="grid grid-cols-3 gap-3 mb-4" id="ingredientGrid"></div>
                <button onclick="document.body.removeChild(this.closest('.fixed'))" class="w-full bg-gray-500 hover:bg-gray-600 text-white p-2 rounded">Cancelar</button>
            `;
            
            modal.appendChild(content);
            
            const grid = content.querySelector('#ingredientGrid');
            availableIngredients.forEach(item => {
                const button = document.createElement('button');
                button.className = 'bg-blue-100 hover:bg-blue-200 border-2 border-blue-300 rounded-lg p-3 text-center transition-all';
                
                let emoji = '📦';
                if (item === 'Água') emoji = '💧';
                else if (item === 'Erva') emoji = '🍃';
                else if (item === 'Alface') emoji = '🥬';
                else if (item === 'Tomate') emoji = '🍅';
                else if (item === 'Cenoura') emoji = '🥕';
                else if (item === 'Brócolis') emoji = '🥦';
                else if (item === 'Abóbora') emoji = '🎃';
                else if (item === 'Ovo') emoji = '🥚';
                else if (item === 'Carne') emoji = '🥩';
                
                button.innerHTML = `
                    <div class="text-2xl mb-1">${emoji}</div>
                    <div class="text-xs font-bold">${item}</div>
                    <div class="text-xs">${item === 'Água' && gameState.hasWell ? 'Ilimitado' : (barn[item] || 0) + ' disponível'}</div>
                `;
                
                button.onclick = () => {
                    let maxQuantity = barn[item] || 0;
                    
                    // Se é água e tem poço, quantidade ilimitada
                    if (item === 'Água' && gameState.hasWell) {
                        maxQuantity = 999;
                    }
                    
                    if (maxQuantity === 0) {
                        alert('Você não tem esse ingrediente!');
                        return;
                    }
                    
                    const quantityStr = prompt(`Quantos ${item}? ${maxQuantity === 999 ? '(Ilimitado - Poço)' : `(Disponível: ${maxQuantity})`}`);
                    
                    if (quantityStr === null) return; // Cancelou
                    
                    const quantity = parseInt(quantityStr);
                    
                    if (isNaN(quantity) || quantity <= 0) {
                        alert('Quantidade inválida!');
                        return;
                    }
                    
                    if (quantity > maxQuantity && maxQuantity !== 999) {
                        alert('Quantidade insuficiente!');
                        return;
                    }
                    
                    // Se não é água do poço, consumir do celeiro
                    if (!(item === 'Água' && gameState.hasWell)) {
                        barn[item] -= quantity;
                        if (barn[item] === 0) delete barn[item];
                    }
                    
                    gameState.stove.ingredients[slotIndex] = {
                        name: item,
                        quantity: quantity
                    };
                    
                    updateStoveDisplay();
                    updateBarnDisplay();
                    document.body.removeChild(modal);
                };
                
                grid.appendChild(button);
            });
            
            document.body.appendChild(modal);
        }

        function startCooking() {
            if (gameState.stove.isCooking) {
                alert('O fogão já está cozinhando!');
                return;
            }
            
            if (gameState.stove.fuel < 2) {
                alert('Você precisa de 2 lenhas para cozinhar!');
                return;
            }
            
            const recipe = checkRecipe();
            if (!recipe) {
                alert('Receita inválida! Verifique os ingredientes.');
                return;
            }
            
            // Consumir lenha
            gameState.stove.fuel -= 2;
            
            // Iniciar cozimento
            gameState.stove.isCooking = true;
            
            const button = document.getElementById('cookButton');
            button.disabled = true;
            
            let timeLeft = recipe.time;
            const statusElement = document.getElementById('cookingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Cozinhando... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar cozimento
                    gameState.stove.isCooking = false;
                    gameState.stove.ingredients = [null, null, null, null];
                    
                    // Adicionar comida ao celeiro
                    addToBarn(recipe.result, 1);
                    
                    button.disabled = false;
                    statusElement.textContent = 'Pronto';
                    
                    updateStoveDisplay();
                    alert(`🍳 ${recipe.result} pronto! Adicionado ao celeiro.`);
                }
            }, 1000);
            
            gameState.stove.cookingTimer = timer;
            updateStoveDisplay();
        }

        // Função global para ser chamada pelo onclick
        window.startCooking = startCooking;

        function checkRecipe() {
            const ingredients = gameState.stove.ingredients.filter(ing => ing !== null);
            
            // Chá: 1 água + 2 ervas
            if (ingredients.length === 2) {
                const water = ingredients.find(ing => ing.name === 'Água' && ing.quantity === 1);
                const herbs = ingredients.find(ing => ing.name === 'Erva' && ing.quantity === 2);
                if (water && herbs) {
                    return {result: 'Chá', time: 10}; // Instantâneo para chá
                }
            }
            
            // Salada: 1 alface + 1 tomate + 1 cenoura
            if (ingredients.length === 3) {
                const lettuce = ingredients.find(ing => ing.name === 'Alface' && ing.quantity === 1);
                const tomato = ingredients.find(ing => ing.name === 'Tomate' && ing.quantity === 1);
                const carrot = ingredients.find(ing => ing.name === 'Cenoura' && ing.quantity === 1);
                if (lettuce && tomato && carrot) {
                    return {result: 'Salada', time: 15};
                }
            }
            
            // Ensopado: 1 brócolis + 1 abóbora + 2 ovos
            if (ingredients.length === 3) {
                const broccoli = ingredients.find(ing => ing.name === 'Brócolis' && ing.quantity === 1);
                const pumpkin = ingredients.find(ing => ing.name === 'Abóbora' && ing.quantity === 1);
                const eggs = ingredients.find(ing => ing.name === 'Ovo' && ing.quantity === 2);
                if (broccoli && pumpkin && eggs) {
                    return {result: 'Ensopado', time: 60};
                }
            }
            
            // Bife: 1 carne
            if (ingredients.length === 1) {
                const meat = ingredients.find(ing => ing.name === 'Carne' && ing.quantity === 1);
                if (meat) {
                    return {result: 'Bife', time: 30};
                }
            }
            
            return null;
        }

        function updateStoveDisplay() {
            // Atualizar slot de lenha
            const fuelSlot = document.getElementById('stoveFuelSlot');
            const fuelCount = document.getElementById('stoveFuelCount');
            fuelCount.textContent = `${gameState.stove.fuel}/2`;
            
            if (gameState.stove.fuel > 0) {
                fuelSlot.className = 'bg-orange-200 border-2 border-orange-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-300';
                fuelSlot.innerHTML = `
                    <div class="text-2xl mb-1">🪵</div>
                    <div class="text-xs text-gray-500">Lenha</div>
                    <div class="text-xs" id="stoveFuelCount">${gameState.stove.fuel}/2</div>
                `;
            } else {
                fuelSlot.className = 'bg-orange-100 border-2 border-orange-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200';
                fuelSlot.innerHTML = `
                    <div class="text-xs text-gray-500">Lenha</div>
                    <div class="text-xs" id="stoveFuelCount">0/2</div>
                `;
            }
            
            // Atualizar slots de ingredientes
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`stoveSlot${i}`);
                const ingredient = gameState.stove.ingredients[i];
                
                if (ingredient) {
                    let emoji = '📦';
                    if (ingredient.name === 'Água') emoji = '💧';
                    else if (ingredient.name === 'Erva') emoji = '🍃';
                    else if (ingredient.name === 'Alface') emoji = '🥬';
                    else if (ingredient.name === 'Tomate') emoji = '🍅';
                    else if (ingredient.name === 'Cenoura') emoji = '🥕';
                    else if (ingredient.name === 'Brócolis') emoji = '🥦';
                    else if (ingredient.name === 'Abóbora') emoji = '🎃';
                    else if (ingredient.name === 'Ovo') emoji = '🥚';
                    else if (ingredient.name === 'Carne') emoji = '🥩';
                    
                    slot.innerHTML = `<div class="text-lg">${emoji}</div><div class="text-xs">${ingredient.quantity}</div>`;
                    slot.className = 'bg-yellow-100 border-2 border-yellow-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-200';
                } else {
                    slot.innerHTML = '<div class="text-xs text-gray-500">Vazio</div>';
                    slot.className = 'bg-gray-100 border-2 border-gray-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200';
                }
            }
            
            // Atualizar botão de cozinhar
            const button = document.getElementById('cookButton');
            const recipe = checkRecipe();
            
            if (gameState.stove.isCooking) {
                button.disabled = true;
            } else if (gameState.stove.fuel >= 2 && recipe) {
                button.disabled = false;
                button.textContent = `🍳 Fazer ${recipe.result}`;
            } else {
                button.disabled = true;
                button.textContent = '🍳 Cozinhar';
            }
        }

        // Funções do Forno
        function addFuelToOven() {
            if (gameState.oven.fuel >= 3) {
                alert('O forno já está cheio de lenha!');
                return;
            }
            
            if (!barn['Lenha'] || barn['Lenha'] <= 0) {
                alert('Você não tem lenhas no celeiro!');
                return;
            }
            
            barn['Lenha']--;
            if (barn['Lenha'] === 0) delete barn['Lenha'];
            
            gameState.oven.fuel++;
            updateOvenDisplay();
            updateBarnDisplay();
        }

        // Função global para ser chamada pelo onclick
        window.addFuelToOven = addFuelToOven;

        function addIngredientToOven(slotIndex) {
            if (gameState.oven.ingredients[slotIndex] !== null) {
                // Remover ingrediente do slot
                const ingredient = gameState.oven.ingredients[slotIndex];
                addToBarn(ingredient.name, ingredient.quantity);
                gameState.oven.ingredients[slotIndex] = null;
                updateOvenDisplay();
                return;
            }
            
            // Mostrar lista de ingredientes disponíveis
            showOvenIngredientSelector(slotIndex);
        }

        // Função global para ser chamada pelo onclick
        window.addIngredientToOven = addIngredientToOven;

        function showOvenIngredientSelector(slotIndex) {
            const validIngredients = ['Peixe', 'Frango Cru', 'Ovo', 'Leite', 'Farinha'];
            const availableIngredients = [];
            
            // Verificar ingredientes no celeiro
            Object.keys(barn).forEach(item => {
                if (barn[item] > 0 && validIngredients.includes(item)) {
                    availableIngredients.push(item);
                }
            });
            
            if (availableIngredients.length === 0) {
                alert('Você não tem ingredientes válidos para o forno no celeiro!');
                return;
            }
            
            // Criar modal de seleção
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const content = document.createElement('div');
            content.className = 'bg-white rounded-lg p-6 max-w-md w-full mx-4';
            content.innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-center">Selecionar Ingrediente</h3>
                <div class="grid grid-cols-3 gap-3 mb-4" id="ovenIngredientGrid"></div>
                <button onclick="document.body.removeChild(this.closest('.fixed'))" class="w-full bg-gray-500 hover:bg-gray-600 text-white p-2 rounded">Cancelar</button>
            `;
            
            modal.appendChild(content);
            
            const grid = content.querySelector('#ovenIngredientGrid');
            availableIngredients.forEach(item => {
                const button = document.createElement('button');
                button.className = 'bg-orange-100 hover:bg-orange-200 border-2 border-orange-300 rounded-lg p-3 text-center transition-all';
                
                let emoji = '📦';
                if (item === 'Peixe') emoji = '🐟';
                else if (item === 'Frango Cru') emoji = '🐔';
                else if (item === 'Ovo') emoji = '🥚';
                else if (item === 'Leite') emoji = '🥛';
                else if (item === 'Farinha') emoji = '🌾';
                
                button.innerHTML = `
                    <div class="text-2xl mb-1">${emoji}</div>
                    <div class="text-xs font-bold">${item}</div>
                    <div class="text-xs">${item === 'Água' && gameState.hasWell ? 'Ilimitado' : (barn[item] || 0) + ' disponível'}</div>
                `;
                
                button.onclick = () => {
                    const quantity = parseInt(prompt(`Quantos ${item}? (Disponível: ${barn[item]})`));
                    
                    if (quantity > 0 && quantity <= barn[item]) {
                        barn[item] -= quantity;
                        if (barn[item] === 0) delete barn[item];
                        
                        gameState.oven.ingredients[slotIndex] = {
                            name: item,
                            quantity: quantity
                        };
                        
                        updateOvenDisplay();
                        updateBarnDisplay();
                        document.body.removeChild(modal);
                    } else if (quantity > barn[item]) {
                        alert('Quantidade insuficiente!');
                    }
                };
                
                grid.appendChild(button);
            });
            
            document.body.appendChild(modal);
        }

        function startBaking() {
            if (gameState.oven.isBaking) {
                alert('O forno já está assando!');
                return;
            }
            
            if (gameState.oven.fuel < 3) {
                alert('Você precisa de 3 lenhas para assar!');
                return;
            }
            
            const recipe = checkOvenRecipe();
            if (!recipe) {
                alert('Receita inválida! Verifique os ingredientes.');
                return;
            }
            
            // Consumir lenha
            gameState.oven.fuel -= 3;
            
            // Iniciar cozimento
            gameState.oven.isBaking = true;
            
            const button = document.getElementById('bakeButton');
            button.disabled = true;
            
            let timeLeft = recipe.time;
            const statusElement = document.getElementById('bakingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Assando... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar cozimento
                    gameState.oven.isBaking = false;
                    gameState.oven.ingredients = [null, null, null, null];
                    
                    // Adicionar comida ao celeiro
                    addToBarn(recipe.result, 1);
                    
                    button.disabled = false;
                    statusElement.textContent = 'Pronto';
                    
                    updateOvenDisplay();
                    alert(`🔥 ${recipe.result} pronto! Adicionado ao celeiro.`);
                }
            }, 1000);
            
            gameState.oven.bakingTimer = timer;
            updateOvenDisplay();
        }

        // Função global para ser chamada pelo onclick
        window.startBaking = startBaking;

        function checkOvenRecipe() {
            const ingredients = gameState.oven.ingredients.filter(ing => ing !== null);
            
            // Peixe assado: 1 peixe
            if (ingredients.length === 1) {
                const fish = ingredients.find(ing => ing.name === 'Peixe' && ing.quantity === 1);
                if (fish) {
                    return {result: 'Peixe Assado', time: 30};
                }
            }
            
            // Frango assado: 1 frango cru
            if (ingredients.length === 1) {
                const chicken = ingredients.find(ing => ing.name === 'Frango Cru' && ing.quantity === 1);
                if (chicken) {
                    return {result: 'Frango Assado', time: 60};
                }
            }
            
            // Pão: 1 ovo + 1 leite + 1 farinha
            if (ingredients.length === 3) {
                const egg = ingredients.find(ing => ing.name === 'Ovo' && ing.quantity === 1);
                const milk = ingredients.find(ing => ing.name === 'Leite' && ing.quantity === 1);
                const flour = ingredients.find(ing => ing.name === 'Farinha' && ing.quantity === 1);
                if (egg && milk && flour) {
                    return {result: 'Pão', time: 60};
                }
            }
            
            return null;
        }

        function updateOvenDisplay() {
            // Atualizar slot de lenha
            const fuelSlot = document.getElementById('ovenFuelSlot');
            const fuelCount = document.getElementById('ovenFuelCount');
            fuelCount.textContent = `${gameState.oven.fuel}/3`;
            
            if (gameState.oven.fuel > 0) {
                fuelSlot.className = 'bg-orange-200 border-2 border-orange-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-300';
                fuelSlot.innerHTML = `
                    <div class="text-2xl mb-1">🪵</div>
                    <div class="text-xs text-gray-500">Lenha</div>
                    <div class="text-xs" id="ovenFuelCount">${gameState.oven.fuel}/3</div>
                `;
            } else {
                fuelSlot.className = 'bg-orange-100 border-2 border-orange-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200';
                fuelSlot.innerHTML = `
                    <div class="text-xs text-gray-500">Lenha</div>
                    <div class="text-xs" id="ovenFuelCount">0/3</div>
                `;
            }
            
            // Atualizar slots de ingredientes
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`ovenSlot${i}`);
                const ingredient = gameState.oven.ingredients[i];
                
                if (ingredient) {
                    let emoji = '📦';
                    if (ingredient.name === 'Peixe') emoji = '🐟';
                    else if (ingredient.name === 'Frango Cru') emoji = '🐔';
                    else if (ingredient.name === 'Ovo') emoji = '🥚';
                    else if (ingredient.name === 'Leite') emoji = '🥛';
                    else if (ingredient.name === 'Farinha') emoji = '🌾';
                    
                    slot.innerHTML = `<div class="text-lg">${emoji}</div><div class="text-xs">${ingredient.quantity}</div>`;
                    slot.className = 'bg-yellow-100 border-2 border-yellow-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-200';
                } else {
                    slot.innerHTML = '<div class="text-xs text-gray-500">Vazio</div>';
                    slot.className = 'bg-gray-100 border-2 border-gray-300 rounded-lg p-3 w-16 h-16 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200';
                }
            }
            
            // Atualizar botão de assar
            const button = document.getElementById('bakeButton');
            const recipe = checkOvenRecipe();
            
            if (gameState.oven.isBaking) {
                button.disabled = true;
            } else if (gameState.oven.fuel >= 3 && recipe) {
                button.disabled = false;
                button.textContent = `🔥 Fazer ${recipe.result}`;
            } else {
                button.disabled = true;
                button.textContent = '🔥 Assar';
            }
        }

        // Funções do Fazendeiro
        function consumeEnergy(amount = 1) {
            if (gameState.farmer.isResting) {
                alert('Você está descansando e não pode trabalhar!');
                return false;
            }
            
            // Se está doente, consome energia mais rápido
            const energyCost = gameState.farmer.isSick ? amount * 2 : amount;
            
            if (gameState.farmer.energy >= energyCost) {
                gameState.farmer.energy -= energyCost;
                updateFarmerDisplay();
                
                // Verificar se morreu (só morre se estiver doente E sem energia)
                if (gameState.farmer.energy <= 0 && gameState.farmer.isSick) {
                    gameOver();
                    return false;
                } else if (gameState.farmer.energy <= 0 && !gameState.farmer.isSick) {
                    // Se não está doente, apenas não pode trabalhar
                    alert('Energia esgotada! Descanse ou coma algo para recuperar energia.');
                    return false;
                }
                
                return true;
            } else {
                alert('Energia insuficiente! Descanse ou coma algo.');
                return false;
            }
        }

        function restFarmer() {
            if (gameState.farmer.isResting) {
                alert('Você já está descansando!');
                return;
            }
            
            gameState.farmer.isResting = true;
            const button = document.getElementById('restButton');
            button.disabled = true;
            
            const initialEnergy = gameState.farmer.energy;
            const energyToRecover = Math.floor(gameState.farmer.maxEnergy * 0.4); // 40% da energia máxima
            const finalEnergy = Math.min(initialEnergy + energyToRecover, gameState.farmer.maxEnergy);
            
            let timeLeft = 300; // 5 minutos
            const timer = setInterval(() => {
                timeLeft--;
                
                // Aumentar energia gradualmente
                const progress = (300 - timeLeft) / 300; // Progresso de 0 a 1
                const currentEnergyGain = Math.floor(energyToRecover * progress);
                gameState.farmer.energy = Math.min(initialEnergy + currentEnergyGain, gameState.farmer.maxEnergy);
                
                button.textContent = `😴 Descansando... ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2, '0')}`;
                updateFarmerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    gameState.farmer.energy = finalEnergy;
                    gameState.farmer.isResting = false;
                    button.disabled = false;
                    button.textContent = '😴 Descansar (5min)';
                    updateFarmerDisplay();
                    alert(`💤 Você descansou e recuperou ${energyToRecover} pontos de energia!`);
                }
            }, 1000);
            
            gameState.farmer.restTimer = timer;
        }

        function showEatMenu() {
            const foods = ['Chá', 'Salada', 'Ensopado', 'Bife', 'Peixe Assado', 'Frango Assado', 'Pão'];
            const availableFoods = [];
            
            foods.forEach(food => {
                if (barn[food] && barn[food] > 0) {
                    availableFoods.push(food);
                }
            });
            
            if (availableFoods.length === 0) {
                alert('Você não tem comida no celeiro!');
                return;
            }
            
            // Criar modal de seleção
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const content = document.createElement('div');
            content.className = 'bg-white rounded-lg p-6 max-w-md w-full mx-4';
            content.innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-center">O que você quer comer?</h3>
                <div class="grid grid-cols-2 gap-3 mb-4" id="foodGrid"></div>
                <button onclick="document.body.removeChild(this.closest('.fixed'))" class="w-full bg-gray-500 hover:bg-gray-600 text-white p-2 rounded">Cancelar</button>
            `;
            
            modal.appendChild(content);
            
            const grid = content.querySelector('#foodGrid');
            availableFoods.forEach(food => {
                const button = document.createElement('button');
                button.className = 'bg-green-100 hover:bg-green-200 border-2 border-green-300 rounded-lg p-3 text-center transition-all';
                
                let emoji = '🍽️';
                let effect = '';
                if (food === 'Chá') { emoji = '🍵'; effect = 'Cura doença'; }
                else if (food === 'Salada') { emoji = '🥗'; effect = '+30% energia'; }
                else if (food === 'Ensopado') { emoji = '🍲'; effect = '+40% energia'; }
                else if (food === 'Bife') { emoji = '🥩'; effect = '+100% energia'; }
                else if (food === 'Peixe Assado') { emoji = '🍤'; effect = '+50% energia'; }
                else if (food === 'Frango Assado') { emoji = '🍗'; effect = '+70% energia'; }
                else if (food === 'Pão') { emoji = '🍞'; effect = '+60% energia'; }
                
                button.innerHTML = `
                    <div class="text-2xl mb-1">${emoji}</div>
                    <div class="text-xs font-bold">${food}</div>
                    <div class="text-xs">${effect}</div>
                    <div class="text-xs">Tem: ${barn[food]}</div>
                `;
                
                button.onclick = () => {
                    eatFood(food);
                    document.body.removeChild(modal);
                };
                
                grid.appendChild(button);
            });
            
            document.body.appendChild(modal);
        }

        function eatFood(food) {
            if (!barn[food] || barn[food] <= 0) {
                alert('Você não tem essa comida!');
                return;
            }
            
            // Verificar se pode comer chá
            if (food === 'Chá' && !gameState.farmer.isSick) {
                alert('Você só pode tomar chá quando estiver doente!');
                return;
            }
            
            barn[food]--;
            if (barn[food] === 0) delete barn[food];
            
            // Aplicar efeitos
            if (food === 'Chá') {
                gameState.farmer.isSick = false;
                if (gameState.farmer.sickTimer) {
                    clearInterval(gameState.farmer.sickTimer);
                    gameState.farmer.sickTimer = null;
                }
                alert('🍵 Você tomou chá e se curou instantaneamente!');
            } else {
                let energyBonus = 0;
                let duration = 0;
                
                if (food === 'Salada') { energyBonus = 30; duration = 15; }
                else if (food === 'Ensopado') { energyBonus = 40; duration = 60; }
                else if (food === 'Bife') { energyBonus = 100; duration = 30; }
                else if (food === 'Peixe Assado') { energyBonus = 50; duration = 30; }
                else if (food === 'Frango Assado') { energyBonus = 70; duration = 60; }
                else if (food === 'Pão') { energyBonus = 60; duration = 60; }
                
                // Aplicar bônus de energia temporário
                gameState.farmer.energyBoost = energyBonus;
                
                if (gameState.farmer.boostTimer) {
                    clearTimeout(gameState.farmer.boostTimer);
                }
                
                gameState.farmer.boostTimer = setTimeout(() => {
                    gameState.farmer.energyBoost = 0;
                    updateFarmerDisplay();
                    alert('⏰ O efeito da comida acabou!');
                }, duration * 1000);
                
                alert(`🍽️ Você comeu ${food}! +${energyBonus}% de energia por ${duration}s!`);
            }
            
            updateFarmerDisplay();
            updateBarnDisplay();
        }

        function makeFarmerSick() {
            if (gameState.farmer.isSick) return;
            
            gameState.farmer.isSick = true;
            alert('🤒 Você ficou doente! Sua energia diminui mais rápido. Tome chá para se curar!');
            updateFarmerDisplay();
        }

        function updateFarmerDisplay() {
            const energyText = document.getElementById('energyText');
            const energyBar = document.getElementById('energyBar');
            const farmerStatus = document.getElementById('farmerStatus');
            const farmerAvatar = document.getElementById('farmerAvatar');
            
            // Calcular energia efetiva com bônus
            const effectiveMaxEnergy = gameState.farmer.maxEnergy + (gameState.farmer.maxEnergy * gameState.farmer.energyBoost / 100);
            const energyPercentage = (gameState.farmer.energy / gameState.farmer.maxEnergy) * 100;
            
            energyText.textContent = `${gameState.farmer.energy}/${gameState.farmer.maxEnergy}${gameState.farmer.energyBoost > 0 ? ` (+${gameState.farmer.energyBoost}%)` : ''}`;
            energyBar.style.width = `${Math.min(energyPercentage, 100)}%`;
            
            // Mudar cor da barra baseado na energia
            if (energyPercentage > 60) {
                energyBar.className = 'bg-green-500 h-4 rounded-full transition-all duration-300';
            } else if (energyPercentage > 30) {
                energyBar.className = 'bg-yellow-500 h-4 rounded-full transition-all duration-300';
            } else {
                energyBar.className = 'bg-red-500 h-4 rounded-full transition-all duration-300';
            }
            
            // Atualizar status e avatar
            if (gameState.farmer.isSick) {
                farmerStatus.textContent = 'Doente 🤒';
                farmerAvatar.textContent = '🤒';
            } else if (gameState.farmer.isResting) {
                farmerStatus.textContent = 'Descansando 😴';
                farmerAvatar.textContent = '😴';
            } else if (gameState.farmer.energyBoost > 0) {
                farmerStatus.textContent = 'Energizado ⚡';
                farmerAvatar.textContent = '👨‍🌾';
            } else {
                farmerStatus.textContent = 'Saudável';
                farmerAvatar.textContent = '👨‍🌾';
            }
        }

        function gameOver() {
            alert('💀 Você morreu de exaustão! O jogo será reiniciado...');
            
            // Reiniciar o jogo
            setTimeout(() => {
                location.reload();
            }, 2000);
        }

        // Adicionar consumo de energia às ações existentes
        const originalFertilizePlot = fertilizePlot;
        fertilizePlot = function(plotIndex) {
            if (consumeEnergy(1)) {
                originalFertilizePlot(plotIndex);
            }
        };

        const originalPlantSeed = plantSeed;
        plantSeed = function(plotIndex) {
            if (consumeEnergy(1)) {
                originalPlantSeed(plotIndex);
            }
        };

        const originalWaterPlot = waterPlot;
        waterPlot = function(plotIndex) {
            if (consumeEnergy(1)) {
                originalWaterPlot(plotIndex);
            }
        };

        const originalHarvestPlot = harvestPlot;
        harvestPlot = function(plotIndex) {
            if (consumeEnergy(1)) {
                originalHarvestPlot(plotIndex);
            }
        };

        const originalCollectFlower = collectFlower;
        collectFlower = function(flowerType) {
            if (consumeEnergy(1)) {
                originalCollectFlower(flowerType);
            }
        };

        const originalCollectGrass = collectGrass;
        collectGrass = function(index) {
            if (consumeEnergy(1)) {
                originalCollectGrass(index);
            }
        };

        const originalInteractWithTree = interactWithTree;
        interactWithTree = function(tree) {
            if (consumeEnergy(1)) {
                originalInteractWithTree(tree);
            }
        };

        const originalCutLumber = cutLumber;
        cutLumber = function() {
            if (consumeEnergy(2)) { // Cortar lenha cansa mais
                originalCutLumber();
            }
        };

        // Sistema de doença aleatória
        function startSicknessSystem() {
            setInterval(() => {
                // 1% de chance a cada minuto de ficar doente
                if (Math.random() < 0.01 && !gameState.farmer.isSick) {
                    makeFarmerSick();
                }
            }, 60000); // A cada minuto
        }

        // Funções do Secador de Grama
        function addGrassToDryer() {
            if (gameState.dryer.grassSlot >= 8) {
                alert('O secador já está cheio!');
                return;
            }
            
            if (!barn['Grama'] || barn['Grama'] <= 0) {
                alert('Você não tem grama no celeiro!');
                return;
            }
            
            // Adicionar uma grama por vez ao clicar
            const maxCanAdd = Math.min(1, barn['Grama'], 8 - gameState.dryer.grassSlot);
            
            if (maxCanAdd <= 0) {
                alert('Não é possível adicionar mais grama!');
                return;
            }
            
            barn['Grama'] -= maxCanAdd;
            if (barn['Grama'] === 0) delete barn['Grama'];
            
            gameState.dryer.grassSlot += maxCanAdd;
            
            updateDryerDisplay();
            updateBarnDisplay();
        }

        function startDrying() {
            if (gameState.dryer.isDrying) {
                alert('O secador já está funcionando!');
                return;
            }
            
            if (gameState.dryer.grassSlot === 0) {
                alert('Adicione grama ao secador primeiro!');
                return;
            }
            
            gameState.dryer.isDrying = true;
            
            const button = document.getElementById('dryButton');
            button.disabled = true;
            
            let timeLeft = 30;
            const statusElement = document.getElementById('dryingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Secando... ${timeLeft}s`;
                button.textContent = `☀️ Secando... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar secagem
                    const driedAmount = gameState.dryer.grassSlot;
                    addToBarn('Grama Seca', driedAmount);
                    
                    gameState.dryer.grassSlot = 0;
                    gameState.dryer.isDrying = false;
                    
                    button.disabled = false;
                    button.textContent = '☀️ Secar (30s)';
                    statusElement.textContent = 'Pronto';
                    
                    updateDryerDisplay();
                    alert(`☀️ ${driedAmount} gramas secas prontas! Adicionadas ao celeiro.`);
                }
            }, 1000);
            
            gameState.dryer.dryingTimer = timer;
        }

        function updateDryerDisplay() {
            const slot = document.getElementById('dryerSlot');
            const countElement = document.getElementById('dryerGrassCount');
            const button = document.getElementById('dryButton');
            
            countElement.textContent = `${gameState.dryer.grassSlot}/8`;
            
            if (gameState.dryer.grassSlot > 0) {
                slot.innerHTML = `
                    <div class="text-2xl mb-1">🌿</div>
                    <div class="text-xs">Grama</div>
                    <div class="text-xs" id="dryerGrassCount">${gameState.dryer.grassSlot}/8</div>
                `;
                slot.className = 'bg-green-200 border-2 border-green-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-green-300';
                button.disabled = gameState.dryer.isDrying ? true : false;
            } else {
                slot.innerHTML = `
                    <div class="text-xs text-gray-500">Vazio</div>
                    <div class="text-xs" id="dryerGrassCount">0/8</div>
                `;
                slot.className = 'bg-green-100 border-2 border-green-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-green-200';
                button.disabled = true;
            }
        }

        // Funções do Fazer Feno
        function addDriedGrassToHayMaker() {
            if (gameState.hayMaker.driedGrassSlot >= 4) {
                alert('O fazedor de feno já está cheio!');
                return;
            }
            
            if (!barn['Grama Seca'] || barn['Grama Seca'] <= 0) {
                alert('Você não tem grama seca no celeiro!');
                return;
            }
            
            // Adicionar uma grama seca por vez ao clicar
            const maxCanAdd = Math.min(1, barn['Grama Seca'], 4 - gameState.hayMaker.driedGrassSlot);
            
            if (maxCanAdd <= 0) {
                alert('Não é possível adicionar mais grama seca!');
                return;
            }
            
            barn['Grama Seca'] -= maxCanAdd;
            if (barn['Grama Seca'] === 0) delete barn['Grama Seca'];
            
            gameState.hayMaker.driedGrassSlot += maxCanAdd;
            
            updateHayMakerDisplay();
            updateBarnDisplay();
        }

        function startMakingHay() {
            if (gameState.hayMaker.isMaking) {
                alert('O fazedor de feno já está funcionando!');
                return;
            }
            
            if (gameState.hayMaker.driedGrassSlot === 0) {
                alert('Adicione grama seca ao fazedor de feno primeiro!');
                return;
            }
            
            gameState.hayMaker.isMaking = true;
            
            const button = document.getElementById('hayButton');
            button.disabled = true;
            
            let timeLeft = 10;
            const statusElement = document.getElementById('hayMakingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Fazendo... ${timeLeft}s`;
                button.textContent = `🌾 Fazendo... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar produção de feno
                    const hayAmount = gameState.hayMaker.driedGrassSlot;
                    addToBarn('Feno', hayAmount);
                    
                    gameState.hayMaker.driedGrassSlot = 0;
                    gameState.hayMaker.isMaking = false;
                    
                    button.disabled = false;
                    button.textContent = '🌾 Fazer (10s)';
                    statusElement.textContent = 'Pronto';
                    
                    updateHayMakerDisplay();
                    alert(`🌾 ${hayAmount} fenos prontos! Adicionados ao celeiro.`);
                }
            }, 1000);
            
            gameState.hayMaker.makingTimer = timer;
        }

        function updateHayMakerDisplay() {
            const slot = document.getElementById('hayMakerSlot');
            const countElement = document.getElementById('hayMakerGrassCount');
            const button = document.getElementById('hayButton');
            
            countElement.textContent = `${gameState.hayMaker.driedGrassSlot}/4`;
            
            if (gameState.hayMaker.driedGrassSlot > 0) {
                slot.innerHTML = `
                    <div class="text-2xl mb-1">🌾</div>
                    <div class="text-xs">Grama Seca</div>
                    <div class="text-xs" id="hayMakerGrassCount">${gameState.hayMaker.driedGrassSlot}/4</div>
                `;
                slot.className = 'bg-orange-200 border-2 border-orange-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-300';
                button.disabled = gameState.hayMaker.isMaking ? true : false;
            } else {
                slot.innerHTML = `
                    <div class="text-xs text-gray-500">Vazio</div>
                    <div class="text-xs" id="hayMakerGrassCount">0/4</div>
                `;
                slot.className = 'bg-orange-100 border-2 border-orange-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-orange-200';
                button.disabled = true;
            }
        }

        // Adicionar emojis para novos itens no celeiro
        function updateBarnDisplay() {
            const container = document.getElementById('barn');
            container.innerHTML = '';
            
            Object.keys(barn).forEach(item => {
                if (barn[item] > 0) {
                    const slot = document.createElement('div');
                    slot.className = 'bg-gray-100 border border-gray-300 rounded p-1 text-center cursor-pointer hover:bg-gray-200';
                    
                    let emoji = '📦';
                    const seed = seeds.find(s => s.name === item);
                    const flower = flowers.find(f => f.name === item);
                    
                    if (seed) emoji = seed.emoji;
                    else if (flower) emoji = flower.emoji;
                    else if (item === 'Minhoca') emoji = '🪱';
                    else if (item === 'Barro') emoji = '🟤';
                    else if (item === 'Erva') emoji = '🍃';
                    else if (item === 'Tronco') emoji = '🪵';
                    else if (item === 'Galho') emoji = '🌲';
                    else if (item === 'Lenha') emoji = '🪵';
                    else if (item === 'Grama') emoji = '🌿';
                    else if (item === 'Grama Seca') emoji = '🌾';
                    else if (item === 'Feno') emoji = '🌾';
                    else if (item === 'Flor') emoji = '🌸';
                    else if (item === 'Maçã') emoji = '🍎';
                    else if (item === 'Laranja') emoji = '🍊';
                    else if (item === 'Banana') emoji = '🍌';
                    else if (item === 'Água') emoji = '💧';
                    else if (item === 'Ovo') emoji = '🥚';
                    else if (item === 'Carne') emoji = '🥩';
                    else if (item === 'Peixe') emoji = '🐟';
                    else if (item === 'Frango Cru') emoji = '🐔';
                    else if (item === 'Leite') emoji = '🥛';
                    else if (item === 'Farinha') emoji = '🌾';
                    else if (item === 'Chá') emoji = '🍵';
                    else if (item === 'Salada') emoji = '🥗';
                    else if (item === 'Ensopado') emoji = '🍲';
                    else if (item === 'Bife') emoji = '🥩';
                    else if (item === 'Peixe Assado') emoji = '🍤';
                    else if (item === 'Frango Assado') emoji = '🍗';
                    else if (item === 'Pão') emoji = '🍞';
                    else if (item === 'Esterco') emoji = '💩';
                    else if (item === 'Queijo') emoji = '🧀';
                    
                    slot.innerHTML = `<div class="text-lg">${emoji}</div><div class="text-xs">${barn[item]}</div>`;
                    slot.onclick = () => moveToShop(item);
                    container.appendChild(slot);
                }
            });
        }

        // Funções do Pasto das Vacas
        function createCowPasture() {
            const container = document.getElementById('cowPasture');
            container.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const cowSlot = document.createElement('div');
                cowSlot.className = 'bg-green-100 border-2 border-green-300 rounded-lg p-4 text-center';
                cowSlot.id = `cowSlot-${i}`;
                
                cowSlot.innerHTML = `
                    <div class="bg-gray-100 border-2 border-gray-300 rounded-lg p-6 mb-2 cursor-pointer hover:bg-gray-200" onclick="placeCow(${i})">
                        <div class="text-4xl mb-2" id="cowIcon-${i}">🐄</div>
                        <div class="text-sm font-bold" id="cowStatus-${i}">Vazio</div>
                    </div>
                    <div class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-2 cursor-pointer hover:bg-yellow-200" onclick="addHayToCow(${i})">
                        <div class="text-lg mb-1" id="hayIcon-${i}">🌾</div>
                        <div class="text-xs" id="hayCount-${i}">Feno: 0</div>
                    </div>
                    <div class="mt-2 flex gap-1">
                        <button onclick="collectMilk(${i})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs disabled:bg-gray-400" id="milkButton-${i}" disabled>
                            🥛 Coletar
                        </button>
                        <button onclick="collectManure(${i})" class="bg-brown-500 hover:bg-brown-600 text-white px-2 py-1 rounded text-xs disabled:bg-gray-400" id="manureButton-${i}" disabled style="background-color: #8B4513;">
                            💩 Coletar
                        </button>
                    </div>
                `;
                
                container.appendChild(cowSlot);
            }
        }

        function buyCowPasture() {
            if (gameState.hasCowPasture) {
                alert('Você já tem um pasto das vacas!');
                return;
            }
            
            if (gameState.coins >= 500) {
                gameState.coins -= 500;
                gameState.hasCowPasture = true;
                
                // Mostrar o pasto das vacas
                document.getElementById('cowPastureContainer').classList.remove('hidden');
                
                // Mostrar botões de compra de vacas
                document.getElementById('cowButton').style.display = 'block';
                
                // Esconder o botão de compra do pasto
                document.getElementById('cowPastureButton').style.display = 'none';
                
                updateUI();
                alert('🐄 Pasto das vacas comprado! Agora você pode comprar vacas no mercadinho!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        function buyCow() {
            // Verificar se há slot vazio
            let emptySlot = -1;
            for (let i = 0; i < 4; i++) {
                if (gameState.cowPasture.cows[i] === null) {
                    emptySlot = i;
                    break;
                }
            }
            
            if (emptySlot === -1) {
                alert('Todos os slots do pasto estão ocupados!');
                return;
            }
            
            if (gameState.coins >= 100) {
                gameState.coins -= 100;
                gameState.cowPasture.cows[emptySlot] = 'Vaca';
                
                updateCowDisplay(emptySlot);
                updateUI();
                alert(`🐄 Vaca comprada e colocada no slot ${emptySlot + 1}!`);
            } else {
                alert('Moedas insuficientes!');
            }
        }

        function placeCow(slotIndex) {
            if (gameState.cowPasture.cows[slotIndex] !== null) {
                // Remover vaca (vender de volta por 50 moedas)
                if (confirm('Vender esta vaca por 50 moedas?')) {
                    gameState.coins += 50;
                    gameState.cowPasture.cows[slotIndex] = null;
                    
                    // Resetar estado da vaca
                    const cowState = gameState.cowPasture.cowStates[slotIndex];
                    cowState.hasHay = false;
                    cowState.hayAmount = 0;
                    cowState.isEating = false;
                    cowState.isProducing = false;
                    cowState.isResting = false;
                    cowState.milk = 0;
                    cowState.manure = 0;
                    
                    if (cowState.restTimer) {
                        clearTimeout(cowState.restTimer);
                        cowState.restTimer = null;
                    }
                    
                    updateCowDisplay(slotIndex);
                    updateUI();
                }
            }
        }

        function addHayToCow(slotIndex) {
            if (gameState.cowPasture.cows[slotIndex] === null) {
                alert('Não há vaca neste slot!');
                return;
            }
            
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            if (cowState.isResting) {
                alert('Esta vaca está descansando!');
                return;
            }
            
            if (cowState.hasHay) {
                alert('Esta vaca já tem feno!');
                return;
            }
            
            if (!barn['Feno'] || barn['Feno'] <= 0) {
                alert('Você não tem feno no celeiro!');
                return;
            }
            
            barn['Feno']--;
            if (barn['Feno'] === 0) delete barn['Feno'];
            
            cowState.hasHay = true;
            cowState.hayAmount = 1;
            
            // Iniciar processo de comer automaticamente
            startEating(slotIndex);
            
            updateCowDisplay(slotIndex);
            updateBarnDisplay();
        }

        function startEating(slotIndex) {
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            if (!cowState.hasHay) return;
            
            cowState.isEating = true;
            
            let timeLeft = 15;
            const timer = setInterval(() => {
                timeLeft--;
                updateCowStatus(slotIndex, `Comendo... ${timeLeft}s`);
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    cowState.isEating = false;
                    cowState.hasHay = false;
                    cowState.hayAmount = 0;
                    
                    // Iniciar produção de leite
                    startMilkProduction(slotIndex);
                }
            }, 1000);
        }

        function startMilkProduction(slotIndex) {
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            cowState.isProducing = true;
            
            let timeLeft = 10;
            const timer = setInterval(() => {
                timeLeft--;
                updateCowStatus(slotIndex, `Produzindo... ${timeLeft}s`);
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    cowState.isProducing = false;
                    
                    // Produzir leite e esterco
                    cowState.milk = 3;
                    cowState.manure = 1;
                    
                    updateCowStatus(slotIndex, 'Pronto para coleta!');
                    updateCowDisplay(slotIndex);
                }
            }, 1000);
        }

        function collectMilk(slotIndex) {
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            if (cowState.milk <= 0) {
                alert('Esta vaca não tem leite para coletar!');
                return;
            }
            
            addToBarn('Leite', cowState.milk);
            cowState.milk = 0;
            
            // Verificar se também coletou esterco para iniciar descanso
            if (cowState.manure === 0) {
                startCowRest(slotIndex);
            }
            
            updateCowDisplay(slotIndex);
            alert('🥛 Leite coletado!');
        }

        function collectManure(slotIndex) {
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            if (cowState.manure <= 0) {
                alert('Esta vaca não tem esterco para coletar!');
                return;
            }
            
            addToBarn('Esterco', cowState.manure);
            cowState.manure = 0;
            
            // Verificar se também coletou leite para iniciar descanso
            if (cowState.milk === 0) {
                startCowRest(slotIndex);
            }
            
            updateCowDisplay(slotIndex);
            alert('💩 Esterco coletado!');
        }

        function startCowRest(slotIndex) {
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            cowState.isResting = true;
            
            let timeLeft = 600; // 10 minutos
            const timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                updateCowStatus(slotIndex, `Descansando... ${minutes}:${seconds.toString().padStart(2, '0')}`);
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    cowState.isResting = false;
                    cowState.restTimer = null;
                    updateCowStatus(slotIndex, 'Pronta');
                    updateCowDisplay(slotIndex);
                }
            }, 1000);
            
            cowState.restTimer = timer;
        }

        function updateCowDisplay(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            const cowState = gameState.cowPasture.cowStates[slotIndex];
            
            const cowIcon = document.getElementById(`cowIcon-${slotIndex}`);
            const cowStatus = document.getElementById(`cowStatus-${slotIndex}`);
            const hayIcon = document.getElementById(`hayIcon-${slotIndex}`);
            const hayCount = document.getElementById(`hayCount-${slotIndex}`);
            const milkButton = document.getElementById(`milkButton-${slotIndex}`);
            const manureButton = document.getElementById(`manureButton-${slotIndex}`);
            
            if (cow === null) {
                cowIcon.textContent = '➕';
                cowStatus.textContent = 'Vazio';
                hayIcon.textContent = '🌾';
                hayCount.textContent = 'Feno: 0';
                milkButton.disabled = true;
                manureButton.disabled = true;
            } else {
                cowIcon.textContent = '🐄';
                
                if (cowState.isResting) {
                    cowStatus.textContent = 'Descansando...';
                } else if (cowState.isEating) {
                    cowStatus.textContent = 'Comendo...';
                } else if (cowState.isProducing) {
                    cowStatus.textContent = 'Produzindo...';
                } else if (cowState.milk > 0 || cowState.manure > 0) {
                    cowStatus.textContent = 'Pronto para coleta!';
                } else {
                    cowStatus.textContent = 'Pronta';
                }
                
                hayCount.textContent = `Feno: ${cowState.hayAmount}`;
                
                milkButton.disabled = cowState.milk <= 0;
                manureButton.disabled = cowState.manure <= 0;
                
                if (cowState.milk > 0) {
                    milkButton.textContent = `🥛 ${cowState.milk}`;
                } else {
                    milkButton.textContent = '🥛 Coletar';
                }
                
                if (cowState.manure > 0) {
                    manureButton.textContent = `💩 ${cowState.manure}`;
                } else {
                    manureButton.textContent = '💩 Coletar';
                }
            }
        }

        function updateCowStatus(slotIndex, status) {
            const cowStatus = document.getElementById(`cowStatus-${slotIndex}`);
            cowStatus.textContent = status;
        }



        // Funções da Composteira
        function buyComposter() {
            if (gameState.hasComposter) {
                alert('Você já tem uma composteira!');
                return;
            }
            
            if (gameState.coins >= 350) {
                gameState.coins -= 350;
                gameState.hasComposter = true;
                
                // Mostrar a composteira
                document.getElementById('composterContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('composterButton').style.display = 'none';
                
                updateUI();
                alert('🗂️ Composteira comprada! Agora você pode fazer adubo com flores, galhos e esterco!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        function addFlowerToComposter() {
            if (gameState.composter.flowers >= 1) {
                alert('O slot de flores já está cheio!');
                return;
            }
            
            if (!barn['Flor'] || barn['Flor'] <= 0) {
                alert('Você não tem flores no celeiro!');
                return;
            }
            
            barn['Flor']--;
            if (barn['Flor'] === 0) delete barn['Flor'];
            
            gameState.composter.flowers++;
            updateComposterDisplay();
            updateBarnDisplay();
        }

        function addBranchToComposter() {
            if (gameState.composter.branches >= 1) {
                alert('O slot de galhos já está cheio!');
                return;
            }
            
            if (!barn['Galho'] || barn['Galho'] <= 0) {
                alert('Você não tem galhos no celeiro!');
                return;
            }
            
            barn['Galho']--;
            if (barn['Galho'] === 0) delete barn['Galho'];
            
            gameState.composter.branches++;
            updateComposterDisplay();
            updateBarnDisplay();
        }

        function addManureToComposter() {
            if (gameState.composter.manure >= 2) {
                alert('O slot de esterco já está cheio!');
                return;
            }
            
            if (!barn['Esterco'] || barn['Esterco'] <= 0) {
                alert('Você não tem esterco no celeiro!');
                return;
            }
            
            barn['Esterco']--;
            if (barn['Esterco'] === 0) delete barn['Esterco'];
            
            gameState.composter.manure++;
            updateComposterDisplay();
            updateBarnDisplay();
        }

        function startComposting() {
            if (gameState.composter.isComposting) {
                alert('A composteira já está funcionando!');
                return;
            }
            
            if (gameState.composter.flowers < 1 || gameState.composter.branches < 1 || gameState.composter.manure < 2) {
                alert('Você precisa de 1 flor, 1 galho e 2 estercos para fazer adubo!');
                return;
            }
            
            gameState.composter.isComposting = true;
            
            const button = document.getElementById('compostButton');
            button.disabled = true;
            
            let timeLeft = 30;
            const statusElement = document.getElementById('compostingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Compostando... ${timeLeft}s`;
                button.textContent = `🗂️ Fazendo... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar compostagem
                    const fertilizerAmount = 10; // Produz 10 adubos
                    gameState.fertilizer += fertilizerAmount;
                    
                    // Limpar slots
                    gameState.composter.flowers = 0;
                    gameState.composter.branches = 0;
                    gameState.composter.manure = 0;
                    gameState.composter.isComposting = false;
                    
                    button.disabled = false;
                    button.textContent = '🗂️ Fazer Adubo';
                    statusElement.textContent = 'Pronto';
                    
                    updateComposterDisplay();
                    updateUI();
                    alert(`🗂️ ${fertilizerAmount} adubos prontos! Adicionados ao cabeçalho.`);
                }
            }, 1000);
            
            gameState.composter.compostingTimer = timer;
        }

        function updateComposterDisplay() {
            // Atualizar slot de flores
            const flowerSlot = document.getElementById('composterFlowerSlot');
            const flowerCount = document.getElementById('composterFlowerCount');
            flowerCount.textContent = `${gameState.composter.flowers}/1`;
            
            if (gameState.composter.flowers > 0) {
                flowerSlot.innerHTML = `
                    <div class="text-2xl mb-1">🌸</div>
                    <div class="text-xs text-gray-500">Flores</div>
                    <div class="text-xs" id="composterFlowerCount">${gameState.composter.flowers}/1</div>
                `;
                flowerSlot.className = 'bg-pink-200 border-2 border-pink-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-pink-300';
            } else {
                flowerSlot.innerHTML = `
                    <div class="text-xs text-gray-500">Flores</div>
                    <div class="text-xs" id="composterFlowerCount">0/1</div>
                `;
                flowerSlot.className = 'bg-pink-100 border-2 border-pink-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-pink-200';
            }
            
            // Atualizar slot de galhos
            const branchSlot = document.getElementById('composterBranchSlot');
            const branchCount = document.getElementById('composterBranchCount');
            branchCount.textContent = `${gameState.composter.branches}/1`;
            
            if (gameState.composter.branches > 0) {
                branchSlot.innerHTML = `
                    <div class="text-2xl mb-1">🌲</div>
                    <div class="text-xs text-gray-500">Galhos</div>
                    <div class="text-xs" id="composterBranchCount">${gameState.composter.branches}/1</div>
                `;
                branchSlot.className = 'bg-yellow-200 border-2 border-yellow-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-300';
                branchSlot.style.backgroundColor = '#F0E68C';
            } else {
                branchSlot.innerHTML = `
                    <div class="text-xs text-gray-500">Galhos</div>
                    <div class="text-xs" id="composterBranchCount">0/1</div>
                `;
                branchSlot.className = 'bg-brown-100 border-2 border-brown-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-brown-200';
                branchSlot.style.backgroundColor = '#D2B48C';
            }
            
            // Atualizar slot de esterco
            const manureSlot = document.getElementById('composterManureSlot');
            const manureCount = document.getElementById('composterManureCount');
            manureCount.textContent = `${gameState.composter.manure}/2`;
            
            if (gameState.composter.manure > 0) {
                manureSlot.innerHTML = `
                    <div class="text-2xl mb-1">💩</div>
                    <div class="text-xs text-gray-500">Esterco</div>
                    <div class="text-xs" id="composterManureCount">${gameState.composter.manure}/2</div>
                `;
                manureSlot.className = 'bg-yellow-200 border-2 border-yellow-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-300';
            } else {
                manureSlot.innerHTML = `
                    <div class="text-xs text-gray-500">Esterco</div>
                    <div class="text-xs" id="composterManureCount">0/2</div>
                `;
                manureSlot.className = 'bg-yellow-100 border-2 border-yellow-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-yellow-200';
            }
            
            // Atualizar botão de fazer
            const button = document.getElementById('compostButton');
            
            if (gameState.composter.isComposting) {
                button.disabled = true;
            } else if (gameState.composter.flowers >= 1 && gameState.composter.branches >= 1 && gameState.composter.manure >= 2) {
                button.disabled = false;
                button.textContent = '🗂️ Fazer Adubo';
            } else {
                button.disabled = true;
                button.textContent = '🗂️ Fazer Adubo';
            }
        }

        // Funções da Queijeira
        function buyCheeseMaker() {
            if (gameState.hasCheeseMaker) {
                alert('Você já tem uma queijeira!');
                return;
            }
            
            if (gameState.coins >= 300) {
                gameState.coins -= 300;
                gameState.hasCheeseMaker = true;
                
                // Mostrar a queijeira
                document.getElementById('cheeseMakerContainer').classList.remove('hidden');
                
                // Esconder o botão de compra
                document.getElementById('cheeseMakerButton').style.display = 'none';
                
                updateUI();
                alert('🧀 Queijeira comprada! Agora você pode fazer queijo com leite!');
            } else {
                alert('Moedas insuficientes!');
            }
        }

        function addMilkToCheeseMaker() {
            if (gameState.cheeseMaker.milk >= 2) {
                alert('A queijeira já está cheia!');
                return;
            }
            
            if (!barn['Leite'] || barn['Leite'] <= 0) {
                alert('Você não tem leite no celeiro!');
                return;
            }
            
            // Adicionar um leite por vez ao clicar
            const maxCanAdd = Math.min(1, barn['Leite'], 2 - gameState.cheeseMaker.milk);
            
            if (maxCanAdd <= 0) {
                alert('Não é possível adicionar mais leite!');
                return;
            }
            
            barn['Leite'] -= maxCanAdd;
            if (barn['Leite'] === 0) delete barn['Leite'];
            
            gameState.cheeseMaker.milk += maxCanAdd;
            
            updateCheeseMakerDisplay();
            updateBarnDisplay();
        }

        function startCheesemaking() {
            if (gameState.cheeseMaker.isMaking) {
                alert('A queijeira já está funcionando!');
                return;
            }
            
            if (gameState.cheeseMaker.milk < 2) {
                alert('Você precisa de 2 leites para fazer queijo!');
                return;
            }
            
            gameState.cheeseMaker.isMaking = true;
            
            const button = document.getElementById('cheeseButton');
            button.disabled = true;
            
            let timeLeft = 60; // 1 minuto
            const statusElement = document.getElementById('cheesemakingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                statusElement.textContent = `Curando... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                button.textContent = `🧀 Curando... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar produção de queijo
                    addToBarn('Queijo', 1);
                    
                    gameState.cheeseMaker.milk = 0;
                    gameState.cheeseMaker.isMaking = false;
                    
                    button.disabled = false;
                    button.textContent = '🧀 Curar (1min)';
                    statusElement.textContent = 'Pronto';
                    
                    updateCheeseMakerDisplay();
                    alert('🧀 Queijo pronto! Adicionado ao celeiro.');
                }
            }, 1000);
            
            gameState.cheeseMaker.makingTimer = timer;
        }

        function updateCheeseMakerDisplay() {
            const slot = document.getElementById('cheeseMakerSlot');
            const countElement = document.getElementById('cheeseMakerMilkCount');
            const button = document.getElementById('cheeseButton');
            
            countElement.textContent = `${gameState.cheeseMaker.milk}/2`;
            
            if (gameState.cheeseMaker.milk > 0) {
                slot.innerHTML = `
                    <div class="text-2xl mb-1">🥛</div>
                    <div class="text-xs">Leite</div>
                    <div class="text-xs" id="cheeseMakerMilkCount">${gameState.cheeseMaker.milk}/2</div>
                `;
                slot.className = 'bg-blue-200 border-2 border-blue-400 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-blue-300';
                button.disabled = gameState.cheeseMaker.isMaking ? true : (gameState.cheeseMaker.milk < 2);
            } else {
                slot.innerHTML = `
                    <div class="text-xs text-gray-500">Vazio</div>
                    <div class="text-xs" id="cheeseMakerMilkCount">0/2</div>
                `;
                slot.className = 'bg-blue-100 border-2 border-blue-300 rounded-lg p-4 w-20 h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-blue-200';
                button.disabled = true;
            }
        }

        // Funções globais para serem chamadas pelos onclick - definir antes de usar
        window.addFuelToStove = function() {
            if (gameState.stove.fuel >= 2) {
                alert('O fogão já está cheio de lenha!');
                return;
            }
            
            if (!barn['Lenha'] || barn['Lenha'] <= 0) {
                alert('Você não tem lenhas no celeiro!');
                return;
            }
            
            barn['Lenha']--;
            if (barn['Lenha'] === 0) delete barn['Lenha'];
            
            gameState.stove.fuel++;
            updateStoveDisplay();
            updateBarnDisplay();
        };

        window.addIngredientToStove = function(slotIndex) {
            if (gameState.stove.ingredients[slotIndex] !== null) {
                // Remover ingrediente do slot
                const ingredient = gameState.stove.ingredients[slotIndex];
                addToBarn(ingredient.name, ingredient.quantity);
                gameState.stove.ingredients[slotIndex] = null;
                updateStoveDisplay();
                return;
            }
            
            // Mostrar seletor visual de ingredientes
            showStoveIngredientSelector(slotIndex);
        };

        window.startCooking = function() {
            if (gameState.stove.isCooking) {
                alert('O fogão já está cozinhando!');
                return;
            }
            
            if (gameState.stove.fuel < 2) {
                alert('Você precisa de 2 lenhas para cozinhar!');
                return;
            }
            
            const recipe = checkRecipe();
            if (!recipe) {
                alert('Receita inválida! Verifique os ingredientes.');
                return;
            }
            
            // Consumir lenha
            gameState.stove.fuel -= 2;
            
            // Iniciar cozimento
            gameState.stove.isCooking = true;
            
            const button = document.getElementById('cookButton');
            button.disabled = true;
            
            let timeLeft = recipe.time;
            const statusElement = document.getElementById('cookingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Cozinhando... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar cozimento
                    gameState.stove.isCooking = false;
                    gameState.stove.ingredients = [null, null, null, null];
                    
                    // Adicionar comida ao celeiro
                    addToBarn(recipe.result, 1);
                    
                    button.disabled = false;
                    statusElement.textContent = 'Pronto';
                    
                    updateStoveDisplay();
                    alert(`🍳 ${recipe.result} pronto! Adicionado ao celeiro.`);
                }
            }, 1000);
            
            gameState.stove.cookingTimer = timer;
            updateStoveDisplay();
        };

        window.addFuelToOven = function() {
            if (gameState.oven.fuel >= 3) {
                alert('O forno já está cheio de lenha!');
                return;
            }
            
            if (!barn['Lenha'] || barn['Lenha'] <= 0) {
                alert('Você não tem lenhas no celeiro!');
                return;
            }
            
            barn['Lenha']--;
            if (barn['Lenha'] === 0) delete barn['Lenha'];
            
            gameState.oven.fuel++;
            updateOvenDisplay();
            updateBarnDisplay();
        };

        window.addIngredientToOven = function(slotIndex) {
            if (gameState.oven.ingredients[slotIndex] !== null) {
                // Remover ingrediente do slot
                const ingredient = gameState.oven.ingredients[slotIndex];
                addToBarn(ingredient.name, ingredient.quantity);
                gameState.oven.ingredients[slotIndex] = null;
                updateOvenDisplay();
                return;
            }
            
            // Mostrar lista de ingredientes disponíveis
            showOvenIngredientSelector(slotIndex);
        };

        window.startBaking = function() {
            if (gameState.oven.isBaking) {
                alert('O forno já está assando!');
                return;
            }
            
            if (gameState.oven.fuel < 3) {
                alert('Você precisa de 3 lenhas para assar!');
                return;
            }
            
            const recipe = checkOvenRecipe();
            if (!recipe) {
                alert('Receita inválida! Verifique os ingredientes.');
                return;
            }
            
            // Consumir lenha
            gameState.oven.fuel -= 3;
            
            // Iniciar cozimento
            gameState.oven.isBaking = true;
            
            const button = document.getElementById('bakeButton');
            button.disabled = true;
            
            let timeLeft = recipe.time;
            const statusElement = document.getElementById('bakingStatus');
            
            const timer = setInterval(() => {
                timeLeft--;
                statusElement.textContent = `Assando... ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    
                    // Finalizar cozimento
                    gameState.oven.isBaking = false;
                    gameState.oven.ingredients = [null, null, null, null];
                    
                    // Adicionar comida ao celeiro
                    addToBarn(recipe.result, 1);
                    
                    button.disabled = false;
                    statusElement.textContent = 'Pronto';
                    
                    updateOvenDisplay();
                    alert(`🔥 ${recipe.result} pronto! Adicionado ao celeiro.`);
                }
            }, 1000);
            
            gameState.oven.bakingTimer = timer;
            updateOvenDisplay();
        };
        window.addGrassToDryer = addGrassToDryer;
        window.startDrying = startDrying;
        window.addDriedGrassToHayMaker = addDriedGrassToHayMaker;
        window.startMakingHay = startMakingHay;
        window.addLogToLumber = addLogToLumber;
        window.cutLumber = cutLumber;
        window.placeCow = placeCow;
        window.addHayToCow = addHayToCow;
        window.collectMilk = collectMilk;
        window.collectManure = collectManure;
        window.addFlowerToComposter = addFlowerToComposter;
        window.addBranchToComposter = addBranchToComposter;
        window.addManureToComposter = addManureToComposter;
        window.startComposting = startComposting;
        window.addMilkToCheeseMaker = addMilkToCheeseMaker;
        window.startCheesemaking = startCheesemaking;
        window.restFarmer = restFarmer;
        window.showEatMenu = showEatMenu;

        // Inicializar jogo quando a página carregar
        window.onload = function() {
            initGame();
            startSicknessSystem();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971356e387650083',t:'MTc1NTU0MDMyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
