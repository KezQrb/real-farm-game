<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Farm - Jogo de Fazendinha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
        }
        
        .farm-title {
            font-family: 'Fredoka One', cursive;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .canteiro {
            width: 90px;
            height: 90px;
            background: radial-gradient(circle at 30% 30%, #A0522D, #8B4513, #654321);
            border: 3px solid #5D4037;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 
                inset 0 2px 4px rgba(160, 82, 45, 0.6),
                inset 0 -2px 4px rgba(0, 0, 0, 0.4),
                0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .canteiro::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            background: 
                radial-gradient(circle at 20% 20%, rgba(160, 82, 45, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 30%, rgba(139, 69, 19, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(101, 67, 33, 0.3) 0%, transparent 45%);
            border-radius: 6px;
            z-index: 1;
        }
        
        .canteiro > * {
            z-index: 2;
            position: relative;
        }
        
        .canteiro:hover {
            transform: scale(1.08);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .canteiro.fertilized {
            background: linear-gradient(145deg, #4A2C17, #2F1B0C);
            box-shadow: inset 0 4px 8px rgba(139, 69, 19, 0.8), 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .canteiro.fertilized::before {
            background: repeating-linear-gradient(
                90deg,
                rgba(74, 44, 23, 0.9),
                rgba(74, 44, 23, 0.9) 3px,
                rgba(47, 27, 12, 0.7) 3px,
                rgba(47, 27, 12, 0.7) 6px
            );
        }
        
        .canteiro.planted {
            background: linear-gradient(145deg, #228B22, #006400);
            border-color: #004d00;
        }
        
        .canteiro.planted::before {
            background: repeating-linear-gradient(
                90deg,
                rgba(34, 139, 34, 0.8),
                rgba(34, 139, 34, 0.8) 3px,
                rgba(0, 100, 0, 0.6) 3px,
                rgba(0, 100, 0, 0.6) 6px
            );
        }
        
        .canteiro.watered {
            background: linear-gradient(145deg, #006400, #004d00);
            border-color: #003300;
            box-shadow: inset 0 4px 8px rgba(0, 100, 255, 0.6), 0 0 20px rgba(0, 150, 255, 0.4);
        }
        
        .canteiro.watered::before {
            background: repeating-linear-gradient(
                90deg,
                rgba(0, 100, 0, 0.8),
                rgba(0, 100, 0, 0.8) 3px,
                rgba(0, 77, 0, 0.6) 3px,
                rgba(0, 77, 0, 0.6) 6px
            );
        }
        
        .canteiro.ready {
            background: linear-gradient(145deg, #90EE90, #32CD32);
            border-color: #228B22;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .canteiro.ready::before {
            background: repeating-linear-gradient(
                90deg,
                rgba(144, 238, 144, 0.3),
                rgba(144, 238, 144, 0.3) 3px,
                rgba(50, 205, 50, 0.2) 3px,
                rgba(50, 205, 50, 0.2) 6px
            );
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #32CD32; }
            to { box-shadow: 0 0 15px #32CD32, 0 0 25px #32CD32; }
        }
        
        .seed-btn {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            border: 2px solid #4CAF50;
            background: linear-gradient(145deg, #66BB6A, #4CAF50);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            text-align: center;
        }
        
        .seed-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        .seed-btn:active {
            transform: translateY(0);
        }
        
        .resource-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .celeiro {
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 12px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .celeiro-item {
            background: rgba(255, 255, 255, 0.9);
            margin: 4px;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .celeiro-item:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .celeiro-item.non-sellable {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .celeiro-item.non-sellable:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: none;
            box-shadow: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .quitanda-slot {
            width: 50px;
            height: 50px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 20px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .quitanda-slot:hover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .quitanda-slot.filled {
            border: 2px solid #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }
        
        .rain-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(100, 100, 100, 0.3);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .rain-overlay.active {
            opacity: 1;
        }
        
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 10px;
            background: linear-gradient(to bottom, transparent, #87CEEB);
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            from {
                transform: translateY(-100vh);
            }
            to {
                transform: translateY(100vh);
            }
        }
        
        .sky-gray {
            background: linear-gradient(135deg, #708090 0%, #778899 100%) !important;
            transition: background 0.5s ease;
        }
        
        .flower-field {
            background: linear-gradient(135deg, #90EE90, #98FB98, #90EE90);
            border: 3px solid #228B22;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(34, 139, 34, 0.3);
            display: none;
        }
        
        .flower-field.spring {
            display: block;
            animation: bloom 1s ease-in-out;
        }
        
        @keyframes bloom {
            from { 
                opacity: 0; 
                transform: scale(0.8); 
            }
            to { 
                opacity: 1; 
                transform: scale(1); 
            }
        }
        
        .flower-slot {
            width: 120px;
            height: 100px;
            background: linear-gradient(145deg, #F0FFF0, #E6FFE6);
            border: 2px solid #32CD32;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .flower-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(50, 205, 50, 0.4);
        }
        
        .flower-slot::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, #228B22, transparent);
            z-index: 1;
        }
        
        .flower-display {
            display: flex;
            gap: 2px;
            z-index: 2;
            position: relative;
        }
        
        .flower-icon {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .flower-icon.collected {
            opacity: 0.3;
            transform: scale(0.7);
        }
        
        .flower-name {
            font-size: 12px;
            font-weight: bold;
            color: #2E7D32;
            margin-top: 5px;
            z-index: 2;
            position: relative;
        }
        
        .flower-timer {
            font-size: 10px;
            color: #666;
            z-index: 2;
            position: relative;
        }
        
        .feeder-slot {
            width: 120px;
            height: 120px;
            background: linear-gradient(145deg, #D2B48C, #DEB887);
            border: 3px solid #8B7355;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(139, 115, 85, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .feeder-slot:hover {
            transform: translateY(-2px);
            box-shadow: inset 0 2px 4px rgba(139, 115, 85, 0.3), 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .feeder-slot.filled {
            background: linear-gradient(145deg, #F0E68C, #FFE4B5);
            border-color: #DAA520;
            animation: attract-birds 3s ease-in-out infinite;
        }
        
        @keyframes attract-birds {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .bird-visit {
            position: absolute;
            top: -30px;
            right: -20px;
            font-size: 24px;
            animation: bird-fly 2s ease-in-out;
            z-index: 10;
        }
        
        @keyframes bird-fly {
            0% { transform: translateX(50px) translateY(20px) rotate(0deg); opacity: 0; }
            20% { opacity: 1; }
            50% { transform: translateX(0px) translateY(0px) rotate(-10deg); }
            80% { transform: translateX(0px) translateY(0px) rotate(10deg); }
            100% { transform: translateX(-50px) translateY(20px) rotate(0deg); opacity: 0; }
        }
        
        .bee-station {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .bee-icon {
            font-size: 32px;
            animation: bee-hover 2s ease-in-out infinite;
        }
        
        @keyframes bee-hover {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        .flower-slot-mini {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #F0FFF0, #E6FFE6);
            border: 2px solid #32CD32;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .flower-slot-mini:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(50, 205, 50, 0.4);
        }
        
        .flower-slot-mini.growing {
            background: linear-gradient(145deg, #FFFACD, #F0E68C);
            border-color: #DAA520;
        }
        
        .flower-slot-mini.bloomed {
            background: linear-gradient(145deg, #FFB6C1, #FFC0CB);
            border-color: #FF69B4;
            animation: bloom-glow 3s ease-in-out infinite;
        }
        
        @keyframes bloom-glow {
            0%, 100% { box-shadow: 0 0 5px #FF69B4; }
            50% { box-shadow: 0 0 15px #FF69B4, 0 0 25px #FF69B4; }
        }
        
        .honey-status {
            font-size: 12px;
            color: #666;
            text-align: center;
            min-height: 16px;
        }
        
        .honey-ready {
            color: #FF8C00;
            font-weight: bold;
            cursor: pointer;
            animation: honey-pulse 1s ease-in-out infinite;
        }
        
        @keyframes honey-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .dog-food-slot, .treasure-chest {
            width: 100px;
            height: 100px;
            background: linear-gradient(145deg, #D2B48C, #DEB887);
            border: 3px solid #8B7355;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .dog-food-slot:hover, .treasure-chest:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .dog-food-slot.filled {
            background: linear-gradient(145deg, #F0E68C, #FFE4B5);
            border-color: #DAA520;
        }
        
        .treasure-chest.has-treasures {
            background: linear-gradient(145deg, #FFD700, #FFA500);
            border-color: #FF8C00;
            animation: treasure-glow 2s ease-in-out infinite;
        }
        
        @keyframes treasure-glow {
            0%, 100% { box-shadow: 0 0 5px #FFD700; }
            50% { box-shadow: 0 0 15px #FFD700, 0 0 25px #FFD700; }
        }
        
        .mocinha-hunting {
            animation: dog-wag 1s ease-in-out infinite;
        }
        
        @keyframes dog-wag {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        .mocinha-resting {
            opacity: 0.7;
        }
        
        .duke-working {
            animation: horse-gallop 0.8s ease-in-out infinite;
        }
        
        @keyframes horse-gallop {
            0%, 100% { transform: translateX(0px) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-2deg); }
            50% { transform: translateX(3px) rotate(0deg); }
            75% { transform: translateX(-2px) rotate(2deg); }
        }
        
        .duke-sick {
            opacity: 0.5;
            filter: grayscale(50%);
        }
        
        .order-card {
            background: linear-gradient(145deg, #FFF8DC, #F5F5DC);
            border: 2px solid #DAA520;
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s ease;
        }
        
        .order-card.delivering {
            background: linear-gradient(145deg, #E6F3FF, #CCE7FF);
            border-color: #4A90E2;
            animation: delivery-pulse 2s ease-in-out infinite;
        }
        
        @keyframes delivery-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .order-items {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            margin: 8px 0;
        }
        
        .order-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .order-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .order-btn {
            flex: 1;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .order-btn.refuse {
            background: linear-gradient(145deg, #FF6B6B, #FF5252);
            color: white;
        }
        
        .order-btn.refuse:hover {
            background: linear-gradient(145deg, #FF5252, #FF4444);
            transform: translateY(-1px);
        }
        
        .order-btn.deliver {
            background: linear-gradient(145deg, #4CAF50, #45A049);
            color: white;
        }
        
        .order-btn.deliver:hover {
            background: linear-gradient(145deg, #45A049, #3E8E41);
            transform: translateY(-1px);
        }
        
        .order-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .delivery-timer {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 4px;
        }
        
        .mail-item {
            background: linear-gradient(145deg, #FFF8DC, #F5F5DC);
            border: 2px solid #DAA520;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .mail-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
        }
        
        .mail-item.newspaper {
            background: linear-gradient(145deg, #E6F3FF, #CCE7FF);
            border-color: #4A90E2;
        }
        
        .mail-item.letter {
            background: linear-gradient(145deg, #FFE6F0, #FFCCDD);
            border-color: #FF69B4;
        }
        
        .mail-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .mail-type {
            font-size: 14px;
            font-weight: bold;
            color: #666;
        }
        
        .mail-time {
            font-size: 12px;
            color: #888;
        }
        
        .mail-content {
            font-size: 14px;
            line-height: 1.4;
            color: #333;
        }
        
        .newspaper-content {
            margin-top: 8px;
        }
        
        .product-highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #FFD700;
        }
        
        .tip-section {
            background: rgba(76, 175, 80, 0.1);
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .mailbox-new {
            animation: mailbox-bounce 2s ease-in-out infinite;
        }
        
        @keyframes mailbox-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        .phone-ringing {
            animation: phone-ring 1s ease-in-out infinite;
        }
        
        @keyframes phone-ring {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }
        
        .urgent-order {
            background: linear-gradient(145deg, #FFE6E6, #FFCCCC);
            border: 2px solid #FF6B6B;
            animation: urgent-pulse 2s ease-in-out infinite;
        }
        
        @keyframes urgent-pulse {
            0%, 100% { box-shadow: 0 0 5px #FF6B6B; }
            50% { box-shadow: 0 0 15px #FF6B6B, 0 0 25px #FF6B6B; }
        }
        
        .truck-slot {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #F5F5F5, #E0E0E0);
            border: 2px solid #CCCCCC;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .truck-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .truck-slot.filled {
            background: linear-gradient(145deg, #E8F5E8, #D4F4D4);
            border-color: #4CAF50;
        }
        
        .truck-delivering {
            animation: truck-shake 0.5s ease-in-out infinite;
        }
        
        @keyframes truck-shake {
            0%, 100% { transform: translateX(0px); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        .chicken-slot {
            width: 120px;
            height: 140px;
            background: linear-gradient(145deg, #F5DEB3, #DEB887);
            border: 3px solid #CD853F;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(205, 133, 63, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .chicken-slot:hover {
            transform: translateY(-2px);
            box-shadow: inset 0 2px 4px rgba(205, 133, 63, 0.3), 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .chicken-slot.has-chicken {
            background: linear-gradient(145deg, #FFE4B5, #FFEFD5);
            border-color: #DAA520;
        }
        
        .chicken-food-slot {
            width: 30px;
            height: 30px;
            background: linear-gradient(145deg, #8B4513, #A0522D);
            border: 2px solid #654321;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 12px;
        }
        
        .chicken-food-slot:hover {
            transform: scale(1.1);
        }
        
        .chicken-food-slot.filled {
            background: linear-gradient(145deg, #F0E68C, #FFE4B5);
            border-color: #DAA520;
        }
        
        .chicken-eating {
            animation: chicken-peck 0.5s ease-in-out infinite;
        }
        
        @keyframes chicken-peck {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }
        
        .chicken-laying {
            animation: chicken-lay 1s ease-in-out infinite;
        }
        
        @keyframes chicken-lay {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .chicken-resting {
            opacity: 0.7;
            animation: chicken-rest 3s ease-in-out infinite;
        }
        
        @keyframes chicken-rest {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-2deg); }
        }
        
        .chick-growing {
            animation: chick-grow 2s ease-in-out infinite;
        }
        
        @keyframes chick-grow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .pig-eating {
            animation: pig-munch 0.6s ease-in-out infinite;
        }
        
        @keyframes pig-munch {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-2px) rotate(-1deg); }
        }
        
        .pig-producing {
            animation: pig-produce 1s ease-in-out infinite;
        }
        
        @keyframes pig-produce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .pig-resting {
            opacity: 0.7;
            animation: pig-rest 3s ease-in-out infinite;
        }
        
        @keyframes pig-rest {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-1deg); }
        }
        
        .meat-ready {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 192, 203, 0.9);
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            color: #8B4513;
            cursor: pointer;
            animation: meat-glow 2s ease-in-out infinite;
        }
        
        @keyframes meat-glow {
            0%, 100% { box-shadow: 0 0 5px #FFB6C1; }
            50% { box-shadow: 0 0 15px #FFB6C1; }
        }
        
        .cow-eating {
            animation: cow-chew 0.8s ease-in-out infinite;
        }
        
        @keyframes cow-chew {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }
        
        .cow-producing {
            animation: cow-produce 1.2s ease-in-out infinite;
        }
        
        @keyframes cow-produce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        .cow-resting {
            opacity: 0.8;
            animation: cow-rest 4s ease-in-out infinite;
        }
        
        @keyframes cow-rest {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-1deg); }
        }
        
        .sheep-eating {
            animation: sheep-chew 0.7s ease-in-out infinite;
        }
        
        @keyframes sheep-chew {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }
        
        .sheep-producing {
            animation: sheep-produce 1s ease-in-out infinite;
        }
        
        @keyframes sheep-produce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .sheep-resting {
            opacity: 0.8;
            animation: sheep-rest 3.5s ease-in-out infinite;
        }
        
        @keyframes sheep-rest {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-1deg); }
        }
        
        .milk-ready {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            color: #4169E1;
            cursor: pointer;
            animation: milk-glow 2s ease-in-out infinite;
        }
        
        @keyframes milk-glow {
            0%, 100% { box-shadow: 0 0 5px #87CEEB; }
            50% { box-shadow: 0 0 15px #87CEEB; }
        }
        
        .wool-ready {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            color: #8B4513;
            cursor: pointer;
            animation: wool-glow 2s ease-in-out infinite;
        }
        
        @keyframes wool-glow {
            0%, 100% { box-shadow: 0 0 5px #DDD; }
            50% { box-shadow: 0 0 15px #DDD; }
        }
        
        .grass-slot {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #90EE90, #98FB98);
            border: 2px solid #32CD32;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 20px;
        }
        
        .grass-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(50, 205, 50, 0.4);
        }
        
        .grass-slot.collected {
            background: linear-gradient(145deg, #D2B48C, #DEB887);
            border-color: #8B7355;
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .grass-slot.collected:hover {
            transform: none;
            box-shadow: none;
        }
        
        .grass-slot.regrowing {
            background: linear-gradient(145deg, #F0E68C, #FFE4B5);
            border-color: #DAA520;
            animation: grass-regrow 1s ease-in-out infinite;
        }
        
        @keyframes grass-regrow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .grass-timer {
            position: absolute;
            bottom: 2px;
            font-size: 8px;
            color: #666;
            background: rgba(255, 255, 255, 0.8);
            padding: 1px 3px;
            border-radius: 3px;
        }
        
        .eggs-ready {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            color: #8B4513;
            cursor: pointer;
            animation: eggs-glow 2s ease-in-out infinite;
        }
        
        @keyframes eggs-glow {
            0%, 100% { box-shadow: 0 0 5px #FFD700; }
            50% { box-shadow: 0 0 15px #FFD700; }
        }
        
        .farmer-resting {
            opacity: 0.7;
            animation: farmer-sleep 2s ease-in-out infinite;
        }
        
        @keyframes farmer-sleep {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .farmer-sick {
            filter: hue-rotate(60deg) saturate(0.7);
            animation: farmer-sick-shake 1s ease-in-out infinite;
        }
        
        @keyframes farmer-sick-shake {
            0%, 100% { transform: translateX(0px); }
            25% { transform: translateX(-1px); }
            75% { transform: translateX(1px); }
        }
        
        .farmer-dead {
            filter: grayscale(100%);
            opacity: 0.5;
            transform: rotate(90deg);
        }
        
        .fish-slot {
            width: 120px;
            height: 120px;
            background: linear-gradient(145deg, #87CEEB, #4682B4);
            border: 3px solid #1E90FF;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(135, 206, 235, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .fish-slot:hover {
            transform: translateY(-2px);
            box-shadow: inset 0 2px 4px rgba(135, 206, 235, 0.3), 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .fish-slot.empty {
            background: linear-gradient(145deg, #B0C4DE, #778899);
            border-color: #708090;
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .fish-slot.empty:hover {
            transform: none;
            box-shadow: inset 0 2px 4px rgba(176, 196, 222, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .fish-slot.respawning {
            background: linear-gradient(145deg, #F0F8FF, #E6F3FF);
            border-color: #87CEEB;
            animation: fish-respawn 1s ease-in-out infinite;
        }
        
        @keyframes fish-respawn {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fish-timer {
            position: absolute;
            bottom: 2px;
            font-size: 8px;
            color: #333;
            background: rgba(255, 255, 255, 0.8);
            padding: 1px 3px;
            border-radius: 3px;
        }
        
        .animal-sick {
            filter: hue-rotate(60deg) saturate(0.7);
            animation: animal-sick-shake 1s ease-in-out infinite;
            border: 3px solid #FF6B6B !important;
        }
        
        @keyframes animal-sick-shake {
            0%, 100% { transform: translateX(0px); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        .sick-timer {
            position: absolute;
            top: -5px;
            left: -5px;
            background: #FF6B6B;
            color: white;
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            animation: sick-pulse 1s ease-in-out infinite;
        }
        
        @keyframes sick-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .energy-bar-low {
            background: linear-gradient(90deg, #FF6B6B, #FF8E53) !important;
        }
        
        .energy-bar-critical {
            background: linear-gradient(90deg, #FF4757, #FF3742) !important;
            animation: energy-pulse 1s ease-in-out infinite;
        }
        
        @keyframes energy-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .food-item {
            background: linear-gradient(145deg, #FFF8DC, #F5F5DC);
            border: 2px solid #DAA520;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .food-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
        }
        
        .food-item.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(145deg, #F5F5F5, #E0E0E0);
            border-color: #CCCCCC;
        }
        
        .food-item.unavailable:hover {
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="p-4">
    <!-- Overlay de Chuva -->
    <div class="rain-overlay" id="rain-overlay"></div>
    
    <div class="max-w-7xl mx-auto">
        <!-- Título -->
        <h1 class="farm-title text-4xl text-center text-green-800 mb-6">🌾 Real Farm 🌾</h1>
        
        <!-- Avatar do Fazendeiro e Caixa de Correios -->
        <div class="flex justify-center gap-6 mb-6">
            <!-- Avatar -->
            <div class="resource-card relative">
                <div class="text-center">
                    <div class="text-6xl mb-2" id="farmer-avatar">🧑‍🌾</div>
                    <div class="font-bold text-lg text-green-800">Você</div>
                    <div class="text-sm text-gray-600" id="farmer-status">Trabalhando</div>
                    
                    <!-- Barra de Energia -->
                    <div class="mt-2">
                        <div class="text-xs text-gray-600 mb-1">Energia: <span id="energy-display">200/200</span></div>
                        <div class="w-32 h-3 bg-gray-200 rounded-full">
                            <div class="h-full bg-green-500 rounded-full transition-all duration-300" id="energy-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="flex gap-2 mt-3">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded text-xs transition-colors" onclick="restFarmer()" id="rest-btn">
                            😴 Descansar
                        </button>
                        <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-1 px-3 rounded text-xs transition-colors" onclick="showFoodMenu()" id="eat-btn">
                            🍽️ Comer
                        </button>
                    </div>
                </div>
                
                <!-- Indicador de Doença -->
                <div class="absolute -top-2 -right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center text-lg" id="sick-indicator" style="display: none;">🤒</div>
            </div>
            
            <!-- Caixa de Correios -->
            <div class="resource-card relative">
                <div class="text-center cursor-pointer" onclick="openMailbox()">
                    <div class="text-3xl mb-2" id="mailbox-icon">📬</div>
                    <div class="text-sm text-gray-600">Caixa de Correios</div>
                    <div class="text-xs text-gray-500" id="mail-count">0 mensagens</div>
                </div>
                <!-- Indicador de nova mensagem -->
                <div class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold" id="new-mail-indicator" style="display: none;">!</div>
            </div>
        </div>

        <!-- Modal de Comida -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" id="food-modal" style="display: none;">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-green-800">🍽️ Cardápio</h3>
                    <button class="text-2xl text-gray-500 hover:text-gray-700" onclick="closeFoodMenu()">✕</button>
                </div>
                <div id="food-menu" class="space-y-3">
                    <!-- Opções de comida aparecerão aqui -->
                </div>
            </div>
        </div>
        
        <!-- Telefone -->
        <div class="flex justify-center gap-6 mb-4">
            <div class="resource-card relative" id="phone-container" style="display: none;">
                <div class="text-center cursor-pointer" onclick="answerPhone()">
                    <div class="text-3xl mb-2" id="phone-icon">📞</div>
                    <div class="text-sm text-gray-600">Telefone</div>
                    <div class="text-xs text-gray-500" id="phone-status">Aguardando chamadas</div>
                </div>
                <!-- Indicador de chamada -->
                <div class="absolute -top-2 -right-2 w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-xs font-bold" id="phone-ring-indicator" style="display: none;">📞</div>
            </div>
        </div>

        <!-- Modal da Caixa de Correios -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" id="mailbox-modal" style="display: none;">
            <div class="bg-white rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-green-800">📬 Caixa de Correios</h3>
                    <button class="text-2xl text-gray-500 hover:text-gray-700" onclick="closeMailbox()">✕</button>
                </div>
                <div id="mail-content">
                    <div class="text-center text-gray-500 py-8">Nenhuma mensagem ainda</div>
                </div>
            </div>
        </div>

        <!-- Modal do Telefone -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" id="phone-modal" style="display: none;">
            <div class="bg-white rounded-2xl p-6 max-w-lg w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-green-800">📞 Chamada de Agrônomo</h3>
                    <button class="text-2xl text-gray-500 hover:text-gray-700" onclick="closePhone()">✕</button>
                </div>
                <div id="phone-content">
                    <div class="text-center text-gray-500 py-8">Nenhuma chamada</div>
                </div>
            </div>
        </div>

        <!-- Recursos do Jogador -->
        <div class="flex justify-center gap-6 mb-6">
            <div class="resource-card text-center">
                <div class="text-2xl">💰</div>
                <div class="font-bold text-lg" id="coins">200</div>
                <div class="text-sm text-gray-600">Moedas</div>
            </div>
            <div class="resource-card text-center">
                <div class="text-2xl">💧</div>
                <div class="font-bold text-lg" id="water">10</div>
                <div class="text-sm text-gray-600">Água</div>
            </div>
            <div class="resource-card text-center">
                <div class="text-2xl">🍂</div>
                <div class="font-bold text-lg" id="fertilizer">50</div>
                <div class="text-sm text-gray-600">Folhas Secas</div>
            </div>
            <div class="resource-card text-center" id="compost-resource" style="display: none;">
                <div class="text-2xl">🌱</div>
                <div class="font-bold text-lg" id="compost">0</div>
                <div class="text-sm text-gray-600">Adubo</div>
            </div>
            <div class="resource-card text-center">
                <div class="text-2xl" id="season-emoji">🌸</div>
                <div class="font-bold text-lg" id="season-name">Primavera</div>
                <div class="text-sm text-gray-600" id="season-bonus">Plantações +10%</div>
                <div class="text-xs text-gray-500" id="season-timer">59:59</div>
            </div>
        </div>
        
        <div class="flex gap-6">
            <!-- Sementes (Lateral Esquerda) -->
            <div class="w-80">
                <h2 class="text-2xl font-bold text-green-800 mb-4 text-center">🌱 Sementes</h2>
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button class="seed-btn" onclick="selectSeed('abobora', '🎃')">
                        🎃<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('alface', '🥬')">
                        🥬<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('batata', '🥔')">
                        🥔<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('brocolis', '🥦')">
                        🥦<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('cafe', '🔴')">
                        🔴<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('cenoura', '🥕')">
                        🥕<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('milho', '🌽')">
                        🌽<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('tomate', '🍅')">
                        🍅<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('trigo', '🌾')">
                        🌾<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('uva', '🍇')">
                        🍇<br><span class="text-xs">10💰</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('cacau', '🍫')" id="seed-cacau" style="display: none;">
                        🍫<br><span class="text-xs">Grátis</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('pitaia', '💖')" id="seed-pitaia" style="display: none;">
                        💖<br><span class="text-xs">Grátis</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('avocado', '🥑')" id="seed-avocado" style="display: none;">
                        🥑<br><span class="text-xs">Grátis</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('tulipa', '🌷')" id="seed-tulipa" style="display: none;">
                        🌷<br><span class="text-xs">Grátis</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('lirio', '🪷')" id="seed-lirio" style="display: none;">
                        🪷<br><span class="text-xs">Grátis</span>
                    </button>
                    <button class="seed-btn" onclick="selectSeed('sakura', '🌸')" id="seed-sakura" style="display: none;">
                        🌸<br><span class="text-xs">Grátis</span>
                    </button>
                </div>
                
                <!-- Celeiro -->
                <div class="resource-card mb-4">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🏚️ Celeiro</h3>
                    <div class="celeiro p-3" id="celeiro">
                        <div class="text-center text-gray-500 text-sm">Celeiro vazio</div>
                    </div>
                </div>
                
                <!-- Mercadinho -->
                <div class="resource-card">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🏪 Mercadinho</h3>
                    <div class="p-3" id="mercadinho">
                        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('well', 100)" id="item-well">
                            🪣 Poço de Água - 100💰
                        </button>
                        <button class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('feeder', 150)" id="item-feeder">
                            🍽️ Comedouro - 150💰
                        </button>
                        <button class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('beehive', 200)" id="item-beehive">
                            🐝 Colmeia - 200💰
                        </button>
                        <button class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('doghouse', 300)" id="item-doghouse">
                            🏠 Casinha da Mocinha - 300💰
                        </button>
                        <button class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('stable', 400)" id="item-stable">
                            🏇 Baia do Duque - 400💰
                        </button>
                        <button class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('phone', 500)" id="item-phone">
                            📞 Telefone - 500💰
                        </button>
                        <button class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('chicken_coop', 350)" id="item-chicken_coop">
                            🐔 Galinheiro - 350💰
                        </button>
                        <button class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('pig_pen', 450)" id="item-pig_pen">
                            🐷 Chiqueiro - 450💰
                        </button>
                        <button class="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('cow_pasture', 600)" id="item-cow_pasture">
                            🐄 Pasto das Vacas - 600💰
                        </button>
                        <button class="w-full bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('sheep_pen', 550)" id="item-sheep_pen">
                            🐑 Curral das Ovelhas - 550💰
                        </button>
                        <button class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('grass_field', 300)" id="item-grass_field">
                            🌱 Campo de Grama - 300💰
                        </button>
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('fish_lake', 450)" id="item-fish_lake">
                            🎣 Lago dos Peixes - 450💰
                        </button>
                        <button class="w-full bg-green-800 hover:bg-green-900 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('forest', 500)" id="item-forest">
                            🌳 Bosque - 500💰
                        </button>
                        <button class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('mine', 800)" id="item-mine">
                            ⛏️ Mina - 800💰
                        </button>
                        <button class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('truck', 800)" id="item-truck" style="display: none;">
                            🚚 Caminhonete - 800💰
                        </button>
                        <div class="grid grid-cols-2 gap-2 mt-2" id="flower-seeds-market" style="display: none;">
                            <button class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyFlowerSeed('tulipa', '🌷', 15)">
                                🌷 Tulipa - 15💰
                            </button>
                            <button class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyFlowerSeed('lirio', '🪷', 15)">
                                🪷 Lírio - 15💰
                            </button>
                            <button class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyFlowerSeed('sakura', '🌸', 15)">
                                🌸 Sakura - 15💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="dog-food-market" style="display: none;">
                            <button class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyDogFood()">
                                🦴 Ração para Cachorro - 25💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="diesel-market" style="display: none;">
                            <button class="bg-black hover:bg-gray-800 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyDiesel()">
                                ⛽ Diesel - 30💰
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-2" id="chicken-market" style="display: none;">
                            <button class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyChickenFeed()">
                                🌾 Ração p/ Galinhas - 20💰
                            </button>
                            <button class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyChicken()">
                                🐔 Galinha - 80💰
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-2" id="pig-market" style="display: none;">
                            <button class="bg-amber-700 hover:bg-amber-800 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyPigFeed()">
                                🌽 Ração p/ Porcos - 25💰
                            </button>
                            <button class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyPig()">
                                🐷 Porco - 100💰
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-2" id="cow-market" style="display: none;">
                            <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyCowHay()">
                                🌾 Feno p/ Vacas - 30💰
                            </button>
                            <button class="bg-green-700 hover:bg-green-800 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyCow()">
                                🐄 Vaca - 120💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="vaccine-market" style="display: none;">
                            <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyVaccine()">
                                💉 Vacina Animal - 50💰
                            </button>
                        </div>
                        <div class="grid grid-cols-3 gap-2 mt-2" id="sheep-market" style="display: none;">
                            <button class="bg-green-700 hover:bg-green-800 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buySheepHay()">
                                🌾 Feno p/ Ovelhas - 25💰
                            </button>
                            <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buySheep()">
                                🐑 Ovelha - 90💰
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyShears()">
                                ✂️ Tesoura - 40💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="fishing-market" style="display: none;">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyFishingRod()">
                                🎣 Vara de Pesca - 60💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="forest-market" style="display: none;">
                            <button class="bg-amber-800 hover:bg-amber-900 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyAxe()">
                                🪓 Machado - 80💰
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mt-2" id="mine-market" style="display: none;">
                            <button class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-1 px-2 rounded text-xs transition-colors" onclick="buyPickaxe()">
                                ⛏️ Picareta - 100💰
                            </button>
                        </div>
                        <button class="w-full bg-green-800 hover:bg-green-900 text-white font-bold py-2 px-4 rounded-lg mb-2 transition-colors" onclick="buyItem('composter', 250)" id="item-composter">
                            🗂️ Composteira - 250💰
                        </button>
                        <div class="text-xs text-gray-600 text-center mt-2">Itens únicos - comprou, saiu!</div>
                    </div>
                </div>
                
                <!-- Comedouro -->
                <div class="resource-card mt-4" id="feeder-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🍽️ Comedouro</h3>
                    <div class="flex justify-center">
                        <div class="feeder-slot" id="feeder-slot" onclick="feedBirds()">
                            <div class="text-4xl mb-2">🍽️</div>
                            <div class="text-sm text-gray-600" id="feeder-status">Vazio</div>
                            <div class="text-xs text-gray-500 mt-1">Clique para colocar água ou banana</div>
                        </div>
                    </div>
                    <div class="text-xs text-center text-gray-500 mt-2">
                        Pássaros visitam esporadicamente e trazem sementes especiais!
                    </div>
                </div>
                
                <!-- Colmeia -->
                <div class="resource-card mt-4" id="beehive-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🐝 Colmeia</h3>
                    <div class="flex justify-center gap-4">
                        <div class="bee-station">
                            <div class="bee-icon">🐝</div>
                            <div class="flower-slot-mini" id="bee-slot-0" onclick="plantFlowerInBeehive(0)">
                                <div class="text-2xl">🌱</div>
                                <div class="text-xs">Vazio</div>
                            </div>
                            <div class="honey-status" id="honey-status-0">Sem flor</div>
                        </div>
                        <div class="bee-station">
                            <div class="bee-icon">🐝</div>
                            <div class="flower-slot-mini" id="bee-slot-1" onclick="plantFlowerInBeehive(1)">
                                <div class="text-2xl">🌱</div>
                                <div class="text-xs">Vazio</div>
                            </div>
                            <div class="honey-status" id="honey-status-1">Sem flor</div>
                        </div>
                        <div class="bee-station">
                            <div class="bee-icon">🐝</div>
                            <div class="flower-slot-mini" id="bee-slot-2" onclick="plantFlowerInBeehive(2)">
                                <div class="text-2xl">🌱</div>
                                <div class="text-xs">Vazio</div>
                            </div>
                            <div class="honey-status" id="honey-status-2">Sem flor</div>
                        </div>
                    </div>
                    <div class="text-xs text-center text-gray-500 mt-2">
                        Plante flores especiais para as abelhas produzirem mel!
                    </div>
                </div>
                
                <!-- Casinha da Mocinha -->
                <div class="resource-card mt-4" id="doghouse-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🏠 Casinha da Mocinha</h3>
                    <div class="flex justify-center gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2">🐕</div>
                            <div class="text-sm font-bold">Mocinha</div>
                            <div class="text-xs text-gray-600" id="friendship-level">Amizade: 0/100</div>
                            <div class="w-20 h-2 bg-gray-200 rounded-full mt-1">
                                <div class="h-full bg-pink-500 rounded-full transition-all duration-300" id="friendship-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center gap-4 mb-4">
                        <div class="dog-food-slot" id="dog-food-slot" onclick="feedMocinha()">
                            <div class="text-2xl">🍽️</div>
                            <div class="text-xs">Vazio</div>
                            <div class="text-xs text-gray-500 mt-1">Clique para dar ração</div>
                        </div>
                        <div class="treasure-chest" id="treasure-chest" onclick="openTreasureChest()">
                            <div class="text-2xl">📦</div>
                            <div class="text-xs">Baú</div>
                            <div class="text-xs text-gray-500 mt-1" id="treasure-count">0 tesouros</div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-gray-500" id="mocinha-status">Mocinha está descansando</div>
                        <button class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded text-xs mt-2 transition-colors" onclick="giveBone()" id="bone-btn">
                            🦴 Dar Osso (+20% chance de chave)
                        </button>
                    </div>
                </div>
                
                <!-- Baia do Duque -->
                <div class="resource-card mt-4" id="stable-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🏇 Baia do Duque</h3>
                    <div class="flex justify-center gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="duke-horse">🐎</div>
                            <div class="text-sm font-bold">Duque</div>
                            <div class="text-xs text-gray-600" id="duke-friendship-level">Amizade: 0/100</div>
                            <div class="w-20 h-2 bg-gray-200 rounded-full mt-1">
                                <div class="h-full bg-blue-500 rounded-full transition-all duration-300" id="duke-friendship-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center gap-4 mb-4">
                        <div class="dog-food-slot" id="hay-slot" onclick="feedDuke()">
                            <div class="text-2xl">🌾</div>
                            <div class="text-xs">Vazio</div>
                            <div class="text-xs text-gray-500 mt-1">2 fenos necessários</div>
                        </div>
                        <div class="dog-food-slot" id="apple-slot" onclick="giveApple()">
                            <div class="text-2xl">🍎</div>
                            <div class="text-xs">Vazio</div>
                            <div class="text-xs text-gray-500 mt-1">Clique para dar maçã</div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-gray-500" id="duke-status">Duque está descansando</div>
                        <div class="text-xs text-gray-400 mt-1" id="duke-work-timer"></div>
                        <div class="text-xs text-gray-400 mt-1">
                            Use o painel de pedidos para fazer entregas
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fazenda (Centro) -->
            <div class="flex-1">
                <h2 class="text-2xl font-bold text-green-800 mb-4 text-center">🚜 Fazenda</h2>
                <div class="flex justify-center mb-6">
                    <div class="grid grid-cols-4 gap-4 p-6 bg-green-200 rounded-2xl border-4 border-green-400">
                        <!-- Canteiros -->
                        <div class="canteiro" id="canteiro-0" onclick="clickCanteiro(0)"></div>
                        <div class="canteiro" id="canteiro-1" onclick="clickCanteiro(1)"></div>
                        <div class="canteiro" id="canteiro-2" onclick="clickCanteiro(2)"></div>
                        <div class="canteiro" id="canteiro-3" onclick="clickCanteiro(3)"></div>
                        <div class="canteiro" id="canteiro-4" onclick="clickCanteiro(4)"></div>
                        <div class="canteiro" id="canteiro-5" onclick="clickCanteiro(5)"></div>
                        <div class="canteiro" id="canteiro-6" onclick="clickCanteiro(6)"></div>
                        <div class="canteiro" id="canteiro-7" onclick="clickCanteiro(7)"></div>
                    </div>
                </div>
                
                <!-- Poço de Água -->
                <div class="flex justify-center mb-6" id="well-container" style="display: none;">
                    <div class="resource-card">
                        <div class="text-center">
                            <button class="text-4xl hover:scale-110 transition-transform cursor-pointer bg-blue-100 rounded-full p-4" onclick="collectWater()">
                                🪣
                            </button>
                            <div class="text-sm text-gray-600 mt-2">Poço de Água</div>
                            <div class="text-xs text-gray-500">Clique para coletar 4 baldes</div>
                        </div>
                    </div>
                </div>
                
                <!-- Galinheiro -->
                <div class="resource-card mb-6" id="chicken-coop-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🐔 Galinheiro</h3>
                    
                    <div class="grid grid-cols-4 gap-3 mb-4" id="chicken-slots">
                        <div class="chicken-slot" id="chicken-slot-0" onclick="manageChickenSlot(0)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="food-slot-0" onclick="feedChicken(0, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="chicken-slot-1" onclick="manageChickenSlot(1)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="food-slot-1" onclick="feedChicken(1, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="chicken-slot-2" onclick="manageChickenSlot(2)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="food-slot-2" onclick="feedChicken(2, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="chicken-slot-3" onclick="manageChickenSlot(3)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="food-slot-3" onclick="feedChicken(3, event)">
                                🌾
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="feedAllChickens()" id="feed-all-btn">
                            🌾 Alimentar Todas
                        </button>
                        <button class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="showSacrificeMenu()" id="sacrifice-btn">
                            🔪 Sacrificar
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>2-3 galinhas: +10% chance de pintinho • Pintinho vira adulto em 30min</div>
                        <div id="chicken-status">0/4 galinhas no galinheiro</div>
                    </div>
                </div>

                <!-- Chiqueiro -->
                <div class="resource-card mb-6" id="pig-pen-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🐷 Chiqueiro</h3>
                    
                    <div class="grid grid-cols-4 gap-3 mb-4" id="pig-slots">
                        <div class="chicken-slot" id="pig-slot-0" onclick="managePigSlot(0)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="pig-food-slot-0" onclick="feedPig(0, event)">
                                🌽
                            </div>
                        </div>
                        <div class="chicken-slot" id="pig-slot-1" onclick="managePigSlot(1)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="pig-food-slot-1" onclick="feedPig(1, event)">
                                🌽
                            </div>
                        </div>
                        <div class="chicken-slot" id="pig-slot-2" onclick="managePigSlot(2)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="pig-food-slot-2" onclick="feedPig(2, event)">
                                🌽
                            </div>
                        </div>
                        <div class="chicken-slot" id="pig-slot-3" onclick="managePigSlot(3)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="pig-food-slot-3" onclick="feedPig(3, event)">
                                🌽
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="feedAllPigs()" id="feed-all-pigs-btn">
                            🌽 Alimentar Todos
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>15s para comer • 10s para produzir carne • 10min de descanso</div>
                        <div id="pig-status">0/4 porcos no chiqueiro</div>
                    </div>
                </div>

                <!-- Pasto das Vacas -->
                <div class="resource-card mb-6" id="cow-pasture-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🐄 Pasto das Vacas</h3>
                    
                    <div class="grid grid-cols-4 gap-3 mb-4" id="cow-slots">
                        <div class="chicken-slot" id="cow-slot-0" onclick="manageCowSlot(0)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="cow-food-slot-0" onclick="feedCow(0, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="cow-slot-1" onclick="manageCowSlot(1)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="cow-food-slot-1" onclick="feedCow(1, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="cow-slot-2" onclick="manageCowSlot(2)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="cow-food-slot-2" onclick="feedCow(2, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="cow-slot-3" onclick="manageCowSlot(3)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="cow-food-slot-3" onclick="feedCow(3, event)">
                                🌾
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="feedAllCows()" id="feed-all-cows-btn">
                            🌾 Alimentar Todas
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>15s para comer • 10s para produzir leite • 10min de descanso</div>
                        <div id="cow-status">0/4 vacas no pasto</div>
                    </div>
                </div>
                
                <!-- Campo de Flores (Primavera) -->
                <div class="flex justify-center mb-6" id="flower-field-container">
                    <div class="flower-field" id="flower-field">
                        <h3 class="text-xl font-bold text-center text-green-800 mb-4">🌸 Campo de Flores</h3>
                        <div class="flex gap-4 justify-center">
                            <div class="flower-slot" id="flower-slot-0" onclick="collectFlower(0)">
                                <div class="flower-display" id="flower-display-0">
                                    <span class="flower-icon">🌹</span>
                                    <span class="flower-icon">🌹</span>
                                    <span class="flower-icon">🌹</span>
                                </div>
                                <div class="flower-name">Rosa</div>
                                <div class="flower-timer" id="flower-timer-0"></div>
                            </div>
                            <div class="flower-slot" id="flower-slot-1" onclick="collectFlower(1)">
                                <div class="flower-display" id="flower-display-1">
                                    <span class="flower-icon">🌻</span>
                                    <span class="flower-icon">🌻</span>
                                    <span class="flower-icon">🌻</span>
                                </div>
                                <div class="flower-name">Girassol</div>
                                <div class="flower-timer" id="flower-timer-1"></div>
                            </div>
                            <div class="flower-slot" id="flower-slot-2" onclick="collectFlower(2)">
                                <div class="flower-display" id="flower-display-2">
                                    <span class="flower-icon">🌼</span>
                                    <span class="flower-icon">🌼</span>
                                    <span class="flower-icon">🌼</span>
                                </div>
                                <div class="flower-name">Margarida</div>
                                <div class="flower-timer" id="flower-timer-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Curral das Ovelhas -->
                <div class="resource-card mb-6" id="sheep-pen-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🐑 Curral das Ovelhas</h3>
                    
                    <div class="grid grid-cols-4 gap-3 mb-4" id="sheep-slots">
                        <div class="chicken-slot" id="sheep-slot-0" onclick="manageSheepSlot(0)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="sheep-food-slot-0" onclick="feedSheep(0, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="sheep-slot-1" onclick="manageSheepSlot(1)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="sheep-food-slot-1" onclick="feedSheep(1, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="sheep-slot-2" onclick="manageSheepSlot(2)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="sheep-food-slot-2" onclick="feedSheep(2, event)">
                                🌾
                            </div>
                        </div>
                        <div class="chicken-slot" id="sheep-slot-3" onclick="manageSheepSlot(3)">
                            <div class="text-4xl mb-2">🏠</div>
                            <div class="text-xs">Vazio</div>
                            <div class="chicken-food-slot" id="sheep-food-slot-3" onclick="feedSheep(3, event)">
                                🌾
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="feedAllSheep()" id="feed-all-sheep-btn">
                            🌾 Alimentar Todas
                        </button>
                        <button class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="shearAllSheep()" id="shear-all-btn">
                            ✂️ Tosquiar Todas
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>15s para comer • 5s para produzir lã • 10min de descanso</div>
                        <div id="sheep-status">0/4 ovelhas no curral</div>
                    </div>
                </div>

                <!-- Campo de Grama -->
                <div class="resource-card mb-6" id="grass-field-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🌱 Campo de Grama</h3>
                    
                    <div class="grid grid-cols-5 gap-2 mb-4" id="grass-slots">
                        <!-- 20 slots de grama serão criados aqui -->
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="collectAllGrass()" id="collect-all-grass-btn">
                            🌱 Coletar Toda Grama
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Grama renasce em 1 minuto • A cada 8 gramas coletadas, ganha 1 flor</div>
                        <div id="grass-status">Gramas coletadas: 0 | Próxima flor em: 8</div>
                    </div>
                </div>

                <!-- Lago dos Peixes -->
                <div class="resource-card mb-6" id="fish-lake-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🎣 Lago dos Peixes</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4" id="fish-slots">
                        <div class="fish-slot" id="fish-slot-0" onclick="catchFish(0)">
                            <div class="text-4xl mb-2">🐟</div>
                            <div class="text-xs">Peixe disponível</div>
                        </div>
                        <div class="fish-slot" id="fish-slot-1" onclick="catchFish(1)">
                            <div class="text-4xl mb-2">🐟</div>
                            <div class="text-xs">Peixe disponível</div>
                        </div>
                        <div class="fish-slot" id="fish-slot-2" onclick="catchFish(2)">
                            <div class="text-4xl mb-2">🐟</div>
                            <div class="text-xs">Peixe disponível</div>
                        </div>
                        <div class="fish-slot" id="fish-slot-3" onclick="catchFish(3)">
                            <div class="text-4xl mb-2">🐟</div>
                            <div class="text-xs">Peixe disponível</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="catchAllFish()" id="catch-all-fish-btn">
                            🎣 Pescar Todos
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Precisa de vara de pesca e minhocas • A cada 5 peixes coletados, ganha 1 pérola</div>
                        <div id="fishing-status">Peixes coletados: 0 | Próxima pérola em: 5</div>
                        <div id="fishing-rod-status">Vara: Nenhuma</div>
                    </div>
                </div>

                <!-- Bosque -->
                <div class="resource-card mb-6" id="forest-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🌳 Bosque</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4" id="forest-trees">
                        <!-- Árvore Comum -->
                        <div class="fish-slot" id="common-tree" onclick="chopTree('common')">
                            <div class="text-4xl mb-2">🌳</div>
                            <div class="text-xs">Árvore Comum</div>
                            <div class="text-xs text-gray-500">Infinitos troncos</div>
                        </div>
                        
                        <!-- Macieira -->
                        <div class="fish-slot" id="apple-tree" onclick="harvestFruit('apple')">
                            <div class="text-4xl mb-2">🍎</div>
                            <div class="text-xs">Macieira</div>
                            <div class="text-xs text-gray-500" id="apple-count">4 maçãs</div>
                        </div>
                        
                        <!-- Laranjeira -->
                        <div class="fish-slot" id="orange-tree" onclick="harvestFruit('orange')">
                            <div class="text-4xl mb-2">🍊</div>
                            <div class="text-xs">Laranjeira</div>
                            <div class="text-xs text-gray-500" id="orange-count">4 laranjas</div>
                        </div>
                        
                        <!-- Bananeira -->
                        <div class="fish-slot" id="banana-tree" onclick="harvestFruit('banana')">
                            <div class="text-4xl mb-2">🍌</div>
                            <div class="text-xs">Bananeira</div>
                            <div class="text-xs text-gray-500" id="banana-count">4 bananas</div>
                        </div>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Precisa de machado para cortar troncos • A cada 3 troncos coletados, ganha 1 galho</div>
                        <div id="forest-status">Troncos coletados: 0 | Próximo galho em: 3</div>
                        <div id="axe-status">Machado: Nenhum</div>
                    </div>
                </div>
                
                <!-- Caminhonete -->
                <div class="resource-card mb-4" id="truck-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🚚 Caminhonete</h3>
                    <div class="flex justify-center mb-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2">🚚</div>
                            <div class="text-sm font-bold">Caminhonete de Entregas</div>
                            <div class="text-xs text-gray-600" id="truck-fuel-level">Combustível: 0/10</div>
                            <div class="w-32 h-2 bg-gray-200 rounded-full mt-1">
                                <div class="h-full bg-yellow-500 rounded-full transition-all duration-300" id="truck-fuel-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2 mb-4" id="truck-slots">
                        <div class="truck-slot" id="truck-slot-0" onclick="manageTruckSlot(0)">
                            <div class="text-2xl">📦</div>
                            <div class="text-xs">Vazio</div>
                        </div>
                        <div class="truck-slot" id="truck-slot-1" onclick="manageTruckSlot(1)">
                            <div class="text-2xl">📦</div>
                            <div class="text-xs">Vazio</div>
                        </div>
                        <div class="truck-slot" id="truck-slot-2" onclick="manageTruckSlot(2)">
                            <div class="text-2xl">📦</div>
                            <div class="text-xs">Vazio</div>
                        </div>
                        <div class="truck-slot" id="truck-slot-3" onclick="manageTruckSlot(3)">
                            <div class="text-2xl">📦</div>
                            <div class="text-xs">Vazio</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="refuelTruck()" id="refuel-btn">
                            ⛽ Abastecer (30💰)
                        </button>
                        <button class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="startTruckDelivery()" id="deliver-truck-btn">
                            🚚 Entregar Pedido
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Consome 2 diesel a cada 3 viagens • Entrega em 15 segundos</div>
                        <div id="truck-status">Pronta para entregas</div>
                    </div>
                </div>

                <!-- Painel de Pedidos dos Clientes -->
                <div class="resource-card mb-4" id="orders-panel" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">📋 Pedidos dos Clientes</h3>
                    <div class="space-y-3" id="orders-container">
                        <!-- Pedidos aparecerão aqui -->
                    </div>
                    <div class="text-xs text-center text-gray-500 mt-2">
                        Máximo 3 pedidos por vez • Sem limite de tempo
                    </div>
                </div>

                <!-- Área de Cortar Lenha -->
                <div class="resource-card mb-6" id="wood-cutting-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🪓 Cortar Lenha</h3>
                    
                    <div class="flex justify-center mb-4">
                        <div class="fish-slot" id="wood-cutting-slot" onclick="addTrunkToWoodCutting()">
                            <div class="text-4xl mb-2">📦</div>
                            <div class="text-xs">Slot vazio</div>
                            <div class="text-xs text-gray-500">Clique para adicionar tronco</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="cutWood()" id="cut-wood-btn" disabled>
                            🪓 Cortar (3s)
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>1 tronco = 4 lenhas • Machado: <span id="axe-uses">40/40</span> usos</div>
                        <div id="wood-cutting-status">Adicione um tronco para começar</div>
                    </div>
                </div>

                <!-- Mina -->
                <div class="resource-card mb-6" id="mine-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">⛏️ Mina</h3>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4" id="mine-rocks">
                        <div class="fish-slot" id="rock-slot-0" onclick="mineRock(0)">
                            <div class="text-4xl mb-2">🪨</div>
                            <div class="text-xs">Rocha</div>
                            <div class="text-xs text-gray-500" id="rock-hits-0">3/3 batidas</div>
                        </div>
                        <div class="fish-slot" id="rock-slot-1" onclick="mineRock(1)">
                            <div class="text-4xl mb-2">🪨</div>
                            <div class="text-xs">Rocha</div>
                            <div class="text-xs text-gray-500" id="rock-hits-1">3/3 batidas</div>
                        </div>
                        <div class="fish-slot" id="rock-slot-2" onclick="mineRock(2)">
                            <div class="text-4xl mb-2">🪨</div>
                            <div class="text-xs">Rocha</div>
                            <div class="text-xs text-gray-500" id="rock-hits-2">3/3 batidas</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="mineAllRocks()" id="mine-all-btn">
                            ⛏️ Minerar Todas
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Precisa de picareta e chave • Picareta: <span id="pickaxe-uses">30/30</span> usos</div>
                        <div id="mine-status">Use chave para entrar na mina</div>
                    </div>
                </div>

                <!-- Composteira -->
                <div class="resource-card mb-6" id="composter-container" style="display: none;">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🗂️ Composteira</h3>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4" id="composter-slots">
                        <div class="fish-slot" id="composter-slot-0" onclick="manageComposterSlot(0)">
                            <div class="text-4xl mb-2">🌸</div>
                            <div class="text-xs">Flores</div>
                            <div class="text-xs text-gray-500" id="composter-count-0">0 flores</div>
                        </div>
                        <div class="fish-slot" id="composter-slot-1" onclick="manageComposterSlot(1)">
                            <div class="text-4xl mb-2">🌿</div>
                            <div class="text-xs">Galhos</div>
                            <div class="text-xs text-gray-500" id="composter-count-1">0 galhos</div>
                        </div>
                        <div class="fish-slot" id="composter-slot-2" onclick="manageComposterSlot(2)">
                            <div class="text-4xl mb-2">💩</div>
                            <div class="text-xs">Esterco</div>
                            <div class="text-xs text-gray-500" id="composter-count-2">0 estercos</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <button class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="startComposting()" id="compost-btn">
                            🌱 Fazer Adubo (30s)
                        </button>
                    </div>
                    
                    <div class="text-xs text-center text-gray-500">
                        <div>Precisa: 1 flor + 1 galho + 1 esterco = 1 adubo</div>
                        <div id="composter-status">Adicione ingredientes para começar</div>
                    </div>
                </div>

                <!-- Quitanda -->
                <div class="resource-card">
                    <h3 class="text-xl font-bold text-center text-green-800 mb-3">🏬 Quitanda</h3>
                    <div class="grid grid-cols-5 gap-2 mb-4" id="quitanda-slots">
                        <!-- 20 slots vazios -->
                    </div>
                    <button class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="sellAll()">
                        💰 Vender Tudo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado do jogo
        let gameState = {
            coins: 200,
            water: 10,
            fertilizer: 50,
            compost: 0,
            farmer: {
                energy: 200,
                maxEnergy: 200,
                isResting: false,
                restTimer: 0,
                isSick: false,
                sickTimer: 0,
                isDead: false,
                energyDrainRate: 1, // Normal: 1, Doente: 2
                lastAction: Date.now()
            },
            selectedSeed: null,
            selectedSeedEmoji: null,
            canteiros: Array(8).fill().map(() => ({
                state: 'empty', // empty, fertilized, planted, watered, ready
                seedType: null,
                seedEmoji: null,
                timer: null,
                progress: 0
            })),
            celeiro: {},
            harvestedCount: 0,
            quitanda: {},
            hasWell: false,
            isRaining: false,
            rainTimer: null,
            marketItems: {
                well: true,
                feeder: true,
                beehive: true,
                doghouse: true,
                stable: true,
                phone: true,
                chicken_coop: true,
                pig_pen: true,
                cow_pasture: true,
                sheep_pen: true,
                grass_field: true,
                fish_lake: true,
                forest: true,
                mine: true,
                composter: true,
                kitchen: true
            },
            currentSeason: 0, // 0=Primavera, 1=Verão, 2=Outono, 3=Inverno
            seasonTimeLeft: 3600, // 1 hora em segundos
            seasons: [
                { name: 'Primavera', emoji: '🌸', bonus: 'Plantações +10%' },
                { name: 'Verão', emoji: '☀️', bonus: 'Dupla colheita' },
                { name: 'Outono', emoji: '🍂', bonus: 'Animais +15%' },
                { name: 'Inverno', emoji: '❄️', bonus: 'Fabricados +15%' }
            ],
            flowerField: {
                flowers: [
                    { type: 'rosa', emoji: '🌹', available: 3, timers: [0, 0, 0] },
                    { type: 'girassol', emoji: '🌻', available: 3, timers: [0, 0, 0] },
                    { type: 'margarida', emoji: '🌼', available: 3, timers: [0, 0, 0] }
                ],
                totalCollected: 0
            },
            feeder: {
                hasFeeder: false,
                isEmpty: true,
                foodType: null, // 'water' ou 'banana'
                birdVisitTimer: 0,
                availableSeeds: {
                    cacau: false,
                    pitaia: false,
                    avocado: false
                }
            },
            beehive: {
                hasBeehive: false,
                bees: [
                    { hasFlower: false, flowerType: null, flowerEmoji: null, isGrowing: false, isPollenating: false, honeyTimer: 0, honeyReady: false },
                    { hasFlower: false, flowerType: null, flowerEmoji: null, isGrowing: false, isPollenating: false, honeyTimer: 0, honeyReady: false },
                    { hasFlower: false, flowerType: null, flowerEmoji: null, isGrowing: false, isPollenating: false, honeyTimer: 0, honeyReady: false }
                ],
                availableFlowerSeeds: {
                    tulipa: false,
                    lirio: false,
                    sakura: false
                }
            },
            doghouse: {
                hasDoghouse: false,
                friendship: 0,
                isHunting: false,
                isResting: false,
                huntingTimer: 0,
                restingTimer: 0,
                hasFoodInSlot: false,
                treasures: {
                    bola: 0,
                    cd: 0,
                    sapato: 0,
                    chave: 0
                },
                bonusChance: false, // Bônus de 20% para chave quando come osso
                dogFoodPurchased: 0 // Contador para dar osso a cada 2 rações
            },
            stable: {
                hasStable: false,
                friendship: 0,
                isWorking: false,
                isSick: false,
                workTimer: 0,
                sickTimer: 0,
                hasHayInSlot: false,
                hasAppleInSlot: false,
                hayCount: 0, // Contador de fenos no slot (precisa de 2)
                lastAppleTime: 0, // Timestamp da última maçã para evitar doença
                sicknessPrevented: false // Flag para prevenir doença com maçã
            },
            orders: {
                hasOrdersPanel: false,
                activeOrders: [], // Máximo 3 pedidos
                nextOrderId: 1,
                orderGenerationTimer: 0
            },
            mailbox: {
                messages: [],
                hasNewMail: false,
                nextMessageId: 1,
                newspaperTimer: 1500, // 25 minutos em segundos
                letterTimer: 2400 // 40 minutos em segundos
            },
            phone: {
                hasPhone: false,
                isRinging: false,
                currentCall: null,
                callTimer: 2100, // 35 minutos em segundos
                nextCallId: 1
            },
            truck: {
                hasTruck: false,
                fuel: 0, // 0-10 litros
                maxFuel: 10,
                slots: [null, null, null, null], // 4 slots para mercadorias
                isDelivering: false,
                deliveryTimer: 0,
                tripsCount: 0, // Contador de viagens para consumo de combustível
                currentPhoneOrder: null // Pedido do telefone sendo entregue
            },
            chickenCoop: {
                hasChickenCoop: false,
                chickens: [
                    { hasChicken: false, type: 'adult', isEating: false, isLaying: false, isResting: false, hasFood: false, eatingTimer: 0, layingTimer: 0, restingTimer: 0, eggsReady: 0, growthTimer: 0, isSick: false, sickTimer: 0 },
                    { hasChicken: false, type: 'adult', isEating: false, isLaying: false, isResting: false, hasFood: false, eatingTimer: 0, layingTimer: 0, restingTimer: 0, eggsReady: 0, growthTimer: 0, isSick: false, sickTimer: 0 },
                    { hasChicken: false, type: 'adult', isEating: false, isLaying: false, isResting: false, hasFood: false, eatingTimer: 0, layingTimer: 0, restingTimer: 0, eggsReady: 0, growthTimer: 0, isSick: false, sickTimer: 0 },
                    { hasChicken: false, type: 'adult', isEating: false, isLaying: false, isResting: false, hasFood: false, eatingTimer: 0, layingTimer: 0, restingTimer: 0, eggsReady: 0, growthTimer: 0, isSick: false, sickTimer: 0 }
                ],
                totalChickens: 0,
                chickFeedPurchased: 0
            },
            pigPen: {
                hasPigPen: false,
                pigs: [
                    { hasPig: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, meatReady: 0, isSick: false, sickTimer: 0 },
                    { hasPig: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, meatReady: 0, isSick: false, sickTimer: 0 },
                    { hasPig: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, meatReady: 0, isSick: false, sickTimer: 0 },
                    { hasPig: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, meatReady: 0, isSick: false, sickTimer: 0 }
                ],
                totalPigs: 0,
                pigFeedPurchased: 0
            },
            cowPasture: {
                hasCowPasture: false,
                cows: [
                    { hasCow: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, milkReady: 0, isSick: false, sickTimer: 0 },
                    { hasCow: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, milkReady: 0, isSick: false, sickTimer: 0 },
                    { hasCow: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, milkReady: 0, isSick: false, sickTimer: 0 },
                    { hasCow: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, milkReady: 0, isSick: false, sickTimer: 0 }
                ],
                totalCows: 0,
                cowHayPurchased: 0
            },
            animalSickness: {
                lastSicknessTime: 0,
                sicknessCooldown: 300000, // 5 minutos entre doenças
                sicknessDuration: 300 // 5 minutos para vacinar
            },
            sheepPen: {
                hasSheepPen: false,
                sheep: [
                    { hasSheep: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, woolReady: 0, isSick: false, sickTimer: 0 },
                    { hasSheep: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, woolReady: 0, isSick: false, sickTimer: 0 },
                    { hasSheep: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, woolReady: 0, isSick: false, sickTimer: 0 },
                    { hasSheep: false, isEating: false, isProducing: false, isResting: false, hasFood: false, eatingTimer: 0, producingTimer: 0, restingTimer: 0, woolReady: 0, isSick: false, sickTimer: 0 }
                ],
                totalSheep: 0,
                sheepHayPurchased: 0,
                hasShears: false
            },
            grassField: {
                hasGrassField: false,
                grassSlots: Array(20).fill().map(() => ({
                    hasGrass: true,
                    regrowTimer: 0
                })),
                totalGrassCollected: 0,
                flowersEarned: 0
            },
            fishLake: {
                hasFishLake: false,
                fishSlots: Array(4).fill().map(() => ({
                    hasFish: true,
                    respawnTimer: 0
                })),
                totalFishCaught: 0,
                pearlsEarned: 0,
                fishingRod: {
                    hasRod: false,
                    usesLeft: 0
                }
            },
            forest: {
                hasForest: false,
                totalTrunksCollected: 0,
                branchesEarned: 0,
                axe: {
                    hasAxe: false,
                    usesLeft: 40
                },
                fruitTrees: {
                    apple: { fruitsLeft: 4 },
                    orange: { fruitsLeft: 4 },
                    banana: { fruitsLeft: 4 }
                }
            },
            woodCutting: {
                hasWoodCutting: false,
                hasTrunkInSlot: false,
                isCutting: false,
                cuttingTimer: 0
            },
            mine: {
                hasMine: false,
                hasAccess: false, // Precisa de chave para entrar
                pickaxe: {
                    hasPickaxe: false,
                    usesLeft: 30
                },
                rocks: [
                    { hitsLeft: 3, isRespawning: false, respawnTimer: 0 },
                    { hitsLeft: 3, isRespawning: false, respawnTimer: 0 },
                    { hitsLeft: 3, isRespawning: false, respawnTimer: 0 }
                ],
                totalGemsFound: 0
            },
            composter: {
                hasComposter: false,
                slots: [
                    { type: 'flowers', count: 0, items: [] }, // Slot 0: Flores
                    { type: 'branches', count: 0, items: [] }, // Slot 1: Galhos
                    { type: 'manure', count: 0, items: [] }    // Slot 2: Esterco
                ],
                isComposting: false,
                compostingTimer: 0
            }
        };

        // Atualizar display dos recursos
        function updateResources() {
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('water').textContent = gameState.water;
            document.getElementById('fertilizer').textContent = gameState.fertilizer;
            document.getElementById('compost').textContent = gameState.compost;
        }

        // Sistema do Fazendeiro
        function updateFarmerDisplay() {
            const energyDisplay = document.getElementById('energy-display');
            const energyBar = document.getElementById('energy-bar');
            const farmerAvatar = document.getElementById('farmer-avatar');
            const farmerStatus = document.getElementById('farmer-status');
            const sickIndicator = document.getElementById('sick-indicator');
            const restBtn = document.getElementById('rest-btn');
            const eatBtn = document.getElementById('eat-btn');
            
            // Atualizar energia
            energyDisplay.textContent = `${gameState.farmer.energy}/${gameState.farmer.maxEnergy}`;
            const energyPercent = (gameState.farmer.energy / gameState.farmer.maxEnergy) * 100;
            energyBar.style.width = `${energyPercent}%`;
            
            // Cores da barra de energia
            energyBar.className = 'h-full rounded-full transition-all duration-300';
            if (energyPercent <= 10) {
                energyBar.classList.add('energy-bar-critical');
            } else if (energyPercent <= 30) {
                energyBar.classList.add('energy-bar-low');
            } else {
                energyBar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
            }
            
            // Resetar classes do avatar
            farmerAvatar.className = 'text-6xl mb-2';
            
            // Estados do fazendeiro
            if (gameState.farmer.isDead) {
                farmerAvatar.classList.add('farmer-dead');
                farmerStatus.textContent = 'Morto 💀';
                restBtn.disabled = true;
                eatBtn.disabled = true;
                sickIndicator.style.display = 'none';
            } else if (gameState.farmer.isResting) {
                farmerAvatar.classList.add('farmer-resting');
                const minutes = Math.floor(gameState.farmer.restTimer / 60);
                const seconds = gameState.farmer.restTimer % 60;
                farmerStatus.textContent = `Descansando ${minutes}:${seconds.toString().padStart(2, '0')}`;
                restBtn.disabled = true;
                eatBtn.disabled = true;
                sickIndicator.style.display = gameState.farmer.isSick ? 'flex' : 'none';
            } else if (gameState.farmer.isSick) {
                farmerAvatar.classList.add('farmer-sick');
                farmerStatus.textContent = 'Doente 🤒';
                sickIndicator.style.display = 'flex';
                restBtn.disabled = false;
                eatBtn.disabled = false;
            } else {
                farmerStatus.textContent = 'Trabalhando';
                sickIndicator.style.display = 'none';
                restBtn.disabled = false;
                eatBtn.disabled = false;
            }
        }
        
        function consumeEnergy(amount = 1) {
            if (gameState.farmer.isDead || gameState.farmer.isResting) {
                return false; // Não pode fazer ações
            }
            
            gameState.farmer.energy = Math.max(0, gameState.farmer.energy - amount);
            gameState.farmer.lastAction = Date.now();
            
            if (gameState.farmer.energy === 0) {
                if (gameState.farmer.isSick) {
                    // Morrer se estiver doente e energia chegar a 0
                    gameState.farmer.isDead = true;
                    alert('💀 Você morreu de exaustão! O jogo será reiniciado...');
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                } else {
                    alert('⚠️ Sua energia está no limite! Descanse ou coma algo urgentemente!');
                }
            }
            
            updateFarmerDisplay();
            return true;
        }
        
        function restFarmer() {
            if (gameState.farmer.isDead) {
                alert('💀 Você não pode descansar porque está morto!');
                return;
            }
            
            if (gameState.farmer.isResting) {
                alert('😴 Você já está descansando!');
                return;
            }
            
            gameState.farmer.isResting = true;
            gameState.farmer.restTimer = 300; // 5 minutos em segundos
            
            updateFarmerDisplay();
            alert('😴 Você começou a descansar por 5 minutos. Não poderá trabalhar durante este período.');
        }
        
        function finishResting() {
            gameState.farmer.isResting = false;
            gameState.farmer.restTimer = 0;
            gameState.farmer.energy = gameState.farmer.maxEnergy; // Recupera energia total
            
            updateFarmerDisplay();
            alert('😊 Você terminou de descansar e recuperou toda sua energia!');
        }
        
        function makeFarmerSick() {
            if (gameState.farmer.isDead || gameState.farmer.isSick) return;
            
            gameState.farmer.isSick = true;
            gameState.farmer.sickTimer = 1800; // 30 minutos doente
            gameState.farmer.energyDrainRate = 2; // Energia cai mais rápido
            
            updateFarmerDisplay();
            alert('🤒 Você ficou doente! Sua energia cairá mais rápido. Tome chá para se curar!');
        }
        
        function showFoodMenu() {
            if (gameState.farmer.isDead) {
                alert('💀 Você não pode comer porque está morto!');
                return;
            }
            
            document.getElementById('food-modal').style.display = 'flex';
            updateFoodMenu();
        }
        
        function closeFoodMenu() {
            document.getElementById('food-modal').style.display = 'none';
        }
        
        function updateFoodMenu() {
            const foodMenu = document.getElementById('food-menu');
            
            const foods = [
                { 
                    name: 'Salada', 
                    emoji: '🥗', 
                    recovery: 30, 
                    ingredients: [
                        { type: 'alface', count: 2, name: 'Alface' },
                        { type: 'tomate', count: 1, name: 'Tomate' },
                        { type: 'cenoura', count: 1, name: 'Cenoura' }
                    ]
                },
                { 
                    name: 'Ensopado', 
                    emoji: '🍲', 
                    recovery: 40, 
                    ingredients: [
                        { type: 'batata', count: 2, name: 'Batata' },
                        { type: 'cenoura', count: 2, name: 'Cenoura' },
                        { type: 'brocolis', count: 1, name: 'Brócolis' }
                    ]
                },
                { 
                    name: 'Bife', 
                    emoji: '🥩', 
                    recovery: 100, 
                    ingredients: [
                        { type: 'trigo', count: 3, name: 'Trigo (para ração)' },
                        { type: 'milho', count: 2, name: 'Milho (para ração)' }
                    ]
                },
                { 
                    name: 'Peixe Assado', 
                    emoji: '🐟', 
                    recovery: 50, 
                    ingredients: [
                        { type: 'minhoca', count: 3, name: 'Minhoca (para pescar)' }
                    ]
                },
                { 
                    name: 'Frango Assado', 
                    emoji: '🍗', 
                    recovery: 70, 
                    ingredients: [
                        { type: 'milho', count: 4, name: 'Milho (para ração)' },
                        { type: 'trigo', count: 2, name: 'Trigo (para ração)' }
                    ]
                },
                { 
                    name: 'Chá Medicinal', 
                    emoji: '🍵', 
                    recovery: 0, 
                    isMedicine: true,
                    ingredients: [
                        { type: 'erva', count: 2, name: 'Erva' }
                    ]
                }
            ];
            
            let html = '';
            foods.forEach(food => {
                // Verificar se tem todos os ingredientes
                let canMake = true;
                let ingredientsText = '';
                
                food.ingredients.forEach((ingredient, index) => {
                    if (index > 0) ingredientsText += ', ';
                    ingredientsText += `${ingredient.count}x ${ingredient.name}`;
                    
                    if (!gameState.celeiro[ingredient.type] || gameState.celeiro[ingredient.type].count < ingredient.count) {
                        canMake = false;
                    }
                });
                
                // Chá só pode ser tomado quando doente
                if (food.isMedicine && !gameState.farmer.isSick) {
                    canMake = false;
                }
                
                const itemClass = canMake ? 'food-item' : 'food-item unavailable';
                const recoveryText = food.isMedicine ? 'Cura doença' : `+${food.recovery}% energia`;
                
                html += `
                    <div class="${itemClass}" onclick="${canMake ? `eatFood('${food.name}')` : ''}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">${food.emoji}</div>
                                <div>
                                    <div class="font-bold">${food.name}</div>
                                    <div class="text-xs text-gray-600">${recoveryText}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">Precisa:</div>
                                <div class="text-xs">${ingredientsText}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            foodMenu.innerHTML = html;
        }
        
        function eatFood(foodName) {
            const foods = {
                'Salada': { 
                    recovery: 30, 
                    ingredients: [
                        { type: 'alface', count: 2 },
                        { type: 'tomate', count: 1 },
                        { type: 'cenoura', count: 1 }
                    ]
                },
                'Ensopado': { 
                    recovery: 40, 
                    ingredients: [
                        { type: 'batata', count: 2 },
                        { type: 'cenoura', count: 2 },
                        { type: 'brocolis', count: 1 }
                    ]
                },
                'Bife': { 
                    recovery: 100, 
                    ingredients: [
                        { type: 'trigo', count: 3 },
                        { type: 'milho', count: 2 }
                    ]
                },
                'Peixe Assado': { 
                    recovery: 50, 
                    ingredients: [
                        { type: 'minhoca', count: 3 }
                    ]
                },
                'Frango Assado': { 
                    recovery: 70, 
                    ingredients: [
                        { type: 'milho', count: 4 },
                        { type: 'trigo', count: 2 }
                    ]
                },
                'Chá Medicinal': { 
                    recovery: 0, 
                    isMedicine: true,
                    ingredients: [
                        { type: 'erva', count: 2 }
                    ]
                }
            };
            
            const food = foods[foodName];
            if (!food) return;
            
            // Verificar ingredientes
            for (const ingredient of food.ingredients) {
                if (!gameState.celeiro[ingredient.type] || gameState.celeiro[ingredient.type].count < ingredient.count) {
                    alert(`❌ Você não tem ${ingredient.count}x ${ingredient.type} suficiente!`);
                    return;
                }
            }
            
            // Consumir ingredientes
            for (const ingredient of food.ingredients) {
                gameState.celeiro[ingredient.type].count -= ingredient.count;
                if (gameState.celeiro[ingredient.type].count === 0) {
                    delete gameState.celeiro[ingredient.type];
                }
            }
            
            if (food.isMedicine) {
                // Curar doença
                gameState.farmer.isSick = false;
                gameState.farmer.sickTimer = 0;
                gameState.farmer.energyDrainRate = 1;
                alert('🍵 Você tomou chá medicinal e se curou instantaneamente!');
            } else {
                // Recuperar energia
                const recoveryAmount = Math.floor((gameState.farmer.maxEnergy * food.recovery) / 100);
                gameState.farmer.energy = Math.min(gameState.farmer.maxEnergy, gameState.farmer.energy + recoveryAmount);
                alert(`🍽️ Você comeu ${foodName} e recuperou ${recoveryAmount} pontos de energia!`);
            }
            
            updateCeleiro();
            updateFarmerDisplay();
            closeFoodMenu();
        }
        
        function startFarmerSystem() {
            // Timer principal do fazendeiro
            setInterval(() => {
                if (gameState.farmer.isDead) return;
                
                // Timer de descanso
                if (gameState.farmer.isResting && gameState.farmer.restTimer > 0) {
                    gameState.farmer.restTimer--;
                    if (gameState.farmer.restTimer === 0) {
                        finishResting();
                    }
                    updateFarmerDisplay();
                }
                
                // Timer de doença
                if (gameState.farmer.isSick && gameState.farmer.sickTimer > 0) {
                    gameState.farmer.sickTimer--;
                    if (gameState.farmer.sickTimer === 0) {
                        gameState.farmer.isSick = false;
                        gameState.farmer.energyDrainRate = 1;
                        alert('😊 Você se recuperou naturalmente da doença!');
                        updateFarmerDisplay();
                    }
                }
                
                // Chance de ficar doente (1% por minuto se energia < 50%)
                if (!gameState.farmer.isSick && !gameState.farmer.isResting && gameState.farmer.energy < gameState.farmer.maxEnergy * 0.5) {
                    if (Math.random() < 0.0167) { // ~1% por minuto
                        makeFarmerSick();
                    }
                }
            }, 1000);
            
            // Drenagem passiva de energia (a cada 2 minutos)
            setInterval(() => {
                if (gameState.farmer.isDead || gameState.farmer.isResting) return;
                
                const energyLoss = gameState.farmer.energyDrainRate;
                gameState.farmer.energy = Math.max(0, gameState.farmer.energy - energyLoss);
                
                if (gameState.farmer.energy === 0 && gameState.farmer.isSick) {
                    gameState.farmer.isDead = true;
                    alert('💀 Você morreu de exaustão! O jogo será reiniciado...');
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                }
                
                updateFarmerDisplay();
            }, 120000); // 2 minutos
        }

        // Atualizar display da estação
        function updateSeasonDisplay() {
            const season = gameState.seasons[gameState.currentSeason];
            document.getElementById('season-emoji').textContent = season.emoji;
            document.getElementById('season-name').textContent = season.name;
            document.getElementById('season-bonus').textContent = season.bonus;
            
            const minutes = Math.floor(gameState.seasonTimeLeft / 60);
            const seconds = gameState.seasonTimeLeft % 60;
            document.getElementById('season-timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Mostrar/esconder campo de flores na primavera
            const flowerField = document.getElementById('flower-field');
            if (gameState.currentSeason === 0) { // Primavera
                flowerField.classList.add('spring');
            } else {
                flowerField.classList.remove('spring');
            }
        }

        // Sistema de estações
        function startSeasonTimer() {
            setInterval(() => {
                gameState.seasonTimeLeft--;
                
                if (gameState.seasonTimeLeft <= 0) {
                    // Mudar estação
                    gameState.currentSeason = (gameState.currentSeason + 1) % 4;
                    gameState.seasonTimeLeft = 3600; // Reset para 1 hora
                    
                    const newSeason = gameState.seasons[gameState.currentSeason];
                    alert(`🌍 A estação mudou para ${newSeason.name}! ${newSeason.bonus}`);
                }
                
                updateSeasonDisplay();
            }, 1000);
        }

        // Selecionar semente
        function selectSeed(type, emoji) {
            // Sementes especiais são grátis
            const specialSeeds = ['cacau', 'pitaia', 'avocado'];
            const isFree = specialSeeds.includes(type);
            
            if (!isFree && gameState.coins < 10) {
                alert('💰 Moedas insuficientes! Você precisa de 10 moedas.');
                return;
            }
            
            gameState.selectedSeed = type;
            gameState.selectedSeedEmoji = emoji;
            
            // Destacar semente selecionada
            document.querySelectorAll('.seed-btn').forEach(btn => {
                btn.style.border = '2px solid #4CAF50';
            });
            event.target.style.border = '3px solid #FF5722';
            
            const seedName = type.charAt(0).toUpperCase() + type.slice(1);
            const message = isFree ? 
                `🌱 Semente especial de ${seedName} selecionada! Clique em um canteiro para plantar.` :
                `🌱 Semente de ${seedName} selecionada! Clique em um canteiro para começar o plantio.`;
            alert(message);
        }

        // Clique no canteiro
        function clickCanteiro(index) {
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            const canteiro = gameState.canteiros[index];
            const canteiroElement = document.getElementById(`canteiro-${index}`);
            
            switch(canteiro.state) {
                case 'empty':
                    // Verificar se tem folhas secas ou adubo
                    if (gameState.fertilizer <= 0 && gameState.compost <= 0) {
                        alert('🍂 Você precisa de folhas secas ou adubo orgânico!');
                        return;
                    }
                    
                    // Priorizar adubo orgânico se disponível
                    if (gameState.compost > 0) {
                        gameState.compost--;
                        canteiro.state = 'fertilized';
                        canteiroElement.className = 'canteiro fertilized';
                        canteiroElement.innerHTML = '🌱';
                        alert('🌱 Canteiro adubado com adubo orgânico!');
                    } else {
                        gameState.fertilizer--;
                        canteiro.state = 'fertilized';
                        canteiroElement.className = 'canteiro fertilized';
                        canteiroElement.innerHTML = '🍂';
                    }
                    updateResources();
                    break;
                    
                case 'fertilized':
                    if (!gameState.selectedSeed) {
                        alert('🌱 Selecione uma semente primeiro!');
                        return;
                    }
                    
                    // Sementes especiais são grátis
                    const specialSeeds = ['cacau', 'pitaia', 'avocado'];
                    const isFree = specialSeeds.includes(gameState.selectedSeed);
                    
                    if (!isFree && gameState.coins < 10) {
                        alert('💰 Moedas insuficientes!');
                        return;
                    }
                    
                    // Plantar
                    if (!isFree) {
                        gameState.coins -= 10;
                    }
                    canteiro.state = 'planted';
                    canteiro.seedType = gameState.selectedSeed;
                    canteiro.seedEmoji = gameState.selectedSeedEmoji;
                    canteiroElement.className = 'canteiro planted';
                    canteiroElement.innerHTML = '🌱';
                    updateResources();
                    break;
                    
                case 'planted':
                    if (gameState.water <= 0) {
                        alert('💧 Água insuficiente!');
                        return;
                    }
                    // Regar
                    gameState.water--;
                    canteiro.state = 'watered';
                    canteiroElement.className = 'canteiro watered';
                    canteiroElement.innerHTML = '💧';
                    updateResources();
                    startGrowth(index);
                    break;
                    
                case 'ready':
                    // Colher
                    harvest(index);
                    break;
            }
        }

        // Iniciar crescimento
        function startGrowth(index) {
            const canteiro = gameState.canteiros[index];
            const canteiroElement = document.getElementById(`canteiro-${index}`);
            
            canteiro.progress = 0;
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            progressBar.innerHTML = '<div class="progress-fill"></div>';
            
            const interval = setInterval(() => {
                canteiro.progress += 100/300; // 30 segundos = 300 décimos
                const progressFill = canteiroElement.querySelector('.progress-fill');
                if (progressFill) {
                    progressFill.style.width = canteiro.progress + '%';
                }
                
                if (canteiro.progress >= 100) {
                    clearInterval(interval);
                    canteiro.state = 'ready';
                    canteiroElement.className = 'canteiro ready';
                    canteiroElement.innerHTML = canteiro.seedEmoji;
                }
            }, 100);
            
            canteiroElement.innerHTML = '';
            canteiroElement.appendChild(progressBar);
        }

        // Colher
        function harvest(index) {
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            const canteiro = gameState.canteiros[index];
            const canteiroElement = document.getElementById(`canteiro-${index}`);
            
            // Adicionar ao celeiro
            if (!gameState.celeiro[canteiro.seedType]) {
                gameState.celeiro[canteiro.seedType] = {
                    count: 0,
                    emoji: canteiro.seedEmoji
                };
            }
            
            // Verão = dupla colheita
            const harvestAmount = gameState.currentSeason === 1 ? 2 : 1;
            gameState.celeiro[canteiro.seedType].count += harvestAmount;
            
            if (harvestAmount === 2) {
                alert(`☀️ Verão! Você colheu 2x ${canteiro.seedEmoji}!`);
            }
            
            // Resetar canteiro
            canteiro.state = 'empty';
            canteiro.seedType = null;
            canteiro.seedEmoji = null;
            canteiro.progress = 0;
            canteiroElement.className = 'canteiro';
            canteiroElement.innerHTML = '';
            
            gameState.harvestedCount++;
            
            // A cada 2 canteiros colhidos, adicionar minhoca
            if (gameState.harvestedCount % 2 === 0) {
                if (!gameState.celeiro['minhoca']) {
                    gameState.celeiro['minhoca'] = {
                        count: 0,
                        emoji: '🪱'
                    };
                }
                gameState.celeiro['minhoca'].count++;
                alert('🪱 Uma minhoca apareceu no seu celeiro!');
            }
            
            updateCeleiro();
        }

        // Atualizar celeiro
        function updateCeleiro() {
            const celeiroElement = document.getElementById('celeiro');
            
            if (Object.keys(gameState.celeiro).length === 0) {
                celeiroElement.innerHTML = '<div class="text-center text-gray-500 text-sm">Celeiro vazio</div>';
                return;
            }
            
            let html = '';
            for (const [type, data] of Object.entries(gameState.celeiro)) {
                if (data.count > 0) {
                    let displayName = type.charAt(0).toUpperCase() + type.slice(1);
                    let isNonSellable = false;
                    
                    if (type === 'minhoca') {
                        displayName = 'Minhoca (Não vendável)';
                        isNonSellable = true;
                    } else if (type === 'erva') {
                        displayName = 'Erva (Não vendável)';
                        isNonSellable = true;
                    } else if (['cacau', 'pitaia', 'avocado'].includes(type)) {
                        displayName = type.charAt(0).toUpperCase() + type.slice(1) + ' (Não vendável)';
                        isNonSellable = true;
                    } else if (['racao', 'osso'].includes(type)) {
                        displayName = type.charAt(0).toUpperCase() + type.slice(1) + ' (Para Mocinha)';
                        isNonSellable = true;
                    } else if (type === 'racao_galinha') {
                        displayName = 'Ração p/ Galinhas (Para Galinheiro)';
                        isNonSellable = true;
                    } else if (type === 'racao_porco') {
                        displayName = 'Ração p/ Porcos (Para Chiqueiro)';
                        isNonSellable = true;
                    } else if (type === 'feno_vaca') {
                        displayName = 'Feno p/ Vacas (Para Pasto)';
                        isNonSellable = true;
                    } else if (type === 'chave') {
                        displayName = 'Chave (Não vendável)';
                        isNonSellable = true;
                    } else if (type === 'diesel') {
                        displayName = 'Diesel (Para Caminhonete)';
                        isNonSellable = true;
                    } else if (type === 'vacina') {
                        displayName = 'Vacina (Para Animais Doentes)';
                        isNonSellable = true;
                    } else if (type === 'grama') {
                        displayName = 'Grama';
                        isNonSellable = false;
                    } else if (type === 'peixe') {
                        displayName = 'Peixe';
                        isNonSellable = false;
                    } else if (type === 'perola') {
                        displayName = 'Pérola';
                        isNonSellable = false;
                    } else if (type === 'tronco') {
                        displayName = 'Tronco';
                        isNonSellable = false;
                    } else if (type === 'galho') {
                        displayName = 'Galho';
                        isNonSellable = false;
                    } else if (type === 'apple') {
                        displayName = 'Maçã';
                        isNonSellable = false;
                    } else if (type === 'orange') {
                        displayName = 'Laranja';
                        isNonSellable = false;
                    } else if (type === 'banana') {
                        displayName = 'Banana';
                        isNonSellable = false;
                    } else if (type === 'lenha') {
                        displayName = 'Lenha';
                        isNonSellable = false;
                    } else if (type === 'picareta') {
                        displayName = 'Picareta (Para Mina)';
                        isNonSellable = true;
                    } else if (type === 'esmeralda') {
                        displayName = 'Esmeralda';
                        isNonSellable = false;
                    } else if (type === 'rubi') {
                        displayName = 'Rubi';
                        isNonSellable = false;
                    } else if (type === 'safira') {
                        displayName = 'Safira';
                        isNonSellable = false;
                    } else if (type === 'carvao') {
                        displayName = 'Carvão';
                        isNonSellable = false;
                    } else if (['cha', 'salada', 'ensopado', 'bife', 'peixe_assado', 'frango_assado', 'pao'].includes(type)) {
                        const foodNames = {
                            'cha': 'Chá Medicinal (Cura doença)',
                            'salada': 'Salada (+30% energia)',
                            'ensopado': 'Ensopado (+50% energia)',
                            'bife': 'Bife (+100% energia)',
                            'peixe_assado': 'Peixe Assado (+70% energia)',
                            'frango_assado': 'Frango Assado (+80% energia)',
                            'pao': 'Pão (+40% energia)'
                        };
                        displayName = foodNames[type];
                        isNonSellable = true;
                    }
                    
                    const clickHandler = isNonSellable ? '' : `onclick="moveFromCeleiro('${type}')"`;
                    const cssClass = isNonSellable ? 'celeiro-item non-sellable' : 'celeiro-item';
                    
                    html += `
                        <div class="${cssClass}" ${clickHandler}>
                            <span>${data.emoji} ${displayName}</span>
                            <span class="font-bold">${data.count}</span>
                        </div>
                    `;
                }
            }
            
            celeiroElement.innerHTML = html;
        }

        // Comprar item do mercadinho
        function buyItem(itemType, price) {
            if (gameState.coins < price) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            if (!gameState.marketItems[itemType]) {
                alert('🏪 Item já foi vendido!');
                return;
            }
            
            if (itemType === 'well') {
                if (gameState.hasWell) {
                    alert('🪣 Você já tem um poço!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.hasWell = true;
                document.getElementById('well-container').style.display = 'flex';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                alert('🪣 Poço de água comprado! Agora você tem água infinita!');
                updateResources();
            } else if (itemType === 'feeder') {
                if (gameState.feeder.hasFeeder) {
                    alert('🍽️ Você já tem um comedouro!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.feeder.hasFeeder = true;
                document.getElementById('feeder-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                alert('🍽️ Comedouro comprado! Coloque água ou banana para atrair pássaros!');
                updateResources();
                startBirdVisitTimer();
            } else if (itemType === 'beehive') {
                if (gameState.beehive.hasBeehive) {
                    alert('🐝 Você já tem uma colmeia!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.beehive.hasBeehive = true;
                
                // Mostrar sementes das flores especiais no mercadinho
                document.getElementById('flower-seeds-market').style.display = 'grid';
                
                document.getElementById('beehive-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🐝 Colmeia comprada! Agora você pode comprar sementes de flores especiais no mercadinho!');
                updateResources();
                startBeehiveTimers();
            } else if (itemType === 'doghouse') {
                if (gameState.doghouse.hasDoghouse) {
                    alert('🏠 Você já tem uma casinha!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.doghouse.hasDoghouse = true;
                
                // Mostrar ração no mercadinho após comprar a casinha
                document.getElementById('dog-food-market').style.display = 'block';
                
                document.getElementById('doghouse-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🏠 Casinha da Mocinha comprada! Agora você pode comprar ração no mercadinho para alimentá-la!');
                updateResources();
                startDoghouseTimers();
            } else if (itemType === 'stable') {
                if (gameState.stable.hasStable) {
                    alert('🏇 Você já tem uma baia!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.stable.hasStable = true;
                
                // Ativar painel de pedidos
                gameState.orders.hasOrdersPanel = true;
                document.getElementById('orders-panel').style.display = 'block';
                
                document.getElementById('stable-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🏇 Baia do Duque comprada! Use feno (trigo) e maçãs (abóboras) para cuidar dele. Quando ele estiver trabalhando, poderá entregar os pedidos dos clientes! O painel de pedidos foi ativado!');
                updateResources();
                startStableTimers();
                startOrdersSystem();
            } else if (itemType === 'phone') {
                if (gameState.phone.hasPhone) {
                    alert('📞 Você já tem um telefone!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.phone.hasPhone = true;
                
                // Mostrar caminhonete no mercadinho após comprar telefone
                document.getElementById('item-truck').style.display = 'block';
                
                document.getElementById('phone-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('📞 Telefone comprado! Agora você receberá chamadas de outros agrônomos com pedidos especiais a cada 35 minutos! A caminhonete também está disponível no mercadinho!');
                updateResources();
                startPhoneSystem();
            } else if (itemType === 'chicken_coop') {
                if (gameState.chickenCoop.hasChickenCoop) {
                    alert('🐔 Você já tem um galinheiro!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.chickenCoop.hasChickenCoop = true;
                
                // Mostrar ração e galinhas no mercadinho após comprar galinheiro
                document.getElementById('chicken-market').style.display = 'grid';
                document.getElementById('vaccine-market').style.display = 'block';
                
                document.getElementById('chicken-coop-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🐔 Galinheiro comprado! Agora você pode comprar galinhas e ração no mercadinho! Vacinas também estão disponíveis para tratar animais doentes.');
                updateResources();
                updateChickenCoopDisplay();
                startChickenCoopTimers();
                startAnimalSicknessSystem();
            } else if (itemType === 'pig_pen') {
                if (gameState.pigPen.hasPigPen) {
                    alert('🐷 Você já tem um chiqueiro!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.pigPen.hasPigPen = true;
                
                // Mostrar ração e porcos no mercadinho após comprar chiqueiro
                document.getElementById('pig-market').style.display = 'grid';
                
                document.getElementById('pig-pen-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🐷 Chiqueiro comprado! Agora você pode comprar porcos e ração no mercadinho!');
                updateResources();
                updatePigPenDisplay();
                startPigPenTimers();
            } else if (itemType === 'cow_pasture') {
                if (gameState.cowPasture.hasCowPasture) {
                    alert('🐄 Você já tem um pasto!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.cowPasture.hasCowPasture = true;
                
                // Mostrar feno e vacas no mercadinho após comprar pasto
                document.getElementById('cow-market').style.display = 'grid';
                
                document.getElementById('cow-pasture-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🐄 Pasto das Vacas comprado! Agora você pode comprar vacas e feno no mercadinho!');
                updateResources();
                updateCowPastureDisplay();
                startCowPastureTimers();
            } else if (itemType === 'sheep_pen') {
                if (gameState.sheepPen.hasSheepPen) {
                    alert('🐑 Você já tem um curral!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.sheepPen.hasSheepPen = true;
                
                // Mostrar feno, ovelhas e tesoura no mercadinho após comprar curral
                document.getElementById('sheep-market').style.display = 'grid';
                
                document.getElementById('sheep-pen-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🐑 Curral das Ovelhas comprado! Agora você pode comprar ovelhas, feno e tesoura no mercadinho!');
                updateResources();
                updateSheepPenDisplay();
                startSheepPenTimers();
            } else if (itemType === 'grass_field') {
                if (gameState.grassField.hasGrassField) {
                    alert('🌱 Você já tem um campo de grama!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.grassField.hasGrassField = true;
                
                document.getElementById('grass-field-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🌱 Campo de Grama comprado! Colete grama para ganhar flores especiais!');
                updateResources();
                initGrassField();
                startGrassFieldTimers();
            } else if (itemType === 'fish_lake') {
                if (gameState.fishLake.hasFishLake) {
                    alert('🎣 Você já tem um lago dos peixes!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.fishLake.hasFishLake = true;
                
                // Mostrar vara de pesca no mercadinho após comprar lago
                document.getElementById('fishing-market').style.display = 'block';
                
                // Mostrar bosque no mercadinho após comprar lago
                document.getElementById('item-forest').style.display = 'block';
                
                document.getElementById('fish-lake-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🎣 Lago dos Peixes comprado! Agora você pode comprar vara de pesca no mercadinho para pescar! O Bosque também está disponível!');
                updateResources();
                updateFishLakeDisplay();
                startFishLakeTimers();
            } else if (itemType === 'fish_lake') {
                if (gameState.fishLake.hasFishLake) {
                    alert('🎣 Você já tem um lago dos peixes!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.fishLake.hasFishLake = true;
                
                // Mostrar vara de pesca no mercadinho após comprar lago
                document.getElementById('fishing-market').style.display = 'block';
                
                document.getElementById('fish-lake-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🎣 Lago dos Peixes comprado! Agora você pode comprar vara de pesca no mercadinho para pescar!');
                updateResources();
                updateFishLakeDisplay();
                startFishLakeTimers();
            } else if (itemType === 'forest') {
                if (gameState.forest.hasForest) {
                    alert('🌳 Você já tem um bosque!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.forest.hasForest = true;
                
                // Mostrar machado no mercadinho após comprar bosque
                document.getElementById('forest-market').style.display = 'block';
                
                // Mostrar mina no mercadinho após comprar bosque
                document.getElementById('item-mine').style.display = 'block';
                
                document.getElementById('forest-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🌳 Bosque comprado! Agora você pode comprar machado no mercadinho para cortar troncos e colher frutas! A Mina também está disponível!');
                updateResources();
                updateForestDisplay();
            } else if (itemType === 'mine') {
                if (gameState.mine.hasMine) {
                    alert('⛏️ Você já tem uma mina!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.mine.hasMine = true;
                
                // Mostrar picareta no mercadinho após comprar mina
                document.getElementById('mine-market').style.display = 'block';
                
                document.getElementById('mine-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('⛏️ Mina comprada! Use uma chave para entrar e compre uma picareta no mercadinho para minerar pedras preciosas!');
                updateResources();
                updateMineDisplay();
            } else if (itemType === 'truck') {
                if (gameState.truck.hasTruck) {
                    alert('🚚 Você já tem uma caminhonete!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.truck.hasTruck = true;
                
                // Mostrar diesel no mercadinho após comprar caminhonete
                document.getElementById('diesel-market').style.display = 'block';
                
                document.getElementById('truck-container').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🚚 Caminhonete comprada! Agora você pode entregar os pedidos do telefone com mais eficiência! O diesel está disponível no mercadinho.');
                updateResources();
                updateTruckDisplay();
            } else if (itemType === 'composter') {
                if (gameState.composter.hasComposter) {
                    alert('🗂️ Você já tem uma composteira!');
                    return;
                }
                gameState.coins -= price;
                gameState.marketItems[itemType] = false;
                gameState.composter.hasComposter = true;
                
                document.getElementById('composter-container').style.display = 'block';
                document.getElementById('compost-resource').style.display = 'block';
                document.getElementById(`item-${itemType}`).style.display = 'none';
                
                alert('🗂️ Composteira comprada! Use flores, galhos e esterco para fazer adubo orgânico!');
                updateResources();
                updateComposterDisplay();
            }
        }

        // Coletar água do poço
        function collectWater() {
            if (!gameState.hasWell) return;
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            gameState.water += 4;
            updateResources();
            
            // Animação visual
            const wellBtn = document.querySelector('#well-container button');
            wellBtn.style.transform = 'scale(1.2)';
            setTimeout(() => {
                wellBtn.style.transform = 'scale(1)';
            }, 200);
        }

        // Inicializar quitanda
        function initQuitanda() {
            const quitandaSlots = document.getElementById('quitanda-slots');
            quitandaSlots.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'quitanda-slot';
                slot.id = `quitanda-slot-${i}`;
                slot.onclick = () => moveToQuitanda(i);
                quitandaSlots.appendChild(slot);
            }
        }

        // Mover item específico do celeiro para quitanda
        function moveFromCeleiro(type) {
            if (type === 'minhoca') {
                alert('🪱 Minhocas não podem ser vendidas!');
                return;
            }
            if (type === 'erva') {
                alert('🌿 Ervas não podem ser vendidas!');
                return;
            }
            if (['cacau', 'pitaia', 'avocado'].includes(type)) {
                alert('🍫 Frutos especiais não podem ser vendidos!');
                return;
            }
            if (['racao', 'osso'].includes(type)) {
                alert('🦴 Ração e ossos são para a Mocinha!');
                return;
            }
            if (type === 'racao_galinha') {
                alert('🌾 Ração para galinhas é para o galinheiro!');
                return;
            }
            if (type === 'racao_porco') {
                alert('🌽 Ração para porcos é para o chiqueiro!');
                return;
            }
            if (type === 'feno_vaca') {
                alert('🌾 Feno para vacas é para o pasto!');
                return;
            }
            if (type === 'chave') {
                alert('🗝️ Chaves não podem ser vendidas!');
                return;
            }
            if (type === 'diesel') {
                alert('⛽ Diesel é para a caminhonete!');
                return;
            }
            if (type === 'vacina') {
                alert('💉 Vacinas são para animais doentes!');
                return;
            }
            
            if (!gameState.celeiro[type] || gameState.celeiro[type].count <= 0) {
                return;
            }
            
            // Mover item do celeiro para quitanda
            gameState.celeiro[type].count--;
            if (gameState.celeiro[type].count === 0) {
                delete gameState.celeiro[type];
            }
            
            if (!gameState.quitanda[type]) {
                gameState.quitanda[type] = 0;
            }
            gameState.quitanda[type]++;
            
            updateQuitanda();
            updateCeleiro();
        }

        // Mover item da quitanda de volta para celeiro
        function moveToQuitanda(slotIndex) {
            const slot = document.getElementById(`quitanda-slot-${slotIndex}`);
            
            if (slot.dataset.type) {
                // Slot ocupado, mover de volta para celeiro
                const type = slot.dataset.type;
                const emoji = slot.dataset.emoji;
                
                if (!gameState.celeiro[type]) {
                    gameState.celeiro[type] = { count: 0, emoji: emoji };
                }
                gameState.celeiro[type].count++;
                gameState.quitanda[type]--;
                
                if (gameState.quitanda[type] <= 0) {
                    delete gameState.quitanda[type];
                }
                
                updateQuitanda();
                updateCeleiro();
            }
        }

        // Obter preço do item
        function getItemPrice(type) {
            const basePrices = {
                'abobora': 25, 'alface': 20, 'batata': 18, 'brocolis': 22,
                'cafe': 30, 'cenoura': 15, 'milho': 20, 'tomate': 25,
                'trigo': 18, 'uva': 35, 'minhoca': 50, 'barro': 10,
                'mel': 80, 'rosa': 15, 'girassol': 18, 'margarida': 12,
                'bola': 40, 'cd': 35, 'sapato': 30, 'ovo': 15, 'frango_cru': 60,
                'carne_suina': 80, 'leite': 25, 'esterco': 15, 'grama': 8,
                'tulipa': 20, 'lirio': 22, 'sakura': 25, 'la': 30,
                'peixe': 35, 'perola': 100, 'tronco': 12, 'galho': 25,
                'apple': 18, 'orange': 20, 'banana': 15, 'lenha': 8,
                'esmeralda': 200, 'rubi': 180, 'safira': 160, 'carvao': 25,
                'feno': 35
            };
            
            let price = basePrices[type] || 20;
            
            // Aplicar bônus de estação
            const plantProducts = ['abobora', 'alface', 'batata', 'brocolis', 'cafe', 'cenoura', 'milho', 'tomate', 'trigo', 'uva'];
            const animalProducts = ['minhoca']; // Produtos de animais
            const manufacturedProducts = ['barro']; // Produtos fabricados
            
            if (gameState.currentSeason === 0 && plantProducts.includes(type)) {
                // Primavera: Plantações +10%
                price = Math.floor(price * 1.1);
            } else if (gameState.currentSeason === 2 && animalProducts.includes(type)) {
                // Outono: Animais +15%
                price = Math.floor(price * 1.15);
            } else if (gameState.currentSeason === 3 && manufacturedProducts.includes(type)) {
                // Inverno: Fabricados +15%
                price = Math.floor(price * 1.15);
            }
            
            // Aplicar bônus do jornal (se ativo)
            if (gameState.priceBonus && gameState.priceBonus[type]) {
                const bonus = gameState.priceBonus[type];
                if (Date.now() < bonus.expiresAt) {
                    price = Math.floor(price * (1 + bonus.bonus / 100));
                }
            }
            
            return price;
        }

        // Atualizar quitanda
        function updateQuitanda() {
            const slots = document.querySelectorAll('.quitanda-slot');
            
            // Limpar todos os slots
            slots.forEach(slot => {
                slot.className = 'quitanda-slot';
                slot.innerHTML = '';
                slot.removeAttribute('data-type');
                slot.removeAttribute('data-emoji');
            });
            
            // Preencher slots com itens da quitanda
            let slotIndex = 0;
            for (const [type, count] of Object.entries(gameState.quitanda)) {
                if (count > 0 && slotIndex < 20) {
                    const slot = slots[slotIndex];
                    const emoji = getItemEmoji(type);
                    const price = getItemPrice(type);
                    
                    slot.className = 'quitanda-slot filled';
                    slot.innerHTML = `${emoji}<div class="text-xs">${count}x ${price}💰</div>`;
                    slot.dataset.type = type;
                    slot.dataset.emoji = emoji;
                    slotIndex++;
                }
            }
        }
        
        // Obter emoji do item
        function getItemEmoji(type) {
            const emojis = {
                'abobora': '🎃', 'alface': '🥬', 'batata': '🥔', 'brocolis': '🥦',
                'cafe': '🔴', 'cenoura': '🥕', 'milho': '🌽', 'tomate': '🍅',
                'trigo': '🌾', 'uva': '🍇', 'barro': '🟤', 'rosa': '🌹',
                'girassol': '🌻', 'margarida': '🌼', 'erva': '🌿',
                'cacau': '🍫', 'pitaia': '💖', 'avocado': '🥑',
                'tulipa': '🌷', 'lirio': '🪷', 'sakura': '🌸', 'mel': '🍯',
                'bola': '⚽', 'cd': '💿', 'sapato': '👟', 'chave': '🗝️',
                'racao': '🦴', 'osso': '🦴', 'diesel': '⛽',
                'racao_galinha': '🌾', 'ovo': '🥚', 'frango_cru': '🍗',
                'racao_porco': '🌽', 'carne_suina': '🥩',
                'feno_vaca': '🌾', 'leite': '🥛', 'esterco': '💩',
                'grama': '🌱', 'la': '🧶', 'feno_ovelha': '🌾', 'tesoura': '✂️',
                'peixe': '🐟', 'perola': '🦪', 'tronco': '🪵', 'galho': '🌿',
                'apple': '🍎', 'orange': '🍊', 'banana': '🍌', 'lenha': '🪵',
                'picareta': '⛏️', 'esmeralda': '💚', 'rubi': '❤️', 'safira': '💙', 'carvao': '⚫',
                'feno': '🌾', 'cha': '🍵', 'salada': '🥗', 'ensopado': '🍲', 'bife': '🥩',
                'peixe_assado': '🐟', 'frango_assado': '🍗', 'pao': '🍞', 'water': '💧'
            };
            return emojis[type] || '🌱';
        }

        // Vender tudo
        function sellAll() {
            let totalEarnings = 0;
            let itemsSold = 0;
            
            for (const [type, count] of Object.entries(gameState.quitanda)) {
                if (count > 0) {
                    const price = getItemPrice(type);
                    totalEarnings += price * count;
                    itemsSold += count;
                }
            }
            
            if (itemsSold === 0) {
                alert('🏬 Quitanda vazia! Coloque alguns produtos para vender.');
                return;
            }
            
            gameState.quitanda = {};
            gameState.coins += totalEarnings;
            updateResources();
            updateQuitanda();
            alert(`💰 Vendeu ${itemsSold} itens por ${totalEarnings} moedas!`);
        }

        // Sistema de chuva
        function startRain() {
            if (gameState.isRaining) return;
            
            gameState.isRaining = true;
            document.body.classList.add('sky-gray');
            
            const rainOverlay = document.getElementById('rain-overlay');
            rainOverlay.classList.add('active');
            
            // Criar gotas de chuva
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    createRainDrop();
                }, i * 50);
            }
            
            // Regar plantações automaticamente
            gameState.canteiros.forEach((canteiro, index) => {
                if (canteiro.state === 'planted') {
                    canteiro.state = 'watered';
                    const canteiroElement = document.getElementById(`canteiro-${index}`);
                    canteiroElement.className = 'canteiro watered';
                    canteiroElement.innerHTML = '💧';
                    startGrowth(index);
                }
            });
            
            // Adicionar barro ao celeiro
            if (!gameState.celeiro['barro']) {
                gameState.celeiro['barro'] = { count: 0, emoji: '🟤' };
            }
            gameState.celeiro['barro'].count++;
            updateCeleiro();
            
            // Parar chuva após 10 segundos
            setTimeout(() => {
                stopRain();
            }, 10000);
        }

        function createRainDrop() {
            const drop = document.createElement('div');
            drop.className = 'rain-drop';
            drop.style.left = Math.random() * 100 + '%';
            drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
            
            document.getElementById('rain-overlay').appendChild(drop);
            
            setTimeout(() => {
                if (drop.parentNode) {
                    drop.parentNode.removeChild(drop);
                }
            }, 1000);
        }

        function stopRain() {
            gameState.isRaining = false;
            document.body.classList.remove('sky-gray');
            document.getElementById('rain-overlay').classList.remove('active');
            
            // Limpar gotas restantes
            setTimeout(() => {
                document.getElementById('rain-overlay').innerHTML = '';
            }, 1000);
            
            alert('🌧️ A chuva parou! Suas plantas foram regadas e você ganhou 1 barro!');
        }

        // Iniciar timer de chuva (15 minutos = 900000ms)
        function startRainTimer() {
            setInterval(() => {
                if (!gameState.isRaining) {
                    startRain();
                }
            }, 900000); // 15 minutos
        }

        // Sistema de Campo de Flores
        function collectFlower(slotIndex) {
            if (gameState.currentSeason !== 0) {
                alert('🌸 O campo de flores só aparece na primavera!');
                return;
            }
            
            const flower = gameState.flowerField.flowers[slotIndex];
            
            if (flower.available <= 0) {
                alert('🌸 Todas as flores deste tipo foram coletadas! Aguarde elas florirem novamente.');
                return;
            }
            
            // Encontrar primeira flor disponível
            let flowerIndex = -1;
            for (let i = 0; i < 3; i++) {
                if (flower.timers[i] === 0) {
                    flowerIndex = i;
                    break;
                }
            }
            
            if (flowerIndex === -1) return;
            
            // Coletar flor
            flower.available--;
            flower.timers[flowerIndex] = 300; // 5 minutos em segundos
            gameState.flowerField.totalCollected++;
            
            // Adicionar flor ao celeiro
            if (!gameState.celeiro[flower.type]) {
                gameState.celeiro[flower.type] = {
                    count: 0,
                    emoji: flower.emoji
                };
            }
            gameState.celeiro[flower.type].count++;
            
            // A cada 4 flores coletadas, adicionar erva
            if (gameState.flowerField.totalCollected % 4 === 0) {
                if (!gameState.celeiro['erva']) {
                    gameState.celeiro['erva'] = {
                        count: 0,
                        emoji: '🌿'
                    };
                }
                gameState.celeiro['erva'].count++;
                alert('🌿 Uma erva especial apareceu no seu celeiro!');
            }
            
            updateFlowerDisplay();
            updateCeleiro();
        }
        
        function updateFlowerDisplay() {
            gameState.flowerField.flowers.forEach((flower, slotIndex) => {
                const display = document.getElementById(`flower-display-${slotIndex}`);
                const timer = document.getElementById(`flower-timer-${slotIndex}`);
                const icons = display.querySelectorAll('.flower-icon');
                
                // Atualizar ícones das flores
                icons.forEach((icon, iconIndex) => {
                    if (flower.timers[iconIndex] > 0) {
                        icon.classList.add('collected');
                    } else {
                        icon.classList.remove('collected');
                    }
                });
                
                // Mostrar timer da próxima flor a florescer
                const nextTimer = Math.max(...flower.timers);
                if (nextTimer > 0) {
                    const minutes = Math.floor(nextTimer / 60);
                    const seconds = nextTimer % 60;
                    timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    timer.textContent = '';
                }
            });
        }
        
        function startFlowerTimers() {
            setInterval(() => {
                if (gameState.currentSeason !== 0) return; // Só na primavera
                
                let updated = false;
                gameState.flowerField.flowers.forEach(flower => {
                    flower.timers.forEach((timer, index) => {
                        if (timer > 0) {
                            flower.timers[index]--;
                            if (flower.timers[index] === 0) {
                                flower.available++;
                                updated = true;
                            }
                        }
                    });
                });
                
                if (updated) {
                    updateFlowerDisplay();
                }
            }, 1000);
        }

        // Sistema do Comedouro
        function feedBirds() {
            if (!gameState.feeder.hasFeeder) {
                alert('🍽️ Você precisa comprar um comedouro primeiro!');
                return;
            }
            
            if (!gameState.feeder.isEmpty) {
                alert('🍽️ O comedouro já tem comida! Aguarde os pássaros comerem.');
                return;
            }
            
            // Alternar entre água e banana
            const foods = [
                { type: 'water', emoji: '💧', name: 'Água' },
                { type: 'banana', emoji: '🍌', name: 'Banana' }
            ];
            
            const randomFood = foods[Math.floor(Math.random() * foods.length)];
            
            gameState.feeder.isEmpty = false;
            gameState.feeder.foodType = randomFood.type;
            
            const feederSlot = document.getElementById('feeder-slot');
            const feederStatus = document.getElementById('feeder-status');
            
            feederSlot.classList.add('filled');
            feederSlot.innerHTML = `
                <div class="text-4xl mb-2">${randomFood.emoji}</div>
                <div class="text-sm text-gray-600">${randomFood.name}</div>
                <div class="text-xs text-gray-500 mt-1">Aguardando pássaros...</div>
            `;
            
            alert(`🍽️ Você colocou ${randomFood.name} no comedouro! Os pássaros virão em breve.`);
        }
        
        function birdVisit() {
            if (gameState.feeder.isEmpty || !gameState.feeder.hasFeeder) return;
            
            const feederSlot = document.getElementById('feeder-slot');
            
            // Criar pássaro visitante
            const bird = document.createElement('div');
            bird.className = 'bird-visit';
            bird.textContent = '🐦';
            feederSlot.appendChild(bird);
            
            // Remover pássaro após animação
            setTimeout(() => {
                if (bird.parentNode) {
                    bird.parentNode.removeChild(bird);
                }
            }, 2000);
            
            // Esvaziar comedouro
            gameState.feeder.isEmpty = true;
            gameState.feeder.foodType = null;
            
            feederSlot.classList.remove('filled');
            feederSlot.innerHTML = `
                <div class="text-4xl mb-2">🍽️</div>
                <div class="text-sm text-gray-600">Vazio</div>
                <div class="text-xs text-gray-500 mt-1">Clique para colocar água ou banana</div>
            `;
            
            // Dar semente especial
            const specialSeeds = ['cacau', 'pitaia', 'avocado'];
            const randomSeed = specialSeeds[Math.floor(Math.random() * specialSeeds.length)];
            
            gameState.feeder.availableSeeds[randomSeed] = true;
            document.getElementById(`seed-${randomSeed}`).style.display = 'block';
            
            const seedNames = { cacau: 'Cacau', pitaia: 'Pitaia', avocado: 'Avocado' };
            alert(`🐦 Um pássaro visitou o comedouro e trouxe uma semente de ${seedNames[randomSeed]}! Agora você pode plantá-la.`);
        }
        
        function startBirdVisitTimer() {
            setInterval(() => {
                if (!gameState.feeder.isEmpty && gameState.feeder.hasFeeder) {
                    // Chance de 30% a cada 30 segundos
                    if (Math.random() < 0.3) {
                        birdVisit();
                    }
                }
            }, 30000); // 30 segundos
        }

        // Sistema da Colmeia
        function plantFlowerInBeehive(beeIndex) {
            if (!gameState.beehive.hasBeehive) {
                alert('🐝 Você precisa comprar uma colmeia primeiro!');
                return;
            }
            
            const bee = gameState.beehive.bees[beeIndex];
            
            if (bee.hasFlower) {
                if (bee.honeyReady) {
                    // Coletar mel
                    collectHoney(beeIndex);
                } else {
                    alert('🌸 Esta abelha já tem uma flor! Aguarde o mel ficar pronto.');
                }
                return;
            }
            
            // Verificar se tem semente de flor selecionada
            const flowerSeeds = ['tulipa', 'lirio', 'sakura'];
            if (!gameState.selectedSeed || !flowerSeeds.includes(gameState.selectedSeed)) {
                alert('🌷 Selecione uma semente de flor especial primeiro! (Tulipa, Lírio ou Sakura)');
                return;
            }
            
            // Plantar flor
            bee.hasFlower = true;
            bee.flowerType = gameState.selectedSeed;
            bee.flowerEmoji = gameState.selectedSeedEmoji;
            bee.isGrowing = true;
            
            const slot = document.getElementById(`bee-slot-${beeIndex}`);
            const status = document.getElementById(`honey-status-${beeIndex}`);
            
            slot.classList.add('growing');
            slot.innerHTML = `<div class="text-2xl">🌱</div><div class="text-xs">Crescendo...</div>`;
            status.textContent = 'Flor crescendo...';
            
            // Crescimento da flor (10 segundos)
            setTimeout(() => {
                if (bee.isGrowing) {
                    bee.isGrowing = false;
                    bee.isPollenating = true;
                    bee.honeyTimer = 900; // 15 minutos em segundos
                    
                    slot.classList.remove('growing');
                    slot.classList.add('bloomed');
                    slot.innerHTML = `<div class="text-2xl">${bee.flowerEmoji}</div><div class="text-xs">Floresceu!</div>`;
                    status.textContent = 'Abelha polinizando...';
                    
                    alert(`🌸 A ${bee.flowerType} floresceu! A abelha começou a polinizar.`);
                }
            }, 10000); // 10 segundos
            
            alert(`🌱 Você plantou uma ${gameState.selectedSeed}! Aguarde 10 segundos para ela florescer.`);
        }
        
        function collectHoney(beeIndex) {
            const bee = gameState.beehive.bees[beeIndex];
            
            if (!bee.honeyReady) {
                alert('🍯 O mel ainda não está pronto!');
                return;
            }
            
            // Adicionar mel ao celeiro
            if (!gameState.celeiro['mel']) {
                gameState.celeiro['mel'] = {
                    count: 0,
                    emoji: '🍯'
                };
            }
            gameState.celeiro['mel'].count++;
            
            // Resetar abelha
            bee.hasFlower = false;
            bee.flowerType = null;
            bee.flowerEmoji = null;
            bee.isGrowing = false;
            bee.isPollenating = false;
            bee.honeyTimer = 0;
            bee.honeyReady = false;
            
            const slot = document.getElementById(`bee-slot-${beeIndex}`);
            const status = document.getElementById(`honey-status-${beeIndex}`);
            
            slot.className = 'flower-slot-mini';
            slot.innerHTML = `<div class="text-2xl">🌱</div><div class="text-xs">Vazio</div>`;
            status.textContent = 'Sem flor';
            status.classList.remove('honey-ready');
            
            updateCeleiro();
            alert('🍯 Mel coletado! A abelha está pronta para uma nova flor.');
        }
        
        function updateBeehiveDisplay() {
            if (!gameState.beehive.hasBeehive) return;
            
            gameState.beehive.bees.forEach((bee, index) => {
                const status = document.getElementById(`honey-status-${index}`);
                
                if (bee.isPollenating && bee.honeyTimer > 0) {
                    const minutes = Math.floor(bee.honeyTimer / 60);
                    const seconds = bee.honeyTimer % 60;
                    status.textContent = `Mel em ${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else if (bee.honeyReady) {
                    status.textContent = '🍯 Mel pronto! Clique para coletar';
                    status.classList.add('honey-ready');
                }
            });
        }
        
        function startBeehiveTimers() {
            setInterval(() => {
                if (!gameState.beehive.hasBeehive) return;
                
                let updated = false;
                gameState.beehive.bees.forEach(bee => {
                    if (bee.isPollenating && bee.honeyTimer > 0) {
                        bee.honeyTimer--;
                        if (bee.honeyTimer === 0) {
                            bee.honeyReady = true;
                            bee.isPollenating = false;
                            updated = true;
                        }
                    }
                });
                
                if (updated) {
                    updateBeehiveDisplay();
                }
            }, 1000);
            
            // Atualizar display a cada segundo
            setInterval(() => {
                updateBeehiveDisplay();
            }, 1000);
        }

        // Comprar semente de flor especial
        function buyFlowerSeed(seedType, emoji, price) {
            if (gameState.coins < price) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= price;
            updateResources();
            
            // Selecionar automaticamente a semente
            selectSeed(seedType, emoji);
            
            alert(`🌸 Semente de ${seedType} comprada e selecionada! Plante na colmeia para as abelhas produzirem mel.`);
        }
        
        // Comprar ração para cachorro
        function buyDogFood() {
            if (gameState.coins < 25) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 25;
            gameState.doghouse.dogFoodPurchased++;
            
            // Adicionar ração ao celeiro
            if (!gameState.celeiro['racao']) {
                gameState.celeiro['racao'] = { count: 0, emoji: '🦴' };
            }
            gameState.celeiro['racao'].count++;
            
            // A cada 2 rações, ganhar 1 osso
            if (gameState.doghouse.dogFoodPurchased % 2 === 0) {
                if (!gameState.celeiro['osso']) {
                    gameState.celeiro['osso'] = { count: 0, emoji: '🦴' };
                }
                gameState.celeiro['osso'].count++;
                alert('🦴 Você ganhou um osso grátis! Use para aumentar a amizade com a Mocinha.');
            }
            
            updateResources();
            updateCeleiro();
            alert('🦴 Ração comprada! Use para alimentar a Mocinha.');
        }
        
        // Comprar ração para porcos
        function buyPigFeed() {
            if (gameState.coins < 25) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 25;
            gameState.pigPen.pigFeedPurchased++;
            
            // Adicionar ração ao celeiro
            if (!gameState.celeiro['racao_porco']) {
                gameState.celeiro['racao_porco'] = { count: 0, emoji: '🌽' };
            }
            gameState.celeiro['racao_porco'].count++;
            
            updateResources();
            updateCeleiro();
            alert('🌽 Ração para porcos comprada!');
        }
        
        // Comprar porco
        function buyPig() {
            if (gameState.coins < 100) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Verificar se há slot vazio
            const emptySlot = gameState.pigPen.pigs.findIndex(pig => !pig.hasPig);
            if (emptySlot === -1) {
                alert('🐷 Chiqueiro lotado! Máximo 4 porcos.');
                return;
            }
            
            gameState.coins -= 100;
            gameState.pigPen.pigs[emptySlot].hasPig = true;
            gameState.pigPen.totalPigs++;
            
            updateResources();
            updatePigPenDisplay();
            alert('🐷 Porco comprado e colocado no chiqueiro!');
        }
        
        // Comprar feno para vacas
        function buyCowHay() {
            if (gameState.coins < 30) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 30;
            gameState.cowPasture.cowHayPurchased++;
            
            // Adicionar feno ao celeiro
            if (!gameState.celeiro['feno_vaca']) {
                gameState.celeiro['feno_vaca'] = { count: 0, emoji: '🌾' };
            }
            gameState.celeiro['feno_vaca'].count++;
            
            updateResources();
            updateCeleiro();
            alert('🌾 Feno para vacas comprado!');
        }
        
        // Comprar vaca
        function buyCow() {
            if (gameState.coins < 120) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Verificar se há slot vazio
            const emptySlot = gameState.cowPasture.cows.findIndex(cow => !cow.hasCow);
            if (emptySlot === -1) {
                alert('🐄 Pasto lotado! Máximo 4 vacas.');
                return;
            }
            
            gameState.coins -= 120;
            gameState.cowPasture.cows[emptySlot].hasCow = true;
            gameState.cowPasture.totalCows++;
            
            updateResources();
            updateCowPastureDisplay();
            alert('🐄 Vaca comprada e colocada no pasto!');
        }
        
        // Comprar diesel
        function buyDiesel() {
            if (gameState.coins < 30) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Adicionar diesel ao celeiro
            if (!gameState.celeiro['diesel']) {
                gameState.celeiro['diesel'] = { count: 0, emoji: '⛽' };
            }
            gameState.celeiro['diesel'].count++;
            gameState.coins -= 30;
            
            updateResources();
            updateCeleiro();
            alert('⛽ Diesel comprado! Use para abastecer a caminhonete.');
        }
        
        // Comprar vacina
        function buyVaccine() {
            if (gameState.coins < 50) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Adicionar vacina ao celeiro
            if (!gameState.celeiro['vacina']) {
                gameState.celeiro['vacina'] = { count: 0, emoji: '💉' };
            }
            gameState.celeiro['vacina'].count++;
            gameState.coins -= 50;
            
            updateResources();
            updateCeleiro();
            alert('💉 Vacina comprada! Use para curar animais doentes.');
        }
        
        // Comprar feno para ovelhas
        function buySheepHay() {
            if (gameState.coins < 25) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 25;
            gameState.sheepPen.sheepHayPurchased++;
            
            // Adicionar feno ao celeiro
            if (!gameState.celeiro['feno_ovelha']) {
                gameState.celeiro['feno_ovelha'] = { count: 0, emoji: '🌾' };
            }
            gameState.celeiro['feno_ovelha'].count++;
            
            updateResources();
            updateCeleiro();
            alert('🌾 Feno para ovelhas comprado!');
        }
        
        // Comprar ovelha
        function buySheep() {
            if (gameState.coins < 90) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Verificar se há slot vazio
            const emptySlot = gameState.sheepPen.sheep.findIndex(sheep => !sheep.hasSheep);
            if (emptySlot === -1) {
                alert('🐑 Curral lotado! Máximo 4 ovelhas.');
                return;
            }
            
            gameState.coins -= 90;
            gameState.sheepPen.sheep[emptySlot].hasSheep = true;
            gameState.sheepPen.totalSheep++;
            
            updateResources();
            updateSheepPenDisplay();
            alert('🐑 Ovelha comprada e colocada no curral!');
        }
        
        // Comprar tesoura
        function buyShears() {
            if (gameState.coins < 40) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            if (gameState.sheepPen.hasShears) {
                alert('✂️ Você já tem uma tesoura!');
                return;
            }
            
            gameState.coins -= 40;
            gameState.sheepPen.hasShears = true;
            
            // Adicionar tesoura ao celeiro
            if (!gameState.celeiro['tesoura']) {
                gameState.celeiro['tesoura'] = { count: 0, emoji: '✂️' };
            }
            gameState.celeiro['tesoura'].count++;
            
            updateResources();
            updateCeleiro();
            alert('✂️ Tesoura de tosquiar comprada! Use para coletar lã das ovelhas.');
        }
        
        // Comprar vara de pesca
        function buyFishingRod() {
            if (gameState.coins < 60) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 60;
            gameState.fishLake.fishingRod.hasRod = true;
            gameState.fishLake.fishingRod.usesLeft = 20; // 20 usos
            
            updateResources();
            updateFishLakeDisplay();
            alert('🎣 Vara de pesca comprada! Ela tem 20 usos. Use com minhocas para pescar!');
        }
        
        // Comprar machado
        function buyAxe() {
            if (gameState.coins < 80) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            if (gameState.forest.axe.hasAxe) {
                alert('🪓 Você já tem um machado!');
                return;
            }
            
            gameState.coins -= 80;
            gameState.forest.axe.hasAxe = true;
            gameState.forest.axe.usesLeft = 40;
            gameState.woodCutting.hasWoodCutting = true;
            
            // Mostrar área de cortar lenha
            document.getElementById('wood-cutting-container').style.display = 'block';
            
            updateResources();
            updateForestDisplay();
            updateWoodCuttingDisplay();
            alert('🪓 Machado comprado! Agora você pode cortar troncos da árvore comum e usar a área de Cortar Lenha!');
        }
        
        // Abastecer caminhonete
        function refuelTruck() {
            if (!gameState.truck.hasTruck) {
                alert('🚚 Você precisa comprar uma caminhonete primeiro!');
                return;
            }
            
            if (gameState.truck.fuel >= gameState.truck.maxFuel) {
                alert('⛽ A caminhonete já está com o tanque cheio!');
                return;
            }
            
            if (!gameState.celeiro['diesel'] || gameState.celeiro['diesel'].count <= 0) {
                alert('⛽ Você não tem diesel! Compre no mercadinho.');
                return;
            }
            
            // Usar diesel
            gameState.celeiro['diesel'].count--;
            if (gameState.celeiro['diesel'].count === 0) {
                delete gameState.celeiro['diesel'];
            }
            
            // Abastecer (cada diesel = 1 litro)
            gameState.truck.fuel = Math.min(gameState.truck.maxFuel, gameState.truck.fuel + 1);
            
            updateCeleiro();
            updateTruckDisplay();
            alert(`⛽ Caminhonete abastecida! Combustível: ${gameState.truck.fuel}/${gameState.truck.maxFuel}`);
        }
        
        // Gerenciar slot da caminhonete
        function manageTruckSlot(slotIndex) {
            if (!gameState.truck.hasTruck) {
                alert('🚚 Você precisa comprar uma caminhonete primeiro!');
                return;
            }
            
            if (gameState.truck.isDelivering) {
                alert('🚚 A caminhonete está fazendo uma entrega! Aguarde ela voltar.');
                return;
            }
            
            const slot = gameState.truck.slots[slotIndex];
            
            if (slot) {
                // Slot ocupado - remover item e devolver ao celeiro
                if (!gameState.celeiro[slot.type]) {
                    gameState.celeiro[slot.type] = { count: 0, emoji: slot.emoji };
                }
                gameState.celeiro[slot.type].count += slot.quantity;
                gameState.truck.slots[slotIndex] = null;
                
                updateCeleiro();
                updateTruckDisplay();
                alert(`📦 ${slot.quantity}x ${slot.name} removido da caminhonete!`);
            } else {
                // Slot vazio - mostrar opções para adicionar
                showTruckLoadOptions(slotIndex);
            }
        }
        
        // Mostrar opções para carregar na caminhonete
        function showTruckLoadOptions(slotIndex) {
            const availableItems = [];
            
            // Listar itens disponíveis no celeiro (exceto não vendáveis)
            for (const [type, data] of Object.entries(gameState.celeiro)) {
                if (data.count > 0 && !['minhoca', 'erva', 'cacau', 'pitaia', 'avocado', 'racao', 'osso', 'chave', 'diesel'].includes(type)) {
                    availableItems.push({
                        type: type,
                        name: type.charAt(0).toUpperCase() + type.slice(1),
                        emoji: data.emoji,
                        count: data.count
                    });
                }
            }
            
            if (availableItems.length === 0) {
                alert('📦 Não há itens disponíveis no celeiro para carregar na caminhonete!');
                return;
            }
            
            // Criar lista de opções
            let options = 'Escolha um item para carregar:\n\n';
            availableItems.forEach((item, index) => {
                options += `${index + 1}. ${item.emoji} ${item.name} (${item.count} disponível)\n`;
            });
            
            const choice = prompt(options + '\nDigite o número do item:');
            const itemIndex = parseInt(choice) - 1;
            
            if (itemIndex >= 0 && itemIndex < availableItems.length) {
                const selectedItem = availableItems[itemIndex];
                const quantity = prompt(`Quantos ${selectedItem.name} carregar? (Máximo: ${selectedItem.count})`);
                const loadQuantity = parseInt(quantity);
                
                if (loadQuantity > 0 && loadQuantity <= selectedItem.count) {
                    // Carregar item na caminhonete
                    gameState.celeiro[selectedItem.type].count -= loadQuantity;
                    if (gameState.celeiro[selectedItem.type].count === 0) {
                        delete gameState.celeiro[selectedItem.type];
                    }
                    
                    gameState.truck.slots[slotIndex] = {
                        type: selectedItem.type,
                        name: selectedItem.name,
                        emoji: selectedItem.emoji,
                        quantity: loadQuantity
                    };
                    
                    updateCeleiro();
                    updateTruckDisplay();
                    alert(`📦 ${loadQuantity}x ${selectedItem.name} carregado na caminhonete!`);
                } else {
                    alert('❌ Quantidade inválida!');
                }
            }
        }
        
        // Iniciar entrega com caminhonete
        function startTruckDelivery() {
            if (!gameState.truck.hasTruck) {
                alert('🚚 Você precisa comprar uma caminhonete primeiro!');
                return;
            }
            
            if (!gameState.phone.currentCall) {
                alert('📞 Não há pedido do telefone para entregar! Aguarde uma chamada.');
                return;
            }
            
            if (gameState.truck.fuel < 2) {
                alert('⛽ Combustível insuficiente! A caminhonete precisa de pelo menos 2 litros para fazer uma entrega.');
                return;
            }
            
            if (gameState.truck.isDelivering) {
                alert('🚚 A caminhonete já está fazendo uma entrega!');
                return;
            }
            
            const call = gameState.phone.currentCall;
            
            // Verificar se tem o produto necessário na caminhonete
            let hasProduct = false;
            let productSlot = -1;
            
            for (let i = 0; i < gameState.truck.slots.length; i++) {
                const slot = gameState.truck.slots[i];
                if (slot && slot.type === call.product.type && slot.quantity >= call.quantity) {
                    hasProduct = true;
                    productSlot = i;
                    break;
                }
            }
            
            if (!hasProduct) {
                alert(`🚚 A caminhonete não tem ${call.quantity}x ${call.product.name} carregado! Carregue o produto nos slots primeiro.`);
                return;
            }
            
            // Iniciar entrega
            gameState.truck.isDelivering = true;
            gameState.truck.deliveryTimer = 15; // 15 segundos
            gameState.truck.currentPhoneOrder = call;
            
            // Remover produto da caminhonete
            const slot = gameState.truck.slots[productSlot];
            slot.quantity -= call.quantity;
            if (slot.quantity <= 0) {
                gameState.truck.slots[productSlot] = null;
            }
            
            // Consumir combustível (2 litros a cada 3 viagens)
            gameState.truck.tripsCount++;
            if (gameState.truck.tripsCount % 3 === 0) {
                gameState.truck.fuel -= 2;
                alert('⛽ A caminhonete consumiu 2 litros de diesel após 3 viagens!');
            }
            
            updateTruckDisplay();
            
            const truckIcon = document.querySelector('#truck-container .text-4xl');
            truckIcon.classList.add('truck-delivering');
            
            alert(`🚚 Caminhonete saiu para entregar ${call.quantity}x ${call.product.name} para ${call.agronomist}! Chegará em 15 segundos.`);
        }
        
        // Completar entrega da caminhonete
        function completeTruckDelivery() {
            const call = gameState.truck.currentPhoneOrder;
            
            // Adicionar moedas
            gameState.coins += call.totalValue;
            
            // Limpar chamada do telefone
            gameState.phone.currentCall = null;
            gameState.phone.isRinging = false;
            
            // Resetar caminhonete
            gameState.truck.isDelivering = false;
            gameState.truck.deliveryTimer = 0;
            gameState.truck.currentPhoneOrder = null;
            
            const truckIcon = document.querySelector('#truck-container .text-4xl');
            truckIcon.classList.remove('truck-delivering');
            
            updateResources();
            updateTruckDisplay();
            updatePhoneDisplay();
            
            alert(`✅ Entrega concluída! Você ganhou ${call.totalValue} moedas! A caminhonete voltou.`);
        }
        
        // Atualizar display da caminhonete
        function updateTruckDisplay() {
            if (!gameState.truck.hasTruck) return;
            
            // Atualizar nível de combustível
            document.getElementById('truck-fuel-level').textContent = `Combustível: ${gameState.truck.fuel}/${gameState.truck.maxFuel}`;
            document.getElementById('truck-fuel-bar').style.width = `${(gameState.truck.fuel / gameState.truck.maxFuel) * 100}%`;
            
            // Atualizar slots
            gameState.truck.slots.forEach((slot, index) => {
                const slotElement = document.getElementById(`truck-slot-${index}`);
                
                if (slot) {
                    slotElement.classList.add('filled');
                    slotElement.innerHTML = `
                        <div class="text-2xl">${slot.emoji}</div>
                        <div class="text-xs">${slot.quantity}x</div>
                    `;
                } else {
                    slotElement.classList.remove('filled');
                    slotElement.innerHTML = `
                        <div class="text-2xl">📦</div>
                        <div class="text-xs">Vazio</div>
                    `;
                }
            });
            
            // Atualizar status
            if (gameState.truck.isDelivering) {
                document.getElementById('truck-status').textContent = `Entregando... ${gameState.truck.deliveryTimer}s`;
            } else {
                document.getElementById('truck-status').textContent = 'Pronta para entregas';
            }
            
            // Atualizar botões
            const refuelBtn = document.getElementById('refuel-btn');
            const deliverBtn = document.getElementById('deliver-truck-btn');
            
            if (gameState.truck.fuel >= gameState.truck.maxFuel) {
                refuelBtn.textContent = '⛽ Tanque Cheio';
                refuelBtn.disabled = true;
                refuelBtn.style.opacity = '0.6';
            } else {
                refuelBtn.textContent = '⛽ Abastecer (30💰)';
                refuelBtn.disabled = false;
                refuelBtn.style.opacity = '1';
            }
            
            if (gameState.truck.isDelivering) {
                deliverBtn.disabled = true;
                deliverBtn.style.opacity = '0.6';
            } else {
                deliverBtn.disabled = false;
                deliverBtn.style.opacity = '1';
            }
        }
        
        // Iniciar sistema da caminhonete
        function startTruckSystem() {
            setInterval(() => {
                if (!gameState.truck.hasTruck) return;
                
                // Timer de entrega
                if (gameState.truck.isDelivering && gameState.truck.deliveryTimer > 0) {
                    gameState.truck.deliveryTimer--;
                    if (gameState.truck.deliveryTimer === 0) {
                        completeTruckDelivery();
                    }
                    updateTruckDisplay();
                }
            }, 1000);
        }
        
        // Alimentar Mocinha
        function feedMocinha() {
            if (!gameState.doghouse.hasDoghouse) {
                alert('🏠 Você precisa comprar a casinha primeiro!');
                return;
            }
            
            if (gameState.doghouse.isHunting) {
                alert('🐕 Mocinha está caçando tesouros! Aguarde ela voltar.');
                return;
            }
            
            if (gameState.doghouse.isResting) {
                alert('🐕 Mocinha está descansando! Aguarde ela acordar.');
                return;
            }
            
            if (gameState.doghouse.hasFoodInSlot) {
                alert('🍽️ Mocinha já tem ração! Aguarde ela comer.');
                return;
            }
            
            if (!gameState.celeiro['racao'] || gameState.celeiro['racao'].count <= 0) {
                alert('🦴 Você não tem ração! Compre no mercadinho.');
                return;
            }
            
            // Usar ração
            gameState.celeiro['racao'].count--;
            if (gameState.celeiro['racao'].count === 0) {
                delete gameState.celeiro['racao'];
            }
            
            gameState.doghouse.hasFoodInSlot = true;
            
            const foodSlot = document.getElementById('dog-food-slot');
            foodSlot.classList.add('filled');
            foodSlot.innerHTML = `<div class="text-2xl">🦴</div><div class="text-xs">Ração</div><div class="text-xs text-gray-500 mt-1">Mocinha vai comer</div>`;
            
            // Mocinha come após 3 segundos
            setTimeout(() => {
                eatFood();
            }, 3000);
            
            updateCeleiro();
        }
        
        // Mocinha come a ração
        function eatFood() {
            gameState.doghouse.hasFoodInSlot = false;
            
            const foodSlot = document.getElementById('dog-food-slot');
            foodSlot.classList.remove('filled');
            foodSlot.innerHTML = `<div class="text-2xl">🍽️</div><div class="text-xs">Vazio</div><div class="text-xs text-gray-500 mt-1">Clique para dar ração</div>`;
            
            // Verificar se pode caçar tesouros (amizade >= 100)
            if (gameState.doghouse.friendship >= 100) {
                startHunting();
            } else {
                alert('🐕 Mocinha comeu, mas ainda não tem amizade suficiente para caçar tesouros. Dê ossos para aumentar a amizade!');
            }
        }
        
        // Dar osso para Mocinha
        function giveBone() {
            if (!gameState.doghouse.hasDoghouse) {
                alert('🏠 Você precisa comprar a casinha primeiro!');
                return;
            }
            
            if (!gameState.celeiro['osso'] || gameState.celeiro['osso'].count <= 0) {
                alert('🦴 Você não tem ossos! Compre 2 rações para ganhar 1 osso.');
                return;
            }
            
            // Usar osso
            gameState.celeiro['osso'].count--;
            if (gameState.celeiro['osso'].count === 0) {
                delete gameState.celeiro['osso'];
            }
            
            // Aumentar amizade
            gameState.doghouse.friendship = Math.min(100, gameState.doghouse.friendship + 10);
            gameState.doghouse.bonusChance = true; // Ativar bônus de 20% para chave
            
            updateDoghouseDisplay();
            updateCeleiro();
            
            alert(`🦴 Mocinha adorou o osso! Amizade: ${gameState.doghouse.friendship}/100. Bônus de 20% para encontrar chaves ativado!`);
        }
        
        // Iniciar caça aos tesouros
        function startHunting() {
            gameState.doghouse.isHunting = true;
            gameState.doghouse.huntingTimer = 1200; // 20 minutos em segundos
            
            const mocinha = document.querySelector('#doghouse-container .text-4xl');
            mocinha.classList.add('mocinha-hunting');
            
            document.getElementById('mocinha-status').textContent = 'Mocinha está caçando tesouros...';
            
            alert('🐕 Mocinha saiu para caçar tesouros! Ela voltará em 20 minutos.');
        }
        
        // Mocinha volta da caça
        function returnFromHunt() {
            gameState.doghouse.isHunting = false;
            gameState.doghouse.huntingTimer = 0;
            
            const mocinha = document.querySelector('#doghouse-container .text-4xl');
            mocinha.classList.remove('mocinha-hunting');
            
            // Encontrar tesouro aleatório
            const treasures = ['bola', 'cd', 'sapato', 'chave'];
            let foundTreasure = treasures[Math.floor(Math.random() * treasures.length)];
            
            // Aplicar bônus de 20% para chave se comeu osso
            if (gameState.doghouse.bonusChance && Math.random() < 0.2) {
                foundTreasure = 'chave';
            }
            gameState.doghouse.bonusChance = false; // Resetar bônus
            
            // Adicionar tesouro
            gameState.doghouse.treasures[foundTreasure]++;
            
            // Iniciar descanso
            gameState.doghouse.isResting = true;
            gameState.doghouse.restingTimer = 300; // 5 minutos em segundos
            
            const mocinha2 = document.querySelector('#doghouse-container .text-4xl');
            mocinha2.classList.add('mocinha-resting');
            
            document.getElementById('mocinha-status').textContent = 'Mocinha está descansando...';
            
            updateDoghouseDisplay();
            
            const treasureNames = { bola: 'Bola', cd: 'CD', sapato: 'Sapato', chave: 'Chave' };
            alert(`🐕 Mocinha voltou e encontrou: ${getItemEmoji(foundTreasure)} ${treasureNames[foundTreasure]}! Ela está descansando por 5 minutos.`);
        }
        
        // Mocinha termina o descanso
        function finishResting() {
            gameState.doghouse.isResting = false;
            gameState.doghouse.restingTimer = 0;
            
            const mocinha = document.querySelector('#doghouse-container .text-4xl');
            mocinha.classList.remove('mocinha-resting');
            
            document.getElementById('mocinha-status').textContent = 'Mocinha está pronta para comer novamente!';
        }
        
        // Abrir baú de tesouros
        function openTreasureChest() {
            if (!gameState.doghouse.hasDoghouse) {
                alert('🏠 Você precisa comprar a casinha primeiro!');
                return;
            }
            
            const totalTreasures = Object.values(gameState.doghouse.treasures).reduce((sum, count) => sum + count, 0);
            
            if (totalTreasures === 0) {
                alert('📦 O baú está vazio! Alimente a Mocinha para ela caçar tesouros.');
                return;
            }
            
            // Mover tesouros para o celeiro
            for (const [treasure, count] of Object.entries(gameState.doghouse.treasures)) {
                if (count > 0) {
                    if (!gameState.celeiro[treasure]) {
                        gameState.celeiro[treasure] = { count: 0, emoji: getItemEmoji(treasure) };
                    }
                    gameState.celeiro[treasure].count += count;
                    gameState.doghouse.treasures[treasure] = 0;
                }
            }
            
            updateDoghouseDisplay();
            updateCeleiro();
            
            alert(`📦 Tesouros coletados do baú! Total: ${totalTreasures} itens movidos para o celeiro.`);
        }
        
        // Atualizar display da casinha
        function updateDoghouseDisplay() {
            if (!gameState.doghouse.hasDoghouse) return;
            
            // Atualizar nível de amizade
            document.getElementById('friendship-level').textContent = `Amizade: ${gameState.doghouse.friendship}/100`;
            document.getElementById('friendship-bar').style.width = `${gameState.doghouse.friendship}%`;
            
            // Atualizar contador de tesouros
            const totalTreasures = Object.values(gameState.doghouse.treasures).reduce((sum, count) => sum + count, 0);
            document.getElementById('treasure-count').textContent = `${totalTreasures} tesouros`;
            
            // Atualizar aparência do baú
            const chest = document.getElementById('treasure-chest');
            if (totalTreasures > 0) {
                chest.classList.add('has-treasures');
            } else {
                chest.classList.remove('has-treasures');
            }
            
            // Atualizar status dos timers
            if (gameState.doghouse.isHunting && gameState.doghouse.huntingTimer > 0) {
                const minutes = Math.floor(gameState.doghouse.huntingTimer / 60);
                const seconds = gameState.doghouse.huntingTimer % 60;
                document.getElementById('mocinha-status').textContent = `Caçando tesouros... ${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else if (gameState.doghouse.isResting && gameState.doghouse.restingTimer > 0) {
                const minutes = Math.floor(gameState.doghouse.restingTimer / 60);
                const seconds = gameState.doghouse.restingTimer % 60;
                document.getElementById('mocinha-status').textContent = `Descansando... ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Mostrar/esconder botão de osso baseado na disponibilidade
            const boneBtn = document.getElementById('bone-btn');
            if (gameState.celeiro['osso'] && gameState.celeiro['osso'].count > 0) {
                boneBtn.style.display = 'inline-block';
            } else {
                boneBtn.style.display = 'none';
            }
        }
        
        // Iniciar timers da casinha
        function startDoghouseTimers() {
            setInterval(() => {
                if (!gameState.doghouse.hasDoghouse) return;
                
                // Timer de caça
                if (gameState.doghouse.isHunting && gameState.doghouse.huntingTimer > 0) {
                    gameState.doghouse.huntingTimer--;
                    if (gameState.doghouse.huntingTimer === 0) {
                        returnFromHunt();
                    }
                }
                
                // Timer de descanso
                if (gameState.doghouse.isResting && gameState.doghouse.restingTimer > 0) {
                    gameState.doghouse.restingTimer--;
                    if (gameState.doghouse.restingTimer === 0) {
                        finishResting();
                    }
                }
                
                updateDoghouseDisplay();
            }, 1000);
        }

        // Sistema da Baia do Duque
        function feedDuke() {
            if (!gameState.stable.hasStable) {
                alert('🏇 Você precisa comprar a baia primeiro!');
                return;
            }
            
            if (gameState.stable.isSick) {
                alert('🐎 Duque está doente! Aguarde ele sarar ou dê uma maçã para curá-lo.');
                return;
            }
            
            if (gameState.stable.isWorking) {
                alert('🐎 Duque está trabalhando! Aguarde ele terminar.');
                return;
            }
            
            if (gameState.stable.hasHayInSlot && gameState.stable.hayCount >= 2) {
                alert('🌾 Duque já tem feno suficiente! Aguarde ele comer.');
                return;
            }
            
            // Verificar se tem trigo no celeiro (feno)
            if (!gameState.celeiro['trigo'] || gameState.celeiro['trigo'].count <= 0) {
                alert('🌾 Você não tem trigo (feno)! Plante e colha trigo primeiro.');
                return;
            }
            
            // Usar trigo como feno
            gameState.celeiro['trigo'].count--;
            if (gameState.celeiro['trigo'].count === 0) {
                delete gameState.celeiro['trigo'];
            }
            
            gameState.stable.hayCount++;
            
            const haySlot = document.getElementById('hay-slot');
            
            if (gameState.stable.hayCount === 1) {
                gameState.stable.hasHayInSlot = true;
                haySlot.classList.add('filled');
                haySlot.innerHTML = `<div class="text-2xl">🌾</div><div class="text-xs">1/2 fenos</div><div class="text-xs text-gray-500 mt-1">Precisa mais 1</div>`;
            } else if (gameState.stable.hayCount >= 2) {
                haySlot.innerHTML = `<div class="text-2xl">🌾🌾</div><div class="text-xs">2/2 fenos</div><div class="text-xs text-gray-500 mt-1">Duque vai comer</div>`;
                
                // Duque come após 3 segundos
                setTimeout(() => {
                    eatHay();
                }, 3000);
            }
            
            updateCeleiro();
        }
        
        function eatHay() {
            gameState.stable.hasHayInSlot = false;
            gameState.stable.hayCount = 0;
            
            const haySlot = document.getElementById('hay-slot');
            haySlot.classList.remove('filled');
            haySlot.innerHTML = `<div class="text-2xl">🌾</div><div class="text-xs">Vazio</div><div class="text-xs text-gray-500 mt-1">2 fenos necessários</div>`;
            
            // Verificar se pode trabalhar (amizade >= 100)
            if (gameState.stable.friendship >= 100) {
                startWork();
            } else {
                alert('🐎 Duque comeu, mas ainda não tem amizade suficiente para trabalhar. Dê maçãs para aumentar a amizade!');
            }
            
            // Chance de ficar doente se não comeu maçã recentemente
            const timeSinceApple = Date.now() - gameState.stable.lastAppleTime;
            if (timeSinceApple > 300000 && !gameState.stable.sicknessPrevented && Math.random() < 0.3) { // 5 minutos e 30% de chance
                makeDukeSick();
            }
        }
        
        function giveApple() {
            if (!gameState.stable.hasStable) {
                alert('🏇 Você precisa comprar a baia primeiro!');
                return;
            }
            
            if (gameState.stable.hasAppleInSlot) {
                alert('🍎 Duque já tem uma maçã! Aguarde ele comer.');
                return;
            }
            
            // Verificar se tem maçã no celeiro (usar abóbora como maçã)
            if (!gameState.celeiro['abobora'] || gameState.celeiro['abobora'].count <= 0) {
                alert('🍎 Você não tem maçãs! Use abóboras como maçãs.');
                return;
            }
            
            // Usar abóbora como maçã
            gameState.celeiro['abobora'].count--;
            if (gameState.celeiro['abobora'].count === 0) {
                delete gameState.celeiro['abobora'];
            }
            
            gameState.stable.hasAppleInSlot = true;
            gameState.stable.lastAppleTime = Date.now();
            gameState.stable.sicknessPrevented = true;
            
            const appleSlot = document.getElementById('apple-slot');
            appleSlot.classList.add('filled');
            appleSlot.innerHTML = `<div class="text-2xl">🍎</div><div class="text-xs">Maçã</div><div class="text-xs text-gray-500 mt-1">Duque vai comer</div>`;
            
            // Duque come após 2 segundos
            setTimeout(() => {
                eatApple();
            }, 2000);
            
            updateCeleiro();
        }
        
        function eatApple() {
            gameState.stable.hasAppleInSlot = false;
            
            // Aumentar amizade
            gameState.stable.friendship = Math.min(100, gameState.stable.friendship + 10);
            
            // Curar se estiver doente
            if (gameState.stable.isSick) {
                gameState.stable.isSick = false;
                gameState.stable.sickTimer = 0;
                
                const dukeHorse = document.getElementById('duke-horse');
                dukeHorse.classList.remove('duke-sick');
                
                alert('🍎 A maçã curou o Duque! Ele não está mais doente.');
            }
            
            const appleSlot = document.getElementById('apple-slot');
            appleSlot.classList.remove('filled');
            appleSlot.innerHTML = `<div class="text-2xl">🍎</div><div class="text-xs">Vazio</div><div class="text-xs text-gray-500 mt-1">Clique para dar maçã</div>`;
            
            updateStableDisplay();
            
            alert(`🍎 Duque adorou a maçã! Amizade: ${gameState.stable.friendship}/100. Risco de doença reduzido!`);
        }
        
        function startWork() {
            gameState.stable.isWorking = true;
            gameState.stable.workTimer = 1800; // 30 minutos em segundos
            gameState.stable.sicknessPrevented = false; // Reset da prevenção
            
            const dukeHorse = document.getElementById('duke-horse');
            dukeHorse.classList.add('duke-working');
            
            document.getElementById('duke-status').textContent = 'Duque está trabalhando e pode fazer entregas!';
            document.getElementById('delivery-btn').style.display = 'none';
            
            alert('🐎 Duque começou a trabalhar! Agora ele pode entregar os pedidos dos clientes pelos próximos 30 minutos.');
        }
        
        function finishWork() {
            gameState.stable.isWorking = false;
            gameState.stable.workTimer = 0;
            
            const dukeHorse = document.getElementById('duke-horse');
            dukeHorse.classList.remove('duke-working');
            
            document.getElementById('duke-status').textContent = 'Duque terminou o trabalho e não pode mais fazer entregas';
            document.getElementById('delivery-btn').style.display = 'none';
            
            alert('🐎 Duque terminou o trabalho! Ele não pode mais entregar pedidos. Alimente-o novamente para trabalhar mais.');
        }
        
        function makeDukeSick() {
            gameState.stable.isSick = true;
            gameState.stable.sickTimer = 1200; // 20 minutos em segundos
            gameState.stable.isWorking = false;
            gameState.stable.workTimer = 0;
            
            const dukeHorse = document.getElementById('duke-horse');
            dukeHorse.classList.remove('duke-working');
            dukeHorse.classList.add('duke-sick');
            
            document.getElementById('duke-status').textContent = 'Duque está doente e não pode fazer entregas!';
            document.getElementById('delivery-btn').style.display = 'none';
            
            alert('🤒 Duque ficou doente! Ele não pode fazer entregas por 20 minutos. Dê uma maçã para curá-lo mais rápido.');
        }
        
        function recoverFromSickness() {
            gameState.stable.isSick = false;
            gameState.stable.sickTimer = 0;
            
            const dukeHorse = document.getElementById('duke-horse');
            dukeHorse.classList.remove('duke-sick');
            
            document.getElementById('duke-status').textContent = 'Duque se recuperou da doença!';
            
            alert('🐎 Duque se recuperou sozinho! Agora ele pode trabalhar novamente.');
        }
        
        // Função removida - Duque agora só faz entregas através do sistema de pedidos dos clientes
        
        function updateStableDisplay() {
            if (!gameState.stable.hasStable) return;
            
            // Atualizar nível de amizade
            document.getElementById('duke-friendship-level').textContent = `Amizade: ${gameState.stable.friendship}/100`;
            document.getElementById('duke-friendship-bar').style.width = `${gameState.stable.friendship}%`;
            
            // Atualizar status dos timers
            if (gameState.stable.isWorking && gameState.stable.workTimer > 0) {
                const minutes = Math.floor(gameState.stable.workTimer / 60);
                const seconds = gameState.stable.workTimer % 60;
                document.getElementById('duke-work-timer').textContent = `Trabalhando: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else if (gameState.stable.isSick && gameState.stable.sickTimer > 0) {
                const minutes = Math.floor(gameState.stable.sickTimer / 60);
                const seconds = gameState.stable.sickTimer % 60;
                document.getElementById('duke-work-timer').textContent = `Doente: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('duke-work-timer').textContent = '';
            }
        }
        
        function startStableTimers() {
            setInterval(() => {
                if (!gameState.stable.hasStable) return;
                
                // Timer de trabalho
                if (gameState.stable.isWorking && gameState.stable.workTimer > 0) {
                    gameState.stable.workTimer--;
                    if (gameState.stable.workTimer === 0) {
                        finishWork();
                    }
                }
                
                // Timer de doença
                if (gameState.stable.isSick && gameState.stable.sickTimer > 0) {
                    gameState.stable.sickTimer--;
                    if (gameState.stable.sickTimer === 0) {
                        recoverFromSickness();
                    }
                }
                
                updateStableDisplay();
            }, 1000);
        }

        // Sistema de Pedidos dos Clientes
        function generateOrder() {
            if (!gameState.orders.hasOrdersPanel) return;
            if (gameState.orders.activeOrders.length >= 3) return;
            
            // Lista de produtos disponíveis para pedidos
            const availableProducts = [
                { type: 'abobora', emoji: '🎃', name: 'Abóbora', price: 40 },
                { type: 'alface', emoji: '🥬', name: 'Alface', price: 35 },
                { type: 'batata', emoji: '🥔', name: 'Batata', price: 30 },
                { type: 'brocolis', emoji: '🥦', name: 'Brócolis', price: 38 },
                { type: 'cafe', emoji: '🔴', name: 'Café', price: 45 },
                { type: 'cenoura', emoji: '🥕', name: 'Cenoura', price: 28 },
                { type: 'milho', emoji: '🌽', name: 'Milho', price: 35 },
                { type: 'tomate', emoji: '🍅', name: 'Tomate', price: 40 },
                { type: 'trigo', emoji: '🌾', name: 'Trigo', price: 32 },
                { type: 'uva', emoji: '🍇', name: 'Uva', price: 50 },
                { type: 'mel', emoji: '🍯', name: 'Mel', price: 120 },
                { type: 'rosa', emoji: '🌹', name: 'Rosa', price: 25 },
                { type: 'girassol', emoji: '🌻', name: 'Girassol', price: 30 },
                { type: 'margarida', emoji: '🌼', name: 'Margarida', price: 20 }
            ];
            
            // Gerar pedido aleatório
            const numItems = Math.floor(Math.random() * 3) + 1; // 1-3 itens
            const orderItems = [];
            
            for (let i = 0; i < numItems; i++) {
                const product = availableProducts[Math.floor(Math.random() * availableProducts.length)];
                const quantity = Math.floor(Math.random() * 3) + 1; // 1-3 quantidade
                
                // Verificar se já existe este produto no pedido
                const existingItem = orderItems.find(item => item.type === product.type);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    orderItems.push({
                        type: product.type,
                        emoji: product.emoji,
                        name: product.name,
                        quantity: quantity,
                        price: product.price
                    });
                }
            }
            
            // Calcular valor total do pedido
            const totalValue = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Criar pedido
            const order = {
                id: gameState.orders.nextOrderId++,
                items: orderItems,
                totalValue: totalValue,
                isDelivering: false,
                deliveryTimer: 0
            };
            
            gameState.orders.activeOrders.push(order);
            updateOrdersDisplay();
            
            alert(`📋 Novo pedido recebido! Valor: ${totalValue} moedas`);
        }
        
        function updateOrdersDisplay() {
            if (!gameState.orders.hasOrdersPanel) return;
            
            const container = document.getElementById('orders-container');
            
            if (gameState.orders.activeOrders.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 text-sm">Nenhum pedido no momento</div>';
                return;
            }
            
            let html = '';
            gameState.orders.activeOrders.forEach(order => {
                const itemsHtml = order.items.map(item => 
                    `<div class="order-item">${item.emoji} ${item.quantity}x ${item.name}</div>`
                ).join('');
                
                const buttonsHtml = order.isDelivering ? 
                    `<div class="delivery-timer">Entregando... ${order.deliveryTimer}s</div>` :
                    `<div class="order-buttons">
                        <button class="order-btn refuse" onclick="refuseOrder(${order.id})">❌ Recusar</button>
                        <button class="order-btn deliver" onclick="deliverOrder(${order.id})">📦 Entregar</button>
                    </div>`;
                
                const cardClass = order.isDelivering ? 'order-card delivering' : 'order-card';
                
                html += `
                    <div class="${cardClass}">
                        <div class="flex justify-between items-center mb-2">
                            <div class="font-bold text-sm">Pedido #${order.id}</div>
                            <div class="text-sm font-bold text-green-600">${order.totalValue}💰</div>
                        </div>
                        <div class="order-items">${itemsHtml}</div>
                        ${buttonsHtml}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function refuseOrder(orderId) {
            const orderIndex = gameState.orders.activeOrders.findIndex(order => order.id === orderId);
            if (orderIndex === -1) return;
            
            gameState.orders.activeOrders.splice(orderIndex, 1);
            updateOrdersDisplay();
            
            alert('❌ Pedido recusado!');
        }
        
        function deliverOrder(orderId) {
            const order = gameState.orders.activeOrders.find(order => order.id === orderId);
            if (!order) return;
            
            // REGRA 1: Duque deve estar trabalhando
            if (!gameState.stable.isWorking) {
                alert(`❌ Duque não está trabalhando! Alimente-o com 2 fenos para ele começar a trabalhar.`);
                return;
            }
            
            // REGRA 2: Duque não pode estar doente
            if (gameState.stable.isSick) {
                alert(`❌ Duque está doente! Dê uma maçã para curá-lo antes de fazer entregas.`);
                return;
            }
            
            // REGRA 3: Duque deve ter amizade >= 100
            if (gameState.stable.friendship < 100) {
                alert(`❌ Duque precisa de mais amizade para fazer entregas! Amizade atual: ${gameState.stable.friendship}/100. Dê maçãs para aumentar.`);
                return;
            }
            
            // REGRA 4: Verificar se tem todos os itens no celeiro
            for (const item of order.items) {
                if (!gameState.celeiro[item.type] || gameState.celeiro[item.type].count < item.quantity) {
                    alert(`❌ Você não tem ${item.quantity}x ${item.name} no celeiro!`);
                    return;
                }
            }
            
            // REGRA 5: Duque só pode fazer uma entrega por vez
            const hasActiveDelivery = gameState.orders.activeOrders.some(o => o.isDelivering);
            if (hasActiveDelivery) {
                alert(`❌ Duque já está fazendo uma entrega! Aguarde ele voltar.`);
                return;
            }
            
            // Remover itens do celeiro
            for (const item of order.items) {
                gameState.celeiro[item.type].count -= item.quantity;
                if (gameState.celeiro[item.type].count === 0) {
                    delete gameState.celeiro[item.type];
                }
            }
            
            // Iniciar entrega
            order.isDelivering = true;
            order.deliveryTimer = 20; // 20 segundos
            
            updateCeleiro();
            updateOrdersDisplay();
            
            alert(`📦 Duque saiu para entregar o pedido #${order.id}! Ele voltará em 20 segundos com ${order.totalValue} moedas.`);
        }
        
        function completeDelivery(orderId) {
            const orderIndex = gameState.orders.activeOrders.findIndex(order => order.id === orderId);
            if (orderIndex === -1) return;
            
            const order = gameState.orders.activeOrders[orderIndex];
            
            // Adicionar moedas
            gameState.coins += order.totalValue;
            
            // Remover pedido
            gameState.orders.activeOrders.splice(orderIndex, 1);
            
            updateResources();
            updateOrdersDisplay();
            
            alert(`✅ Pedido #${order.id} entregue com sucesso! Você ganhou ${order.totalValue} moedas!`);
        }
        
        function startOrdersSystem() {
            if (!gameState.orders.hasOrdersPanel) return;
            
            // Gerar primeiro pedido após 30 segundos
            setTimeout(() => {
                generateOrder();
            }, 30000);
            
            // Timer principal do sistema de pedidos
            setInterval(() => {
                if (!gameState.orders.hasOrdersPanel) return;
                
                // Atualizar timers de entrega
                let deliveryUpdated = false;
                gameState.orders.activeOrders.forEach(order => {
                    if (order.isDelivering && order.deliveryTimer > 0) {
                        order.deliveryTimer--;
                        deliveryUpdated = true;
                        
                        if (order.deliveryTimer === 0) {
                            completeDelivery(order.id);
                        }
                    }
                });
                
                if (deliveryUpdated) {
                    updateOrdersDisplay();
                }
                
                // Gerar novos pedidos (chance de 10% a cada minuto se tiver menos de 3)
                gameState.orders.orderGenerationTimer++;
                if (gameState.orders.orderGenerationTimer >= 60) { // 1 minuto
                    gameState.orders.orderGenerationTimer = 0;
                    if (gameState.orders.activeOrders.length < 3 && Math.random() < 0.1) {
                        generateOrder();
                    }
                }
            }, 1000);
            
            // Gerar pedidos periodicamente (a cada 2-5 minutos)
            setInterval(() => {
                if (gameState.orders.hasOrdersPanel && gameState.orders.activeOrders.length < 3) {
                    if (Math.random() < 0.7) { // 70% de chance
                        generateOrder();
                    }
                }
            }, Math.random() * 180000 + 120000); // 2-5 minutos
        }

        // Sistema da Caixa de Correios
        function openMailbox() {
            document.getElementById('mailbox-modal').style.display = 'flex';
            
            // Marcar como lido
            gameState.mailbox.hasNewMail = false;
            updateMailboxDisplay();
            
            // Mostrar mensagens
            displayMessages();
        }
        
        function closeMailbox() {
            document.getElementById('mailbox-modal').style.display = 'none';
        }
        
        function displayMessages() {
            const container = document.getElementById('mail-content');
            
            if (gameState.mailbox.messages.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Nenhuma mensagem ainda</div>';
                return;
            }
            
            // Ordenar mensagens por timestamp (mais recente primeiro)
            const sortedMessages = [...gameState.mailbox.messages].sort((a, b) => b.timestamp - a.timestamp);
            
            let html = '';
            sortedMessages.forEach(message => {
                const timeStr = new Date(message.timestamp).toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                if (message.type === 'newspaper') {
                    html += `
                        <div class="mail-item newspaper">
                            <div class="mail-header">
                                <div class="mail-type">📰 Jornal dos Agricultores</div>
                                <div class="mail-time">${timeStr}</div>
                            </div>
                            <div class="mail-content">
                                <div class="font-bold text-lg mb-2">${message.title}</div>
                                <div class="newspaper-content">
                                    <div class="product-highlight">
                                        <div class="font-bold">💰 Produto em Alta:</div>
                                        <div>${message.productHighlight.emoji} ${message.productHighlight.name} - Preço aumentado em ${message.productHighlight.bonus}%!</div>
                                    </div>
                                    <div class="tip-section">
                                        <div class="font-bold">💡 Dica do Dia:</div>
                                        <div>${message.tip}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="mail-item letter">
                            <div class="mail-header">
                                <div class="mail-type">💌 Carta Motivacional</div>
                                <div class="mail-time">${timeStr}</div>
                            </div>
                            <div class="mail-content">
                                <div class="text-center font-medium">${message.content}</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function generateNewspaper() {
            const products = [
                { type: 'abobora', emoji: '🎃', name: 'Abóbora' },
                { type: 'alface', emoji: '🥬', name: 'Alface' },
                { type: 'batata', emoji: '🥔', name: 'Batata' },
                { type: 'brocolis', emoji: '🥦', name: 'Brócolis' },
                { type: 'cafe', emoji: '🔴', name: 'Café' },
                { type: 'cenoura', emoji: '🥕', name: 'Cenoura' },
                { type: 'milho', emoji: '🌽', name: 'Milho' },
                { type: 'tomate', emoji: '🍅', name: 'Tomate' },
                { type: 'trigo', emoji: '🌾', name: 'Trigo' },
                { type: 'uva', emoji: '🍇', name: 'Uva' },
                { type: 'mel', emoji: '🍯', name: 'Mel' },
                { type: 'rosa', emoji: '🌹', name: 'Rosa' },
                { type: 'girassol', emoji: '🌻', name: 'Girassol' },
                { type: 'margarida', emoji: '🌼', name: 'Margarida' }
            ];
            
            const tips = [
                "Regue suas plantas antes da chuva para economizar água!",
                "Plante diferentes culturas para diversificar sua renda.",
                "Alimente os animais regularmente para manter a amizade alta.",
                "Use o comedouro para atrair pássaros com sementes especiais.",
                "Colete flores na primavera para fazer produtos especiais.",
                "Mantenha sempre estoque de produtos para os pedidos dos clientes.",
                "A colmeia produz mel valioso - plante flores especiais!",
                "Cuide bem do Duque para ele fazer mais entregas.",
                "Venda produtos na quitanda quando os preços estão altos.",
                "Explore todas as estações - cada uma tem seus benefícios!"
            ];
            
            const titles = [
                "Mercado Agrícola em Movimento",
                "Tendências do Campo",
                "Boletim Rural Diário",
                "Notícias da Fazenda",
                "Relatório de Preços",
                "Jornal do Agricultor"
            ];
            
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            const randomTitle = titles[Math.floor(Math.random() * titles.length)];
            const bonus = Math.floor(Math.random() * 20) + 10; // 10-30% de bônus
            
            const newspaper = {
                id: gameState.mailbox.nextMessageId++,
                type: 'newspaper',
                title: randomTitle,
                productHighlight: {
                    ...randomProduct,
                    bonus: bonus
                },
                tip: randomTip,
                timestamp: Date.now()
            };
            
            gameState.mailbox.messages.push(newspaper);
            gameState.mailbox.hasNewMail = true;
            
            // Aplicar bônus temporário no preço (por 10 minutos)
            applyPriceBonus(randomProduct.type, bonus);
            
            updateMailboxDisplay();
            alert(`📰 Novo jornal chegou! ${randomProduct.name} está em alta com +${bonus}% no preço!`);
        }
        
        function generateLetter() {
            const motivationalMessages = [
                "🌱 Cada semente plantada é um sonho que cresce!",
                "🌟 Sua fazenda está florescendo como seu coração!",
                "💪 Trabalho duro sempre dá frutos doces!",
                "🌈 Depois da chuva, sempre vem o arco-íris!",
                "🎯 Foque no progresso, não na perfeição!",
                "🌸 Pequenos passos levam a grandes colheitas!",
                "✨ Você está fazendo um trabalho incrível!",
                "🌻 Sua dedicação inspira toda a comunidade!",
                "🏆 Cada dia é uma nova oportunidade de crescer!",
                "💖 Acredite em si mesmo - você é capaz!",
                "🌾 A paciência é a chave para uma boa colheita!",
                "🎉 Celebre cada pequena vitória no campo!",
                "🌟 Sua fazenda é reflexo do seu amor pela terra!",
                "💫 Continue plantando esperança e colhendo alegria!",
                "🌺 Você transforma sementes em milagres diários!"
            ];
            
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            
            const letter = {
                id: gameState.mailbox.nextMessageId++,
                type: 'letter',
                content: randomMessage,
                timestamp: Date.now()
            };
            
            gameState.mailbox.messages.push(letter);
            gameState.mailbox.hasNewMail = true;
            
            updateMailboxDisplay();
            alert('💌 Nova carta motivacional chegou na sua caixa de correios!');
        }
        
        function applyPriceBonus(productType, bonusPercent) {
            // Criar um bônus temporário que será aplicado na função getItemPrice
            if (!gameState.priceBonus) {
                gameState.priceBonus = {};
            }
            
            gameState.priceBonus[productType] = {
                bonus: bonusPercent,
                expiresAt: Date.now() + 600000 // 10 minutos
            };
            
            // Remover bônus após 10 minutos
            setTimeout(() => {
                if (gameState.priceBonus && gameState.priceBonus[productType]) {
                    delete gameState.priceBonus[productType];
                    alert(`📰 O bônus de preço para ${productType} expirou!`);
                }
            }, 600000);
        }
        
        function updateMailboxDisplay() {
            const mailCount = gameState.mailbox.messages.length;
            const mailIcon = document.getElementById('mailbox-icon');
            const mailCountElement = document.getElementById('mail-count');
            const newMailIndicator = document.getElementById('new-mail-indicator');
            
            mailCountElement.textContent = `${mailCount} mensagem${mailCount !== 1 ? 's' : ''}`;
            
            if (gameState.mailbox.hasNewMail) {
                mailIcon.textContent = '📬';
                mailIcon.classList.add('mailbox-new');
                newMailIndicator.style.display = 'flex';
            } else {
                mailIcon.textContent = '📭';
                mailIcon.classList.remove('mailbox-new');
                newMailIndicator.style.display = 'none';
            }
        }
        
        function startMailboxTimers() {
            setInterval(() => {
                // Timer do jornal (25 minutos)
                gameState.mailbox.newspaperTimer--;
                if (gameState.mailbox.newspaperTimer <= 0) {
                    generateNewspaper();
                    gameState.mailbox.newspaperTimer = 1500; // Reset para 25 minutos
                }
                
                // Timer das cartas (40 minutos)
                gameState.mailbox.letterTimer--;
                if (gameState.mailbox.letterTimer <= 0) {
                    generateLetter();
                    gameState.mailbox.letterTimer = 2400; // Reset para 40 minutos
                }
            }, 1000);
        }

        // Sistema do Telefone
        function answerPhone() {
            if (!gameState.phone.hasPhone) {
                alert('📞 Você precisa comprar um telefone primeiro!');
                return;
            }
            
            if (!gameState.phone.isRinging) {
                alert('📞 Nenhuma chamada no momento.');
                return;
            }
            
            document.getElementById('phone-modal').style.display = 'flex';
            displayPhoneCall();
        }
        
        function closePhone() {
            document.getElementById('phone-modal').style.display = 'none';
        }
        
        function generatePhoneCall() {
            if (!gameState.phone.hasPhone) return;
            
            // Produtos que podem ser pedidos em grandes quantidades
            const products = [
                { type: 'trigo', emoji: '🌾', name: 'Farinha de Trigo', unit: 'sacos', price: 45 },
                { type: 'milho', emoji: '🌽', name: 'Farinha de Milho', unit: 'sacos', price: 42 },
                { type: 'cafe', emoji: '☕', name: 'Café Torrado', unit: 'pacotes', price: 60 },
                { type: 'uva', emoji: '🍷', name: 'Suco de Uva', unit: 'garrafas', price: 70 },
                { type: 'tomate', emoji: '🥫', name: 'Molho de Tomate', unit: 'latas', price: 55 },
                { type: 'batata', emoji: '🍟', name: 'Batata Processada', unit: 'pacotes', price: 50 },
                { type: 'mel', emoji: '🍯', name: 'Mel Puro', unit: 'potes', price: 150 }
            ];
            
            const agronomists = [
                'Dr. Silva', 'Eng. Santos', 'Prof. Oliveira', 'Dr. Costa', 'Eng. Ferreira',
                'Prof. Almeida', 'Dr. Pereira', 'Eng. Lima', 'Prof. Rodrigues', 'Dr. Martins'
            ];
            
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            const randomAgronomist = agronomists[Math.floor(Math.random() * agronomists.length)];
            const quantity = Math.floor(Math.random() * 21) + 30; // 30-50 unidades
            const totalValue = randomProduct.price * quantity;
            
            const phoneCall = {
                id: gameState.phone.nextCallId++,
                agronomist: randomAgronomist,
                product: randomProduct,
                quantity: quantity,
                totalValue: totalValue,
                timeLimit: 600, // 10 minutos em segundos
                timestamp: Date.now()
            };
            
            gameState.phone.currentCall = phoneCall;
            gameState.phone.isRinging = true;
            
            updatePhoneDisplay();
            alert(`📞 RING RING! ${randomAgronomist} está ligando com um pedido urgente! Você tem 10 minutos para entregar!`);
        }
        
        function displayPhoneCall() {
            const container = document.getElementById('phone-content');
            const call = gameState.phone.currentCall;
            
            if (!call) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Nenhuma chamada</div>';
                return;
            }
            
            const minutes = Math.floor(call.timeLimit / 60);
            const seconds = call.timeLimit % 60;
            const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            container.innerHTML = `
                <div class="urgent-order p-4 rounded-lg mb-4">
                    <div class="text-center mb-4">
                        <div class="text-2xl mb-2">📞</div>
                        <div class="font-bold text-lg">${call.agronomist}</div>
                        <div class="text-sm text-gray-600">Agrônomo Especialista</div>
                    </div>
                    
                    <div class="bg-white p-3 rounded-lg mb-4">
                        <div class="font-bold text-center mb-2">PEDIDO URGENTE</div>
                        <div class="text-center">
                            <div class="text-3xl mb-2">${call.product.emoji}</div>
                            <div class="font-bold">${call.quantity} ${call.product.unit} de ${call.product.name}</div>
                            <div class="text-lg text-green-600 font-bold mt-2">${call.totalValue}💰</div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-4">
                        <div class="text-red-600 font-bold">⏰ TEMPO LIMITE: ${timeStr}</div>
                        <div class="text-xs text-gray-600 mt-1">O pedido expira automaticamente!</div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="rejectPhoneCall()">
                            ❌ Recusar
                        </button>
                        <button class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" onclick="acceptPhoneCall()">
                            ✅ Aceitar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function acceptPhoneCall() {
            const call = gameState.phone.currentCall;
            if (!call) return;
            
            // Verificar se tem o produto no celeiro
            if (!gameState.celeiro[call.product.type] || gameState.celeiro[call.product.type].count < call.quantity) {
                alert(`❌ Você não tem ${call.quantity}x ${call.product.name} no celeiro! Você precisa de ${call.quantity} ${call.product.type} para fazer este pedido.`);
                return;
            }
            
            // Remover produtos do celeiro
            gameState.celeiro[call.product.type].count -= call.quantity;
            if (gameState.celeiro[call.product.type].count === 0) {
                delete gameState.celeiro[call.product.type];
            }
            
            // Adicionar moedas
            gameState.coins += call.totalValue;
            
            // Limpar chamada
            gameState.phone.currentCall = null;
            gameState.phone.isRinging = false;
            
            updateResources();
            updateCeleiro();
            updatePhoneDisplay();
            closePhone();
            
            alert(`✅ Pedido entregue com sucesso para ${call.agronomist}! Você ganhou ${call.totalValue} moedas!`);
        }
        
        function rejectPhoneCall() {
            const call = gameState.phone.currentCall;
            if (!call) return;
            
            // Limpar chamada
            gameState.phone.currentCall = null;
            gameState.phone.isRinging = false;
            
            updatePhoneDisplay();
            closePhone();
            
            alert(`❌ Pedido de ${call.agronomist} recusado.`);
        }
        
        function expirePhoneCall() {
            const call = gameState.phone.currentCall;
            if (!call) return;
            
            // Limpar chamada
            gameState.phone.currentCall = null;
            gameState.phone.isRinging = false;
            
            updatePhoneDisplay();
            
            alert(`⏰ O pedido de ${call.agronomist} expirou! Você perdeu a oportunidade de ganhar ${call.totalValue} moedas.`);
        }
        
        function updatePhoneDisplay() {
            if (!gameState.phone.hasPhone) return;
            
            const phoneIcon = document.getElementById('phone-icon');
            const phoneStatus = document.getElementById('phone-status');
            const phoneRingIndicator = document.getElementById('phone-ring-indicator');
            
            if (gameState.phone.isRinging) {
                phoneIcon.classList.add('phone-ringing');
                phoneRingIndicator.style.display = 'flex';
                phoneStatus.textContent = 'CHAMADA URGENTE!';
            } else {
                phoneIcon.classList.remove('phone-ringing');
                phoneRingIndicator.style.display = 'none';
                phoneStatus.textContent = 'Aguardando chamadas';
            }
        }
        
        function startPhoneSystem() {
            if (!gameState.phone.hasPhone) return;
            
            // Timer principal do telefone
            setInterval(() => {
                if (!gameState.phone.hasPhone) return;
                
                // Timer para próxima chamada
                if (!gameState.phone.isRinging) {
                    gameState.phone.callTimer--;
                    if (gameState.phone.callTimer <= 0) {
                        generatePhoneCall();
                        gameState.phone.callTimer = 2100; // Reset para 35 minutos
                    }
                }
                
                // Timer do limite da chamada atual
                if (gameState.phone.currentCall && gameState.phone.currentCall.timeLimit > 0) {
                    gameState.phone.currentCall.timeLimit--;
                    if (gameState.phone.currentCall.timeLimit === 0) {
                        expirePhoneCall();
                    }
                    
                    // Atualizar display se modal estiver aberto
                    if (document.getElementById('phone-modal').style.display === 'flex') {
                        displayPhoneCall();
                    }
                }
            }, 1000);
        }

        // Sistema do Galinheiro
        function buyChickenFeed() {
            if (gameState.coins < 20) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 20;
            gameState.chickenCoop.chickFeedPurchased++;
            
            // Adicionar ração ao celeiro
            if (!gameState.celeiro['racao_galinha']) {
                gameState.celeiro['racao_galinha'] = { count: 0, emoji: '🌾' };
            }
            gameState.celeiro['racao_galinha'].count++;
            
            updateResources();
            updateCeleiro();
            alert('🌾 Ração para galinhas comprada!');
        }
        
        function buyChicken() {
            if (gameState.coins < 80) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            // Verificar se há slot vazio
            const emptySlot = gameState.chickenCoop.chickens.findIndex(chicken => !chicken.hasChicken);
            if (emptySlot === -1) {
                alert('🐔 Galinheiro lotado! Máximo 4 galinhas.');
                return;
            }
            
            gameState.coins -= 80;
            gameState.chickenCoop.chickens[emptySlot].hasChicken = true;
            gameState.chickenCoop.chickens[emptySlot].type = 'adult';
            gameState.chickenCoop.totalChickens++;
            
            updateResources();
            updateChickenCoopDisplay();
            alert('🐔 Galinha comprada e colocada no galinheiro!');
        }
        
        function manageChickenSlot(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            
            if (!chicken.hasChicken) {
                alert('🐔 Este slot está vazio! Compre uma galinha no mercadinho.');
                return;
            }
            
            if (chicken.eggsReady > 0) {
                // Coletar ovos
                collectEggs(slotIndex);
            } else {
                alert('🐔 Esta galinha não tem ovos prontos para coletar.');
            }
        }
        
        function feedChicken(slotIndex, event) {
            event.stopPropagation(); // Evitar trigger do slot principal
            
            if (!gameState.chickenCoop.hasChickenCoop) {
                alert('🐔 Você precisa comprar um galinheiro primeiro!');
                return;
            }
            
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            
            if (!chicken.hasChicken) {
                alert('🐔 Não há galinha neste slot!');
                return;
            }
            
            if (chicken.isSick) {
                alert('🤒 Esta galinha está doente! Use uma vacina para curá-la primeiro.');
                return;
            }
            
            if (chicken.hasFood) {
                alert('🌾 Esta galinha já tem ração!');
                return;
            }
            
            if (chicken.isEating || chicken.isLaying || chicken.isResting) {
                alert('🐔 Esta galinha está ocupada!');
                return;
            }
            
            if (!gameState.celeiro['racao_galinha'] || gameState.celeiro['racao_galinha'].count <= 0) {
                alert('🌾 Você não tem ração para galinhas! Compre no mercadinho.');
                return;
            }
            
            // Usar ração
            gameState.celeiro['racao_galinha'].count--;
            if (gameState.celeiro['racao_galinha'].count === 0) {
                delete gameState.celeiro['racao_galinha'];
            }
            
            chicken.hasFood = true;
            chicken.isEating = true;
            chicken.eatingTimer = 10; // 10 segundos para comer
            
            updateCeleiro();
            updateChickenCoopDisplay();
        }
        
        function feedAllChickens() {
            if (!gameState.chickenCoop.hasChickenCoop) {
                alert('🐔 Você precisa comprar um galinheiro primeiro!');
                return;
            }
            
            let fedCount = 0;
            let neededFood = 0;
            
            // Contar quantas galinhas precisam de comida
            gameState.chickenCoop.chickens.forEach(chicken => {
                if (chicken.hasChicken && !chicken.hasFood && !chicken.isEating && !chicken.isLaying && !chicken.isResting) {
                    neededFood++;
                }
            });
            
            if (neededFood === 0) {
                alert('🐔 Todas as galinhas já estão alimentadas ou ocupadas!');
                return;
            }
            
            if (!gameState.celeiro['racao_galinha'] || gameState.celeiro['racao_galinha'].count < neededFood) {
                alert(`🌾 Você precisa de ${neededFood} rações para alimentar todas as galinhas! Você tem apenas ${gameState.celeiro['racao_galinha']?.count || 0}.`);
                return;
            }
            
            // Alimentar todas
            gameState.chickenCoop.chickens.forEach(chicken => {
                if (chicken.hasChicken && !chicken.hasFood && !chicken.isEating && !chicken.isLaying && !chicken.isResting) {
                    chicken.hasFood = true;
                    chicken.isEating = true;
                    chicken.eatingTimer = 10;
                    fedCount++;
                }
            });
            
            // Usar ração
            gameState.celeiro['racao_galinha'].count -= fedCount;
            if (gameState.celeiro['racao_galinha'].count === 0) {
                delete gameState.celeiro['racao_galinha'];
            }
            
            updateCeleiro();
            updateChickenCoopDisplay();
            alert(`🌾 ${fedCount} galinhas foram alimentadas!`);
        }
        
        function finishEating(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            chicken.isEating = false;
            chicken.hasFood = false;
            chicken.eatingTimer = 0;
            
            // Começar a botar ovos
            chicken.isLaying = true;
            chicken.layingTimer = 5; // 5 segundos para botar ovos
            
            updateChickenCoopDisplay();
        }
        
        function finishLaying(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            chicken.isLaying = false;
            chicken.layingTimer = 0;
            chicken.eggsReady = 3; // 3 ovos prontos
            
            // Começar descanso
            chicken.isResting = true;
            chicken.restingTimer = 300; // 5 minutos de descanso
            
            updateChickenCoopDisplay();
            
            // Chance de pintinho (10% se tiver 2-3 galinhas)
            const adultChickens = gameState.chickenCoop.chickens.filter(c => c.hasChicken && c.type === 'adult').length;
            if (adultChickens >= 2 && adultChickens <= 3 && Math.random() < 0.1) {
                spawnChick();
            }
        }
        
        function finishResting(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            chicken.isResting = false;
            chicken.restingTimer = 0;
            
            updateChickenCoopDisplay();
        }
        
        function collectEggs(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            
            if (chicken.eggsReady <= 0) {
                alert('🥚 Esta galinha não tem ovos para coletar!');
                return;
            }
            
            // Adicionar ovos ao celeiro
            if (!gameState.celeiro['ovo']) {
                gameState.celeiro['ovo'] = { count: 0, emoji: '🥚' };
            }
            gameState.celeiro['ovo'].count += chicken.eggsReady;
            
            const eggsCollected = chicken.eggsReady;
            chicken.eggsReady = 0;
            
            updateCeleiro();
            updateChickenCoopDisplay();
            alert(`🥚 Coletou ${eggsCollected} ovos!`);
        }
        
        function spawnChick() {
            // Encontrar slot vazio para o pintinho
            const emptySlot = gameState.chickenCoop.chickens.findIndex(chicken => !chicken.hasChicken);
            if (emptySlot === -1) {
                alert('🐣 Um pintinho nasceu, mas o galinheiro está lotado!');
                return;
            }
            
            const chick = gameState.chickenCoop.chickens[emptySlot];
            chick.hasChicken = true;
            chick.type = 'chick';
            chick.growthTimer = 1800; // 30 minutos para virar adulto
            gameState.chickenCoop.totalChickens++;
            
            updateChickenCoopDisplay();
            alert('🐣 Um pintinho nasceu no galinheiro! Ele virará adulto em 30 minutos.');
        }
        
        function growChick(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            chicken.type = 'adult';
            chicken.growthTimer = 0;
            
            updateChickenCoopDisplay();
            alert('🐔 O pintinho cresceu e virou uma galinha adulta!');
        }
        
        function showSacrificeMenu() {
            if (!gameState.chickenCoop.hasChickenCoop) {
                alert('🐔 Você precisa comprar um galinheiro primeiro!');
                return;
            }
            
            const availableChickens = [];
            gameState.chickenCoop.chickens.forEach((chicken, index) => {
                if (chicken.hasChicken) {
                    const type = chicken.type === 'chick' ? 'Pintinho' : 'Galinha';
                    const status = chicken.isEating ? ' (comendo)' : chicken.isLaying ? ' (botando ovos)' : chicken.isResting ? ' (descansando)' : '';
                    availableChickens.push(`${index + 1}. ${type}${status}`);
                }
            });
            
            if (availableChickens.length === 0) {
                alert('🐔 Não há galinhas para sacrificar!');
                return;
            }
            
            let options = 'Escolha uma galinha para sacrificar:\n\n';
            options += availableChickens.join('\n');
            
            const choice = prompt(options + '\n\nDigite o número da galinha (ou "cancelar"):');
            
            if (choice && choice.toLowerCase() !== 'cancelar') {
                const slotIndex = parseInt(choice) - 1;
                if (slotIndex >= 0 && slotIndex < 4 && gameState.chickenCoop.chickens[slotIndex].hasChicken) {
                    sacrificeChicken(slotIndex);
                } else {
                    alert('❌ Escolha inválida!');
                }
            }
        }
        
        function sacrificeChicken(slotIndex) {
            const chicken = gameState.chickenCoop.chickens[slotIndex];
            
            if (!chicken.hasChicken) {
                alert('🐔 Não há galinha neste slot!');
                return;
            }
            
            const confirm = window.confirm(`🔪 Tem certeza que deseja sacrificar esta ${chicken.type === 'chick' ? 'pintinho' : 'galinha'}?`);
            if (!confirm) return;
            
            // Adicionar frango cru ao celeiro
            if (!gameState.celeiro['frango_cru']) {
                gameState.celeiro['frango_cru'] = { count: 0, emoji: '🍗' };
            }
            gameState.celeiro['frango_cru'].count++;
            
            // Remover galinha
            chicken.hasChicken = false;
            chicken.type = 'adult';
            chicken.isEating = false;
            chicken.isLaying = false;
            chicken.isResting = false;
            chicken.hasFood = false;
            chicken.eatingTimer = 0;
            chicken.layingTimer = 0;
            chicken.restingTimer = 0;
            chicken.eggsReady = 0;
            chicken.growthTimer = 0;
            gameState.chickenCoop.totalChickens--;
            
            updateCeleiro();
            updateChickenCoopDisplay();
            alert('🔪 Galinha sacrificada! Frango cru adicionado ao celeiro.');
        }
        
        function updateChickenCoopDisplay() {
            if (!gameState.chickenCoop.hasChickenCoop) return;
            
            // Atualizar status geral
            document.getElementById('chicken-status').textContent = `${gameState.chickenCoop.totalChickens}/4 galinhas no galinheiro`;
            
            // Atualizar cada slot
            gameState.chickenCoop.chickens.forEach((chicken, index) => {
                const slot = document.getElementById(`chicken-slot-${index}`);
                const foodSlot = document.getElementById(`food-slot-${index}`);
                
                // Limpar classes anteriores
                slot.className = 'chicken-slot';
                
                if (!chicken.hasChicken) {
                    // Slot vazio
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">🏠</div>
                        <div class="text-xs">Vazio</div>
                        <div class="chicken-food-slot" id="food-slot-${index}" onclick="feedChicken(${index}, event)">🌾</div>
                    `;
                } else {
                    slot.classList.add('has-chicken');
                    
                    let chickenEmoji = chicken.type === 'chick' ? '🐣' : '🐔';
                    let statusText = '';
                    let eggsDisplay = '';
                    let sickDisplay = '';
                    
                    if (chicken.eggsReady > 0) {
                        eggsDisplay = `<div class="eggs-ready" onclick="collectEggs(${index})">${chicken.eggsReady}🥚</div>`;
                    }
                    
                    if (chicken.isSick) {
                        slot.classList.add('animal-sick');
                        const minutes = Math.floor(chicken.sickTimer / 60);
                        const seconds = chicken.sickTimer % 60;
                        statusText = `DOENTE! ${minutes}:${seconds.toString().padStart(2, '0')}`;
                        sickDisplay = `<div class="sick-timer" onclick="vaccinateAnimal('chicken', ${index})">💉 ${minutes}:${seconds.toString().padStart(2, '0')}</div>`;
                    } else if (chicken.isEating) {
                        slot.classList.add('chicken-eating');
                        statusText = `Comendo... ${chicken.eatingTimer}s`;
                    } else if (chicken.isLaying) {
                        slot.classList.add('chicken-laying');
                        statusText = `Botando ovos... ${chicken.layingTimer}s`;
                    } else if (chicken.isResting) {
                        slot.classList.add('chicken-resting');
                        const minutes = Math.floor(chicken.restingTimer / 60);
                        const seconds = chicken.restingTimer % 60;
                        statusText = `Descansando ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else if (chicken.type === 'chick') {
                        slot.classList.add('chick-growing');
                        const minutes = Math.floor(chicken.growthTimer / 60);
                        const seconds = chicken.growthTimer % 60;
                        statusText = `Crescendo ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        statusText = 'Pronta para comer';
                    }
                    
                    // Atualizar slot da comida
                    const foodSlotHtml = chicken.hasFood ? 
                        `<div class="chicken-food-slot filled" onclick="feedChicken(${index}, event)">🌾</div>` :
                        `<div class="chicken-food-slot" onclick="feedChicken(${index}, event)">🌾</div>`;
                    
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">${chickenEmoji}</div>
                        <div class="text-xs">${statusText}</div>
                        ${eggsDisplay}
                        ${sickDisplay}
                        ${foodSlotHtml}
                    `;
                }
            });
        }
        
        function startChickenCoopTimers() {
            setInterval(() => {
                if (!gameState.chickenCoop.hasChickenCoop) return;
                
                let updated = false;
                
                gameState.chickenCoop.chickens.forEach((chicken, index) => {
                    if (!chicken.hasChicken) return;
                    
                    // Timer de comer
                    if (chicken.isEating && chicken.eatingTimer > 0) {
                        chicken.eatingTimer--;
                        updated = true;
                        if (chicken.eatingTimer === 0) {
                            finishEating(index);
                        }
                    }
                    
                    // Timer de botar ovos
                    if (chicken.isLaying && chicken.layingTimer > 0) {
                        chicken.layingTimer--;
                        updated = true;
                        if (chicken.layingTimer === 0) {
                            finishLaying(index);
                        }
                    }
                    
                    // Timer de descanso
                    if (chicken.isResting && chicken.restingTimer > 0) {
                        chicken.restingTimer--;
                        updated = true;
                        if (chicken.restingTimer === 0) {
                            finishResting(index);
                        }
                    }
                    
                    // Timer de crescimento do pintinho
                    if (chicken.type === 'chick' && chicken.growthTimer > 0) {
                        chicken.growthTimer--;
                        updated = true;
                        if (chicken.growthTimer === 0) {
                            growChick(index);
                        }
                    }
                });
                
                if (updated) {
                    updateChickenCoopDisplay();
                }
            }, 1000);
        }

        // Sistema do Chiqueiro
        function managePigSlot(slotIndex) {
            const pig = gameState.pigPen.pigs[slotIndex];
            
            if (!pig.hasPig) {
                alert('🐷 Este slot está vazio! Compre um porco no mercadinho.');
                return;
            }
            
            if (pig.meatReady > 0) {
                // Coletar carne
                collectMeat(slotIndex);
            } else {
                alert('🐷 Este porco não tem carne pronta para coletar.');
            }
        }
        
        function feedPig(slotIndex, event) {
            event.stopPropagation();
            
            if (!gameState.pigPen.hasPigPen) {
                alert('🐷 Você precisa comprar um chiqueiro primeiro!');
                return;
            }
            
            const pig = gameState.pigPen.pigs[slotIndex];
            
            if (!pig.hasPig) {
                alert('🐷 Não há porco neste slot!');
                return;
            }
            
            if (pig.isSick) {
                alert('🤒 Este porco está doente! Use uma vacina para curá-lo primeiro.');
                return;
            }
            
            if (pig.hasFood) {
                alert('🌽 Este porco já tem ração!');
                return;
            }
            
            if (pig.isEating || pig.isProducing || pig.isResting) {
                alert('🐷 Este porco está ocupado!');
                return;
            }
            
            if (!gameState.celeiro['racao_porco'] || gameState.celeiro['racao_porco'].count <= 0) {
                alert('🌽 Você não tem ração para porcos! Compre no mercadinho.');
                return;
            }
            
            // Usar ração
            gameState.celeiro['racao_porco'].count--;
            if (gameState.celeiro['racao_porco'].count === 0) {
                delete gameState.celeiro['racao_porco'];
            }
            
            pig.hasFood = true;
            pig.isEating = true;
            pig.eatingTimer = 15; // 15 segundos para comer
            
            updateCeleiro();
            updatePigPenDisplay();
        }
        
        function feedAllPigs() {
            if (!gameState.pigPen.hasPigPen) {
                alert('🐷 Você precisa comprar um chiqueiro primeiro!');
                return;
            }
            
            let fedCount = 0;
            let neededFood = 0;
            
            // Contar quantos porcos precisam de comida
            gameState.pigPen.pigs.forEach(pig => {
                if (pig.hasPig && !pig.hasFood && !pig.isEating && !pig.isProducing && !pig.isResting) {
                    neededFood++;
                }
            });
            
            if (neededFood === 0) {
                alert('🐷 Todos os porcos já estão alimentados ou ocupados!');
                return;
            }
            
            if (!gameState.celeiro['racao_porco'] || gameState.celeiro['racao_porco'].count < neededFood) {
                alert(`🌽 Você precisa de ${neededFood} rações para alimentar todos os porcos! Você tem apenas ${gameState.celeiro['racao_porco']?.count || 0}.`);
                return;
            }
            
            // Alimentar todos
            gameState.pigPen.pigs.forEach(pig => {
                if (pig.hasPig && !pig.hasFood && !pig.isEating && !pig.isProducing && !pig.isResting) {
                    pig.hasFood = true;
                    pig.isEating = true;
                    pig.eatingTimer = 15;
                    fedCount++;
                }
            });
            
            // Usar ração
            gameState.celeiro['racao_porco'].count -= fedCount;
            if (gameState.celeiro['racao_porco'].count === 0) {
                delete gameState.celeiro['racao_porco'];
            }
            
            updateCeleiro();
            updatePigPenDisplay();
            alert(`🌽 ${fedCount} porcos foram alimentados!`);
        }
        
        function finishPigEating(slotIndex) {
            const pig = gameState.pigPen.pigs[slotIndex];
            pig.isEating = false;
            pig.hasFood = false;
            pig.eatingTimer = 0;
            
            // Começar a produzir carne
            pig.isProducing = true;
            pig.producingTimer = 10; // 10 segundos para produzir carne
            
            updatePigPenDisplay();
        }
        
        function finishPigProducing(slotIndex) {
            const pig = gameState.pigPen.pigs[slotIndex];
            pig.isProducing = false;
            pig.producingTimer = 0;
            pig.meatReady = 1; // 1 carne pronta
            
            // Começar descanso
            pig.isResting = true;
            pig.restingTimer = 600; // 10 minutos de descanso
            
            updatePigPenDisplay();
        }
        
        function finishPigResting(slotIndex) {
            const pig = gameState.pigPen.pigs[slotIndex];
            pig.isResting = false;
            pig.restingTimer = 0;
            
            updatePigPenDisplay();
        }
        
        function collectMeat(slotIndex) {
            const pig = gameState.pigPen.pigs[slotIndex];
            
            if (pig.meatReady <= 0) {
                alert('🥩 Este porco não tem carne para coletar!');
                return;
            }
            
            // Adicionar carne ao celeiro
            if (!gameState.celeiro['carne_suina']) {
                gameState.celeiro['carne_suina'] = { count: 0, emoji: '🥩' };
            }
            gameState.celeiro['carne_suina'].count += pig.meatReady;
            
            const meatCollected = pig.meatReady;
            pig.meatReady = 0;
            
            updateCeleiro();
            updatePigPenDisplay();
            alert(`🥩 Coletou ${meatCollected} carne suína!`);
        }
        
        function updatePigPenDisplay() {
            if (!gameState.pigPen.hasPigPen) return;
            
            // Atualizar status geral
            document.getElementById('pig-status').textContent = `${gameState.pigPen.totalPigs}/4 porcos no chiqueiro`;
            
            // Atualizar cada slot
            gameState.pigPen.pigs.forEach((pig, index) => {
                const slot = document.getElementById(`pig-slot-${index}`);
                const foodSlot = document.getElementById(`pig-food-slot-${index}`);
                
                // Limpar classes anteriores
                slot.className = 'chicken-slot';
                
                if (!pig.hasPig) {
                    // Slot vazio
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">🏠</div>
                        <div class="text-xs">Vazio</div>
                        <div class="chicken-food-slot" id="pig-food-slot-${index}" onclick="feedPig(${index}, event)">🌽</div>
                    `;
                } else {
                    slot.classList.add('has-chicken');
                    
                    let pigEmoji = '🐷';
                    let statusText = '';
                    let meatDisplay = '';
                    let sickDisplay = '';
                    
                    if (pig.meatReady > 0) {
                        meatDisplay = `<div class="meat-ready" onclick="collectMeat(${index})">${pig.meatReady}🥩</div>`;
                    }
                    
                    if (pig.isSick) {
                        slot.classList.add('animal-sick');
                        const minutes = Math.floor(pig.sickTimer / 60);
                        const seconds = pig.sickTimer % 60;
                        statusText = `DOENTE! ${minutes}:${seconds.toString().padStart(2, '0')}`;
                        sickDisplay = `<div class="sick-timer" onclick="vaccinateAnimal('pig', ${index})">💉 ${minutes}:${seconds.toString().padStart(2, '0')}</div>`;
                    } else if (pig.isEating) {
                        slot.classList.add('pig-eating');
                        statusText = `Comendo... ${pig.eatingTimer}s`;
                    } else if (pig.isProducing) {
                        slot.classList.add('pig-producing');
                        statusText = `Produzindo... ${pig.producingTimer}s`;
                    } else if (pig.isResting) {
                        slot.classList.add('pig-resting');
                        const minutes = Math.floor(pig.restingTimer / 60);
                        const seconds = pig.restingTimer % 60;
                        statusText = `Descansando ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        statusText = 'Pronto para comer';
                    }
                    
                    // Atualizar slot da comida
                    const foodSlotHtml = pig.hasFood ? 
                        `<div class="chicken-food-slot filled" onclick="feedPig(${index}, event)">🌽</div>` :
                        `<div class="chicken-food-slot" onclick="feedPig(${index}, event)">🌽</div>`;
                    
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">${pigEmoji}</div>
                        <div class="text-xs">${statusText}</div>
                        ${meatDisplay}
                        ${sickDisplay}
                        ${foodSlotHtml}
                    `;
                }
            });
        }
        
        function startPigPenTimers() {
            setInterval(() => {
                if (!gameState.pigPen.hasPigPen) return;
                
                let updated = false;
                
                gameState.pigPen.pigs.forEach((pig, index) => {
                    if (!pig.hasPig) return;
                    
                    // Timer de comer
                    if (pig.isEating && pig.eatingTimer > 0) {
                        pig.eatingTimer--;
                        updated = true;
                        if (pig.eatingTimer === 0) {
                            finishPigEating(index);
                        }
                    }
                    
                    // Timer de produzir
                    if (pig.isProducing && pig.producingTimer > 0) {
                        pig.producingTimer--;
                        updated = true;
                        if (pig.producingTimer === 0) {
                            finishPigProducing(index);
                        }
                    }
                    
                    // Timer de descanso
                    if (pig.isResting && pig.restingTimer > 0) {
                        pig.restingTimer--;
                        updated = true;
                        if (pig.restingTimer === 0) {
                            finishPigResting(index);
                        }
                    }
                });
                
                if (updated) {
                    updatePigPenDisplay();
                }
            }, 1000);
        }

        // Sistema do Curral das Ovelhas
        function manageSheepSlot(slotIndex) {
            const sheep = gameState.sheepPen.sheep[slotIndex];
            
            if (!sheep.hasSheep) {
                alert('🐑 Este slot está vazio! Compre uma ovelha no mercadinho.');
                return;
            }
            
            if (sheep.woolReady > 0) {
                // Tosquiar ovelha
                shearSheep(slotIndex);
            } else {
                alert('🐑 Esta ovelha não tem lã pronta para tosquiar.');
            }
        }
        
        function feedSheep(slotIndex, event) {
            event.stopPropagation();
            
            if (!gameState.sheepPen.hasSheepPen) {
                alert('🐑 Você precisa comprar um curral primeiro!');
                return;
            }
            
            const sheep = gameState.sheepPen.sheep[slotIndex];
            
            if (!sheep.hasSheep) {
                alert('🐑 Não há ovelha neste slot!');
                return;
            }
            
            if (sheep.isSick) {
                alert('🤒 Esta ovelha está doente! Use uma vacina para curá-la primeiro.');
                return;
            }
            
            if (sheep.hasFood) {
                alert('🌾 Esta ovelha já tem feno!');
                return;
            }
            
            if (sheep.isEating || sheep.isProducing || sheep.isResting) {
                alert('🐑 Esta ovelha está ocupada!');
                return;
            }
            
            if (!gameState.celeiro['feno_ovelha'] || gameState.celeiro['feno_ovelha'].count <= 0) {
                alert('🌾 Você não tem feno para ovelhas! Compre no mercadinho.');
                return;
            }
            
            // Usar feno
            gameState.celeiro['feno_ovelha'].count--;
            if (gameState.celeiro['feno_ovelha'].count === 0) {
                delete gameState.celeiro['feno_ovelha'];
            }
            
            sheep.hasFood = true;
            sheep.isEating = true;
            sheep.eatingTimer = 15; // 15 segundos para comer
            
            updateCeleiro();
            updateSheepPenDisplay();
        }
        
        function feedAllSheep() {
            if (!gameState.sheepPen.hasSheepPen) {
                alert('🐑 Você precisa comprar um curral primeiro!');
                return;
            }
            
            let fedCount = 0;
            let neededFood = 0;
            
            // Contar quantas ovelhas precisam de comida
            gameState.sheepPen.sheep.forEach(sheep => {
                if (sheep.hasSheep && !sheep.hasFood && !sheep.isEating && !sheep.isProducing && !sheep.isResting) {
                    neededFood++;
                }
            });
            
            if (neededFood === 0) {
                alert('🐑 Todas as ovelhas já estão alimentadas ou ocupadas!');
                return;
            }
            
            if (!gameState.celeiro['feno_ovelha'] || gameState.celeiro['feno_ovelha'].count < neededFood) {
                alert(`🌾 Você precisa de ${neededFood} fenos para alimentar todas as ovelhas! Você tem apenas ${gameState.celeiro['feno_ovelha']?.count || 0}.`);
                return;
            }
            
            // Alimentar todas
            gameState.sheepPen.sheep.forEach(sheep => {
                if (sheep.hasSheep && !sheep.hasFood && !sheep.isEating && !sheep.isProducing && !sheep.isResting) {
                    sheep.hasFood = true;
                    sheep.isEating = true;
                    sheep.eatingTimer = 15;
                    fedCount++;
                }
            });
            
            // Usar feno
            gameState.celeiro['feno_ovelha'].count -= fedCount;
            if (gameState.celeiro['feno_ovelha'].count === 0) {
                delete gameState.celeiro['feno_ovelha'];
            }
            
            updateCeleiro();
            updateSheepPenDisplay();
            alert(`🌾 ${fedCount} ovelhas foram alimentadas!`);
        }
        
        function shearSheep(slotIndex) {
            const sheep = gameState.sheepPen.sheep[slotIndex];
            
            if (sheep.woolReady <= 0) {
                alert('🐑 Esta ovelha não tem lã para tosquiar!');
                return;
            }
            
            if (!gameState.sheepPen.hasShears) {
                alert('✂️ Você precisa de uma tesoura para tosquiar! Compre no mercadinho.');
                return;
            }
            
            // Adicionar lã ao celeiro
            if (!gameState.celeiro['la']) {
                gameState.celeiro['la'] = { count: 0, emoji: '🧶' };
            }
            gameState.celeiro['la'].count += sheep.woolReady;
            
            const woolCollected = sheep.woolReady;
            sheep.woolReady = 0;
            
            updateCeleiro();
            updateSheepPenDisplay();
            alert(`✂️ Tosquiou ${woolCollected} lãs!`);
        }
        
        function shearAllSheep() {
            if (!gameState.sheepPen.hasSheepPen) {
                alert('🐑 Você precisa comprar um curral primeiro!');
                return;
            }
            
            if (!gameState.sheepPen.hasShears) {
                alert('✂️ Você precisa de uma tesoura para tosquiar! Compre no mercadinho.');
                return;
            }
            
            let totalWool = 0;
            let shearedCount = 0;
            
            // Tosquiar todas as ovelhas com lã pronta
            gameState.sheepPen.sheep.forEach(sheep => {
                if (sheep.hasSheep && sheep.woolReady > 0) {
                    totalWool += sheep.woolReady;
                    sheep.woolReady = 0;
                    shearedCount++;
                }
            });
            
            if (totalWool === 0) {
                alert('🐑 Nenhuma ovelha tem lã pronta para tosquiar!');
                return;
            }
            
            // Adicionar lã ao celeiro
            if (!gameState.celeiro['la']) {
                gameState.celeiro['la'] = { count: 0, emoji: '🧶' };
            }
            gameState.celeiro['la'].count += totalWool;
            
            updateCeleiro();
            updateSheepPenDisplay();
            alert(`✂️ Tosquiou ${shearedCount} ovelhas e coletou ${totalWool} lãs!`);
        }
        
        function finishSheepEating(slotIndex) {
            const sheep = gameState.sheepPen.sheep[slotIndex];
            sheep.isEating = false;
            sheep.hasFood = false;
            sheep.eatingTimer = 0;
            
            // Começar a produzir lã
            sheep.isProducing = true;
            sheep.producingTimer = 5; // 5 segundos para produzir lã
            
            updateSheepPenDisplay();
        }
        
        function finishSheepProducing(slotIndex) {
            const sheep = gameState.sheepPen.sheep[slotIndex];
            sheep.isProducing = false;
            sheep.producingTimer = 0;
            sheep.woolReady = 2; // 2 lãs prontas
            
            // Começar descanso
            sheep.isResting = true;
            sheep.restingTimer = 600; // 10 minutos de descanso
            
            updateSheepPenDisplay();
        }
        
        function finishSheepResting(slotIndex) {
            const sheep = gameState.sheepPen.sheep[slotIndex];
            sheep.isResting = false;
            sheep.restingTimer = 0;
            
            updateSheepPenDisplay();
        }
        
        function updateSheepPenDisplay() {
            if (!gameState.sheepPen.hasSheepPen) return;
            
            // Atualizar status geral
            document.getElementById('sheep-status').textContent = `${gameState.sheepPen.totalSheep}/4 ovelhas no curral`;
            
            // Atualizar cada slot
            gameState.sheepPen.sheep.forEach((sheep, index) => {
                const slot = document.getElementById(`sheep-slot-${index}`);
                const foodSlot = document.getElementById(`sheep-food-slot-${index}`);
                
                // Limpar classes anteriores
                slot.className = 'chicken-slot';
                
                if (!sheep.hasSheep) {
                    // Slot vazio
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">🏠</div>
                        <div class="text-xs">Vazio</div>
                        <div class="chicken-food-slot" id="sheep-food-slot-${index}" onclick="feedSheep(${index}, event)">🌾</div>
                    `;
                } else {
                    slot.classList.add('has-chicken');
                    
                    let sheepEmoji = '🐑';
                    let statusText = '';
                    let woolDisplay = '';
                    let sickDisplay = '';
                    
                    if (sheep.woolReady > 0) {
                        woolDisplay = `<div class="wool-ready" onclick="shearSheep(${index})">${sheep.woolReady}🧶</div>`;
                    }
                    
                    if (sheep.isSick) {
                        slot.classList.add('animal-sick');
                        const minutes = Math.floor(sheep.sickTimer / 60);
                        const seconds = sheep.sickTimer % 60;
                        statusText = `DOENTE! ${minutes}:${seconds.toString().padStart(2, '0')}`;
                        sickDisplay = `<div class="sick-timer" onclick="vaccinateAnimal('sheep', ${index})">💉 ${minutes}:${seconds.toString().padStart(2, '0')}</div>`;
                    } else if (sheep.isEating) {
                        slot.classList.add('sheep-eating');
                        statusText = `Comendo... ${sheep.eatingTimer}s`;
                    } else if (sheep.isProducing) {
                        slot.classList.add('sheep-producing');
                        statusText = `Produzindo... ${sheep.producingTimer}s`;
                    } else if (sheep.isResting) {
                        slot.classList.add('sheep-resting');
                        const minutes = Math.floor(sheep.restingTimer / 60);
                        const seconds = sheep.restingTimer % 60;
                        statusText = `Descansando ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        statusText = 'Pronta para comer';
                    }
                    
                    // Atualizar slot da comida
                    const foodSlotHtml = sheep.hasFood ? 
                        `<div class="chicken-food-slot filled" onclick="feedSheep(${index}, event)">🌾</div>` :
                        `<div class="chicken-food-slot" onclick="feedSheep(${index}, event)">🌾</div>`;
                    
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">${sheepEmoji}</div>
                        <div class="text-xs">${statusText}</div>
                        ${woolDisplay}
                        ${sickDisplay}
                        ${foodSlotHtml}
                    `;
                }
            });
        }
        
        function startSheepPenTimers() {
            setInterval(() => {
                if (!gameState.sheepPen.hasSheepPen) return;
                
                let updated = false;
                
                gameState.sheepPen.sheep.forEach((sheep, index) => {
                    if (!sheep.hasSheep) return;
                    
                    // Timer de comer
                    if (sheep.isEating && sheep.eatingTimer > 0) {
                        sheep.eatingTimer--;
                        updated = true;
                        if (sheep.eatingTimer === 0) {
                            finishSheepEating(index);
                        }
                    }
                    
                    // Timer de produzir
                    if (sheep.isProducing && sheep.producingTimer > 0) {
                        sheep.producingTimer--;
                        updated = true;
                        if (sheep.producingTimer === 0) {
                            finishSheepProducing(index);
                        }
                    }
                    
                    // Timer de descanso
                    if (sheep.isResting && sheep.restingTimer > 0) {
                        sheep.restingTimer--;
                        updated = true;
                        if (sheep.restingTimer === 0) {
                            finishSheepResting(index);
                        }
                    }
                    
                    // Timer de doença
                    if (sheep.isSick && sheep.sickTimer > 0) {
                        updated = true;
                    }
                });
                
                if (updated) {
                    updateSheepPenDisplay();
                }
            }, 1000);
        }

        // Sistema do Pasto das Vacas
        function manageCowSlot(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            
            if (!cow.hasCow) {
                alert('🐄 Este slot está vazio! Compre uma vaca no mercadinho.');
                return;
            }
            
            if (cow.milkReady > 0) {
                // Coletar leite
                collectMilk(slotIndex);
            } else {
                alert('🐄 Esta vaca não tem leite pronto para coletar.');
            }
        }
        
        function feedCow(slotIndex, event) {
            event.stopPropagation();
            
            if (!gameState.cowPasture.hasCowPasture) {
                alert('🐄 Você precisa comprar um pasto primeiro!');
                return;
            }
            
            const cow = gameState.cowPasture.cows[slotIndex];
            
            if (!cow.hasCow) {
                alert('🐄 Não há vaca neste slot!');
                return;
            }
            
            if (cow.isSick) {
                alert('🤒 Esta vaca está doente! Use uma vacina para curá-la primeiro.');
                return;
            }
            
            if (cow.hasFood) {
                alert('🌾 Esta vaca já tem feno!');
                return;
            }
            
            if (cow.isEating || cow.isProducing || cow.isResting) {
                alert('🐄 Esta vaca está ocupada!');
                return;
            }
            
            if (!gameState.celeiro['feno_vaca'] || gameState.celeiro['feno_vaca'].count <= 0) {
                alert('🌾 Você não tem feno para vacas! Compre no mercadinho.');
                return;
            }
            
            // Usar feno
            gameState.celeiro['feno_vaca'].count--;
            if (gameState.celeiro['feno_vaca'].count === 0) {
                delete gameState.celeiro['feno_vaca'];
            }
            
            cow.hasFood = true;
            cow.isEating = true;
            cow.eatingTimer = 15; // 15 segundos para comer
            
            updateCeleiro();
            updateCowPastureDisplay();
        }
        
        function feedAllCows() {
            if (!gameState.cowPasture.hasCowPasture) {
                alert('🐄 Você precisa comprar um pasto primeiro!');
                return;
            }
            
            let fedCount = 0;
            let neededFood = 0;
            
            // Contar quantas vacas precisam de comida
            gameState.cowPasture.cows.forEach(cow => {
                if (cow.hasCow && !cow.hasFood && !cow.isEating && !cow.isProducing && !cow.isResting) {
                    neededFood++;
                }
            });
            
            if (neededFood === 0) {
                alert('🐄 Todas as vacas já estão alimentadas ou ocupadas!');
                return;
            }
            
            if (!gameState.celeiro['feno_vaca'] || gameState.celeiro['feno_vaca'].count < neededFood) {
                alert(`🌾 Você precisa de ${neededFood} fenos para alimentar todas as vacas! Você tem apenas ${gameState.celeiro['feno_vaca']?.count || 0}.`);
                return;
            }
            
            // Alimentar todas
            gameState.cowPasture.cows.forEach(cow => {
                if (cow.hasCow && !cow.hasFood && !cow.isEating && !cow.isProducing && !cow.isResting) {
                    cow.hasFood = true;
                    cow.isEating = true;
                    cow.eatingTimer = 15;
                    fedCount++;
                }
            });
            
            // Usar feno
            gameState.celeiro['feno_vaca'].count -= fedCount;
            if (gameState.celeiro['feno_vaca'].count === 0) {
                delete gameState.celeiro['feno_vaca'];
            }
            
            updateCeleiro();
            updateCowPastureDisplay();
            alert(`🌾 ${fedCount} vacas foram alimentadas!`);
        }
        
        function finishCowEating(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            cow.isEating = false;
            cow.hasFood = false;
            cow.eatingTimer = 0;
            
            // Começar a produzir leite
            cow.isProducing = true;
            cow.producingTimer = 10; // 10 segundos para produzir leite
            
            updateCowPastureDisplay();
        }
        
        function finishCowProducing(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            cow.isProducing = false;
            cow.producingTimer = 0;
            cow.milkReady = 3; // 3 leites prontos
            
            // Adicionar esterco ao celeiro automaticamente
            if (!gameState.celeiro['esterco']) {
                gameState.celeiro['esterco'] = { count: 0, emoji: '💩' };
            }
            gameState.celeiro['esterco'].count += 1;
            
            // Começar descanso
            cow.isResting = true;
            cow.restingTimer = 600; // 10 minutos de descanso
            
            updateCeleiro();
            updateCowPastureDisplay();
        }
        
        function finishCowResting(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            cow.isResting = false;
            cow.restingTimer = 0;
            
            updateCowPastureDisplay();
        }
        
        function collectMilk(slotIndex) {
            const cow = gameState.cowPasture.cows[slotIndex];
            
            if (cow.milkReady <= 0) {
                alert('🥛 Esta vaca não tem leite para coletar!');
                return;
            }
            
            // Adicionar leite ao celeiro
            if (!gameState.celeiro['leite']) {
                gameState.celeiro['leite'] = { count: 0, emoji: '🥛' };
            }
            gameState.celeiro['leite'].count += cow.milkReady;
            
            const milkCollected = cow.milkReady;
            cow.milkReady = 0;
            
            updateCeleiro();
            updateCowPastureDisplay();
            alert(`🥛 Coletou ${milkCollected} leites!`);
        }
        
        function updateCowPastureDisplay() {
            if (!gameState.cowPasture.hasCowPasture) return;
            
            // Atualizar status geral
            document.getElementById('cow-status').textContent = `${gameState.cowPasture.totalCows}/4 vacas no pasto`;
            
            // Atualizar cada slot
            gameState.cowPasture.cows.forEach((cow, index) => {
                const slot = document.getElementById(`cow-slot-${index}`);
                const foodSlot = document.getElementById(`cow-food-slot-${index}`);
                
                // Limpar classes anteriores
                slot.className = 'chicken-slot';
                
                if (!cow.hasCow) {
                    // Slot vazio
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">🏠</div>
                        <div class="text-xs">Vazio</div>
                        <div class="chicken-food-slot" id="cow-food-slot-${index}" onclick="feedCow(${index}, event)">🌾</div>
                    `;
                } else {
                    slot.classList.add('has-chicken');
                    
                    let cowEmoji = '🐄';
                    let statusText = '';
                    let milkDisplay = '';
                    let sickDisplay = '';
                    
                    if (cow.milkReady > 0) {
                        milkDisplay = `<div class="milk-ready" onclick="collectMilk(${index})">${cow.milkReady}🥛</div>`;
                    }
                    
                    if (cow.isSick) {
                        slot.classList.add('animal-sick');
                        const minutes = Math.floor(cow.sickTimer / 60);
                        const seconds = cow.sickTimer % 60;
                        statusText = `DOENTE! ${minutes}:${seconds.toString().padStart(2, '0')}`;
                        sickDisplay = `<div class="sick-timer" onclick="vaccinateAnimal('cow', ${index})">💉 ${minutes}:${seconds.toString().padStart(2, '0')}</div>`;
                    } else if (cow.isEating) {
                        slot.classList.add('cow-eating');
                        statusText = `Comendo... ${cow.eatingTimer}s`;
                    } else if (cow.isProducing) {
                        slot.classList.add('cow-producing');
                        statusText = `Produzindo... ${cow.producingTimer}s`;
                    } else if (cow.isResting) {
                        slot.classList.add('cow-resting');
                        const minutes = Math.floor(cow.restingTimer / 60);
                        const seconds = cow.restingTimer % 60;
                        statusText = `Descansando ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        statusText = 'Pronta para comer';
                    }
                    
                    // Atualizar slot da comida
                    const foodSlotHtml = cow.hasFood ? 
                        `<div class="chicken-food-slot filled" onclick="feedCow(${index}, event)">🌾</div>` :
                        `<div class="chicken-food-slot" onclick="feedCow(${index}, event)">🌾</div>`;
                    
                    slot.innerHTML = `
                        <div class="text-4xl mb-2">${cowEmoji}</div>
                        <div class="text-xs">${statusText}</div>
                        ${milkDisplay}
                        ${sickDisplay}
                        ${foodSlotHtml}
                    `;
                }
            });
        }
        
        function startCowPastureTimers() {
            setInterval(() => {
                if (!gameState.cowPasture.hasCowPasture) return;
                
                let updated = false;
                
                gameState.cowPasture.cows.forEach((cow, index) => {
                    if (!cow.hasCow) return;
                    
                    // Timer de comer
                    if (cow.isEating && cow.eatingTimer > 0) {
                        cow.eatingTimer--;
                        updated = true;
                        if (cow.eatingTimer === 0) {
                            finishCowEating(index);
                        }
                    }
                    
                    // Timer de produzir
                    if (cow.isProducing && cow.producingTimer > 0) {
                        cow.producingTimer--;
                        updated = true;
                        if (cow.producingTimer === 0) {
                            finishCowProducing(index);
                        }
                    }
                    
                    // Timer de descanso
                    if (cow.isResting && cow.restingTimer > 0) {
                        cow.restingTimer--;
                        updated = true;
                        if (cow.restingTimer === 0) {
                            finishCowResting(index);
                        }
                    }
                    
                    // Timer de doença
                    if (cow.isSick && cow.sickTimer > 0) {
                        updated = true;
                    }
                });
                
                if (updated) {
                    updateCowPastureDisplay();
                }
            }, 1000);
        }

        // Sistema de Doenças dos Animais
        function makeAnimalSick() {
            // Verificar se já passou o cooldown desde a última doença
            const now = Date.now();
            if (now - gameState.animalSickness.lastSicknessTime < gameState.animalSickness.sicknessCooldown) {
                return;
            }
            
            // Coletar todos os animais saudáveis
            const healthyAnimals = [];
            
            // Galinhas
            if (gameState.chickenCoop.hasChickenCoop) {
                gameState.chickenCoop.chickens.forEach((chicken, index) => {
                    if (chicken.hasChicken && !chicken.isSick) {
                        healthyAnimals.push({ type: 'chicken', index: index, animal: chicken });
                    }
                });
            }
            
            // Porcos
            if (gameState.pigPen.hasPigPen) {
                gameState.pigPen.pigs.forEach((pig, index) => {
                    if (pig.hasPig && !pig.isSick) {
                        healthyAnimals.push({ type: 'pig', index: index, animal: pig });
                    }
                });
            }
            
            // Vacas
            if (gameState.cowPasture.hasCowPasture) {
                gameState.cowPasture.cows.forEach((cow, index) => {
                    if (cow.hasCow && !cow.isSick) {
                        healthyAnimals.push({ type: 'cow', index: index, animal: cow });
                    }
                });
            }
            
            // Ovelhas
            if (gameState.sheepPen.hasSheepPen) {
                gameState.sheepPen.sheep.forEach((sheep, index) => {
                    if (sheep.hasSheep && !sheep.isSick) {
                        healthyAnimals.push({ type: 'sheep', index: index, animal: sheep });
                    }
                });
            }
            
            if (healthyAnimals.length === 0) return;
            
            // Escolher um animal aleatório para ficar doente
            const randomAnimal = healthyAnimals[Math.floor(Math.random() * healthyAnimals.length)];
            randomAnimal.animal.isSick = true;
            randomAnimal.animal.sickTimer = gameState.animalSickness.sicknessDuration; // 5 minutos
            
            // Parar todas as atividades do animal
            randomAnimal.animal.isEating = false;
            randomAnimal.animal.isProducing = false;
            randomAnimal.animal.isLaying = false;
            randomAnimal.animal.hasFood = false;
            randomAnimal.animal.eatingTimer = 0;
            randomAnimal.animal.producingTimer = 0;
            randomAnimal.animal.layingTimer = 0;
            
            gameState.animalSickness.lastSicknessTime = now;
            
            const animalNames = { chicken: 'Galinha', pig: 'Porco', cow: 'Vaca' };
            alert(`🤒 Uma ${animalNames[randomAnimal.type]} ficou doente! Você tem 5 minutos para vaciná-la ou ela morrerá!`);
            
            updateAnimalDisplays();
        }
        
        function vaccinateAnimal(animalType, slotIndex) {
            if (!gameState.celeiro['vacina'] || gameState.celeiro['vacina'].count <= 0) {
                alert('💉 Você não tem vacinas! Compre no mercadinho.');
                return;
            }
            
            let animal;
            if (animalType === 'chicken') {
                animal = gameState.chickenCoop.chickens[slotIndex];
            } else if (animalType === 'pig') {
                animal = gameState.pigPen.pigs[slotIndex];
            } else if (animalType === 'cow') {
                animal = gameState.cowPasture.cows[slotIndex];
            } else if (animalType === 'sheep') {
                animal = gameState.sheepPen.sheep[slotIndex];
            }
            
            if (!animal || !animal.isSick) {
                alert('💉 Este animal não está doente!');
                return;
            }
            
            // Usar vacina
            gameState.celeiro['vacina'].count--;
            if (gameState.celeiro['vacina'].count === 0) {
                delete gameState.celeiro['vacina'];
            }
            
            // Curar animal
            animal.isSick = false;
            animal.sickTimer = 0;
            
            updateCeleiro();
            updateAnimalDisplays();
            
            const animalNames = { chicken: 'Galinha', pig: 'Porco', cow: 'Vaca', sheep: 'Ovelha' };
            alert(`💉 ${animalNames[animalType]} curada com sucesso!`);
        }
        
        function killSickAnimal(animalType, slotIndex) {
            let animal, totalCount;
            
            if (animalType === 'chicken') {
                animal = gameState.chickenCoop.chickens[slotIndex];
                gameState.chickenCoop.totalChickens--;
            } else if (animalType === 'pig') {
                animal = gameState.pigPen.pigs[slotIndex];
                gameState.pigPen.totalPigs--;
            } else if (animalType === 'cow') {
                animal = gameState.cowPasture.cows[slotIndex];
                gameState.cowPasture.totalCows--;
            } else if (animalType === 'sheep') {
                animal = gameState.sheepPen.sheep[slotIndex];
                gameState.sheepPen.totalSheep--;
            }
            
            // Resetar animal
            if (animalType === 'chicken') {
                animal.hasChicken = false;
            } else if (animalType === 'pig') {
                animal.hasPig = false;
            } else if (animalType === 'cow') {
                animal.hasCow = false;
            } else if (animalType === 'sheep') {
                animal.hasSheep = false;
            }
            
            animal.type = 'adult';
            animal.isEating = false;
            animal.isLaying = false;
            animal.isProducing = false;
            animal.isResting = false;
            animal.hasFood = false;
            animal.eatingTimer = 0;
            animal.layingTimer = 0;
            animal.producingTimer = 0;
            animal.restingTimer = 0;
            animal.eggsReady = 0;
            animal.meatReady = 0;
            animal.milkReady = 0;
            animal.woolReady = 0;
            animal.growthTimer = 0;
            animal.isSick = false;
            animal.sickTimer = 0;
            
            const animalNames = { chicken: 'Galinha', pig: 'Porco', cow: 'Vaca' };
            alert(`💀 ${animalNames[animalType]} morreu por falta de tratamento! Você precisará comprar outro animal.`);
            
            updateAnimalDisplays();
        }
        
        function updateAnimalDisplays() {
            if (gameState.chickenCoop.hasChickenCoop) updateChickenCoopDisplay();
            if (gameState.pigPen.hasPigPen) updatePigPenDisplay();
            if (gameState.cowPasture.hasCowPasture) updateCowPastureDisplay();
        }
        
        function startAnimalSicknessSystem() {
            // Timer principal do sistema de doenças
            setInterval(() => {
                // Verificar timers de doença
                let animalDied = false;
                
                // Galinhas
                if (gameState.chickenCoop.hasChickenCoop) {
                    gameState.chickenCoop.chickens.forEach((chicken, index) => {
                        if (chicken.isSick && chicken.sickTimer > 0) {
                            chicken.sickTimer--;
                            if (chicken.sickTimer === 0) {
                                killSickAnimal('chicken', index);
                                animalDied = true;
                            }
                        }
                    });
                }
                
                // Porcos
                if (gameState.pigPen.hasPigPen) {
                    gameState.pigPen.pigs.forEach((pig, index) => {
                        if (pig.isSick && pig.sickTimer > 0) {
                            pig.sickTimer--;
                            if (pig.sickTimer === 0) {
                                killSickAnimal('pig', index);
                                animalDied = true;
                            }
                        }
                    });
                }
                
                // Vacas
                if (gameState.cowPasture.hasCowPasture) {
                    gameState.cowPasture.cows.forEach((cow, index) => {
                        if (cow.isSick && cow.sickTimer > 0) {
                            cow.sickTimer--;
                            if (cow.sickTimer === 0) {
                                killSickAnimal('cow', index);
                                animalDied = true;
                            }
                        }
                    });
                }
                
                if (animalDied) {
                    updateAnimalDisplays();
                }
                
                // Chance de um animal ficar doente (5% a cada minuto)
                if (Math.random() < 0.0833) { // ~5% por minuto
                    makeAnimalSick();
                }
            }, 1000);
        }

        // Sistema do Campo de Grama
        function initGrassField() {
            const grassSlotsContainer = document.getElementById('grass-slots');
            grassSlotsContainer.innerHTML = '';
            
            // Criar 20 slots de grama
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'grass-slot';
                slot.id = `grass-slot-${i}`;
                slot.onclick = () => collectGrass(i);
                slot.innerHTML = '🌱';
                grassSlotsContainer.appendChild(slot);
            }
            
            updateGrassFieldDisplay();
        }
        
        // Sistema do Lago dos Peixes
        function catchFish(slotIndex) {
            if (!gameState.fishLake.hasFishLake) {
                alert('🎣 Você precisa comprar o lago dos peixes primeiro!');
                return;
            }
            
            const fishSlot = gameState.fishLake.fishSlots[slotIndex];
            
            if (!fishSlot.hasFish) {
                alert('🐟 Este peixe ainda está se reproduzindo!');
                return;
            }
            
            if (!gameState.fishLake.fishingRod.hasRod) {
                alert('🎣 Você precisa de uma vara de pesca! Compre no mercadinho.');
                return;
            }
            
            if (gameState.fishLake.fishingRod.usesLeft <= 0) {
                alert('🎣 Sua vara de pesca quebrou! Compre uma nova no mercadinho.');
                return;
            }
            
            if (!gameState.celeiro['minhoca'] || gameState.celeiro['minhoca'].count <= 0) {
                alert('🪱 Você precisa de minhocas para pescar! Colete canteiros para ganhar minhocas.');
                return;
            }
            
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            // Usar minhoca
            gameState.celeiro['minhoca'].count--;
            if (gameState.celeiro['minhoca'].count === 0) {
                delete gameState.celeiro['minhoca'];
            }
            
            // Usar vara de pesca
            gameState.fishLake.fishingRod.usesLeft--;
            if (gameState.fishLake.fishingRod.usesLeft === 0) {
                gameState.fishLake.fishingRod.hasRod = false;
                alert('🎣 Sua vara de pesca quebrou! Compre uma nova no mercadinho.');
            }
            
            // Pescar peixe
            fishSlot.hasFish = false;
            fishSlot.respawnTimer = 120; // 2 minutos para respawn
            gameState.fishLake.totalFishCaught++;
            
            // Adicionar peixe ao celeiro
            if (!gameState.celeiro['peixe']) {
                gameState.celeiro['peixe'] = { count: 0, emoji: '🐟' };
            }
            gameState.celeiro['peixe'].count++;
            
            // Verificar se deve ganhar uma pérola (a cada 5 peixes)
            if (gameState.fishLake.totalFishCaught % 5 === 0) {
                gameState.fishLake.pearlsEarned++;
                
                // Adicionar pérola ao celeiro
                if (!gameState.celeiro['perola']) {
                    gameState.celeiro['perola'] = { count: 0, emoji: '🦪' };
                }
                gameState.celeiro['perola'].count++;
                
                alert('🦪 Você pescou 5 peixes e ganhou uma pérola!');
            }
            
            updateCeleiro();
            updateFishLakeDisplay();
        }
        
        function catchAllFish() {
            if (!gameState.fishLake.hasFishLake) {
                alert('🎣 Você precisa comprar o lago dos peixes primeiro!');
                return;
            }
            
            if (!gameState.fishLake.fishingRod.hasRod) {
                alert('🎣 Você precisa de uma vara de pesca! Compre no mercadinho.');
                return;
            }
            
            if (gameState.fishLake.fishingRod.usesLeft <= 0) {
                alert('🎣 Sua vara de pesca quebrou! Compre uma nova no mercadinho.');
                return;
            }
            
            let fishCount = 0;
            let wormsNeeded = 0;
            let energyNeeded = 0;
            
            // Contar quantos peixes podem ser pescados
            gameState.fishLake.fishSlots.forEach(slot => {
                if (slot.hasFish) {
                    fishCount++;
                    wormsNeeded++;
                    energyNeeded++;
                }
            });
            
            if (fishCount === 0) {
                alert('🐟 Não há peixes prontos para pescar!');
                return;
            }
            
            if (!gameState.celeiro['minhoca'] || gameState.celeiro['minhoca'].count < wormsNeeded) {
                alert(`🪱 Você precisa de ${wormsNeeded} minhocas para pescar todos os peixes! Você tem apenas ${gameState.celeiro['minhoca']?.count || 0}.`);
                return;
            }
            
            if (gameState.farmer.energy < energyNeeded) {
                alert(`⚠️ Você precisa de ${energyNeeded} pontos de energia para pescar todos os peixes! Você tem apenas ${gameState.farmer.energy}.`);
                return;
            }
            
            if (gameState.fishLake.fishingRod.usesLeft < fishCount) {
                alert(`🎣 Sua vara de pesca só tem ${gameState.fishLake.fishingRod.usesLeft} usos restantes! Você precisa de ${fishCount} usos.`);
                return;
            }
            
            // Pescar todos os peixes
            gameState.fishLake.fishSlots.forEach(slot => {
                if (slot.hasFish) {
                    slot.hasFish = false;
                    slot.respawnTimer = 120; // 2 minutos para respawn
                    gameState.fishLake.totalFishCaught++;
                }
            });
            
            // Usar recursos
            gameState.celeiro['minhoca'].count -= wormsNeeded;
            if (gameState.celeiro['minhoca'].count === 0) {
                delete gameState.celeiro['minhoca'];
            }
            
            gameState.fishLake.fishingRod.usesLeft -= fishCount;
            if (gameState.fishLake.fishingRod.usesLeft === 0) {
                gameState.fishLake.fishingRod.hasRod = false;
                alert('🎣 Sua vara de pesca quebrou após pescar todos os peixes! Compre uma nova no mercadinho.');
            }
            
            gameState.farmer.energy -= energyNeeded;
            
            // Adicionar peixes ao celeiro
            if (!gameState.celeiro['peixe']) {
                gameState.celeiro['peixe'] = { count: 0, emoji: '🐟' };
            }
            gameState.celeiro['peixe'].count += fishCount;
            
            // Verificar pérolas ganhas
            const pearlsEarned = Math.floor(gameState.fishLake.totalFishCaught / 5) - gameState.fishLake.pearlsEarned;
            
            if (pearlsEarned > 0) {
                gameState.fishLake.pearlsEarned += pearlsEarned;
                
                // Adicionar pérolas ao celeiro
                if (!gameState.celeiro['perola']) {
                    gameState.celeiro['perola'] = { count: 0, emoji: '🦪' };
                }
                gameState.celeiro['perola'].count += pearlsEarned;
                
                alert(`🎣 Pescou ${fishCount} peixes e ganhou ${pearlsEarned} pérolas!`);
            } else {
                alert(`🎣 Pescou ${fishCount} peixes!`);
            }
            
            updateCeleiro();
            updateFishLakeDisplay();
            updateFarmerDisplay();
        }
        
        function respawnFish(slotIndex) {
            const fishSlot = gameState.fishLake.fishSlots[slotIndex];
            fishSlot.hasFish = true;
            fishSlot.respawnTimer = 0;
            
            updateFishLakeDisplay();
        }
        
        function updateFishLakeDisplay() {
            if (!gameState.fishLake.hasFishLake) return;
            
            // Atualizar status geral
            const fishUntilPearl = 5 - (gameState.fishLake.totalFishCaught % 5);
            document.getElementById('fishing-status').textContent = 
                `Peixes coletados: ${gameState.fishLake.totalFishCaught} | Próxima pérola em: ${fishUntilPearl}`;
            
            // Atualizar status da vara
            if (gameState.fishLake.fishingRod.hasRod) {
                document.getElementById('fishing-rod-status').textContent = 
                    `Vara: ${gameState.fishLake.fishingRod.usesLeft}/20 usos`;
            } else {
                document.getElementById('fishing-rod-status').textContent = 'Vara: Nenhuma';
            }
            
            // Atualizar cada slot
            gameState.fishLake.fishSlots.forEach((slot, index) => {
                const slotElement = document.getElementById(`fish-slot-${index}`);
                if (!slotElement) return;
                
                // Limpar classes anteriores
                slotElement.className = 'fish-slot';
                
                if (slot.hasFish) {
                    // Peixe disponível
                    slotElement.innerHTML = `
                        <div class="text-4xl mb-2">🐟</div>
                        <div class="text-xs">Peixe disponível</div>
                    `;
                } else if (slot.respawnTimer > 0) {
                    // Peixe se reproduzindo
                    slotElement.classList.add('respawning');
                    const minutes = Math.floor(slot.respawnTimer / 60);
                    const seconds = slot.respawnTimer % 60;
                    const timerText = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${seconds}s`;
                    slotElement.innerHTML = `
                        <div class="text-4xl mb-2">🥚</div>
                        <div class="text-xs">Reproduzindo</div>
                        <div class="fish-timer">${timerText}</div>
                    `;
                } else {
                    // Peixe pescado (não deveria acontecer)
                    slotElement.classList.add('empty');
                    slotElement.innerHTML = `
                        <div class="text-4xl mb-2">💧</div>
                        <div class="text-xs">Vazio</div>
                    `;
                }
            });
        }
        
        function startFishLakeTimers() {
            setInterval(() => {
                if (!gameState.fishLake.hasFishLake) return;
                
                let updated = false;
                
                gameState.fishLake.fishSlots.forEach((slot, index) => {
                    if (!slot.hasFish && slot.respawnTimer > 0) {
                        slot.respawnTimer--;
                        updated = true;
                        
                        if (slot.respawnTimer === 0) {
                            respawnFish(index);
                        }
                    }
                });
                
                if (updated) {
                    updateFishLakeDisplay();
                }
            }, 1000);
        }
        
        function collectGrass(slotIndex) {
            if (!gameState.grassField.hasGrassField) {
                alert('🌱 Você precisa comprar o campo de grama primeiro!');
                return;
            }
            
            const grassSlot = gameState.grassField.grassSlots[slotIndex];
            
            if (!grassSlot.hasGrass) {
                alert('🌱 Esta grama ainda está crescendo!');
                return;
            }
            
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            // Coletar grama
            grassSlot.hasGrass = false;
            grassSlot.regrowTimer = 60; // 1 minuto para renascer
            gameState.grassField.totalGrassCollected++;
            
            // Adicionar grama ao celeiro
            if (!gameState.celeiro['grama']) {
                gameState.celeiro['grama'] = { count: 0, emoji: '🌱' };
            }
            gameState.celeiro['grama'].count++;
            
            // Verificar se deve ganhar uma flor (a cada 8 gramas)
            if (gameState.grassField.totalGrassCollected % 8 === 0) {
                gameState.grassField.flowersEarned++;
                
                // Escolher flor aleatória
                const flowers = ['rosa', 'girassol', 'margarida', 'tulipa', 'lirio', 'sakura'];
                const randomFlower = flowers[Math.floor(Math.random() * flowers.length)];
                const flowerEmojis = {
                    'rosa': '🌹',
                    'girassol': '🌻', 
                    'margarida': '🌼',
                    'tulipa': '🌷',
                    'lirio': '🪷',
                    'sakura': '🌸'
                };
                
                // Adicionar flor ao celeiro
                if (!gameState.celeiro[randomFlower]) {
                    gameState.celeiro[randomFlower] = { count: 0, emoji: flowerEmojis[randomFlower] };
                }
                gameState.celeiro[randomFlower].count++;
                
                alert(`🌸 Você coletou 8 gramas e ganhou uma ${randomFlower}! ${flowerEmojis[randomFlower]}`);
            }
            
            updateCeleiro();
            updateGrassFieldDisplay();
        }
        
        function collectAllGrass() {
            if (!gameState.grassField.hasGrassField) {
                alert('🌱 Você precisa comprar o campo de grama primeiro!');
                return;
            }
            
            let collectedCount = 0;
            let energyNeeded = 0;
            
            // Contar quantas gramas podem ser coletadas
            gameState.grassField.grassSlots.forEach(slot => {
                if (slot.hasGrass) {
                    energyNeeded++;
                }
            });
            
            if (energyNeeded === 0) {
                alert('🌱 Não há grama pronta para coletar!');
                return;
            }
            
            if (gameState.farmer.energy < energyNeeded) {
                alert(`⚠️ Você precisa de ${energyNeeded} pontos de energia para coletar toda a grama! Você tem apenas ${gameState.farmer.energy}.`);
                return;
            }
            
            // Coletar todas as gramas
            gameState.grassField.grassSlots.forEach(slot => {
                if (slot.hasGrass) {
                    slot.hasGrass = false;
                    slot.regrowTimer = 60; // 1 minuto para renascer
                    collectedCount++;
                    gameState.grassField.totalGrassCollected++;
                }
            });
            
            // Consumir energia
            gameState.farmer.energy -= energyNeeded;
            
            // Adicionar gramas ao celeiro
            if (!gameState.celeiro['grama']) {
                gameState.celeiro['grama'] = { count: 0, emoji: '🌱' };
            }
            gameState.celeiro['grama'].count += collectedCount;
            
            // Verificar flores ganhas
            const flowersEarned = Math.floor(gameState.grassField.totalGrassCollected / 8) - gameState.grassField.flowersEarned;
            
            if (flowersEarned > 0) {
                gameState.grassField.flowersEarned += flowersEarned;
                
                // Dar flores aleatórias
                const flowers = ['rosa', 'girassol', 'margarida', 'tulipa', 'lirio', 'sakura'];
                const flowerEmojis = {
                    'rosa': '🌹',
                    'girassol': '🌻', 
                    'margarida': '🌼',
                    'tulipa': '🌷',
                    'lirio': '🪷',
                    'sakura': '🌸'
                };
                
                let flowersText = '';
                for (let i = 0; i < flowersEarned; i++) {
                    const randomFlower = flowers[Math.floor(Math.random() * flowers.length)];
                    
                    if (!gameState.celeiro[randomFlower]) {
                        gameState.celeiro[randomFlower] = { count: 0, emoji: flowerEmojis[randomFlower] };
                    }
                    gameState.celeiro[randomFlower].count++;
                    
                    flowersText += `${flowerEmojis[randomFlower]} `;
                }
                
                alert(`🌱 Coletou ${collectedCount} gramas e ganhou ${flowersEarned} flores! ${flowersText}`);
            } else {
                alert(`🌱 Coletou ${collectedCount} gramas!`);
            }
            
            updateCeleiro();
            updateGrassFieldDisplay();
            updateFarmerDisplay();
        }
        
        function regrowGrass(slotIndex) {
            const grassSlot = gameState.grassField.grassSlots[slotIndex];
            grassSlot.hasGrass = true;
            grassSlot.regrowTimer = 0;
            
            updateGrassFieldDisplay();
        }
        
        function updateGrassFieldDisplay() {
            if (!gameState.grassField.hasGrassField) return;
            
            // Atualizar status geral
            const grassesUntilFlower = 8 - (gameState.grassField.totalGrassCollected % 8);
            document.getElementById('grass-status').textContent = 
                `Gramas coletadas: ${gameState.grassField.totalGrassCollected} | Próxima flor em: ${grassesUntilFlower}`;
            
            // Atualizar cada slot
            gameState.grassField.grassSlots.forEach((slot, index) => {
                const slotElement = document.getElementById(`grass-slot-${index}`);
                if (!slotElement) return;
                
                // Limpar classes anteriores
                slotElement.className = 'grass-slot';
                
                if (slot.hasGrass) {
                    // Grama disponível
                    slotElement.innerHTML = '🌱';
                } else if (slot.regrowTimer > 0) {
                    // Grama crescendo
                    slotElement.classList.add('regrowing');
                    const minutes = Math.floor(slot.regrowTimer / 60);
                    const seconds = slot.regrowTimer % 60;
                    const timerText = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${seconds}s`;
                    slotElement.innerHTML = `
                        🌿
                        <div class="grass-timer">${timerText}</div>
                    `;
                } else {
                    // Grama coletada (não deveria acontecer)
                    slotElement.classList.add('collected');
                    slotElement.innerHTML = '🟤';
                }
            });
        }
        
        function startGrassFieldTimers() {
            setInterval(() => {
                if (!gameState.grassField.hasGrassField) return;
                
                let updated = false;
                
                gameState.grassField.grassSlots.forEach((slot, index) => {
                    if (!slot.hasGrass && slot.regrowTimer > 0) {
                        slot.regrowTimer--;
                        updated = true;
                        
                        if (slot.regrowTimer === 0) {
                            regrowGrass(index);
                        }
                    }
                });
                
                if (updated) {
                    updateGrassFieldDisplay();
                }
            }, 1000);
        }

        // Sistema do Bosque
        function chopTree(treeType) {
            if (!gameState.forest.hasForest) {
                alert('🌳 Você precisa comprar o bosque primeiro!');
                return;
            }
            
            if (treeType === 'common') {
                if (!gameState.forest.axe.hasAxe) {
                    alert('🪓 Você precisa de um machado para cortar troncos! Compre no mercadinho.');
                    return;
                }
                
                if (gameState.forest.axe.usesLeft <= 0) {
                    alert('🪓 Seu machado quebrou! Compre um novo no mercadinho.');
                    return;
                }
                
                if (!consumeEnergy(1)) {
                    alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                    return;
                }
                
                // Usar machado
                gameState.forest.axe.usesLeft--;
                if (gameState.forest.axe.usesLeft === 0) {
                    gameState.forest.axe.hasAxe = false;
                    gameState.woodCutting.hasWoodCutting = false;
                    document.getElementById('wood-cutting-container').style.display = 'none';
                    alert('🪓 Seu machado quebrou! Compre um novo no mercadinho para continuar cortando.');
                }
                
                // Cortar tronco
                gameState.forest.totalTrunksCollected++;
                
                // Adicionar tronco ao celeiro
                if (!gameState.celeiro['tronco']) {
                    gameState.celeiro['tronco'] = { count: 0, emoji: '🪵' };
                }
                gameState.celeiro['tronco'].count++;
                
                // Verificar se deve ganhar um galho (a cada 3 troncos)
                if (gameState.forest.totalTrunksCollected % 3 === 0) {
                    gameState.forest.branchesEarned++;
                    
                    // Adicionar galho ao celeiro
                    if (!gameState.celeiro['galho']) {
                        gameState.celeiro['galho'] = { count: 0, emoji: '🌿' };
                    }
                    gameState.celeiro['galho'].count++;
                    
                    alert('🌿 Você cortou 3 troncos e ganhou um galho!');
                } else {
                    alert('🪵 Tronco coletado!');
                }
                
                updateCeleiro();
                updateForestDisplay();
                updateWoodCuttingDisplay();
            }
        }
        
        // Sistema de Cortar Lenha
        function addTrunkToWoodCutting() {
            if (!gameState.woodCutting.hasWoodCutting) {
                alert('🪓 Você precisa comprar um machado primeiro!');
                return;
            }
            
            if (gameState.woodCutting.hasTrunkInSlot) {
                alert('🪵 Já há um tronco no slot!');
                return;
            }
            
            if (gameState.woodCutting.isCutting) {
                alert('🪓 Aguarde terminar de cortar o tronco atual!');
                return;
            }
            
            if (!gameState.celeiro['tronco'] || gameState.celeiro['tronco'].count <= 0) {
                alert('🪵 Você não tem troncos no celeiro!');
                return;
            }
            
            // Usar tronco do celeiro
            gameState.celeiro['tronco'].count--;
            if (gameState.celeiro['tronco'].count === 0) {
                delete gameState.celeiro['tronco'];
            }
            
            gameState.woodCutting.hasTrunkInSlot = true;
            
            updateCeleiro();
            updateWoodCuttingDisplay();
        }
        
        function cutWood() {
            if (!gameState.woodCutting.hasWoodCutting) {
                alert('🪓 Você precisa comprar um machado primeiro!');
                return;
            }
            
            if (!gameState.woodCutting.hasTrunkInSlot) {
                alert('🪵 Adicione um tronco ao slot primeiro!');
                return;
            }
            
            if (gameState.woodCutting.isCutting) {
                alert('🪓 Já está cortando lenha!');
                return;
            }
            
            if (!gameState.forest.axe.hasAxe || gameState.forest.axe.usesLeft <= 0) {
                alert('🪓 Seu machado quebrou! Compre um novo no mercadinho.');
                return;
            }
            
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            // Iniciar corte
            gameState.woodCutting.isCutting = true;
            gameState.woodCutting.cuttingTimer = 3; // 3 segundos
            
            updateWoodCuttingDisplay();
        }
        
        function finishCuttingWood() {
            // Usar machado
            gameState.forest.axe.usesLeft--;
            if (gameState.forest.axe.usesLeft === 0) {
                gameState.forest.axe.hasAxe = false;
                gameState.woodCutting.hasWoodCutting = false;
                document.getElementById('wood-cutting-container').style.display = 'none';
                alert('🪓 Seu machado quebrou! Compre um novo no mercadinho para continuar cortando.');
            }
            
            // Adicionar 4 lenhas ao celeiro
            if (!gameState.celeiro['lenha']) {
                gameState.celeiro['lenha'] = { count: 0, emoji: '🪵' };
            }
            gameState.celeiro['lenha'].count += 4;
            
            // Resetar estado
            gameState.woodCutting.hasTrunkInSlot = false;
            gameState.woodCutting.isCutting = false;
            gameState.woodCutting.cuttingTimer = 0;
            
            updateCeleiro();
            updateWoodCuttingDisplay();
            updateForestDisplay();
            
            alert('🪵 Tronco cortado! Você ganhou 4 lenhas!');
        }
        
        function updateWoodCuttingDisplay() {
            if (!gameState.woodCutting.hasWoodCutting) return;
            
            const slot = document.getElementById('wood-cutting-slot');
            const cutBtn = document.getElementById('cut-wood-btn');
            const axeUses = document.getElementById('axe-uses');
            const status = document.getElementById('wood-cutting-status');
            
            // Atualizar usos do machado
            axeUses.textContent = `${gameState.forest.axe.usesLeft}/40`;
            
            if (gameState.woodCutting.isCutting) {
                // Cortando
                slot.innerHTML = `
                    <div class="text-4xl mb-2">🪓</div>
                    <div class="text-xs">Cortando...</div>
                    <div class="text-xs text-gray-500">${gameState.woodCutting.cuttingTimer}s</div>
                `;
                cutBtn.disabled = true;
                cutBtn.style.opacity = '0.6';
                status.textContent = `Cortando lenha... ${gameState.woodCutting.cuttingTimer}s`;
            } else if (gameState.woodCutting.hasTrunkInSlot) {
                // Tronco no slot
                slot.innerHTML = `
                    <div class="text-4xl mb-2">🪵</div>
                    <div class="text-xs">Tronco carregado</div>
                    <div class="text-xs text-gray-500">Pronto para cortar</div>
                `;
                cutBtn.disabled = false;
                cutBtn.style.opacity = '1';
                status.textContent = 'Clique em Cortar para fazer 4 lenhas';
            } else {
                // Slot vazio
                slot.innerHTML = `
                    <div class="text-4xl mb-2">📦</div>
                    <div class="text-xs">Slot vazio</div>
                    <div class="text-xs text-gray-500">Clique para adicionar tronco</div>
                `;
                cutBtn.disabled = true;
                cutBtn.style.opacity = '0.6';
                status.textContent = 'Adicione um tronco para começar';
            }
        }
        
        function startWoodCuttingTimers() {
            setInterval(() => {
                if (!gameState.woodCutting.hasWoodCutting) return;
                
                if (gameState.woodCutting.isCutting && gameState.woodCutting.cuttingTimer > 0) {
                    gameState.woodCutting.cuttingTimer--;
                    if (gameState.woodCutting.cuttingTimer === 0) {
                        finishCuttingWood();
                    }
                    updateWoodCuttingDisplay();
                }
            }, 1000);
        }
        
        function harvestFruit(fruitType) {
            if (!gameState.forest.hasForest) {
                alert('🌳 Você precisa comprar o bosque primeiro!');
                return;
            }
            
            const tree = gameState.forest.fruitTrees[fruitType];
            
            if (tree.fruitsLeft <= 0) {
                alert('🍎 Esta árvore não tem mais frutas! Aguarde elas crescerem novamente.');
                return;
            }
            
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            // Colher fruta
            tree.fruitsLeft--;
            
            const fruitNames = {
                apple: 'maçã',
                orange: 'laranja', 
                banana: 'banana'
            };
            
            const fruitEmojis = {
                apple: '🍎',
                orange: '🍊',
                banana: '🍌'
            };
            
            // Adicionar fruta ao celeiro
            if (!gameState.celeiro[fruitType]) {
                gameState.celeiro[fruitType] = { count: 0, emoji: fruitEmojis[fruitType] };
            }
            gameState.celeiro[fruitType].count++;
            
            updateCeleiro();
            updateForestDisplay();
            
            alert(`${fruitEmojis[fruitType]} ${fruitNames[fruitType].charAt(0).toUpperCase() + fruitNames[fruitType].slice(1)} coletada! Restam ${tree.fruitsLeft} na árvore.`);
            
            // Se a árvore ficou sem frutas, iniciar timer de regeneração
            if (tree.fruitsLeft === 0) {
                tree.regrowTimer = 300; // 5 minutos para regenerar todas as frutas
                setTimeout(() => {
                    regenerateFruits(fruitType);
                }, 300000);
            }
        }
        
        function regenerateFruits(fruitType) {
            const tree = gameState.forest.fruitTrees[fruitType];
            tree.fruitsLeft = 4;
            tree.regrowTimer = 0;
            
            const fruitNames = {
                apple: 'maçãs',
                orange: 'laranjas',
                banana: 'bananas'
            };
            
            updateForestDisplay();
            alert(`🌳 A ${fruitType === 'apple' ? 'macieira' : fruitType === 'orange' ? 'laranjeira' : 'bananeira'} regenerou suas ${fruitNames[fruitType]}!`);
        }
        
        function updateForestDisplay() {
            if (!gameState.forest.hasForest) return;
            
            // Atualizar status geral
            const trunksUntilBranch = 3 - (gameState.forest.totalTrunksCollected % 3);
            document.getElementById('forest-status').textContent = 
                `Troncos coletados: ${gameState.forest.totalTrunksCollected} | Próximo galho em: ${trunksUntilBranch}`;
            
            // Atualizar status do machado
            if (gameState.forest.axe.hasAxe) {
                document.getElementById('axe-status').textContent = `Machado: ${gameState.forest.axe.usesLeft}/40 usos`;
            } else {
                document.getElementById('axe-status').textContent = 'Machado: Nenhum';
            }
            
            // Atualizar contadores de frutas
            document.getElementById('apple-count').textContent = `${gameState.forest.fruitTrees.apple.fruitsLeft} maçãs`;
            document.getElementById('orange-count').textContent = `${gameState.forest.fruitTrees.orange.fruitsLeft} laranjas`;
            document.getElementById('banana-count').textContent = `${gameState.forest.fruitTrees.banana.fruitsLeft} bananas`;
            
            // Atualizar aparência das árvores frutíferas
            const appleTree = document.getElementById('apple-tree');
            const orangeTree = document.getElementById('orange-tree');
            const bananaTree = document.getElementById('banana-tree');
            
            // Árvores sem frutas ficam com aparência diferente
            if (gameState.forest.fruitTrees.apple.fruitsLeft === 0) {
                appleTree.classList.add('empty');
                appleTree.querySelector('.text-4xl').textContent = '🌳';
            } else {
                appleTree.classList.remove('empty');
                appleTree.querySelector('.text-4xl').textContent = '🍎';
            }
            
            if (gameState.forest.fruitTrees.orange.fruitsLeft === 0) {
                orangeTree.classList.add('empty');
                orangeTree.querySelector('.text-4xl').textContent = '🌳';
            } else {
                orangeTree.classList.remove('empty');
                orangeTree.querySelector('.text-4xl').textContent = '🍊';
            }
            
            if (gameState.forest.fruitTrees.banana.fruitsLeft === 0) {
                bananaTree.classList.add('empty');
                bananaTree.querySelector('.text-4xl').textContent = '🌳';
            } else {
                bananaTree.classList.remove('empty');
                bananaTree.querySelector('.text-4xl').textContent = '🍌';
            }
        }

        // Sistema da Mina
        function buyPickaxe() {
            if (gameState.coins < 100) {
                alert('💰 Moedas insuficientes!');
                return;
            }
            
            gameState.coins -= 100;
            gameState.mine.pickaxe.hasPickaxe = true;
            gameState.mine.pickaxe.usesLeft = 30;
            
            // Adicionar picareta ao celeiro
            if (!gameState.celeiro['picareta']) {
                gameState.celeiro['picareta'] = { count: 0, emoji: '⛏️' };
            }
            gameState.celeiro['picareta'].count++;
            
            updateResources();
            updateCeleiro();
            updateMineDisplay();
            alert('⛏️ Picareta comprada! Ela tem 30 usos. Use uma chave para entrar na mina!');
        }
        
        function enterMine() {
            if (!gameState.mine.hasMine) {
                alert('⛏️ Você precisa comprar a mina primeiro!');
                return;
            }
            
            if (gameState.mine.hasAccess) {
                alert('⛏️ Você já está dentro da mina!');
                return;
            }
            
            if (!gameState.celeiro['chave'] || gameState.celeiro['chave'].count <= 0) {
                alert('🗝️ Você precisa de uma chave para entrar na mina! A Mocinha pode encontrar chaves.');
                return;
            }
            
            // Usar chave
            gameState.celeiro['chave'].count--;
            if (gameState.celeiro['chave'].count === 0) {
                delete gameState.celeiro['chave'];
            }
            
            gameState.mine.hasAccess = true;
            
            updateCeleiro();
            updateMineDisplay();
            alert('🗝️ Você usou uma chave e entrou na mina! Agora pode minerar as rochas com uma picareta.');
        }
        
        function mineRock(rockIndex) {
            if (!gameState.mine.hasMine) {
                alert('⛏️ Você precisa comprar a mina primeiro!');
                return;
            }
            
            if (!gameState.mine.hasAccess) {
                enterMine();
                return;
            }
            
            const rock = gameState.mine.rocks[rockIndex];
            
            if (rock.isRespawning) {
                alert('🪨 Esta rocha ainda está se regenerando!');
                return;
            }
            
            if (rock.hitsLeft <= 0) {
                alert('🪨 Esta rocha já foi completamente minerada!');
                return;
            }
            
            if (!gameState.mine.pickaxe.hasPickaxe) {
                alert('⛏️ Você precisa de uma picareta! Compre no mercadinho.');
                return;
            }
            
            if (gameState.mine.pickaxe.usesLeft <= 0) {
                alert('⛏️ Sua picareta quebrou! Compre uma nova no mercadinho.');
                return;
            }
            
            if (!consumeEnergy(1)) {
                alert('⚠️ Você não pode trabalhar agora! Descanse ou coma algo.');
                return;
            }
            
            // Usar picareta
            gameState.mine.pickaxe.usesLeft--;
            if (gameState.mine.pickaxe.usesLeft === 0) {
                gameState.mine.pickaxe.hasPickaxe = false;
                alert('⛏️ Sua picareta quebrou! Compre uma nova no mercadinho.');
            }
            
            // Bater na rocha
            rock.hitsLeft--;
            
            // Determinar o que foi encontrado (baseado na sorte)
            const gems = ['esmeralda', 'rubi', 'safira', 'carvao'];
            const probabilities = [0.15, 0.20, 0.25, 0.40]; // 15% esmeralda, 20% rubi, 25% safira, 40% carvão
            
            let randomValue = Math.random();
            let foundGem = 'carvao'; // padrão
            
            let cumulativeProbability = 0;
            for (let i = 0; i < gems.length; i++) {
                cumulativeProbability += probabilities[i];
                if (randomValue <= cumulativeProbability) {
                    foundGem = gems[i];
                    break;
                }
            }
            
            // Adicionar gema ao celeiro
            if (!gameState.celeiro[foundGem]) {
                gameState.celeiro[foundGem] = { count: 0, emoji: getItemEmoji(foundGem) };
            }
            gameState.celeiro[foundGem].count++;
            gameState.mine.totalGemsFound++;
            
            const gemNames = {
                esmeralda: 'Esmeralda',
                rubi: 'Rubi', 
                safira: 'Safira',
                carvao: 'Carvão'
            };
            
            // Se a rocha foi completamente minerada, iniciar regeneração
            if (rock.hitsLeft === 0) {
                rock.isRespawning = true;
                rock.respawnTimer = 180; // 3 minutos para regenerar
                alert(`${getItemEmoji(foundGem)} Você encontrou ${gemNames[foundGem]}! A rocha foi completamente minerada e se regenerará em 3 minutos.`);
            } else {
                alert(`${getItemEmoji(foundGem)} Você encontrou ${gemNames[foundGem]}! Restam ${rock.hitsLeft} batidas nesta rocha.`);
            }
            
            updateCeleiro();
            updateMineDisplay();
        }
        
        function mineAllRocks() {
            if (!gameState.mine.hasMine) {
                alert('⛏️ Você precisa comprar a mina primeiro!');
                return;
            }
            
            if (!gameState.mine.hasAccess) {
                enterMine();
                return;
            }
            
            if (!gameState.mine.pickaxe.hasPickaxe) {
                alert('⛏️ Você precisa de uma picareta! Compre no mercadinho.');
                return;
            }
            
            if (gameState.mine.pickaxe.usesLeft <= 0) {
                alert('⛏️ Sua picareta quebrou! Compre uma nova no mercadinho.');
                return;
            }
            
            let totalHits = 0;
            let energyNeeded = 0;
            
            // Contar quantas batidas podem ser dadas
            gameState.mine.rocks.forEach(rock => {
                if (!rock.isRespawning && rock.hitsLeft > 0) {
                    totalHits += rock.hitsLeft;
                    energyNeeded += rock.hitsLeft;
                }
            });
            
            if (totalHits === 0) {
                alert('🪨 Não há rochas prontas para minerar!');
                return;
            }
            
            if (gameState.farmer.energy < energyNeeded) {
                alert(`⚠️ Você precisa de ${energyNeeded} pontos de energia para minerar todas as rochas! Você tem apenas ${gameState.farmer.energy}.`);
                return;
            }
            
            if (gameState.mine.pickaxe.usesLeft < totalHits) {
                alert(`⛏️ Sua picareta só tem ${gameState.mine.pickaxe.usesLeft} usos restantes! Você precisa de ${totalHits} usos.`);
                return;
            }
            
            // Minerar todas as rochas
            let gemsFound = {};
            
            gameState.mine.rocks.forEach(rock => {
                while (!rock.isRespawning && rock.hitsLeft > 0) {
                    // Determinar gema encontrada
                    const gems = ['esmeralda', 'rubi', 'safira', 'carvao'];
                    const probabilities = [0.15, 0.20, 0.25, 0.40];
                    
                    let randomValue = Math.random();
                    let foundGem = 'carvao';
                    
                    let cumulativeProbability = 0;
                    for (let i = 0; i < gems.length; i++) {
                        cumulativeProbability += probabilities[i];
                        if (randomValue <= cumulativeProbability) {
                            foundGem = gems[i];
                            break;
                        }
                    }
                    
                    // Adicionar gema
                    if (!gameState.celeiro[foundGem]) {
                        gameState.celeiro[foundGem] = { count: 0, emoji: getItemEmoji(foundGem) };
                    }
                    gameState.celeiro[foundGem].count++;
                    gameState.mine.totalGemsFound++;
                    
                    if (!gemsFound[foundGem]) {
                        gemsFound[foundGem] = 0;
                    }
                    gemsFound[foundGem]++;
                    
                    rock.hitsLeft--;
                    
                    // Se rocha foi completamente minerada
                    if (rock.hitsLeft === 0) {
                        rock.isRespawning = true;
                        rock.respawnTimer = 180; // 3 minutos
                    }
                }
            });
            
            // Usar recursos
            gameState.mine.pickaxe.usesLeft -= totalHits;
            if (gameState.mine.pickaxe.usesLeft === 0) {
                gameState.mine.pickaxe.hasPickaxe = false;
                alert('⛏️ Sua picareta quebrou após minerar todas as rochas! Compre uma nova no mercadinho.');
            }
            
            gameState.farmer.energy -= energyNeeded;
            
            // Mostrar resultado
            let resultText = '⛏️ Mineração completa! Você encontrou:\n';
            const gemNames = { esmeralda: 'Esmeraldas', rubi: 'Rubis', safira: 'Safiras', carvao: 'Carvões' };
            
            for (const [gem, count] of Object.entries(gemsFound)) {
                resultText += `${getItemEmoji(gem)} ${count}x ${gemNames[gem]}\n`;
            }
            
            updateCeleiro();
            updateMineDisplay();
            updateFarmerDisplay();
            alert(resultText);
        }
        
        function respawnRock(rockIndex) {
            const rock = gameState.mine.rocks[rockIndex];
            rock.hitsLeft = 3;
            rock.isRespawning = false;
            rock.respawnTimer = 0;
            
            updateMineDisplay();
        }
        
        function updateMineDisplay() {
            if (!gameState.mine.hasMine) return;
            
            // Atualizar status da picareta
            if (gameState.mine.pickaxe.hasPickaxe) {
                document.getElementById('pickaxe-uses').textContent = `${gameState.mine.pickaxe.usesLeft}/30`;
            } else {
                document.getElementById('pickaxe-uses').textContent = '0/30';
            }
            
            // Atualizar status geral
            if (!gameState.mine.hasAccess) {
                document.getElementById('mine-status').textContent = 'Use chave para entrar na mina';
            } else {
                document.getElementById('mine-status').textContent = `Gemas encontradas: ${gameState.mine.totalGemsFound}`;
            }
            
            // Atualizar cada rocha
            gameState.mine.rocks.forEach((rock, index) => {
                const rockSlot = document.getElementById(`rock-slot-${index}`);
                const rockHits = document.getElementById(`rock-hits-${index}`);
                
                if (!gameState.mine.hasAccess) {
                    // Mina fechada
                    rockSlot.classList.remove('empty', 'respawning');
                    rockSlot.innerHTML = `
                        <div class="text-4xl mb-2">🔒</div>
                        <div class="text-xs">Trancado</div>
                        <div class="text-xs text-gray-500">Precisa de chave</div>
                    `;
                } else if (rock.isRespawning) {
                    // Rocha se regenerando
                    rockSlot.classList.add('respawning');
                    rockSlot.classList.remove('empty');
                    const minutes = Math.floor(rock.respawnTimer / 60);
                    const seconds = rock.respawnTimer % 60;
                    const timerText = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${seconds}s`;
                    rockSlot.innerHTML = `
                        <div class="text-4xl mb-2">⏳</div>
                        <div class="text-xs">Regenerando</div>
                        <div class="text-xs text-gray-500">${timerText}</div>
                    `;
                } else if (rock.hitsLeft > 0) {
                    // Rocha disponível
                    rockSlot.classList.remove('empty', 'respawning');
                    rockSlot.innerHTML = `
                        <div class="text-4xl mb-2">🪨</div>
                        <div class="text-xs">Rocha</div>
                        <div class="text-xs text-gray-500">${rock.hitsLeft}/3 batidas</div>
                    `;
                } else {
                    // Rocha esgotada (não deveria acontecer)
                    rockSlot.classList.add('empty');
                    rockSlot.classList.remove('respawning');
                    rockSlot.innerHTML = `
                        <div class="text-4xl mb-2">💨</div>
                        <div class="text-xs">Esgotada</div>
                        <div class="text-xs text-gray-500">Aguarde regenerar</div>
                    `;
                }
            });
        }
        
        function startMineTimers() {
            setInterval(() => {
                if (!gameState.mine.hasMine) return;
                
                let updated = false;
                
                gameState.mine.rocks.forEach((rock, index) => {
                    if (rock.isRespawning && rock.respawnTimer > 0) {
                        rock.respawnTimer--;
                        updated = true;
                        
                        if (rock.respawnTimer === 0) {
                            respawnRock(index);
                        }
                    }
                });
                
                if (updated) {
                    updateMineDisplay();
                }
            }, 1000);
        }

        // Sistema da Composteira
        function manageComposterSlot(slotIndex) {
            if (!gameState.composter.hasComposter) {
                alert('🗂️ Você precisa comprar uma composteira primeiro!');
                return;
            }
            
            if (gameState.composter.isComposting) {
                alert('🌱 A composteira está fazendo adubo! Aguarde terminar.');
                return;
            }
            
            const slot = gameState.composter.slots[slotIndex];
            
            if (slotIndex === 0) {
                // Slot de flores
                addFlowersToComposter();
            } else if (slotIndex === 1) {
                // Slot de galhos
                addBranchesToComposter();
            } else if (slotIndex === 2) {
                // Slot de esterco
                addManureToComposter();
            }
        }
        
        function addFlowersToComposter() {
            const slot = gameState.composter.slots[0];
            
            // Encontrar flores disponíveis no celeiro
            const availableFlowers = [];
            const flowerTypes = ['rosa', 'girassol', 'margarida', 'tulipa', 'lirio', 'sakura'];
            
            flowerTypes.forEach(flowerType => {
                if (gameState.celeiro[flowerType] && gameState.celeiro[flowerType].count > 0) {
                    availableFlowers.push({
                        type: flowerType,
                        name: flowerType.charAt(0).toUpperCase() + flowerType.slice(1),
                        emoji: gameState.celeiro[flowerType].emoji,
                        count: gameState.celeiro[flowerType].count
                    });
                }
            });
            
            if (availableFlowers.length === 0) {
                alert('🌸 Você não tem flores no celeiro! Colete flores do campo de grama.');
                return;
            }
            
            // Escolher flor para adicionar
            let options = 'Escolha uma flor para adicionar:\n\n';
            availableFlowers.forEach((flower, index) => {
                options += `${index + 1}. ${flower.emoji} ${flower.name} (${flower.count} disponível)\n`;
            });
            
            const choice = prompt(options + '\nDigite o número da flor:');
            const flowerIndex = parseInt(choice) - 1;
            
            if (flowerIndex >= 0 && flowerIndex < availableFlowers.length) {
                const selectedFlower = availableFlowers[flowerIndex];
                
                // Remover flor do celeiro
                gameState.celeiro[selectedFlower.type].count--;
                if (gameState.celeiro[selectedFlower.type].count === 0) {
                    delete gameState.celeiro[selectedFlower.type];
                }
                
                // Adicionar à composteira
                slot.count++;
                slot.items.push({
                    type: selectedFlower.type,
                    emoji: selectedFlower.emoji,
                    name: selectedFlower.name
                });
                
                updateCeleiro();
                updateComposterDisplay();
                alert(`🌸 ${selectedFlower.name} adicionada à composteira!`);
            }
        }
        
        function addBranchesToComposter() {
            const slot = gameState.composter.slots[1];
            
            if (!gameState.celeiro['galho'] || gameState.celeiro['galho'].count <= 0) {
                alert('🌿 Você não tem galhos no celeiro! Corte troncos no bosque para ganhar galhos.');
                return;
            }
            
            // Remover galho do celeiro
            gameState.celeiro['galho'].count--;
            if (gameState.celeiro['galho'].count === 0) {
                delete gameState.celeiro['galho'];
            }
            
            // Adicionar à composteira
            slot.count++;
            slot.items.push({
                type: 'galho',
                emoji: '🌿',
                name: 'Galho'
            });
            
            updateCeleiro();
            updateComposterDisplay();
            alert('🌿 Galho adicionado à composteira!');
        }
        
        function addManureToComposter() {
            const slot = gameState.composter.slots[2];
            
            if (!gameState.celeiro['esterco'] || gameState.celeiro['esterco'].count <= 0) {
                alert('💩 Você não tem esterco no celeiro! Alimente as vacas para obter esterco.');
                return;
            }
            
            // Remover esterco do celeiro
            gameState.celeiro['esterco'].count--;
            if (gameState.celeiro['esterco'].count === 0) {
                delete gameState.celeiro['esterco'];
            }
            
            // Adicionar à composteira
            slot.count++;
            slot.items.push({
                type: 'esterco',
                emoji: '💩',
                name: 'Esterco'
            });
            
            updateCeleiro();
            updateComposterDisplay();
            alert('💩 Esterco adicionado à composteira!');
        }
        
        function startComposting() {
            if (!gameState.composter.hasComposter) {
                alert('🗂️ Você precisa comprar uma composteira primeiro!');
                return;
            }
            
            if (gameState.composter.isComposting) {
                alert('🌱 A composteira já está fazendo adubo!');
                return;
            }
            
            // Verificar se tem pelo menos 1 item em cada slot
            const flowersSlot = gameState.composter.slots[0];
            const branchesSlot = gameState.composter.slots[1];
            const manureSlot = gameState.composter.slots[2];
            
            if (flowersSlot.count === 0) {
                alert('🌸 Você precisa de pelo menos 1 flor no primeiro slot!');
                return;
            }
            
            if (branchesSlot.count === 0) {
                alert('🌿 Você precisa de pelo menos 1 galho no segundo slot!');
                return;
            }
            
            if (manureSlot.count === 0) {
                alert('💩 Você precisa de pelo menos 1 esterco no terceiro slot!');
                return;
            }
            
            // Consumir 1 item de cada slot
            flowersSlot.count--;
            flowersSlot.items.shift();
            
            branchesSlot.count--;
            branchesSlot.items.shift();
            
            manureSlot.count--;
            manureSlot.items.shift();
            
            // Iniciar compostagem
            gameState.composter.isComposting = true;
            gameState.composter.compostingTimer = 30; // 30 segundos
            
            updateComposterDisplay();
            alert('🌱 Compostagem iniciada! O adubo ficará pronto em 30 segundos.');
        }
        
        function finishComposting() {
            gameState.composter.isComposting = false;
            gameState.composter.compostingTimer = 0;
            
            // Adicionar 1 adubo
            gameState.compost++;
            
            updateResources();
            updateComposterDisplay();
            alert('🌱 Adubo orgânico pronto! Você pode usá-lo nos canteiros como fertilizante.');
        }
        
        function updateComposterDisplay() {
            if (!gameState.composter.hasComposter) return;
            
            // Atualizar contadores dos slots
            const flowersSlot = gameState.composter.slots[0];
            const branchesSlot = gameState.composter.slots[1];
            const manureSlot = gameState.composter.slots[2];
            
            document.getElementById('composter-count-0').textContent = `${flowersSlot.count} flores`;
            document.getElementById('composter-count-1').textContent = `${branchesSlot.count} galhos`;
            document.getElementById('composter-count-2').textContent = `${manureSlot.count} estercos`;
            
            // Atualizar botão e status
            const compostBtn = document.getElementById('compost-btn');
            const status = document.getElementById('composter-status');
            
            if (gameState.composter.isComposting) {
                compostBtn.disabled = true;
                compostBtn.style.opacity = '0.6';
                compostBtn.textContent = `🌱 Fazendo... ${gameState.composter.compostingTimer}s`;
                status.textContent = `Compostagem em andamento: ${gameState.composter.compostingTimer}s`;
            } else {
                compostBtn.disabled = false;
                compostBtn.style.opacity = '1';
                compostBtn.textContent = '🌱 Fazer Adubo (30s)';
                
                const canCompost = flowersSlot.count > 0 && branchesSlot.count > 0 && manureSlot.count > 0;
                if (canCompost) {
                    status.textContent = 'Pronto para fazer adubo!';
                } else {
                    status.textContent = 'Adicione ingredientes para começar';
                }
            }
            
            // Atualizar aparência dos slots
            const slots = ['composter-slot-0', 'composter-slot-1', 'composter-slot-2'];
            const counts = [flowersSlot.count, branchesSlot.count, manureSlot.count];
            
            slots.forEach((slotId, index) => {
                const slotElement = document.getElementById(slotId);
                if (counts[index] > 0) {
                    slotElement.classList.add('filled');
                } else {
                    slotElement.classList.remove('filled');
                }
            });
        }
        
        function startComposterTimers() {
            setInterval(() => {
                if (!gameState.composter.hasComposter) return;
                
                if (gameState.composter.isComposting && gameState.composter.compostingTimer > 0) {
                    gameState.composter.compostingTimer--;
                    if (gameState.composter.compostingTimer === 0) {
                        finishComposting();
                    }
                    updateComposterDisplay();
                }
            }, 1000);
        }

        // Inicializar jogo
        updateResources();
        updateCeleiro();
        initQuitanda();
        updateSeasonDisplay();
        updateMailboxDisplay();
        updateFarmerDisplay();
        startSeasonTimer();
        startRainTimer();
        startFlowerTimers();
        startMailboxTimers();
        startTruckSystem();
        startFarmerSystem();
        startWoodCuttingTimers();
        startMineTimers();
        startGrassDryerTimers();
        startComposterTimers();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f40b00355c0093',t:'MTc1NTIxMjE2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
