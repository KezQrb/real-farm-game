<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Farm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        body.raining {
            background: linear-gradient(135deg, #708090 0%, #778899 100%);
        }

        .header {
            background: rgba(139, 69, 19, 0.9);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .game-title {
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .resources {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .resource {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .season-info {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
        }

        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 15px;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .farm-area {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .farm-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .plot {
            width: 80px;
            height: 80px;
            border: 3px solid #8B4513;
            border-radius: 10px;
            background: #D2691E;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .plot:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .plot.fertilized {
            background: #654321;
        }

        .plot.planted {
            background: #228B22;
        }

        .plot.watered {
            background: #4169E1;
        }

        .plot.ready {
            background: #FFD700;
            animation: glow 1s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px #FFD700; }
            to { box-shadow: 0 0 15px #FFD700; }
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .panel h3 {
            color: #8B4513;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
        }

        .seeds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .seed-item {
            background: #F0F8FF;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .seed-item:hover {
            background: #E6F3FF;
            transform: scale(1.05);
        }

        .seed-item.selected {
            background: #4CAF50;
            color: white;
        }

        .market-item {
            background: #FFF8DC;
            border: 2px solid #DAA520;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .market-item:hover {
            background: #F5DEB3;
            transform: scale(1.02);
        }

        .sell-all-btn {
            background: #FF6347;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .sell-all-btn:hover {
            background: #FF4500;
        }

        .rain-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .rain-overlay.active {
            opacity: 1;
        }

        .raindrop {
            position: absolute;
            color: #4169E1;
            font-size: 20px;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
            position: absolute;
            bottom: 2px;
            left: 0;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.1s;
        }

        .structure {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
        }

        .structure h4 {
            color: #8B4513;
            text-align: center;
            margin-bottom: 10px;
        }

        .grass-grid, .cow-grid, .forest-grid, .chicken-grid, .pig-grid, .sheep-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            min-height: 120px;
        }

        .grass-item, .cow-item, .tree-item, .chicken-item, .pig-item, .sheep-item {
            width: 50px;
            height: 50px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .animal-sick {
            border-color: #FF4444;
            background: #FFE6E6;
            animation: sick-pulse 1s infinite;
        }

        @keyframes sick-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .grass-item:hover, .cow-item:hover, .tree-item:hover, .chicken-item:hover, .pig-item:hover, .sheep-item:hover {
            transform: scale(1.1);
        }

        .grass-item.collected {
            background: #DDD;
            cursor: not-allowed;
        }

        .dryer-controls, .composter-controls, .mixer-controls, .woodcutter-controls, .spinner-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .control-btn:hover {
            background: #45a049;
        }

        .control-btn:disabled {
            background: #CCC;
            cursor: not-allowed;
        }

        .well-container {
            text-align: center;
            padding: 20px;
            background: #E6F3FF;
            border-radius: 10px;
            margin-top: 15px;
        }

        .well-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .well-btn:hover {
            background: #1976D2;
        }

        .pet-container {
            text-align: center;
            padding: 15px;
            background: #FFF8DC;
            border-radius: 10px;
            margin: 10px 0;
        }

        .friendship-bar {
            width: 100%;
            height: 10px;
            background: #DDD;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .friendship-fill {
            height: 100%;
            background: #FF69B4;
            transition: width 0.3s;
        }

        .hearts {
            font-size: 24px;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .orders-panel {
            background: #FFF8DC;
            border: 2px solid #DAA520;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .order-item {
            background: #F0F8FF;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-buttons {
            display: flex;
            gap: 5px;
        }

        .accept-btn, .reject-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .accept-btn {
            background: #4CAF50;
            color: white;
        }

        .reject-btn {
            background: #FF6347;
            color: white;
        }

        .flower-field {
            background: rgba(255,192,203,0.3);
            border: 2px solid #FF69B4;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .flower-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .flower-item {
            width: 50px;
            height: 50px;
            border: 2px solid #FF69B4;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .flower-item.collected {
            background: #DDD;
            cursor: not-allowed;
        }

        .avatar-panel {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            color: white;
            min-width: 200px;
            position: relative;
        }

        .avatar-panel h4 {
            margin-bottom: 10px;
            color: white;
        }

        .energy-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .energy-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s;
        }

        .avatar-sick {
            background: rgba(255,100,100,0.3);
            animation: sick-pulse 1s infinite;
        }

        .avatar-sick::before {
            content: 'ü§í';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .farm-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .resources {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="rain-overlay" id="rainOverlay"></div>
    
    <header class="header">
        <div class="game-title">üöú Real Farm</div>
        <div class="resources">
            <div class="resource">üí∞ <span id="coins">200</span></div>
            <div class="resource">ü™£ <span id="water">10</span></div>
            <div class="resource">üçÇ <span id="fertilizer">50</span></div>
            <div class="season-info">
                <span id="season">Primavera</span> - <span id="timeLeft">2:00:00</span>
            </div>
            <button class="save-btn" onclick="saveGame()">üíæ Salvar</button>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="mailbox-container" style="cursor: pointer;" onclick="openMailbox()">
                <div style="font-size: 32px; position: relative;">
                    üìÆ
                    <span id="mailNotification" style="position: absolute; top: -8px; right: -8px; background: red; color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 12px; display: none; text-align: center; line-height: 16px;">!</span>
                </div>
                <div style="font-size: 12px; text-align: center; color: white;">Correios</div>
            </div>
            <div class="avatar-panel" id="avatarPanel">
                <h4>üë®‚Äçüåæ Voc√™</h4>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
                <div>Energia: <span id="energyText">200/200</span></div>
                <button class="control-btn" onclick="rest()" style="margin: 5px;">üò¥ Descansar (5 min)</button>
                <button class="control-btn" onclick="openMeals()" style="margin: 5px;">üçΩÔ∏è Comer</button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <div class="panel">
                <h3>üå± Sementes</h3>
                <div class="seeds-grid" id="seedsGrid"></div>
            </div>

            <div class="panel">
                <h3>üè™ Celeiro</h3>
                <div id="barn"></div>
            </div>

            <div class="panel">
                <h3>üõí Mercadinho</h3>
                <div id="market" style="max-height: 300px; overflow-y: auto;"></div>
            </div>

            <div id="structuresLeft"></div>
        </div>

        <div class="farm-area">
            <h2 style="color: #8B4513; text-align: center; margin-bottom: 20px;">üå± Sua Fazenda</h2>
            <div class="farm-grid" id="farmGrid"></div>
            
            <div id="wellContainer"></div>
            <div id="flowerField"></div>
            <div id="forestContainer"></div>
            <div id="animalsContainer"></div>

            <div class="panel" style="margin-top: 20px;">
                <h3>üè™ Quitanda</h3>
                <button class="sell-all-btn" onclick="sellAll()">üí∞ Vender Tudo</button>
                <div id="quitanda"></div>
            </div>
        </div>

        <div class="sidebar">
            <div id="structuresRight"></div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            coins: 200,
            water: 10,
            fertilizer: 50,
            season: 0,
            seasonTimeLeft: 7200,
            selectedSeed: null,
            plots: [],
            inventory: {},
            lastRain: 0,
            isRaining: false,
            fishingRodUses: 0,
            fishCaught: 0,
            pickaxeUses: 0,
            avatar: {
                energy: 200,
                maxEnergy: 200,
                sick: false,
                sickTime: 0,
                firstSicknessTime: Date.now() + 900000 // 15 minutes from start
            },
            structures: {
                well: false,
                grassField: false,
                dryer: false,
                cowPasture: false,
                forest: false,
                composter: false,
                woodCutter: false,
                chickenCoop: false,
                mixer: false,
                pigPen: false,
                sheepPen: false,
                spinner: false,
                dogHouse: false,
                horseStable: false,
                stove: false,
                lake: true,
                mine: true,
                cheesemaker: false,
                mill: false,
                coffeeRoaster: false,
                juiceMachine: false,
                greenhouse: false,
                beehive: false
            },
            grassField: [],
            cows: [],
            chickens: [],
            pigs: [],
            sheep: [],
            flowerField: [],
            orders: [],
            forestTrees: {
                trunk: { clicks: 0 },
                apple: { clicks: 0, lastReset: 0 },
                orange: { clicks: 0, lastReset: 0 },
                banana: { clicks: 0, lastReset: 0 }
            },
            dryingGrass: { amount: 0, startTime: 0, isActive: false },
            makingHay: { isActive: false, startTime: 0 },
            cuttingWood: { isActive: false, startTime: 0 },
            makingChickenFeed: { isActive: false, startTime: 0 },
            makingPigFeed: { isActive: false, startTime: 0 },
            spinning: { isActive: false, startTime: 0 },
            makingCheese: { isActive: false, startTime: 0 },
            makingFlour: { isActive: false, startTime: 0 },
            roastingCoffee: { isActive: false, startTime: 0 },
            makingJuice: { isActive: false, startTime: 0 },
            cookingTea: { isActive: false, startTime: 0 },
            makingCompost: { isActive: false, startTime: 0 },
            dog: { friendship: 0, lastFed: 0, hasEaten: false, hasWarmClothes: false },
            horse: { friendship: 0, lastFed: 0, hasEaten: false, hasWarmClothes: false },
            rationsEaten: 0,
            producerFair: { items: [], lastPayout: 0 },
            craftTable: { making: null, startTime: 0 },
            bonfire: { lit: false, litTime: 0 },
            mailbox: { 
                messages: [], 
                lastNewspaper: 0, 
                lastMotivationalMessage: 0,
                hasUnread: false
            },
            beehive: {
                bees: 3,
                lastHarvest: 0,
                honeyReady: false
            },
            greenhousePlots: [],
            lake: [
                { caught: false, regrowTime: 0 },
                { caught: false, regrowTime: 0 },
                { caught: false, regrowTime: 0 },
                { caught: false, regrowTime: 0 }
            ],
            mine: [
                { clicks: 0, restTime: 0 },
                { clicks: 0, restTime: 0 },
                { clicks: 0, restTime: 0 }
            ]
        };

        const seasons = ['Primavera', 'Ver√£o', 'Outono', 'Inverno'];
        const seasonEmojis = ['üå∏', '‚òÄÔ∏è', 'üçÇ', '‚ùÑÔ∏è'];

        const seeds = {
            'Trigo': { emoji: 'üåæ', price: 10, sellPrice: 15 },
            'Milho': { emoji: 'üåΩ', price: 10, sellPrice: 18 },
            'Caf√©': { emoji: 'üî¥', price: 10, sellPrice: 25 },
            'Batata': { emoji: 'ü•î', price: 10, sellPrice: 12 },
            'Tomate': { emoji: 'üçÖ', price: 10, sellPrice: 20 },
            'Cenoura': { emoji: 'ü•ï', price: 10, sellPrice: 14 },
            'Ab√≥bora': { emoji: 'üéÉ', price: 10, sellPrice: 22 },
            'Br√≥colis': { emoji: 'ü•¶', price: 10, sellPrice: 16 },
            'Alface': { emoji: 'ü•¨', price: 10, sellPrice: 13 },
            'Uva': { emoji: 'üçá', price: 10, sellPrice: 24 }
        };

        const quitandaItems = {
            'milk': { emoji: 'ü•õ', name: 'Leite', price: 25 },
            'egg': { emoji: 'ü•ö', name: 'Ovo', price: 15 },
            'rawChicken': { emoji: 'üçó', name: 'Frango Cru', price: 80 },
            'pork': { emoji: 'ü•©', name: 'Carne Su√≠na', price: 60 },
            'yarn': { emoji: 'üß∂', name: 'Novelo', price: 40 },
            'treasure': { emoji: 'üíé', name: 'Tesouro', price: 100 },
            'rose': { emoji: 'üåπ', name: 'Rosa', price: 30 },
            'sunflower': { emoji: 'üåª', name: 'Girassol', price: 35 },
            'daisy': { emoji: 'üåº', name: 'Margarida', price: 25 },
            'fish': { emoji: 'üêü', name: 'Peixe', price: 45 },
            'emerald': { emoji: 'üíö', name: 'Esmeralda', price: 150 },
            'ruby': { emoji: '‚ù§Ô∏è', name: 'Rubi', price: 180 },
            'sapphire': { emoji: 'üíô', name: 'Safira', price: 200 },
            'pearl': { emoji: 'ü¶™', name: 'P√©rola', price: 300 },
            'cheese': { emoji: 'üßÄ', name: 'Queijo', price: 80 },
            'flour': { emoji: 'üåæ', name: 'Farinha', price: 60 },
            'coffeeRoasted': { emoji: '‚òï', name: 'Caf√© Torrado', price: 120 },
            'grapeJuice': { emoji: 'üçá', name: 'Suco de Uva', price: 90 },
            'pearlNecklace': { emoji: 'üìø', name: 'Colar de P√©rolas', price: 500 },
            'emeraldRing': { emoji: 'üíç', name: 'Anel de Esmeralda', price: 300 },
            'flowerBouquet': { emoji: 'üíê', name: 'Buqu√™ de Flores', price: 200 },
            'bread': { emoji: 'üçû', name: 'P√£o', price: 120 },
            'honey': { emoji: 'üçØ', name: 'Pote de Mel', price: 50 }
        };

        // Initialize game
        function initGame() {
            loadGame();
            initializeInventory();
            createFarmGrid();
            createSeedsGrid();
            createMarket();
            
            // Initialize flower field if it's Spring and doesn't exist
            if (gameState.season === 0 && (!gameState.flowerField || gameState.flowerField.length === 0)) {
                initializeFlowerField();
            }
            
            // Initialize orders if horse stable exists
            if (gameState.structures.horseStable && (!gameState.orders || gameState.orders.length === 0)) {
                generateOrders();
            }
            
            updateDisplay();
            updateAllStructures();
            startGameLoop();
        }

        function initializeInventory() {
            const items = ['grass', 'flower', 'branch', 'manure', 'hay', 'milk', 'apple', 'orange', 'banana', 'trunk', 'driedGrass', 'wood', 'chickenFeed', 'pigFeed', 'egg', 'rawChicken', 'pork', 'wool', 'yarn', 'bone', 'dogFood', 'treasure', 'rose', 'sunflower', 'daisy', 'vaccine', 'axe', 'fishingRod', 'key', 'fish', 'emerald', 'ruby', 'sapphire', 'coal', 'herb', 'tea', 'salad', 'stew', 'steak', 'cookedChicken', 'cookedFish', 'pickaxe', 'pearl', 'cheese', 'flour', 'coffeeRoasted', 'grapeJuice', 'pearlNecklace', 'emeraldRing', 'flowerBouquet'];
            items.forEach(item => {
                if (!gameState.inventory[item]) {
                    gameState.inventory[item] = 0;
                }
            });
        }

        function initializeGreenhouse() {
            gameState.greenhousePlots = [];
            for (let i = 0; i < 12; i++) {
                gameState.greenhousePlots.push({ state: 'empty', seed: null, plantTime: 0, progress: 0 });
            }
        }

        function initializeFlowerField() {
            gameState.flowerField = [];
            const flowers = ['rose', 'sunflower', 'daisy'];
            flowers.forEach(flower => {
                for (let i = 0; i < 3; i++) {
                    gameState.flowerField.push({
                        type: flower,
                        collected: false,
                        regrowTime: 0
                    });
                }
            });
        }

        function generateOrders() {
            const orderTypes = [
                { items: [{ name: 'Trigo', amount: 5 }], reward: 100, client: 'Jo√£o' },
                { items: [{ name: 'milk', amount: 3 }], reward: 120, client: 'Maria' },
                { items: [{ name: 'egg', amount: 6 }], reward: 150, client: 'Pedro' },
                { items: [{ name: 'hay', amount: 4 }], reward: 80, client: 'Ana' },
                { items: [{ name: 'yarn', amount: 2 }], reward: 200, client: 'Carlos' }
            ];

            gameState.orders = [];
            for (let i = 0; i < 3; i++) {
                const order = orderTypes[Math.floor(Math.random() * orderTypes.length)];
                gameState.orders.push({
                    id: Date.now() + i,
                    ...order
                });
            }
        }

        function createFarmGrid() {
            const farmGrid = document.getElementById('farmGrid');
            farmGrid.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                if (!gameState.plots[i]) {
                    gameState.plots[i] = { state: 'empty', seed: null, plantTime: 0, progress: 0 };
                }
                
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.onclick = () => handlePlotClick(i);
                
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                const progressFill = document.createElement('div');
                progressFill.className = 'progress-fill';
                progressBar.appendChild(progressFill);
                plot.appendChild(progressBar);
                
                farmGrid.appendChild(plot);
            }
            updatePlotsDisplay();
        }

        function createSeedsGrid() {
            const seedsGrid = document.getElementById('seedsGrid');
            seedsGrid.innerHTML = '';
            
            Object.keys(seeds).forEach(seedName => {
                const seedItem = document.createElement('div');
                seedItem.className = 'seed-item';
                seedItem.innerHTML = `${seeds[seedName].emoji}<br>${seedName}<br>üí∞${seeds[seedName].price}`;
                seedItem.onclick = () => selectSeed(seedName);
                seedsGrid.appendChild(seedItem);
            });
        }

        function createMarket() {
            const market = document.getElementById('market');
            market.innerHTML = '';

            const marketItems = [
                { name: 'Po√ßo de √Ågua', emoji: 'ü™£', price: 50, id: 'well', condition: () => !gameState.structures.well },
                { name: 'Machado + Cortar Lenha', emoji: 'ü™ì', price: 50, id: 'axeAndWoodCutter', condition: () => !gameState.structures.woodCutter },
                { name: 'Bosque', emoji: 'üå≥', price: 150, id: 'forest', condition: () => !gameState.structures.forest },
                { name: 'Fog√£o', emoji: 'üî•', price: 250, id: 'stove', condition: () => !gameState.structures.stove },
                { name: 'Campo de Grama', emoji: 'üåø', price: 100, id: 'grassField', condition: () => !gameState.structures.grassField },
                { name: 'Secador de Grama', emoji: 'üåæ', price: 120, id: 'dryer', condition: () => !gameState.structures.dryer },
                { name: 'Pasto de Vacas', emoji: 'üêÑ', price: 200, id: 'cowPasture', condition: () => !gameState.structures.cowPasture },
                { name: 'Composteira', emoji: '‚ôªÔ∏è', price: 80, id: 'composter', condition: () => !gameState.structures.composter },
                { name: 'Vara de Pesca', emoji: 'üé£', price: 75, id: 'fishingRod', condition: () => !gameState.inventory.fishingRod },
                { name: 'Colmeia', emoji: 'üêù', price: 300, id: 'beehive', condition: () => !gameState.structures.beehive },
                { name: 'Misturador', emoji: 'ü•Ñ', price: 90, id: 'mixer', condition: () => !gameState.structures.mixer },
                { name: 'Galinheiro', emoji: 'üêî', price: 110, id: 'chickenCoop', condition: () => !gameState.structures.chickenCoop },
                { name: 'Chiqueiro', emoji: 'üê∑', price: 130, id: 'pigPen', condition: () => !gameState.structures.pigPen },
                { name: 'Curral das Ovelhas', emoji: 'üêë', price: 150, id: 'sheepPen', condition: () => !gameState.structures.sheepPen },
                { name: 'Torra de Caf√©', emoji: '‚òï', price: 220, id: 'coffeeRoaster', condition: () => !gameState.structures.coffeeRoaster },
                { name: 'M√°quina de Suco', emoji: 'üçá', price: 160, id: 'juiceMachine', condition: () => !gameState.structures.juiceMachine },
                { name: 'Queijeira', emoji: 'üßÄ', price: 180, id: 'cheesemaker', condition: () => !gameState.structures.cheesemaker },
                { name: 'M√°quina de Fiar', emoji: 'üßµ', price: 180, id: 'spinner', condition: () => !gameState.structures.spinner },
                { name: 'Moinho', emoji: 'üåæ', price: 200, id: 'mill', condition: () => !gameState.structures.mill },
                { name: 'Vacina', emoji: 'üíâ', price: 40, id: 'vaccine', condition: () => true },
                { name: 'Ra√ß√£o para Cachorro', emoji: 'ü¶¥', price: 30, id: 'dogFood', condition: () => true },
                { name: 'Casinha da Mocinha', emoji: 'üè†', price: 500, id: 'dogHouse', condition: () => !gameState.structures.dogHouse },
                { name: 'Picareta', emoji: '‚õèÔ∏è', price: 100, id: 'pickaxe', condition: () => true },
                { name: 'Baia do Duque', emoji: 'üêé', price: 1000, id: 'horseStable', condition: () => !gameState.structures.horseStable },
                { name: 'Estufa', emoji: 'üè†', price: 800, id: 'greenhouse', condition: () => gameState.season === 3 && !gameState.structures.greenhouse },
                { name: 'Manta para Duque', emoji: 'üß•', price: 150, id: 'horseCoat', condition: () => gameState.season === 3 && gameState.structures.horseStable && !gameState.horse.hasWarmClothes },
                { name: 'Touca para Mocinha', emoji: 'üß¢', price: 100, id: 'dogHat', condition: () => gameState.season === 3 && gameState.structures.dogHouse && !gameState.dog.hasWarmClothes }
            ];

            marketItems.forEach(item => {
                if (item.condition()) {
                    const marketItem = document.createElement('div');
                    marketItem.className = 'market-item';
                    marketItem.innerHTML = `<span>${item.emoji} ${item.name}</span><span>üí∞${item.price}</span>`;
                    marketItem.onclick = () => buyItem(item.id, item.price);
                    market.appendChild(marketItem);
                }
            });

            // Add cow sales after pasture is bought
            if (gameState.structures.cowPasture && gameState.cows.length < 4) {
                const cowItem = document.createElement('div');
                cowItem.className = 'market-item';
                cowItem.innerHTML = `<span>üêÑ Vaca</span><span>üí∞95</span>`;
                cowItem.onclick = () => buyCow();
                market.appendChild(cowItem);
            }

            if (gameState.structures.chickenCoop && gameState.chickens.length < 4) {
                const chickenItem = document.createElement('div');
                chickenItem.className = 'market-item';
                chickenItem.innerHTML = `<span>üêî Galinha</span><span>üí∞70</span>`;
                chickenItem.onclick = () => buyChicken();
                market.appendChild(chickenItem);
            }

            if (gameState.structures.pigPen && gameState.pigs.length < 4) {
                const pigItem = document.createElement('div');
                pigItem.className = 'market-item';
                pigItem.innerHTML = `<span>üê∑ Porco</span><span>üí∞100</span>`;
                pigItem.onclick = () => buyPig();
                market.appendChild(pigItem);
            }

            if (gameState.structures.sheepPen && gameState.sheep.length < 4) {
                const sheepItem = document.createElement('div');
                sheepItem.className = 'market-item';
                sheepItem.innerHTML = `<span>üêë Ovelha</span><span>üí∞120</span>`;
                sheepItem.onclick = () => buySheep();
                market.appendChild(sheepItem);
            }

            // Orders panel (only if horse friendship is 100%)
            if (gameState.structures.horseStable && gameState.horse.friendship >= 100) {
                const ordersPanel = document.createElement('div');
                ordersPanel.className = 'orders-panel';
                ordersPanel.innerHTML = '<h4 style="color: #8B4513; margin-bottom: 10px;">üìã Pedidos dos Clientes</h4>';
                
                gameState.orders.forEach(order => {
                    const orderDiv = document.createElement('div');
                    orderDiv.className = 'order-item';
                    
                    const itemsText = order.items.map(item => `${item.amount}x ${item.name}`).join(', ');
                    orderDiv.innerHTML = `
                        <div>
                            <strong>${order.client}</strong><br>
                            ${itemsText}<br>
                            üí∞ ${order.reward}
                        </div>
                        <div class="order-buttons">
                            <button class="accept-btn" onclick="acceptOrder(${order.id})">‚úÖ</button>
                            <button class="reject-btn" onclick="rejectOrder(${order.id})">‚ùå</button>
                        </div>
                    `;
                    ordersPanel.appendChild(orderDiv);
                });
                
                market.appendChild(ordersPanel);
            }
        }

        function selectSeed(seedName) {
            gameState.selectedSeed = seedName;
            document.querySelectorAll('.seed-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function handlePlotClick(plotIndex) {
            // Disable regular farm plots in winter
            if (gameState.season === 3) {
                alert('‚ùÑÔ∏è No inverno, os canteiros regulares n√£o funcionam! Use a estufa que pode ser comprada no mercadinho.');
                return;
            }
            
            const plot = gameState.plots[plotIndex];
            
            switch (plot.state) {
                case 'empty':
                    if (gameState.fertilizer > 0) {
                        plot.state = 'fertilized';
                        gameState.fertilizer--;
                        updateDisplay();
                    }
                    break;
                    
                case 'fertilized':
                    if (gameState.selectedSeed && gameState.coins >= seeds[gameState.selectedSeed].price) {
                        plot.state = 'planted';
                        plot.seed = gameState.selectedSeed;
                        plot.plantTime = Date.now();
                        gameState.coins -= seeds[gameState.selectedSeed].price;
                        updateDisplay();
                    }
                    break;
                    
                case 'planted':
                    if (gameState.water > 0) {
                        plot.state = 'watered';
                        gameState.water--;
                        updateDisplay();
                    }
                    break;
                    
                case 'ready':
                    harvest(plotIndex);
                    break;
            }
            updatePlotsDisplay();
        }

        function harvest(plotIndex) {
            const plot = gameState.plots[plotIndex];
            const seedName = plot.seed;
            
            if (!gameState.inventory[seedName]) {
                gameState.inventory[seedName] = 0;
            }
            
            // Summer bonus - 2 fruits per plot
            const harvestAmount = gameState.season === 1 ? 2 : 1;
            
            // Spring bonus - mark as special
            if (gameState.season === 0) {
                if (!gameState.inventory[seedName + '_spring']) {
                    gameState.inventory[seedName + '_spring'] = 0;
                }
                gameState.inventory[seedName + '_spring'] += harvestAmount;
            } else {
                gameState.inventory[seedName] += harvestAmount;
            }
            
            plot.state = 'empty';
            plot.seed = null;
            plot.plantTime = 0;
            plot.progress = 0;
            
            // Consume energy (more if sick)
            const energyCost = gameState.avatar.sick ? 3 : 1;
            gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
            
            // Check for death
            if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                gameOver();
                return;
            }
            
            updateDisplay();
            updateQuitanda();
            updatePlotsDisplay();
        }

        function updatePlotsDisplay() {
            const plots = document.querySelectorAll('.plot');
            
            plots.forEach((plotElement, index) => {
                const plot = gameState.plots[index];
                plotElement.className = 'plot';
                
                const progressFill = plotElement.querySelector('.progress-fill');
                
                switch (plot.state) {
                    case 'empty':
                        plotElement.innerHTML = 'üçÇ<div class="progress-bar"><div class="progress-fill"></div></div>';
                        break;
                    case 'fertilized':
                        plotElement.innerHTML = 'üçÇ<div class="progress-bar"><div class="progress-fill"></div></div>';
                        plotElement.classList.add('fertilized');
                        break;
                    case 'planted':
                        plotElement.innerHTML = 'üå±<div class="progress-bar"><div class="progress-fill"></div></div>';
                        plotElement.classList.add('planted');
                        break;
                    case 'watered':
                        plotElement.innerHTML = 'üíß<div class="progress-bar"><div class="progress-fill"></div></div>';
                        plotElement.classList.add('watered');
                        break;
                    case 'ready':
                        plotElement.innerHTML = `${seeds[plot.seed].emoji}<div class="progress-bar"><div class="progress-fill"></div></div>`;
                        plotElement.classList.add('ready');
                        break;
                }
                
                const newProgressFill = plotElement.querySelector('.progress-fill');
                if (plot.state === 'watered' && plot.plantTime > 0) {
                    const elapsed = Date.now() - plot.plantTime;
                    const progress = Math.min((elapsed / 30000) * 100, 100);
                    newProgressFill.style.width = progress + '%';
                    plot.progress = progress;
                }
            });
        }

        function updateQuitanda() {
            const quitanda = document.getElementById('quitanda');
            quitanda.innerHTML = '';
            
            // Farm products
            const farmSection = document.createElement('div');
            farmSection.innerHTML = '<h4 style="color: #8B4513; margin-bottom: 10px;">üåæ Produtos da Fazenda</h4>';
            
            Object.keys(gameState.inventory).forEach(item => {
                if (gameState.inventory[item] > 0) {
                    if (seeds[item]) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'market-item';
                        itemDiv.innerHTML = `
                            <span>${seeds[item].emoji} ${item} (${gameState.inventory[item]})</span>
                            <span>üí∞${seeds[item].sellPrice}</span>
                        `;
                        itemDiv.onclick = () => sellItem(item, seeds[item].sellPrice);
                        farmSection.appendChild(itemDiv);
                    } else if (item.endsWith('_spring')) {
                        const baseName = item.replace('_spring', '');
                        if (seeds[baseName]) {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'market-item';
                            itemDiv.innerHTML = `
                                <span>${seeds[baseName].emoji} ${baseName} (${gameState.inventory[item]})</span>
                                <span>üí∞${Math.floor(seeds[baseName].sellPrice * 1.1)}</span>
                            `;
                            itemDiv.onclick = () => sellItem(item, Math.floor(seeds[baseName].sellPrice * 1.1));
                            farmSection.appendChild(itemDiv);
                        }
                    }
                }
            });
            
            // Fruits
            const fruits = ['apple', 'orange', 'banana'];
            fruits.forEach(fruit => {
                if (gameState.inventory[fruit] > 0) {
                    const fruitEmojis = { apple: 'üçé', orange: 'üçä', banana: 'üçå' };
                    const fruitNames = { apple: 'Ma√ß√£', orange: 'Laranja', banana: 'Banana' };
                    const fruitPrices = { apple: 18, orange: 20, banana: 22 };
                    
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'market-item';
                    itemDiv.innerHTML = `
                        <span>${fruitEmojis[fruit]} ${fruitNames[fruit]} (${gameState.inventory[fruit]})</span>
                        <span>üí∞${fruitPrices[fruit]}</span>
                    `;
                    itemDiv.onclick = () => sellItem(fruit, fruitPrices[fruit]);
                    farmSection.appendChild(itemDiv);
                }
            });

            // Animal products
            Object.keys(quitandaItems).forEach(item => {
                if (gameState.inventory[item] > 0) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'market-item';
                    itemDiv.innerHTML = `
                        <span>${quitandaItems[item].emoji} ${quitandaItems[item].name} (${gameState.inventory[item]})</span>
                        <span>üí∞${quitandaItems[item].price}</span>
                    `;
                    itemDiv.onclick = () => sellItem(item, quitandaItems[item].price);
                    farmSection.appendChild(itemDiv);
                }
            });
            
            quitanda.appendChild(farmSection);
        }

        function sellItem(item, price) {
            if (gameState.inventory[item] > 0) {
                gameState.inventory[item]--;
                gameState.coins += price;
                updateDisplay();
                updateQuitanda();
            }
        }

        function sellAll() {
            const fruitPrices = { apple: 18, orange: 20, banana: 22 };
            
            Object.keys(gameState.inventory).forEach(item => {
                const quantity = gameState.inventory[item];
                if (quantity > 0) {
                    if (seeds[item]) {
                        gameState.coins += quantity * seeds[item].sellPrice;
                        gameState.inventory[item] = 0;
                    } else if (item.endsWith('_spring')) {
                        const baseName = item.replace('_spring', '');
                        if (seeds[baseName]) {
                            gameState.coins += quantity * Math.floor(seeds[baseName].sellPrice * 1.1);
                            gameState.inventory[item] = 0;
                        }
                    } else if (fruitPrices[item]) {
                        gameState.coins += quantity * fruitPrices[item];
                        gameState.inventory[item] = 0;
                    } else if (quitandaItems[item]) {
                        gameState.coins += quantity * quitandaItems[item].price;
                        gameState.inventory[item] = 0;
                    }
                }
            });
            updateDisplay();
            updateQuitanda();
        }

        function acceptOrder(orderId) {
            const order = gameState.orders.find(o => o.id === orderId);
            if (!order) return;

            // Check if player has required items
            const canComplete = order.items.every(item => {
                const inventoryKey = item.name === 'milk' || item.name === 'egg' ? item.name : item.name;
                return gameState.inventory[inventoryKey] >= item.amount;
            });

            if (canComplete) {
                // Remove items from inventory
                order.items.forEach(item => {
                    const inventoryKey = item.name === 'milk' || item.name === 'egg' ? item.name : item.name;
                    gameState.inventory[inventoryKey] -= item.amount;
                });
                
                // Give reward
                gameState.coins += order.reward;
                
                // Remove order and generate new one
                gameState.orders = gameState.orders.filter(o => o.id !== orderId);
                
                // Generate new order
                const orderTypes = [
                    { items: [{ name: 'Trigo', amount: 5 }], reward: 100, client: 'Jo√£o' },
                    { items: [{ name: 'milk', amount: 3 }], reward: 120, client: 'Maria' },
                    { items: [{ name: 'egg', amount: 6 }], reward: 150, client: 'Pedro' },
                    { items: [{ name: 'hay', amount: 4 }], reward: 80, client: 'Ana' },
                    { items: [{ name: 'yarn', amount: 2 }], reward: 200, client: 'Carlos' }
                ];
                
                const newOrder = orderTypes[Math.floor(Math.random() * orderTypes.length)];
                gameState.orders.push({
                    id: Date.now(),
                    ...newOrder
                });
                
                updateDisplay();
                createMarket();
            } else {
                alert('Voc√™ n√£o tem os itens necess√°rios para este pedido!');
            }
        }

        function rejectOrder(orderId) {
            gameState.orders = gameState.orders.filter(o => o.id !== orderId);
            
            // Generate new order
            const orderTypes = [
                { items: [{ name: 'Trigo', amount: 5 }], reward: 100, client: 'Jo√£o' },
                { items: [{ name: 'milk', amount: 3 }], reward: 120, client: 'Maria' },
                { items: [{ name: 'egg', amount: 6 }], reward: 150, client: 'Pedro' },
                { items: [{ name: 'hay', amount: 4 }], reward: 80, client: 'Ana' },
                { items: [{ name: 'yarn', amount: 2 }], reward: 200, client: 'Carlos' }
            ];
            
            const newOrder = orderTypes[Math.floor(Math.random() * orderTypes.length)];
            gameState.orders.push({
                id: Date.now(),
                ...newOrder
            });
            
            createMarket();
        }

        function buyItem(itemId, price) {
            if (itemId === 'dogFood') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.inventory.dogFood++;
                    gameState.rationsEaten++;
                    
                    // Bone surprise every 2 rations
                    if (gameState.rationsEaten % 2 === 0) {
                        gameState.inventory.bone++;
                    }
                    
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (itemId === 'vaccine') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.inventory.vaccine++;
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (itemId === 'axeAndWoodCutter') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.inventory.axe += 50; // 50 uses
                    gameState.structures.woodCutter = true;
                    updateDisplay();
                    createMarket();
                    updateAllStructures();
                }
                return;
            }

            if (itemId === 'fishingRod') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.inventory.fishingRod = 1;
                    gameState.fishingRodUses = 0;
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (itemId === 'pickaxe') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.inventory.pickaxe += 30; // 30 uses
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (itemId === 'horseCoat') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.horse.hasWarmClothes = true;
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (itemId === 'dogHat') {
                if (gameState.coins >= price) {
                    gameState.coins -= price;
                    gameState.dog.hasWarmClothes = true;
                    updateDisplay();
                    createMarket();
                }
                return;
            }

            if (gameState.coins >= price) {
                gameState.coins -= price;
                gameState.structures[itemId] = true;
                
                if (itemId === 'grassField') {
                    initializeGrassField();
                } else if (itemId === 'cowPasture') {
                    gameState.cows = [];
                } else if (itemId === 'chickenCoop') {
                    gameState.chickens = [];
                } else if (itemId === 'pigPen') {
                    gameState.pigs = [];
                } else if (itemId === 'sheepPen') {
                    gameState.sheep = [];
                } else if (itemId === 'forest') {
                    initializeForest();
                } else if (itemId === 'dogHouse') {
                    gameState.dog = { friendship: 0, lastFed: 0, hasEaten: false };
                } else if (itemId === 'horseStable') {
                    gameState.horse = { friendship: 0, lastFed: 0, hasEaten: false };
                    generateOrders();
                } else if (itemId === 'stove') {
                    // Stove is ready to use
                } else if (itemId === 'cheesemaker') {
                    // Cheesemaker is ready to use
                } else if (itemId === 'mill') {
                    // Mill is ready to use
                } else if (itemId === 'coffeeRoaster') {
                    // Coffee roaster is ready to use
                } else if (itemId === 'juiceMachine') {
                    // Juice machine is ready to use
                } else if (itemId === 'greenhouse') {
                    initializeGreenhouse();
                } else if (itemId === 'beehive') {
                    gameState.beehive.lastHarvest = Date.now();
                }
                
                updateDisplay();
                createMarket();
                updateAllStructures();
            }
        }

        function buyCow() {
            if (gameState.coins >= 95 && gameState.cows.length < 4) {
                gameState.coins -= 95;
                gameState.cows.push({
                    fed: false,
                    milking: false,
                    milkTime: 0,
                    restTime: 0,
                    sick: false,
                    sickTime: 0,
                    deathTime: 0
                });
                updateDisplay();
                createMarket();
                updateAllStructures();
            }
        }

        function buyChicken() {
            if (gameState.coins >= 70 && gameState.chickens.length < 4) {
                gameState.coins -= 70;
                gameState.chickens.push({
                    fed: false,
                    laying: false,
                    layTime: 0,
                    restTime: 0,
                    isChick: false,
                    growTime: 0,
                    sick: false,
                    sickTime: 0,
                    deathTime: 0
                });
                updateDisplay();
                createMarket();
                updateAllStructures();
            }
        }

        function buyPig() {
            if (gameState.coins >= 100 && gameState.pigs.length < 4) {
                gameState.coins -= 100;
                gameState.pigs.push({
                    fed: false,
                    producing: false,
                    produceTime: 0,
                    restTime: 0,
                    sick: false,
                    sickTime: 0,
                    deathTime: 0
                });
                updateDisplay();
                createMarket();
                updateAllStructures();
            }
        }

        function buySheep() {
            if (gameState.coins >= 120 && gameState.sheep.length < 4) {
                gameState.coins -= 120;
                gameState.sheep.push({
                    fed: false,
                    producing: false,
                    produceTime: 0,
                    restTime: 0,
                    sick: false,
                    sickTime: 0,
                    deathTime: 0
                });
                updateDisplay();
                createMarket();
                updateAllStructures();
            }
        }

        function initializeGrassField() {
            gameState.grassField = [];
            for (let i = 0; i < 24; i++) {
                gameState.grassField.push({
                    collected: false,
                    regrowTime: 0
                });
            }
        }

        function initializeForest() {
            gameState.forestTrees = {
                trunk: { clicks: 0 },
                apple: { clicks: 0, lastReset: Date.now() },
                orange: { clicks: 0, lastReset: Date.now() },
                banana: { clicks: 0, lastReset: Date.now() }
            };
        }

        function updateDisplay() {
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('water').textContent = gameState.water;
            document.getElementById('fertilizer').textContent = gameState.fertilizer;
            document.getElementById('season').textContent = `${seasonEmojis[gameState.season]} ${seasons[gameState.season]}`;
            
            const hours = Math.floor(gameState.seasonTimeLeft / 3600);
            const minutes = Math.floor((gameState.seasonTimeLeft % 3600) / 60);
            const seconds = gameState.seasonTimeLeft % 60;
            document.getElementById('timeLeft').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            updateBarn();
        }

        function updateBarn() {
            const barn = document.getElementById('barn');
            barn.innerHTML = '';
            
            const barnItems = {
                'hay': { emoji: 'üåæ', name: 'Feno' },
                'wood': { emoji: 'ü™µ', name: 'Lenha' },
                'chickenFeed': { emoji: 'üåæ', name: 'Ra√ß√£o Galinha' },
                'pigFeed': { emoji: 'üåΩ', name: 'Ra√ß√£o Porco' },
                'bone': { emoji: 'ü¶¥', name: 'Osso' },
                'dogFood': { emoji: 'ü•´', name: 'Ra√ß√£o Cachorro' },
                'vaccine': { emoji: 'üíâ', name: 'Vacina' },
                'coal': { emoji: '‚ö´', name: 'Carv√£o' },
                'herb': { emoji: 'üåø', name: 'Erva' },
                'tea': { emoji: 'üçµ', name: 'Ch√°' },
                'salad': { emoji: 'ü•ó', name: 'Salada' },
                'stew': { emoji: 'üç≤', name: 'Ensopado' },
                'steak': { emoji: 'ü•©', name: 'Bife' },
                'cookedChicken': { emoji: 'üçó', name: 'Frango Cozido' },
                'cookedFish': { emoji: 'üêü', name: 'Peixe Cozido' },
                'axe': { emoji: 'ü™ì', name: 'Machado (usos)' },
                'key': { emoji: 'üóùÔ∏è', name: 'Chave' },
                'pickaxe': { emoji: '‚õèÔ∏è', name: 'Picareta (usos)' },
                'flour': { emoji: 'üåæ', name: 'Farinha' },
                'coffeeRoasted': { emoji: '‚òï', name: 'Caf√© Torrado' },
                'grapeJuice': { emoji: 'üçá', name: 'Suco de Uva' },
                'bread': { emoji: 'üçû', name: 'P√£o' }
            };

            Object.keys(barnItems).forEach(item => {
                if (gameState.inventory[item] > 0) {
                    const itemDiv = document.createElement('div');
                    itemDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 5px; background: #F0F8FF; margin: 2px 0; border-radius: 5px;';
                    itemDiv.innerHTML = `<span>${barnItems[item].emoji} ${barnItems[item].name}</span><span>${gameState.inventory[item]}</span>`;
                    barn.appendChild(itemDiv);
                }
            });
        }

        function updateAllStructures() {
            updateWell();
            updateGrassField();
            updateDryer();
            updateCowPasture();
            updateForest();
            updateComposter();
            updateWoodCutter();
            updateMixer();
            updateChickenCoop();
            updatePigPen();
            updateSheepPen();
            updateSpinner();
            updateDogHouse();
            updateHorseStable();
            updateSeasonalStructures();
            updateLake();
            updateMine();
            updateStove();
            updateCheesemaker();
            updateMill();
            updateCoffeeRoaster();
            updateJuiceMachine();
            updateGreenhouse();
            updateBeehive();
        }

        function updateCheesemaker() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('cheesemakerStructure');
            if (existing) existing.remove();

            if (gameState.structures.cheesemaker) {
                const totalMilk = (gameState.inventory.milk || 0) + getQuitandaAmount('milk');
                const cheesemaker = document.createElement('div');
                cheesemaker.id = 'cheesemakerStructure';
                cheesemaker.className = 'structure';
                cheesemaker.innerHTML = `
                    <h4>üßÄ Queijeira</h4>
                    <div>Leite dispon√≠vel: ${totalMilk} (fazenda + quitanda)</div>
                    <div class="control-btn-container">
                        <button class="control-btn" onclick="makeCheese()" 
                            ${gameState.makingCheese.isActive || totalMilk < 2 ? 'disabled' : ''}>
                            Fazer Queijo (2 Leites)
                        </button>
                        <div>Status: ${gameState.makingCheese.isActive ? 'Fazendo queijo...' : 'Pronto'}</div>
                        ${gameState.makingCheese.isActive ? `<div>Tempo restante: ${Math.ceil((60000 - (Date.now() - gameState.makingCheese.startTime)) / 1000)}s</div>` : ''}
                    </div>
                `;
                container.appendChild(cheesemaker);
            }
        }

        function makeCheese() {
            const totalMilk = (gameState.inventory.milk || 0) + getQuitandaAmount('milk');
            if (totalMilk >= 2 && !gameState.makingCheese.isActive) {
                consumeIngredient('milk', 2);
                gameState.makingCheese = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateCheesemaker();
            }
        }

        function updateMill() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('millStructure');
            if (existing) existing.remove();

            if (gameState.structures.mill) {
                const totalWheat = (gameState.inventory.Trigo || 0) + getQuitandaAmount('Trigo');
                const mill = document.createElement('div');
                mill.id = 'millStructure';
                mill.className = 'structure';
                mill.innerHTML = `
                    <h4>üåæ Moinho</h4>
                    <div>Trigo dispon√≠vel: ${totalWheat} (fazenda + quitanda)</div>
                    <div class="control-btn-container">
                        <button class="control-btn" onclick="makeFlour()" 
                            ${gameState.makingFlour.isActive || totalWheat < 4 ? 'disabled' : ''}>
                            Fazer Farinha (4 Trigos)
                        </button>
                        <div>Status: ${gameState.makingFlour.isActive ? 'Fazendo farinha...' : 'Pronto'}</div>
                        ${gameState.makingFlour.isActive ? `<div>Tempo restante: ${Math.ceil((60000 - (Date.now() - gameState.makingFlour.startTime)) / 1000)}s</div>` : ''}
                    </div>
                `;
                container.appendChild(mill);
            }
        }

        function makeFlour() {
            const totalWheat = (gameState.inventory.Trigo || 0) + getQuitandaAmount('Trigo');
            if (totalWheat >= 4 && !gameState.makingFlour.isActive) {
                consumeIngredient('Trigo', 4);
                gameState.makingFlour = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateMill();
            }
        }

        function updateCoffeeRoaster() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('coffeeRoasterStructure');
            if (existing) existing.remove();

            if (gameState.structures.coffeeRoaster) {
                const totalCoffee = (gameState.inventory.Caf√© || 0) + getQuitandaAmount('Caf√©');
                const coffeeRoaster = document.createElement('div');
                coffeeRoaster.id = 'coffeeRoasterStructure';
                coffeeRoaster.className = 'structure';
                coffeeRoaster.innerHTML = `
                    <h4>‚òï Torra de Caf√©</h4>
                    <div>Caf√© dispon√≠vel: ${totalCoffee} (fazenda + quitanda)</div>
                    <div>Lenha dispon√≠vel: ${gameState.inventory.wood || 0}</div>
                    <div class="control-btn-container">
                        <button class="control-btn" onclick="roastCoffee()" 
                            ${gameState.roastingCoffee.isActive || totalCoffee < 4 || gameState.inventory.wood < 3 ? 'disabled' : ''}>
                            Torrar Caf√© (4 Caf√©s + 3 Lenhas)
                        </button>
                        <div>Status: ${gameState.roastingCoffee.isActive ? 'Torrando caf√©...' : 'Pronto'}</div>
                        ${gameState.roastingCoffee.isActive ? `<div>Tempo restante: ${Math.ceil((30000 - (Date.now() - gameState.roastingCoffee.startTime)) / 1000)}s</div>` : ''}
                    </div>
                `;
                container.appendChild(coffeeRoaster);
            }
        }

        function roastCoffee() {
            const totalCoffee = (gameState.inventory.Caf√© || 0) + getQuitandaAmount('Caf√©');
            if (totalCoffee >= 4 && gameState.inventory.wood >= 3 && !gameState.roastingCoffee.isActive) {
                consumeIngredient('Caf√©', 4);
                gameState.inventory.wood -= 3;
                gameState.roastingCoffee = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateCoffeeRoaster();
            }
        }

        function updateJuiceMachine() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('juiceMachineStructure');
            if (existing) existing.remove();

            if (gameState.structures.juiceMachine) {
                const totalGrapes = (gameState.inventory.Uva || 0) + getQuitandaAmount('Uva');
                const juiceMachine = document.createElement('div');
                juiceMachine.id = 'juiceMachineStructure';
                juiceMachine.className = 'structure';
                juiceMachine.innerHTML = `
                    <h4>üçá M√°quina de Suco</h4>
                    <div>Uvas dispon√≠veis: ${totalGrapes} (fazenda + quitanda)</div>
                    <div class="control-btn-container">
                        <button class="control-btn" onclick="makeJuice()" 
                            ${gameState.makingJuice.isActive || totalGrapes < 2 ? 'disabled' : ''}>
                            Fazer Suco (2 Uvas)
                        </button>
                        <div>Status: ${gameState.makingJuice.isActive ? 'Fazendo suco...' : 'Pronto'}</div>
                        ${gameState.makingJuice.isActive ? `<div>Tempo restante: ${Math.ceil((15000 - (Date.now() - gameState.makingJuice.startTime)) / 1000)}s</div>` : ''}
                    </div>
                `;
                container.appendChild(juiceMachine);
            }
        }

        function updateGreenhouse() {
            const wellContainer = document.getElementById('wellContainer');
            const existing = document.getElementById('greenhouseStructure');
            if (existing) existing.remove();

            if (gameState.structures.greenhouse && gameState.season === 3) {
                const greenhouse = document.createElement('div');
                greenhouse.id = 'greenhouseStructure';
                greenhouse.innerHTML = `
                    <div class="structure" style="margin-top: 20px;">
                        <h4>üè† Estufa (Inverno)</h4>
                        <div class="farm-grid" style="grid-template-columns: repeat(4, 1fr); gap: 10px;" id="greenhouseGrid"></div>
                    </div>
                `;
                wellContainer.appendChild(greenhouse);

                const greenhouseGrid = document.getElementById('greenhouseGrid');
                gameState.greenhousePlots.forEach((plot, index) => {
                    const plotElement = document.createElement('div');
                    plotElement.className = 'plot';
                    plotElement.onclick = () => handleGreenhousePlotClick(index);
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar';
                    const progressFill = document.createElement('div');
                    progressFill.className = 'progress-fill';
                    progressBar.appendChild(progressFill);
                    plotElement.appendChild(progressBar);
                    
                    switch (plot.state) {
                        case 'empty':
                            plotElement.innerHTML = 'üçÇ<div class="progress-bar"><div class="progress-fill"></div></div>';
                            break;
                        case 'fertilized':
                            plotElement.innerHTML = 'üçÇ<div class="progress-bar"><div class="progress-fill"></div></div>';
                            plotElement.classList.add('fertilized');
                            break;
                        case 'planted':
                            plotElement.innerHTML = 'üå±<div class="progress-bar"><div class="progress-fill"></div></div>';
                            plotElement.classList.add('planted');
                            break;
                        case 'watered':
                            plotElement.innerHTML = 'üíß<div class="progress-bar"><div class="progress-fill"></div></div>';
                            plotElement.classList.add('watered');
                            break;
                        case 'ready':
                            plotElement.innerHTML = `${seeds[plot.seed].emoji}<div class="progress-bar"><div class="progress-fill"></div></div>`;
                            plotElement.classList.add('ready');
                            break;
                    }
                    
                    const newProgressFill = plotElement.querySelector('.progress-fill');
                    if (plot.state === 'watered' && plot.plantTime > 0) {
                        const elapsed = Date.now() - plot.plantTime;
                        const progress = Math.min((elapsed / 30000) * 100, 100);
                        newProgressFill.style.width = progress + '%';
                        plot.progress = progress;
                    }
                    
                    greenhouseGrid.appendChild(plotElement);
                });
            }
        }

        function updateBeehive() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('beehiveStructure');
            if (existing) existing.remove();

            if (gameState.structures.beehive) {
                const beehive = document.createElement('div');
                beehive.id = 'beehiveStructure';
                beehive.className = 'structure';
                beehive.style.marginBottom = '15px';
                
                const timeUntilHarvest = Math.max(0, 180000 - (Date.now() - gameState.beehive.lastHarvest));
                const canHarvest = timeUntilHarvest === 0;
                
                beehive.innerHTML = `
                    <h4>üêù Colmeia (Embaixo do Pasto)</h4>
                    <div style="display: flex; justify-content: center; gap: 10px; margin: 10px 0;">
                        <span style="font-size: 24px;">üêù</span>
                        <span style="font-size: 24px;">üêù</span>
                        <span style="font-size: 24px;">üêù</span>
                    </div>
                    <div>Status: ${canHarvest ? 'Mel pronto! üçØ' : `Produzindo... ${Math.ceil(timeUntilHarvest / 1000)}s`}</div>
                    <button class="control-btn" onclick="harvestHoney()" ${canHarvest ? '' : 'disabled'}>
                        Coletar 3 Potes de Mel
                    </button>
                `;
                
                // Position below cow pasture
                const cowPasture = document.getElementById('cowPastureStructure');
                if (cowPasture) {
                    container.insertBefore(beehive, cowPasture.nextSibling);
                } else {
                    container.appendChild(beehive);
                }
            }
        }

        function harvestHoney() {
            if (gameState.structures.beehive) {
                const timeUntilHarvest = Math.max(0, 180000 - (Date.now() - gameState.beehive.lastHarvest));
                if (timeUntilHarvest === 0) {
                    gameState.inventory.honey = (gameState.inventory.honey || 0) + 3;
                    gameState.beehive.lastHarvest = Date.now();
                    updateDisplay();
                    updateBeehive();
                    updateQuitanda();
                }
            }
        }

        function openMailbox() {
            if (gameState.mailbox.messages.length === 0) {
                alert('üìÆ Caixa de correios vazia! Aguarde por mensagens motivadoras e o Jornal dos Agricultores.');
                return;
            }

            let messageList = 'üìÆ CAIXA DE CORREIOS\n\n';
            gameState.mailbox.messages.forEach((message, index) => {
                messageList += `${index + 1}. ${message.type === 'newspaper' ? 'üì∞' : 'üíå'} ${message.title}\n`;
            });
            messageList += '\nDigite o n√∫mero da mensagem para ler:';

            const choice = prompt(messageList);
            const messageIndex = parseInt(choice) - 1;

            if (messageIndex >= 0 && messageIndex < gameState.mailbox.messages.length) {
                const message = gameState.mailbox.messages[messageIndex];
                alert(`${message.type === 'newspaper' ? 'üì∞ JORNAL DOS AGRICULTORES' : 'üíå MENSAGEM MOTIVADORA'}\n\n${message.content}`);
                
                // Mark as read and remove
                gameState.mailbox.messages.splice(messageIndex, 1);
                
                // Update notification
                if (gameState.mailbox.messages.length === 0) {
                    gameState.mailbox.hasUnread = false;
                    document.getElementById('mailNotification').style.display = 'none';
                } else {
                    document.getElementById('mailNotification').style.display = 'block';
                }
            }
        }

        function addMotivationalMessage() {
            const messages = [
                'Voc√™ est√° fazendo um √≥timo trabalho na fazenda! Continue assim! üåü',
                'Cada planta que voc√™ cultiva torna o mundo mais verde! üå±',
                'Seus animais est√£o felizes e bem cuidados! üêÑ‚ù§Ô∏è',
                'A paci√™ncia √© a chave para uma boa colheita! ‚è∞',
                'Voc√™ √© um verdadeiro agricultor! üë®‚Äçüåæ',
                'Suas plantas crescem com amor e dedica√ß√£o! üíö',
                'Continue trabalhando duro, a recompensa vir√°! üí™',
                'Voc√™ est√° construindo algo incr√≠vel! üèóÔ∏è'
            ];

            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            gameState.mailbox.messages.push({
                type: 'motivational',
                title: 'Mensagem Motivadora',
                content: randomMessage
            });
            
            gameState.mailbox.hasUnread = true;
            gameState.mailbox.lastMotivationalMessage = Date.now();
            document.getElementById('mailNotification').style.display = 'block';
        }

        function addNewspaper() {
            const crops = ['Trigo', 'Milho', 'Caf√©', 'Batata', 'Tomate', 'Cenoura', 'Ab√≥bora', 'Br√≥colis', 'Alface', 'Uva'];
            const products = ['Leite', 'Ovos', 'Queijo', 'Mel', 'L√£'];
            
            const valuableCrop = crops[Math.floor(Math.random() * crops.length)];
            const valuableProduct = products[Math.floor(Math.random() * products.length)];
            
            const newsContent = `üóûÔ∏è EDI√á√ÉO DE HOJE\n\n` +
                `üìà PRODUTOS EM ALTA:\n` +
                `‚Ä¢ ${valuableCrop} - Demanda aumentou 20%!\n` +
                `‚Ä¢ ${valuableProduct} - Pre√ßos em alta no mercado!\n\n` +
                `üå¶Ô∏è PREVIS√ÉO DO TEMPO:\n` +
                `Possibilidade de chuva nas pr√≥ximas horas.\n\n` +
                `üí° DICA DO DIA:\n` +
                `Mantenha seus animais bem alimentados para melhor produ√ß√£o!`;

            gameState.mailbox.messages.push({
                type: 'newspaper',
                title: 'Jornal dos Agricultores',
                content: newsContent
            });
            
            gameState.mailbox.hasUnread = true;
            gameState.mailbox.lastNewspaper = Date.now();
            document.getElementById('mailNotification').style.display = 'block';
        }

        function handleGreenhousePlotClick(plotIndex) {
            const plot = gameState.greenhousePlots[plotIndex];
            
            switch (plot.state) {
                case 'empty':
                    if (gameState.fertilizer > 0) {
                        plot.state = 'fertilized';
                        gameState.fertilizer--;
                        updateDisplay();
                    }
                    break;
                    
                case 'fertilized':
                    if (gameState.selectedSeed && gameState.coins >= seeds[gameState.selectedSeed].price) {
                        plot.state = 'planted';
                        plot.seed = gameState.selectedSeed;
                        plot.plantTime = Date.now();
                        gameState.coins -= seeds[gameState.selectedSeed].price;
                        updateDisplay();
                    }
                    break;
                    
                case 'planted':
                    if (gameState.water > 0) {
                        plot.state = 'watered';
                        gameState.water--;
                        updateDisplay();
                    }
                    break;
                    
                case 'ready':
                    harvestGreenhouse(plotIndex);
                    break;
            }
            updateGreenhouse();
        }

        function harvestGreenhouse(plotIndex) {
            const plot = gameState.greenhousePlots[plotIndex];
            const seedName = plot.seed;
            
            if (!gameState.inventory[seedName]) {
                gameState.inventory[seedName] = 0;
            }
            
            gameState.inventory[seedName]++;
            
            plot.state = 'empty';
            plot.seed = null;
            plot.plantTime = 0;
            plot.progress = 0;
            
            // Consume energy (more if sick)
            const energyCost = gameState.avatar.sick ? 3 : 1;
            gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
            
            // Check for death
            if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                gameOver();
                return;
            }
            
            updateDisplay();
            updateQuitanda();
            updateGreenhouse();
        }

        function makeJuice() {
            const totalGrapes = (gameState.inventory.Uva || 0) + getQuitandaAmount('Uva');
            if (totalGrapes >= 2 && !gameState.makingJuice.isActive) {
                consumeIngredient('Uva', 2);
                gameState.makingJuice = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateJuiceMachine();
            }
        }

        function updateWell() {
            const wellContainer = document.getElementById('wellContainer');
            wellContainer.innerHTML = '';
            
            if (gameState.structures.well) {
                const wellDiv = document.createElement('div');
                wellDiv.className = 'well-container';
                wellDiv.innerHTML = `
                    <h4>üíß Po√ßo de √Ågua</h4>
                    <button class="well-btn" onclick="collectWater()">üíß Coletar √Ågua (4 baldes)</button>
                `;
                wellContainer.appendChild(wellDiv);
            }
            
            // Add chicken coop below well
            if (gameState.structures.chickenCoop) {
                const chickenCoop = document.createElement('div');
                chickenCoop.className = 'structure';
                chickenCoop.style.marginTop = '20px';
                chickenCoop.innerHTML = `
                    <h4>üêî Galinheiro (${gameState.chickens.length}/4)</h4>
                    <div class="chicken-grid" id="chickenGridWell"></div>
                `;
                wellContainer.appendChild(chickenCoop);

                const chickenGrid = document.getElementById('chickenGridWell');
                for (let i = 0; i < 4; i++) {
                    const chickenItem = document.createElement('div');
                    chickenItem.className = 'chicken-item';
                    
                    if (i < gameState.chickens.length) {
                        const chicken = gameState.chickens[i];
                        if (chicken.sick) {
                            chickenItem.innerHTML = 'ü§í';
                            chickenItem.classList.add('animal-sick');
                            chickenItem.onclick = () => vaccinateAnimal('chicken', i);
                        } else if (chicken.isChick) {
                            chickenItem.innerHTML = 'üê£';
                        } else if (chicken.laying) {
                            chickenItem.innerHTML = 'ü•ö';
                            chickenItem.onclick = () => collectEggs(i);
                        } else if (chicken.fed && chicken.restTime > Date.now()) {
                            chickenItem.innerHTML = 'üò¥';
                        } else {
                            chickenItem.innerHTML = 'üêî';
                            chickenItem.onclick = () => feedChicken(i);
                            chickenItem.oncontextmenu = (e) => {
                                e.preventDefault();
                                sacrificeChicken(i);
                            };
                        }
                    } else {
                        chickenItem.innerHTML = '‚¨ú';
                        chickenItem.style.cursor = 'default';
                    }
                    
                    chickenGrid.appendChild(chickenItem);
                }
            }
        }

        function collectWater() {
            gameState.water += 4;
            updateDisplay();
        }

        function updateGrassField() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('grassFieldStructure');
            if (existing) existing.remove();

            if (gameState.structures.grassField) {
                const grassField = document.createElement('div');
                grassField.id = 'grassFieldStructure';
                grassField.className = 'structure';
                grassField.innerHTML = `
                    <h4>üåø Campo de Grama</h4>
                    <div class="grass-grid" id="grassGrid"></div>
                `;
                container.appendChild(grassField);

                const grassGrid = document.getElementById('grassGrid');
                gameState.grassField.forEach((grass, index) => {
                    const grassItem = document.createElement('div');
                    grassItem.className = `grass-item ${grass.collected ? 'collected' : ''}`;
                    grassItem.innerHTML = grass.collected ? 'üü´' : 'üåø';
                    if (!grass.collected) {
                        grassItem.onclick = () => collectGrass(index);
                    }
                    grassGrid.appendChild(grassItem);
                });
            }
        }

        function collectGrass(index) {
            if (gameState.avatar.resting) {
                alert('Voc√™ n√£o pode trabalhar enquanto estiver descansando!');
                return;
            }
            if (!gameState.grassField[index].collected && gameState.avatar.energy > 0 && !gameState.avatar.sick) {
                gameState.grassField[index].collected = true;
                gameState.grassField[index].regrowTime = Date.now() + 60000;
                gameState.inventory.grass++;
                
                // Consume energy (more if sick)
                const energyCost = gameState.avatar.sick ? 3 : 1;
                gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                
                // Check for death
                if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                    gameOver();
                    return;
                }
                
                const totalCollected = gameState.grassField.filter(g => g.collected).length;
                if (totalCollected % 8 === 0) {
                    gameState.inventory.flower++;
                }
                
                updateDisplay();
                updateGrassField();
            }
        }

        function updateDryer() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('dryerStructure');
            if (existing) existing.remove();

            if (gameState.structures.dryer) {
                const dryer = document.createElement('div');
                dryer.id = 'dryerStructure';
                dryer.className = 'structure';
                dryer.innerHTML = `
                    <h4>üåæ Secador de Grama</h4>
                    <div>Grama armazenada: ${gameState.inventory.grass || 0}</div>
                    <div class="dryer-controls">
                        <button class="control-btn" onclick="startDrying()" 
                            ${gameState.dryingGrass.isActive || gameState.inventory.grass < 4 ? 'disabled' : ''} 
                            style="background: ${gameState.inventory.grass >= 4 && !gameState.dryingGrass.isActive ? '#4CAF50' : '#CCC'};">
                            Secar Grama (4-8 unidades)
                        </button>
                        <button class="control-btn" onclick="makeHay()" ${gameState.makingHay.isActive || gameState.inventory.driedGrass < 4 ? 'disabled' : ''}>
                            Fazer Feno (4 gramas secas)
                        </button>
                        <div>Status: ${gameState.dryingGrass.isActive ? `Secando... ${Math.ceil((30000 - (Date.now() - gameState.dryingGrass.startTime)) / 1000)}s` : gameState.makingHay.isActive ? `Fazendo feno... ${Math.ceil((15000 - (Date.now() - gameState.makingHay.startTime)) / 1000)}s` : 'Pronto'}</div>
                    </div>
                `;
                container.appendChild(dryer);
            }
        }

        function startDrying() {
            const available = gameState.inventory.grass;
            if (available >= 4 && !gameState.dryingGrass.isActive) {
                const amount = Math.min(Math.floor(Math.random() * 5) + 4, available);
                gameState.inventory.grass -= amount;
                gameState.dryingGrass = {
                    amount: amount,
                    startTime: Date.now(),
                    isActive: true
                };
                updateDisplay();
                updateDryer();
            }
        }

        function makeHay() {
            if (gameState.inventory.driedGrass >= 4 && !gameState.makingHay.isActive) {
                gameState.inventory.driedGrass -= 4;
                gameState.makingHay = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateDryer();
            }
        }

        function updateWoodCutter() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('woodCutterStructure');
            if (existing) existing.remove();

            if (gameState.structures.woodCutter) {
                const woodCutter = document.createElement('div');
                woodCutter.id = 'woodCutterStructure';
                woodCutter.className = 'structure';
                woodCutter.innerHTML = `
                    <h4>ü™ì Cortar Lenha</h4>
                    <div>Troncos armazenados: ${gameState.inventory.trunk || 0}</div>
                    <div class="woodcutter-controls">
                        <button class="control-btn" onclick="cutWood()" ${gameState.cuttingWood.isActive || gameState.inventory.trunk < 1 ? 'disabled' : ''}>
                            Cortar Lenha (1 tronco = 4 lenhas)
                        </button>
                        <div>Status: ${gameState.cuttingWood.isActive ? 'Cortando...' : 'Pronto'}</div>
                    </div>
                `;
                container.appendChild(woodCutter);
            }
        }

        function cutWood() {
            if (gameState.inventory.trunk >= 1 && !gameState.cuttingWood.isActive) {
                gameState.inventory.trunk--;
                gameState.cuttingWood = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateWoodCutter();
            }
        }

        // Helper function to get amount of items available in quitanda
        function getQuitandaAmount(itemName) {
            // This simulates checking what's available in the quitanda for production
            // In reality, items sold to quitanda are no longer in inventory
            // But for production purposes, we'll consider them "available" from quitanda
            return 0; // For now, only use inventory items
        }

        // Helper function to consume ingredients from inventory first, then quitanda
        function consumeIngredient(itemName, amount) {
            const inventoryAmount = gameState.inventory[itemName] || 0;
            if (inventoryAmount >= amount) {
                // Take all from inventory
                gameState.inventory[itemName] -= amount;
            } else {
                // Take what we can from inventory, rest from quitanda
                gameState.inventory[itemName] = 0;
                // In future implementation, would remove from quitanda here
                // For now, just consume from inventory
            }
        }

        function updateMixer() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('mixerStructure');
            if (existing) existing.remove();

            if (gameState.structures.mixer) {
                // Get ingredients from both inventory and quitanda
                const totalWheat = (gameState.inventory.Trigo || 0) + getQuitandaAmount('Trigo');
                const totalCorn = (gameState.inventory.Milho || 0) + getQuitandaAmount('Milho');
                const totalPotato = (gameState.inventory.Batata || 0) + getQuitandaAmount('Batata');
                const totalCarrot = (gameState.inventory.Cenoura || 0) + getQuitandaAmount('Cenoura');
                const totalBroccoli = (gameState.inventory.Br√≥colis || 0) + getQuitandaAmount('Br√≥colis');
                
                const mixer = document.createElement('div');
                mixer.id = 'mixerStructure';
                mixer.className = 'structure';
                mixer.innerHTML = `
                    <h4>ü•Ñ Misturador</h4>
                    <div>Ingredientes (fazenda + quitanda):</div>
                    <div style="font-size: 12px; margin: 5px 0;">üåæ${totalWheat} üåΩ${totalCorn} ü•î${totalPotato} ü•ï${totalCarrot} ü•¶${totalBroccoli}</div>
                    <div class="mixer-controls">
                        <button class="control-btn" onclick="makeChickenFeed()" 
                            ${gameState.makingChickenFeed.isActive || totalWheat < 1 || totalCorn < 2 ? 'disabled' : ''}>
                            Ra√ß√£o Galinha (1üåæ + 2üåΩ)
                        </button>
                        <button class="control-btn" onclick="makePigFeed()" 
                            ${gameState.makingPigFeed.isActive || totalCorn < 1 || totalPotato < 1 || totalCarrot < 1 || totalBroccoli < 1 ? 'disabled' : ''}>
                            Ra√ß√£o Porco (1üåΩ + 1ü•î + 1ü•ï + 1ü•¶)
                        </button>
                        <div>Status: ${gameState.makingChickenFeed.isActive ? 'Fazendo ra√ß√£o galinha...' : gameState.makingPigFeed.isActive ? 'Fazendo ra√ß√£o porco...' : 'Pronto'}</div>
                    </div>
                `;
                container.appendChild(mixer);
            }
        }

        function makeChickenFeed() {
            const totalWheat = (gameState.inventory.Trigo || 0) + getQuitandaAmount('Trigo');
            const totalCorn = (gameState.inventory.Milho || 0) + getQuitandaAmount('Milho');
            if (totalWheat >= 1 && totalCorn >= 2 && !gameState.makingChickenFeed.isActive) {
                // Consume from inventory first, then from quitanda if needed
                consumeIngredient('Trigo', 1);
                consumeIngredient('Milho', 2);
                gameState.makingChickenFeed = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateMixer();
            }
        }

        function makePigFeed() {
            const totalCorn = (gameState.inventory.Milho || 0) + getQuitandaAmount('Milho');
            const totalPotato = (gameState.inventory.Batata || 0) + getQuitandaAmount('Batata');
            const totalCarrot = (gameState.inventory.Cenoura || 0) + getQuitandaAmount('Cenoura');
            const totalBroccoli = (gameState.inventory.Br√≥colis || 0) + getQuitandaAmount('Br√≥colis');
            
            if (totalCorn >= 1 && totalPotato >= 1 && totalCarrot >= 1 && totalBroccoli >= 1 && !gameState.makingPigFeed.isActive) {
                // Consume from inventory first, then from quitanda if needed
                consumeIngredient('Milho', 1);
                consumeIngredient('Batata', 1);
                consumeIngredient('Cenoura', 1);
                consumeIngredient('Br√≥colis', 1);
                gameState.makingPigFeed = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateMixer();
            }
        }

        function updateCowPasture() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('cowPastureStructure');
            if (existing) existing.remove();

            if (gameState.structures.cowPasture) {
                const cowPasture = document.createElement('div');
                cowPasture.id = 'cowPastureStructure';
                cowPasture.className = 'structure';
                cowPasture.innerHTML = `
                    <h4>üêÑ Pasto de Vacas (${gameState.cows.length}/4)</h4>
                    <div class="cow-grid" id="cowGrid"></div>
                `;
                container.insertBefore(cowPasture, container.firstChild);

                const cowGrid = document.getElementById('cowGrid');
                for (let i = 0; i < 4; i++) {
                    const cowItem = document.createElement('div');
                    cowItem.className = 'cow-item';
                    
                    if (i < gameState.cows.length) {
                        const cow = gameState.cows[i];
                        if (cow.sick) {
                            cowItem.innerHTML = 'ü§í';
                            cowItem.classList.add('animal-sick');
                            cowItem.onclick = () => vaccinateAnimal('cow', i);
                        } else if (cow.eating && Date.now() < cow.eatTime) {
                            cowItem.innerHTML = 'üçΩÔ∏è';
                            cowItem.title = 'Comendo';
                        } else if (cow.milking) {
                            cowItem.innerHTML = 'ü•õ';
                            cowItem.onclick = () => milkCow(i);
                        } else if (cow.fed && cow.restTime > Date.now()) {
                            cowItem.innerHTML = 'üò¥';
                            cowItem.title = 'Descansando';
                        } else {
                            cowItem.innerHTML = 'üêÑ';
                            cowItem.onclick = () => feedCow(i);
                        }
                    } else {
                        cowItem.innerHTML = '‚¨ú';
                        cowItem.style.cursor = 'default';
                    }
                    
                    cowGrid.appendChild(cowItem);
                }
            }
        }

        function vaccinateAnimal(animalType, index) {
            if (gameState.inventory.vaccine > 0) {
                gameState.inventory.vaccine--;
                
                if (animalType === 'cow') {
                    gameState.cows[index].sick = false;
                    gameState.cows[index].sickTime = 0;
                    gameState.cows[index].deathTime = 0;
                } else if (animalType === 'chicken') {
                    gameState.chickens[index].sick = false;
                    gameState.chickens[index].sickTime = 0;
                    gameState.chickens[index].deathTime = 0;
                } else if (animalType === 'pig') {
                    gameState.pigs[index].sick = false;
                    gameState.pigs[index].sickTime = 0;
                    gameState.pigs[index].deathTime = 0;
                } else if (animalType === 'sheep') {
                    gameState.sheep[index].sick = false;
                    gameState.sheep[index].sickTime = 0;
                    gameState.sheep[index].deathTime = 0;
                }
                
                updateDisplay();
                updateAllStructures();
            }
        }

        function feedCow(index) {
            // Check if it's winter and bonfire is not lit
            if (gameState.season === 3 && !gameState.bonfire.lit) {
                alert('‚ùÑÔ∏è No inverno, os animais precisam da fogueira acesa para produzir!');
                return;
            }
            
            if (gameState.inventory.hay > 0 && !gameState.cows[index].fed && !gameState.cows[index].sick) {
                gameState.inventory.hay--;
                gameState.cows[index].fed = true;
                gameState.cows[index].eating = true;
                gameState.cows[index].eatTime = Date.now() + 10000; // 10 seconds to eat
                gameState.inventory.manure = (gameState.inventory.manure || 0) + 1;
                updateDisplay();
                updateCowPasture();
            }
        }

        function milkCow(index) {
            const cow = gameState.cows[index];
            if (cow.milking && Date.now() >= cow.milkTime) {
                gameState.inventory.milk += 3;
                cow.milking = false;
                cow.fed = false;
                cow.restTime = Date.now() + 180000; // 3 minutes rest
                updateDisplay();
                updateCowPasture();
                updateQuitanda();
            }
        }

        function updateChickenCoop() {
            // Chicken coop is now handled in updateWell function
        }

        function feedChicken(index) {
            // Check if it's winter and bonfire is not lit
            if (gameState.season === 3 && !gameState.bonfire.lit) {
                alert('‚ùÑÔ∏è No inverno, os animais precisam da fogueira acesa para produzir!');
                return;
            }
            
            if (gameState.inventory.chickenFeed > 0 && !gameState.chickens[index].fed && !gameState.chickens[index].sick) {
                gameState.inventory.chickenFeed--;
                gameState.chickens[index].fed = true;
                gameState.chickens[index].laying = true;
                gameState.chickens[index].layTime = Date.now() + 30000;
                
                // Check for chick spawn (50% chance with 2+ chickens)
                if (gameState.chickens.length >= 2 && Math.random() < 0.5) {
                    gameState.chickens.push({
                        fed: false,
                        laying: false,
                        layTime: 0,
                        restTime: 0,
                        isChick: true,
                        growTime: Date.now() + 1800000, // 30 minutes
                        sick: false,
                        sickTime: 0,
                        deathTime: 0
                    });
                }
                
                updateDisplay();
                updateChickenCoop();
            }
        }

        function collectEggs(index) {
            const chicken = gameState.chickens[index];
            if (chicken.laying && Date.now() >= chicken.layTime) {
                gameState.inventory.egg += 3;
                chicken.laying = false;
                chicken.fed = false;
                chicken.restTime = Date.now() + 180000; // 3 minutes rest
                updateDisplay();
                updateChickenCoop();
                updateQuitanda();
            }
        }

        function sacrificeChicken(index) {
            if (confirm('Sacrificar galinha por frango cru?')) {
                gameState.inventory.rawChicken++;
                gameState.chickens.splice(index, 1);
                updateDisplay();
                updateChickenCoop();
                createMarket();
            }
        }

        function updatePigPen() {
            const wellContainer = document.getElementById('wellContainer');
            const existing = document.getElementById('pigPenStructure');
            if (existing) existing.remove();

            if (gameState.structures.pigPen) {
                const pigPen = document.createElement('div');
                pigPen.id = 'pigPenStructure';
                pigPen.className = 'structure';
                pigPen.style.marginTop = '20px';
                pigPen.innerHTML = `
                    <h4>üê∑ Chiqueiro (${gameState.pigs.length}/4)</h4>
                    <div class="pig-grid" id="pigGrid"></div>
                `;
                wellContainer.appendChild(pigPen);

                const pigGrid = document.getElementById('pigGrid');
                for (let i = 0; i < 4; i++) {
                    const pigItem = document.createElement('div');
                    pigItem.className = 'pig-item';
                    
                    if (i < gameState.pigs.length) {
                        const pig = gameState.pigs[i];
                        if (pig.sick) {
                            pigItem.innerHTML = 'ü§í';
                            pigItem.classList.add('animal-sick');
                            pigItem.onclick = () => vaccinateAnimal('pig', i);
                        } else if (pig.producing) {
                            pigItem.innerHTML = 'ü•©';
                            pigItem.onclick = () => collectPork(i);
                        } else if (pig.fed && pig.restTime > Date.now()) {
                            pigItem.innerHTML = 'üò¥';
                        } else {
                            pigItem.innerHTML = 'üê∑';
                            pigItem.onclick = () => feedPig(i);
                        }
                    } else {
                        pigItem.innerHTML = '‚¨ú';
                        pigItem.style.cursor = 'default';
                    }
                    
                    pigGrid.appendChild(pigItem);
                }
            }
        }

        function feedPig(index) {
            // Check if it's winter and bonfire is not lit
            if (gameState.season === 3 && !gameState.bonfire.lit) {
                alert('‚ùÑÔ∏è No inverno, os animais precisam da fogueira acesa para produzir!');
                return;
            }
            
            if (gameState.inventory.pigFeed > 0 && !gameState.pigs[index].fed && !gameState.pigs[index].sick) {
                gameState.inventory.pigFeed--;
                gameState.pigs[index].fed = true;
                gameState.pigs[index].producing = true;
                gameState.pigs[index].produceTime = Date.now() + 30000;
                updateDisplay();
                updatePigPen();
            }
        }

        function collectPork(index) {
            const pig = gameState.pigs[index];
            if (pig.producing && Date.now() >= pig.produceTime) {
                gameState.inventory.pork++;
                pig.producing = false;
                pig.fed = false;
                pig.restTime = Date.now() + 180000; // 3 minutes rest
                updateDisplay();
                updatePigPen();
                updateQuitanda();
            }
        }

        function updateSheepPen() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('sheepPenStructure');
            if (existing) existing.remove();

            if (gameState.structures.sheepPen) {
                const sheepPen = document.createElement('div');
                sheepPen.id = 'sheepPenStructure';
                sheepPen.className = 'structure';
                sheepPen.innerHTML = `
                    <h4>üêë Curral das Ovelhas (${gameState.sheep.length}/4)</h4>
                    <div class="sheep-grid" id="sheepGrid"></div>
                `;
                
                // Insert sheep pen above cow pasture
                const cowPasture = document.getElementById('cowPastureStructure');
                if (cowPasture) {
                    container.insertBefore(sheepPen, cowPasture);
                } else {
                    container.appendChild(sheepPen);
                }

                const sheepGrid = document.getElementById('sheepGrid');
                for (let i = 0; i < 4; i++) {
                    const sheepItem = document.createElement('div');
                    sheepItem.className = 'sheep-item';
                    
                    if (i < gameState.sheep.length) {
                        const sheep = gameState.sheep[i];
                        if (sheep.sick) {
                            sheepItem.innerHTML = 'ü§í';
                            sheepItem.classList.add('animal-sick');
                            sheepItem.onclick = () => vaccinateAnimal('sheep', i);
                        } else if (sheep.producing) {
                            sheepItem.innerHTML = 'üß∂';
                            sheepItem.onclick = () => collectWool(i);
                        } else if (sheep.fed && sheep.restTime > Date.now()) {
                            sheepItem.innerHTML = 'üò¥';
                        } else {
                            sheepItem.innerHTML = 'üêë';
                            sheepItem.onclick = () => feedSheep(i);
                        }
                    } else {
                        sheepItem.innerHTML = '‚¨ú';
                        sheepItem.style.cursor = 'default';
                    }
                    
                    sheepGrid.appendChild(sheepItem);
                }
            }
        }

        function feedSheep(index) {
            // Check if it's winter and bonfire is not lit
            if (gameState.season === 3 && !gameState.bonfire.lit) {
                alert('‚ùÑÔ∏è No inverno, os animais precisam da fogueira acesa para produzir!');
                return;
            }
            
            if (gameState.inventory.hay > 0 && !gameState.sheep[index].fed && !gameState.sheep[index].sick) {
                gameState.inventory.hay--;
                gameState.sheep[index].fed = true;
                gameState.sheep[index].producing = true;
                gameState.sheep[index].produceTime = Date.now() + 30000;
                updateDisplay();
                updateSheepPen();
            }
        }

        function collectWool(index) {
            const sheep = gameState.sheep[index];
            if (sheep.producing && Date.now() >= sheep.produceTime) {
                gameState.inventory.wool++;
                sheep.producing = false;
                sheep.fed = false;
                sheep.restTime = Date.now() + 180000; // 3 minutes rest
                updateDisplay();
                updateSheepPen();
                updateQuitanda();
            }
        }

        function updateSpinner() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('spinnerStructure');
            if (existing) existing.remove();

            if (gameState.structures.spinner) {
                const spinner = document.createElement('div');
                spinner.id = 'spinnerStructure';
                spinner.className = 'structure';
                spinner.innerHTML = `
                    <h4>üßµ M√°quina de Fiar</h4>
                    <div class="spinner-controls">
                        <button class="control-btn" onclick="spinYarn()" 
                            ${gameState.spinning.isActive || gameState.inventory.wool < 2 ? 'disabled' : ''}>
                            Fazer Novelo (2 l√£s)
                        </button>
                        <div>Status: ${gameState.spinning.isActive ? 'Fiando...' : 'Pronto'}</div>
                        ${gameState.spinning.isActive ? `<div>Tempo restante: ${Math.ceil((30000 - (Date.now() - gameState.spinning.startTime)) / 1000)}s</div>` : ''}
                    </div>
                `;
                container.appendChild(spinner);
            }
        }

        function spinYarn() {
            if (gameState.inventory.wool >= 2 && !gameState.spinning.isActive) {
                gameState.inventory.wool -= 2;
                gameState.spinning = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateSpinner();
            }
        }

        function updateDogHouse() {
            const container = document.getElementById('structuresLeft');
            const existing = document.getElementById('dogHouseStructure');
            if (existing) existing.remove();

            if (gameState.structures.dogHouse) {
                const dogHouse = document.createElement('div');
                dogHouse.id = 'dogHouseStructure';
                dogHouse.className = 'structure';
                
                const dogDisplay = gameState.season === 3 && gameState.dog.hasWarmClothes ? 'üß¢üêï' : 'üêï';
                const canWork = gameState.season !== 3 || gameState.dog.hasWarmClothes;
                const canEat = !gameState.dog.lastFed || Date.now() - gameState.dog.lastFed >= 300000; // 5 minutes
                const isSearching = gameState.dog.searchingUntil && Date.now() < gameState.dog.searchingUntil;
                
                dogHouse.innerHTML = `
                    <h4>üè† Casinha da Mocinha</h4>
                    <div class="pet-container">
                        <div>${dogDisplay} Mocinha</div>
                        <div class="friendship-bar">
                            <div class="friendship-fill" style="width: ${gameState.dog.friendship}%"></div>
                        </div>
                        <div>Amizade: ${gameState.dog.friendship}%</div>
                        <button class="control-btn" onclick="feedDog()" ${gameState.inventory.dogFood < 1 || !canEat ? 'disabled' : ''}>
                            ${canEat ? 'Dar Ra√ß√£o' : `Aguardar ${Math.ceil((300000 - (Date.now() - gameState.dog.lastFed)) / 60000)} min`}
                        </button>
                        <button class="control-btn" onclick="giveBone()" ${gameState.inventory.bone < 1 || !canEat ? 'disabled' : ''}>
                            Dar Osso ü¶¥
                        </button>
                        ${gameState.dog.friendship >= 100 && canWork && !isSearching ? '<button class="control-btn" onclick="findTreasure()">Procurar Tesouro</button>' : ''}
                        ${isSearching ? `<div>üîç Procurando tesouro... ${Math.ceil((gameState.dog.searchingUntil - Date.now()) / 1000)}s</div>` : ''}
                        ${gameState.season === 3 && !gameState.dog.hasWarmClothes ? '<div style="color: red; font-size: 12px;">‚ùÑÔ∏è Precisa de touca para trabalhar no inverno!</div>' : ''}
                    </div>
                `;
                container.appendChild(dogHouse);
            }
        }

        function feedDog() {
            const canEat = !gameState.dog.lastFed || Date.now() - gameState.dog.lastFed >= 300000; // 5 minutes
            if (gameState.inventory.dogFood > 0 && canEat) {
                gameState.inventory.dogFood--;
                gameState.dog.lastFed = Date.now();
                // Only ration doesn't increase friendship
                updateDisplay();
                updateDogHouse();
            }
        }

        function giveBone() {
            const canEat = !gameState.dog.lastFed || Date.now() - gameState.dog.lastFed >= 300000; // 5 minutes
            if (gameState.inventory.bone > 0 && canEat) {
                gameState.inventory.bone--;
                gameState.dog.lastFed = Date.now();
                gameState.dog.friendship = Math.min(gameState.dog.friendship + 20, 100);
                
                // Show hearts animation
                const dogHouse = document.getElementById('dogHouseStructure');
                const hearts = document.createElement('div');
                hearts.className = 'hearts';
                hearts.innerHTML = 'üíïüíïüíï';
                dogHouse.appendChild(hearts);
                setTimeout(() => hearts.remove(), 1000);
                
                updateDisplay();
                updateDogHouse();
            }
        }

        function findTreasure() {
            if (gameState.dog.friendship >= 100) {
                gameState.dog.searchingUntil = Date.now() + 180000; // 3 minutes
                updateDogHouse();
                
                setTimeout(() => {
                    const treasures = ['CD', 'Bola', 'Sapato', 'Chave'];
                    const treasure = treasures[Math.floor(Math.random() * treasures.length)];
                    if (treasure === 'Chave') {
                        gameState.inventory.key++;
                    } else {
                        gameState.inventory.treasure++;
                    }
                    alert(`Mocinha encontrou um tesouro: ${treasure}!`);
                    updateDisplay();
                    updateQuitanda();
                    updateDogHouse();
                }, 180000);
            }
        }

        function updateHorseStable() {
            const container = document.getElementById('structuresLeft');
            const existing = document.getElementById('horseStableStructure');
            if (existing) existing.remove();

            if (gameState.structures.horseStable) {
                const horseStable = document.createElement('div');
                horseStable.id = 'horseStableStructure';
                horseStable.className = 'structure';
                
                const horseDisplay = gameState.season === 3 && gameState.horse.hasWarmClothes ? 'üß•üêé' : 'üêé';
                const canWork = gameState.season !== 3 || gameState.horse.hasWarmClothes;
                const canEat = !gameState.horse.lastFed || Date.now() - gameState.horse.lastFed >= 300000; // 5 minutes
                
                horseStable.innerHTML = `
                    <h4>üêé Baia do Duque</h4>
                    <div class="pet-container">
                        <div>${horseDisplay} Duque</div>
                        <div class="friendship-bar">
                            <div class="friendship-fill" style="width: ${gameState.horse.friendship}%"></div>
                        </div>
                        <div>Amizade: ${gameState.horse.friendship}%</div>
                        <button class="control-btn" onclick="feedHorse()" ${gameState.inventory.hay < 2 || !canEat ? 'disabled' : ''}>
                            ${canEat ? 'Dar Feno (2 unidades)' : `Aguardar ${Math.ceil((300000 - (Date.now() - gameState.horse.lastFed)) / 60000)} min`}
                        </button>
                        <button class="control-btn" onclick="giveApple()" ${gameState.inventory.apple < 1 || !canEat || (gameState.horse.lastApple && Date.now() - gameState.horse.lastApple < 300000) ? 'disabled' : ''}>
                            ${gameState.horse.lastApple && Date.now() - gameState.horse.lastApple < 300000 ? `Aguardar ${Math.ceil((300000 - (Date.now() - gameState.horse.lastApple)) / 60000)} min` : 'Dar Ma√ß√£ üçé'}
                        </button>
                        ${gameState.horse.friendship >= 100 && canWork ? '<div>Duque est√° pronto para trabalhar! üöö</div>' : ''}
                        ${gameState.season === 3 && !gameState.horse.hasWarmClothes ? '<div style="color: red; font-size: 12px;">‚ùÑÔ∏è Precisa de manta para trabalhar no inverno!</div>' : ''}
                    </div>
                `;
                container.appendChild(horseStable);
            }
        }

        function updateStove() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('stoveStructure');
            if (existing) existing.remove();

            if (gameState.structures.stove) {
                const totalTomato = (gameState.inventory.Tomate || 0) + getQuitandaAmount('Tomate');
                const totalLettuce = (gameState.inventory.Alface || 0) + getQuitandaAmount('Alface');
                const totalBroccoli = (gameState.inventory.Br√≥colis || 0) + getQuitandaAmount('Br√≥colis');
                const totalEgg = (gameState.inventory.egg || 0) + getQuitandaAmount('egg');
                const totalPotato = (gameState.inventory.Batata || 0) + getQuitandaAmount('Batata');
                const totalPumpkin = (gameState.inventory.Ab√≥bora || 0) + getQuitandaAmount('Ab√≥bora');
                const totalPork = (gameState.inventory.pork || 0) + getQuitandaAmount('pork');
                const totalRawChicken = (gameState.inventory.rawChicken || 0) + getQuitandaAmount('rawChicken');
                const totalFish = (gameState.inventory.fish || 0) + getQuitandaAmount('fish');
                
                const stove = document.createElement('div');
                stove.id = 'stoveStructure';
                stove.className = 'structure';
                stove.innerHTML = `
                    <h4>üî• Fog√£o com Forno</h4>
                    <div>Lenha dispon√≠vel: ${gameState.inventory.wood || 0}</div>
                    <div>Ervas armazenadas: ${gameState.inventory.herb || 0}</div>
                    <div style="font-size: 12px; margin: 5px 0;">Ingredientes (fazenda + quitanda): üçÖ${totalTomato} ü•¨${totalLettuce} ü•¶${totalBroccoli} ü•ö${totalEgg} ü•î${totalPotato} üéÉ${totalPumpkin} ü•©${totalPork} üçó${totalRawChicken} üêü${totalFish}</div>
                    
                    <h5>Receitas do Fog√£o (2 lenhas):</h5>
                    <button class="control-btn" onclick="cookMeal('tea')" 
                        ${gameState.cookingTea && gameState.cookingTea.isActive ? 'disabled' : gameState.inventory.herb >= 2 && gameState.water >= 1 && gameState.inventory.wood >= 2 ? '' : 'disabled'}>
                        ${gameState.cookingTea && gameState.cookingTea.isActive ? `Fazendo ch√°... ${Math.ceil((10000 - (Date.now() - gameState.cookingTea.startTime)) / 1000)}s` : 'Ch√° (1üíß + 2üåø) - Cura doen√ßa'}
                    </button>
                    <button class="control-btn" onclick="cookMeal('salad')" 
                        ${totalTomato >= 1 && totalLettuce >= 1 && totalBroccoli >= 1 && gameState.inventory.wood >= 2 ? '' : 'disabled'}>
                        Salada (1üçÖ + 1ü•¨ + 1ü•¶) - +30% energia
                    </button>
                    <button class="control-btn" onclick="cookMeal('stew')" 
                        ${totalEgg >= 1 && totalPotato >= 1 && totalPumpkin >= 1 && gameState.inventory.wood >= 2 ? '' : 'disabled'}>
                        Ensopado (1ü•ö + 1ü•î + 1üéÉ) - +50% energia
                    </button>
                    <button class="control-btn" onclick="cookMeal('steak')" 
                        ${totalPork >= 1 && gameState.inventory.wood >= 2 ? '' : 'disabled'}>
                        Bife (1ü•©) - +100% energia
                    </button>
                    
                    <h5>Receitas do Forno (3 lenhas):</h5>
                    <button class="control-btn" onclick="cookMeal('chicken')" 
                        ${totalRawChicken >= 1 && gameState.inventory.wood >= 3 ? '' : 'disabled'}>
                        Frango (1üçó) - +65% energia
                    </button>
                    <button class="control-btn" onclick="cookMeal('fish')" 
                        ${gameState.cookingFish && gameState.cookingFish.isActive ? 'disabled' : totalFish >= 1 && gameState.inventory.wood >= 3 ? '' : 'disabled'}>
                        ${gameState.cookingFish && gameState.cookingFish.isActive ? `Assando peixe... ${Math.ceil((30000 - (Date.now() - gameState.cookingFish.startTime)) / 1000)}s` : 'Peixe (1üêü) - +80% energia'}
                    </button>
                    <button class="control-btn" onclick="cookMeal('bread')" 
                        ${gameState.cookingBread && gameState.cookingBread.isActive ? 'disabled' : totalEgg >= 1 && gameState.inventory.milk >= 1 && gameState.inventory.flour >= 1 && gameState.inventory.wood >= 3 ? '' : 'disabled'}>
                        ${gameState.cookingBread && gameState.cookingBread.isActive ? `Fazendo p√£o... ${Math.ceil((60000 - (Date.now() - gameState.cookingBread.startTime)) / 1000)}s` : 'P√£o no Forno (1ü•ö + 1ü•õ + 1üåæ + 3ü™µ) - 1 min'}
                    </button>
                `;
                container.appendChild(stove);
            }
        }

        function cookMeal(mealType) {
            let woodCost = 2;
            let canCook = false;
            
            switch (mealType) {
                case 'tea':
                    if (gameState.inventory.herb >= 2 && gameState.water >= 1 && gameState.inventory.wood >= 2 && (!gameState.cookingTea || !gameState.cookingTea.isActive)) {
                        gameState.inventory.herb -= 2;
                        gameState.water -= 1;
                        gameState.inventory.wood -= 2;
                        gameState.cookingTea = {
                            isActive: true,
                            startTime: Date.now()
                        };
                        canCook = true;
                    }
                    break;
                case 'salad':
                    const totalTomato = (gameState.inventory.Tomate || 0) + getQuitandaAmount('Tomate');
                    const totalLettuce = (gameState.inventory.Alface || 0) + getQuitandaAmount('Alface');
                    const totalBroccoli = (gameState.inventory.Br√≥colis || 0) + getQuitandaAmount('Br√≥colis');
                    if (totalTomato >= 1 && totalLettuce >= 1 && totalBroccoli >= 1 && gameState.inventory.wood >= 2) {
                        consumeIngredient('Tomate', 1);
                        consumeIngredient('Alface', 1);
                        consumeIngredient('Br√≥colis', 1);
                        gameState.inventory.wood -= 2;
                        gameState.inventory.salad = (gameState.inventory.salad || 0) + 1;
                        canCook = true;
                    }
                    break;
                case 'stew':
                    const totalEgg = (gameState.inventory.egg || 0) + getQuitandaAmount('egg');
                    const totalPotato = (gameState.inventory.Batata || 0) + getQuitandaAmount('Batata');
                    const totalPumpkin = (gameState.inventory.Ab√≥bora || 0) + getQuitandaAmount('Ab√≥bora');
                    if (totalEgg >= 1 && totalPotato >= 1 && totalPumpkin >= 1 && gameState.inventory.wood >= 2) {
                        consumeIngredient('egg', 1);
                        consumeIngredient('Batata', 1);
                        consumeIngredient('Ab√≥bora', 1);
                        gameState.inventory.wood -= 2;
                        gameState.inventory.stew = (gameState.inventory.stew || 0) + 1;
                        canCook = true;
                    }
                    break;
                case 'steak':
                    const totalPork = (gameState.inventory.pork || 0) + getQuitandaAmount('pork');
                    if (totalPork >= 1 && gameState.inventory.wood >= 2) {
                        consumeIngredient('pork', 1);
                        gameState.inventory.wood -= 2;
                        gameState.inventory.steak = (gameState.inventory.steak || 0) + 1;
                        canCook = true;
                    }
                    break;
                case 'chicken':
                    woodCost = 3;
                    const totalRawChicken = (gameState.inventory.rawChicken || 0) + getQuitandaAmount('rawChicken');
                    if (totalRawChicken >= 1 && gameState.inventory.wood >= 3) {
                        consumeIngredient('rawChicken', 1);
                        gameState.inventory.wood -= 3;
                        gameState.inventory.cookedChicken = (gameState.inventory.cookedChicken || 0) + 1;
                        canCook = true;
                    }
                    break;
                case 'fish':
                    woodCost = 3;
                    const totalFish = (gameState.inventory.fish || 0) + getQuitandaAmount('fish');
                    if (totalFish >= 1 && gameState.inventory.wood >= 3 && (!gameState.cookingFish || !gameState.cookingFish.isActive)) {
                        consumeIngredient('fish', 1);
                        gameState.inventory.wood -= 3;
                        gameState.cookingFish = {
                            isActive: true,
                            startTime: Date.now()
                        };
                        canCook = true;
                    }
                    break;
                case 'bread':
                    woodCost = 3;
                    const totalEggForBread = (gameState.inventory.egg || 0) + getQuitandaAmount('egg');
                    if (totalEggForBread >= 1 && gameState.inventory.milk >= 1 && gameState.inventory.flour >= 1 && gameState.inventory.wood >= 3 && (!gameState.cookingBread || !gameState.cookingBread.isActive)) {
                        consumeIngredient('egg', 1);
                        gameState.inventory.milk -= 1;
                        gameState.inventory.flour -= 1;
                        gameState.inventory.wood -= 3;
                        gameState.cookingBread = {
                            isActive: true,
                            startTime: Date.now()
                        };
                        canCook = true;
                    }
                    break;
            }
            
            if (canCook) {
                updateDisplay();
                updateStove();
                updateBarn();
            }
        }

        function updateSeasonalStructures() {
            const seasonalArea = document.getElementById('flowerField');
            
            if (gameState.season === 0) {
                // Spring - Flower Field
                if (gameState.flowerField && gameState.flowerField.length > 0) {
                    seasonalArea.innerHTML = `
                        <div class="flower-field">
                            <h4>üå∏ Campo de Flores (Primavera)</h4>
                            <div class="flower-grid" id="flowerGrid"></div>
                        </div>
                    `;
                    
                    const flowerGrid = document.getElementById('flowerGrid');
                    const flowerEmojis = { rose: 'üåπ', sunflower: 'üåª', daisy: 'üåº' };
                    
                    gameState.flowerField.forEach((flower, index) => {
                        const flowerItem = document.createElement('div');
                        flowerItem.className = `flower-item ${flower.collected ? 'collected' : ''}`;
                        flowerItem.innerHTML = flower.collected ? 'üü´' : flowerEmojis[flower.type];
                        
                        if (!flower.collected) {
                            flowerItem.onclick = () => collectFlower(index);
                        }
                        
                        flowerGrid.appendChild(flowerItem);
                    });
                }
            } else if (gameState.season === 1) {
                // Summer - Producer Fair
                seasonalArea.innerHTML = `
                    <div class="flower-field">
                        <h4>üè™ Feira do Produtor (Ver√£o)</h4>
                        <div style="margin: 10px 0;">Exponha de 1 a 3 produtos por 50 moedas cada a cada 29 minutos!</div>
                        <div id="fairItems"></div>
                        <button class="control-btn" onclick="openFairDialog()" style="margin: 10px 0;">Gerenciar Feira</button>
                    </div>
                `;
                updateProducerFair();
            } else if (gameState.season === 2) {
                // Autumn - Craft Table
                seasonalArea.innerHTML = `
                    <div class="flower-field">
                        <h4>üî® Mesa de Craft (Outono)</h4>
                        <div class="craft-controls" style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="control-btn" onclick="craftItem('pearlNecklace')" 
                                ${gameState.craftTable.making || gameState.inventory.pearl < 6 ? 'disabled' : ''}>
                                Colar de P√©rolas (6 P√©rolas) - 10s
                            </button>
                            <button class="control-btn" onclick="craftItem('emeraldRing')" 
                                ${gameState.craftTable.making || gameState.inventory.emerald < 1 ? 'disabled' : ''}>
                                Anel de Esmeralda (1 Esmeralda) - 20s
                            </button>
                            <button class="control-btn" onclick="craftItem('flowerBouquet')" 
                                ${gameState.craftTable.making || gameState.inventory.rose < 1 || gameState.inventory.sunflower < 1 || gameState.inventory.daisy < 1 ? 'disabled' : ''}>
                                Buqu√™ de Flores (1üåπ + 1üåª + 1üåº) - 13s
                            </button>
                            <div>Status: ${gameState.craftTable.making ? `Fazendo ${gameState.craftTable.making}...` : 'Pronto'}</div>
                        </div>
                    </div>
                `;
            } else if (gameState.season === 3) {
                // Winter - Bonfire
                seasonalArea.innerHTML = `
                    <div class="flower-field">
                        <h4>üî• Fogueira (Inverno)</h4>
                        <div style="margin: 10px 0;">Necess√°ria para os animais produzirem no inverno!</div>
                        <div>Lenha: ${gameState.inventory.wood || 0} | Carv√£o: ${gameState.inventory.coal || 0}</div>
                        <button class="control-btn" onclick="lightBonfire()" 
                            ${gameState.bonfire.lit || gameState.inventory.wood < 4 || gameState.inventory.coal < 3 ? 'disabled' : ''}>
                            Acender Fogueira (4 Lenhas + 3 Carv√µes)
                        </button>
                        <div>Status: ${gameState.bonfire.lit ? 'Acesa üî•' : 'Apagada ‚ö´'}</div>
                        ${gameState.bonfire.lit ? `<div>Tempo restante: ${Math.ceil((3600000 - (Date.now() - gameState.bonfire.litTime)) / 60000)} min</div>` : ''}
                    </div>
                `;
            } else {
                seasonalArea.innerHTML = '';
            }
        }

        function updateLake() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('lakeStructure');
            if (existing) existing.remove();

            if (gameState.structures.lake) {
                const lake = document.createElement('div');
                lake.id = 'lakeStructure';
                lake.className = 'structure';
                lake.innerHTML = `
                    <h4>üèûÔ∏è Lago dos Peixes</h4>
                    <div class="lake-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        ${gameState.lake.map((fish, index) => `
                            <div class="fish-spot" style="width: 60px; height: 60px; border: 2px solid #4CAF50; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; background: ${fish.caught ? '#DDD' : '#E6F3FF'};" 
                                onclick="fishAtSpot(${index})" ${fish.caught ? 'style="cursor: not-allowed;"' : ''}>
                                ${fish.caught ? 'üü´' : 'üêü'}
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 10px; font-size: 12px;">
                        ${gameState.inventory.fishingRod > 0 ? 'Clique nos peixes para pescar!' : 'Voc√™ precisa de uma vara de pesca!'}
                    </div>
                `;
                container.appendChild(lake);
            }
        }

        function fishAtSpot(index) {
            if (gameState.inventory.fishingRod > 0 && !gameState.lake[index].caught && gameState.avatar.energy > 0 && !gameState.avatar.sick) {
                gameState.lake[index].caught = true;
                gameState.lake[index].regrowTime = Date.now() + 180000; // 3 minutes
                gameState.inventory.fish = (gameState.inventory.fish || 0) + 1;
                
                // Consume energy (more if sick)
                const energyCost = gameState.avatar.sick ? 3 : 1;
                gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                
                // Check for death
                if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                    gameOver();
                    return;
                }
                
                // Fishing rod durability
                gameState.fishingRodUses++;
                gameState.fishCaught++;
                
                // Pearl every 5 fish
                if (gameState.fishCaught % 5 === 0) {
                    gameState.inventory.pearl = (gameState.inventory.pearl || 0) + 1;
                    alert('Voc√™ encontrou uma p√©rola! ü¶™');
                }
                
                // Break fishing rod after 20 uses
                if (gameState.fishingRodUses >= 20) {
                    gameState.inventory.fishingRod = 0;
                    gameState.fishingRodUses = 0;
                    alert('Sua vara de pesca quebrou! Compre uma nova no mercadinho.');
                }
                
                updateDisplay();
                updateLake();
                updateQuitanda();
                createMarket();
            }
        }

        function updateMine() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('mineStructure');
            if (existing) existing.remove();

            if (gameState.structures.mine) {
                const mine = document.createElement('div');
                mine.id = 'mineStructure';
                mine.className = 'structure';
                mine.innerHTML = `
                    <h4>‚õèÔ∏è Mina</h4>
                    <div>Chaves dispon√≠veis: ${gameState.inventory.key || 0}</div>
                    <div class="mine-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px 0;">
                        ${gameState.mine.map((rock, index) => `
                            <div class="rock-spot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; background: ${rock.restTime > Date.now() ? '#DDD' : '#D2691E'};" 
                                onclick="mineRock(${index})" ${rock.restTime > Date.now() ? 'style="cursor: not-allowed;"' : ''}>
                                ${rock.restTime > Date.now() ? 'üò¥' : 'ü™®'}
                            </div>
                        `).join('')}
                    </div>
                    <div style="font-size: 12px;">
                        ${gameState.inventory.key > 0 ? 'Clique nas rochas para minerar! (3 cliques por rocha)' : 'Voc√™ precisa de uma chave para entrar na mina!'}
                    </div>
                    <div style="font-size: 11px; color: #666;">
                        Poss√≠veis recompensas: Esmeralda üíö, Rubi ‚ù§Ô∏è, Safira üíô, Carv√£o ‚ö´
                    </div>
                `;
                container.appendChild(mine);
            }
        }

        function mineRock(index) {
            if (gameState.inventory.key > 0 && gameState.inventory.pickaxe > 0 && gameState.mine[index].restTime <= Date.now() && gameState.avatar.energy > 0 && !gameState.avatar.sick) {
                // Use a key to enter mine
                if (gameState.mine[index].clicks === 0) {
                    gameState.inventory.key--;
                }
                
                gameState.mine[index].clicks++;
                gameState.inventory.pickaxe--; // Use pickaxe
                
                // Consume energy (more if sick)
                const energyCost = gameState.avatar.sick ? 3 : 1;
                gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                
                // Check for death
                if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                    gameOver();
                    return;
                }
                
                // Random gem drop
                const gems = ['emerald', 'ruby', 'sapphire', 'coal'];
                const randomGem = gems[Math.floor(Math.random() * gems.length)];
                gameState.inventory[randomGem] = (gameState.inventory[randomGem] || 0) + 1;
                
                // If rock has been hit 3 times, put it to rest
                if (gameState.mine[index].clicks >= 3) {
                    gameState.mine[index].clicks = 0;
                    gameState.mine[index].restTime = Date.now() + 180000; // 3 minutes
                }
                
                updateDisplay();
                updateMine();
                updateQuitanda();
                updateBarn();
            }
        }

        function collectFlower(index) {
            if (!gameState.flowerField[index].collected && gameState.avatar.energy > 0) {
                const flower = gameState.flowerField[index];
                flower.collected = true;
                flower.regrowTime = Date.now() + 180000; // 3 minutes
                
                gameState.inventory[flower.type]++;
                
                // Consume energy (more if sick)
                const energyCost = gameState.avatar.sick ? 3 : 1;
                gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                
                // Check for death
                if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                    gameOver();
                    return;
                }
                
                // Every 4 flowers collected, get herb
                const totalFlowersCollected = (gameState.inventory.rose || 0) + (gameState.inventory.sunflower || 0) + (gameState.inventory.daisy || 0);
                if (totalFlowersCollected % 4 === 0) {
                    gameState.inventory.herb++;
                }
                
                updateDisplay();
                updateSeasonalStructures();
                updateQuitanda();
            }
        }

        function openFairDialog() {
            const availableItems = Object.keys(gameState.inventory).filter(item => 
                gameState.inventory[item] > 0 && 
                (seeds[item] || quitandaItems[item])
            );
            
            if (availableItems.length === 0) {
                alert('Voc√™ n√£o tem produtos para expor na feira!');
                return;
            }
            
            const itemList = availableItems.map((item, i) => 
                `${i + 1}. ${seeds[item] ? seeds[item].emoji + ' ' + item : quitandaItems[item].emoji + ' ' + quitandaItems[item].name} (${gameState.inventory[item]})`
            ).join('\n');
            
            const choice = prompt(`Escolha at√© 3 itens para expor (digite os n√∫meros separados por v√≠rgula):\n${itemList}`);
            if (!choice) return;
            
            const indices = choice.split(',').map(n => parseInt(n.trim()) - 1).filter(i => i >= 0 && i < availableItems.length);
            
            if (indices.length > 3) {
                alert('Voc√™ pode expor no m√°ximo 3 itens!');
                return;
            }
            
            gameState.producerFair.items = [];
            indices.forEach(i => {
                const item = availableItems[i];
                if (gameState.inventory[item] > 0) {
                    gameState.inventory[item]--;
                    gameState.producerFair.items.push(item);
                }
            });
            
            gameState.producerFair.lastPayout = Date.now();
            updateDisplay();
            updateSeasonalStructures();
        }

        function updateProducerFair() {
            const fairItems = document.getElementById('fairItems');
            if (fairItems) {
                fairItems.innerHTML = gameState.producerFair.items.map(item => {
                    const display = seeds[item] ? seeds[item].emoji + ' ' + item : quitandaItems[item].emoji + ' ' + quitandaItems[item].name;
                    return `<div style="padding: 5px; background: #F0F8FF; margin: 2px 0; border-radius: 5px;">${display}</div>`;
                }).join('');
            }
        }

        function craftItem(itemType) {
            if (gameState.craftTable.making) return;
            
            let canCraft = false;
            let craftTime = 0;
            
            switch (itemType) {
                case 'pearlNecklace':
                    if (gameState.inventory.pearl >= 6) {
                        gameState.inventory.pearl -= 6;
                        craftTime = 10000;
                        canCraft = true;
                    }
                    break;
                case 'emeraldRing':
                    if (gameState.inventory.emerald >= 1) {
                        gameState.inventory.emerald -= 1;
                        craftTime = 20000;
                        canCraft = true;
                    }
                    break;
                case 'flowerBouquet':
                    if (gameState.inventory.rose >= 1 && gameState.inventory.sunflower >= 1 && gameState.inventory.daisy >= 1) {
                        gameState.inventory.rose -= 1;
                        gameState.inventory.sunflower -= 1;
                        gameState.inventory.daisy -= 1;
                        craftTime = 13000;
                        canCraft = true;
                    }
                    break;
            }
            
            if (canCraft) {
                gameState.craftTable.making = itemType;
                gameState.craftTable.startTime = Date.now();
                gameState.craftTable.craftTime = craftTime;
                updateDisplay();
                updateSeasonalStructures();
            }
        }

        function lightBonfire() {
            if (gameState.inventory.wood >= 4 && gameState.inventory.coal >= 3 && !gameState.bonfire.lit) {
                gameState.inventory.wood -= 4;
                gameState.inventory.coal -= 3;
                gameState.bonfire.lit = true;
                gameState.bonfire.litTime = Date.now();
                updateDisplay();
                updateSeasonalStructures();
            }
        }

        function feedHorse() {
            if (gameState.inventory.hay >= 2) {
                gameState.inventory.hay -= 2;
                gameState.horse.friendship = Math.min(gameState.horse.friendship + 5, 100);
                gameState.inventory.manure = (gameState.inventory.manure || 0) + 1;
                updateDisplay();
                updateHorseStable();
            }
        }

        function giveApple() {
            const canEatApple = !gameState.horse.lastApple || Date.now() - gameState.horse.lastApple >= 300000; // 5 minutes
            if (gameState.inventory.apple > 0 && canEatApple) {
                gameState.inventory.apple--;
                gameState.horse.friendship = Math.min(gameState.horse.friendship + 15, 100);
                gameState.horse.lastApple = Date.now();
                
                // Show hearts animation
                const horseStable = document.getElementById('horseStableStructure');
                const hearts = document.createElement('div');
                hearts.className = 'hearts';
                hearts.innerHTML = 'üíïüíïüíï';
                horseStable.appendChild(hearts);
                setTimeout(() => hearts.remove(), 1000);
                
                updateDisplay();
                updateHorseStable();
            } else if (!canEatApple) {
                alert('Duque s√≥ pode comer uma ma√ß√£ a cada 5 minutos!');
            }
        }

        function updateForest() {
            const container = document.getElementById('animalsContainer');
            const existing = document.getElementById('forestStructure');
            if (existing) existing.remove();

            if (gameState.structures.forest) {
                const forest = document.createElement('div');
                forest.id = 'forestStructure';
                forest.className = 'structure';
                forest.innerHTML = `
                    <h4>üå≥ Bosque</h4>
                    <div class="forest-grid">
                        <div class="tree-item" onclick="clickTree('trunk')">ü™µ</div>
                        <div class="tree-item" onclick="clickTree('apple')" ${gameState.forestTrees.apple.clicks >= 4 ? 'style="opacity:0.5"' : ''}>üçé</div>
                        <div class="tree-item" onclick="clickTree('orange')" ${gameState.forestTrees.orange.clicks >= 4 ? 'style="opacity:0.5"' : ''}>üçä</div>
                        <div class="tree-item" onclick="clickTree('banana')" ${gameState.forestTrees.banana.clicks >= 4 ? 'style="opacity:0.5"' : ''}>üçå</div>
                    </div>
                `;
                
                // Insert forest between lake and mine
                const mineStructure = document.getElementById('mineStructure');
                if (mineStructure) {
                    container.insertBefore(forest, mineStructure);
                } else {
                    container.appendChild(forest);
                }
            }
        }

        function clickTree(treeType) {
            if (gameState.avatar.energy <= 0 || gameState.avatar.sick) return;
            
            const tree = gameState.forestTrees[treeType];
            
            if (treeType === 'trunk') {
                if (gameState.inventory.axe > 0) {
                    gameState.inventory.trunk++;
                    gameState.inventory.axe--;
                    
                    // Consume energy (more if sick)
                    const energyCost = gameState.avatar.sick ? 3 : 1;
                    gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                    
                    // Check for death
                    if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                        gameOver();
                        return;
                    }
                    
                    tree.clicks++;
                    if (tree.clicks % 4 === 0) {
                        gameState.inventory.branch++;
                    }
                }
            } else {
                if (tree.clicks < 4) {
                    gameState.inventory[treeType]++;
                    
                    // Consume energy (more if sick)
                    const energyCost = gameState.avatar.sick ? 3 : 1;
                    gameState.avatar.energy = Math.max(0, gameState.avatar.energy - energyCost);
                    
                    // Check for death
                    if (gameState.avatar.energy === 0 && gameState.avatar.sick) {
                        gameOver();
                        return;
                    }
                    
                    tree.clicks++;
                }
            }
            
            updateDisplay();
            updateForest();
        }

        function updateComposter() {
            const container = document.getElementById('structuresRight');
            const existing = document.getElementById('composterStructure');
            if (existing) existing.remove();

            if (gameState.structures.composter) {
                const composter = document.createElement('div');
                composter.id = 'composterStructure';
                composter.className = 'structure';
                composter.innerHTML = `
                    <h4>‚ôªÔ∏è Composteira</h4>
                    <div>Flores: ${gameState.inventory.flower || 0}</div>
                    <div>Galhos: ${gameState.inventory.branch || 0}</div>
                    <div>Estercos: ${gameState.inventory.manure || 0}</div>
                    <div class="composter-controls">
                        <div>Receita: 1üå∏ + 1üåø + 2üí© = 8üçÇ</div>
                        <button class="control-btn" onclick="makeCompost()" 
                            ${gameState.makingCompost && gameState.makingCompost.isActive || !(gameState.inventory.flower >= 1 && gameState.inventory.branch >= 1 && gameState.inventory.manure >= 2) ? 'disabled' : ''}>
                            ${gameState.makingCompost && gameState.makingCompost.isActive ? `Fazendo adubo... ${Math.ceil((30000 - (Date.now() - gameState.makingCompost.startTime)) / 1000)}s` : 'Fazer Adubo'}
                        </button>
                        <div>Status: ${gameState.makingCompost && gameState.makingCompost.isActive ? 'Fazendo adubo...' : 'Pronto'}</div>
                    </div>
                `;
                container.appendChild(composter);
            }
        }

        function makeCompost() {
            if (gameState.inventory.flower >= 1 && gameState.inventory.branch >= 1 && gameState.inventory.manure >= 2 && (!gameState.makingCompost || !gameState.makingCompost.isActive)) {
                gameState.inventory.flower--;
                gameState.inventory.branch--;
                gameState.inventory.manure -= 2;
                gameState.makingCompost = {
                    isActive: true,
                    startTime: Date.now()
                };
                updateDisplay();
                updateComposter();
            }
        }

        function startRain() {
            if (gameState.isRaining) return;
            
            gameState.isRaining = true;
            document.body.classList.add('raining');
            
            gameState.plots.forEach(plot => {
                if (plot.state === 'planted') {
                    plot.state = 'watered';
                }
            });
            
            const rainOverlay = document.getElementById('rainOverlay');
            rainOverlay.classList.add('active');
            
            // Different precipitation for winter
            const precipitationType = gameState.season === 3 ? '‚ùÑÔ∏è' : 'üíß';
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const raindrop = document.createElement('div');
                    raindrop.className = 'raindrop';
                    raindrop.textContent = precipitationType;
                    raindrop.style.left = Math.random() * 100 + '%';
                    raindrop.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
                    rainOverlay.appendChild(raindrop);
                    
                    setTimeout(() => {
                        raindrop.remove();
                    }, 2000);
                }, i * 100);
            }
            
            updatePlotsDisplay();
            
            // Stop rain after 15 seconds
            setTimeout(() => {
                gameState.isRaining = false;
                document.body.classList.remove('raining');
                rainOverlay.classList.remove('active');
                gameState.lastRain = Date.now();
            }, 15000);
        }

        function rest() {
            // Can't rest when sick
            if (gameState.avatar.sick) {
                alert('Voc√™ n√£o pode descansar enquanto estiver doente! Tome ch√° para se curar primeiro.');
                return;
            }
            
            if (gameState.avatar.energy < gameState.avatar.maxEnergy) {
                // Start 5-minute rest timer
                const restTime = 5 * 60 * 1000; // 5 minutes in milliseconds
                const startTime = Date.now();
                
                // Mark avatar as resting
                gameState.avatar.resting = true;
                gameState.avatar.restStartTime = startTime;
                
                // Disable rest button during rest
                const restBtn = document.querySelector('button[onclick="rest()"]');
                restBtn.disabled = true;
                restBtn.textContent = 'üò¥ Descansando...';
                
                // Store rest interval globally so it can be interrupted
                gameState.restInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = elapsed / restTime;
                    
                    // Gradual energy recovery during rest
                    const energyGain = Math.floor((gameState.avatar.maxEnergy * 0.5) * progress);
                    const currentEnergy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + energyGain);
                    
                    // Update energy display gradually
                    const energyFill = document.getElementById('energyFill');
                    const energyText = document.getElementById('energyText');
                    const energyPercent = (currentEnergy / gameState.avatar.maxEnergy) * 100;
                    energyFill.style.width = energyPercent + '%';
                    energyText.textContent = `${currentEnergy}/${gameState.avatar.maxEnergy}`;
                    
                    if (progress >= 1) {
                        // Rest complete - recover 50% energy
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.5));
                        gameState.avatar.resting = false;
                        gameState.avatar.restStartTime = 0;
                        clearInterval(gameState.restInterval);
                        gameState.restInterval = null;
                        restBtn.disabled = false;
                        restBtn.textContent = 'üò¥ Descansar (5 min)';
                        updateAvatarDisplay();
                    }
                }, 1000);
            }
        }

        function openMeals() {
            // Interrupt rest if active
            if (gameState.restInterval) {
                clearInterval(gameState.restInterval);
                gameState.restInterval = null;
                const restBtn = document.querySelector('button[onclick="rest()"]');
                restBtn.disabled = false;
                restBtn.textContent = 'üò¥ Descansar (5 min)';
            }
            
            // If sick, only allow tea
            if (gameState.avatar.sick) {
                if (gameState.inventory.tea > 0) {
                    gameState.inventory.tea--;
                    gameState.avatar.sick = false;
                    gameState.avatar.sickTime = 0;
                    // Restore some energy when cured
                    gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + 50);
                    alert('Voc√™ tomou ch√° e se curou da doen√ßa!');
                    updateAvatarDisplay();
                    updateDisplay();
                } else {
                    alert('Voc√™ est√° doente e s√≥ pode tomar ch√°! Fa√ßa ch√° no fog√£o com 2 ervas.');
                }
                return;
            }
            
            const mealOptions = [];
            
            // Check available cooked meals
            if (gameState.inventory.tea > 0) mealOptions.push('Ch√° (cura doen√ßa)');
            if (gameState.inventory.salad > 0) mealOptions.push('Salada (+30% energia)');
            if (gameState.inventory.stew > 0) mealOptions.push('Ensopado (+50% energia)');
            if (gameState.inventory.steak > 0) mealOptions.push('Bife (+100% energia)');
            if (gameState.inventory.cookedChicken > 0) mealOptions.push('Frango (+65% energia)');
            if (gameState.inventory.cookedFish > 0) mealOptions.push('Peixe (+80% energia)');
            
            if (mealOptions.length === 0) {
                alert('Voc√™ n√£o tem refei√ß√µes prontas! Cozinhe algo no fog√£o primeiro.');
                return;
            }
            
            const choice = prompt(`Escolha uma refei√ß√£o:\n${mealOptions.map((meal, i) => `${i + 1}. ${meal}`).join('\n')}\n\nDigite o n√∫mero:`);
            const index = parseInt(choice) - 1;
            
            if (index >= 0 && index < mealOptions.length) {
                const meal = mealOptions[index];
                
                if (meal.includes('Ch√°')) {
                    gameState.inventory.tea--;
                    gameState.avatar.sick = false;
                    gameState.avatar.sickTime = 0;
                    alert('Voc√™ se curou da doen√ßa!');
                } else if (meal.includes('Salada')) {
                    gameState.inventory.salad--;
                    gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.3));
                } else if (meal.includes('Ensopado')) {
                    gameState.inventory.stew--;
                    gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.5));
                } else if (meal.includes('Bife')) {
                    gameState.inventory.steak--;
                    gameState.avatar.energy = gameState.avatar.maxEnergy;
                } else if (meal.includes('Frango')) {
                    gameState.inventory.cookedChicken--;
                    gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.65));
                } else if (meal.includes('Peixe')) {
                    gameState.inventory.cookedFish--;
                    gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.8));
                }
                
                updateAvatarDisplay();
                updateDisplay();
            }
        }

        function updateAvatarDisplay() {
            const energyFill = document.getElementById('energyFill');
            const energyText = document.getElementById('energyText');
            const avatarPanel = document.getElementById('avatarPanel');
            
            const energyPercent = (gameState.avatar.energy / gameState.avatar.maxEnergy) * 100;
            energyFill.style.width = energyPercent + '%';
            energyText.textContent = `${gameState.avatar.energy}/${gameState.avatar.maxEnergy}`;
            
            if (gameState.avatar.sick) {
                avatarPanel.classList.add('avatar-sick');
            } else {
                avatarPanel.classList.remove('avatar-sick');
            }
        }

        function gameOver() {
            alert('üíÄ GAME OVER! Voc√™ morreu de exaust√£o! O jogo ser√° reiniciado.');
            localStorage.removeItem('realFarmSave');
            location.reload();
        }

        function startGameLoop() {
            setInterval(() => {
                gameState.seasonTimeLeft--;
                if (gameState.seasonTimeLeft <= 0) {
                    gameState.season = (gameState.season + 1) % 4;
                    gameState.seasonTimeLeft = 7200;
                    
                    // Initialize flower field for Spring
                    if (gameState.season === 0) {
                        initializeFlowerField();
                    }
                }
                
                if (Date.now() - gameState.lastRain > 1200000 && !gameState.isRaining) {
                    startRain();
                }
                
                gameState.plots.forEach(plot => {
                    if (plot.state === 'watered' && plot.plantTime > 0) {
                        const elapsed = Date.now() - plot.plantTime;
                        if (elapsed >= 30000) {
                            plot.state = 'ready';
                        }
                    }
                });

                if (gameState.structures.grassField) {
                    gameState.grassField.forEach(grass => {
                        if (grass.collected && Date.now() >= grass.regrowTime) {
                            grass.collected = false;
                        }
                    });
                }

                // Animal sickness system
                const allAnimals = [
                    { array: gameState.cows, type: 'cow' },
                    { array: gameState.chickens, type: 'chicken' },
                    { array: gameState.pigs, type: 'pig' },
                    { array: gameState.sheep, type: 'sheep' }
                ];

                allAnimals.forEach(({ array, type }) => {
                    array.forEach((animal, index) => {
                        // Random sickness (0.1% chance per second - much less frequent)
                        if (!animal.sick && Math.random() < 0.001) {
                            animal.sick = true;
                            animal.sickTime = Date.now();
                            animal.deathTime = Date.now() + 1200000; // 20 minutes
                        }
                        
                        // Check for death
                        if (animal.sick && Date.now() >= animal.deathTime) {
                            array.splice(index, 1);
                            alert(`Um ${type === 'cow' ? 'vaca' : type === 'chicken' ? 'galinha' : type === 'pig' ? 'porco' : 'ovelha'} morreu por falta de vacina!`);
                        }
                    });
                });

                // Flower field regrowth
                if (gameState.season === 0 && gameState.flowerField) {
                    gameState.flowerField.forEach(flower => {
                        if (flower.collected && Date.now() >= flower.regrowTime) {
                            flower.collected = false;
                        }
                    });
                }

                // Check cow eating completion
                gameState.cows.forEach(cow => {
                    if (cow.eating && Date.now() >= cow.eatTime) {
                        cow.eating = false;
                        cow.milking = true;
                        cow.milkTime = Date.now(); // Ready to milk immediately after eating
                    }
                });

                // Update all production timers
                if (gameState.dryingGrass.isActive && Date.now() - gameState.dryingGrass.startTime >= 30000) {
                    gameState.inventory.driedGrass += gameState.dryingGrass.amount;
                    gameState.dryingGrass.isActive = false;
                }

                if (gameState.makingHay.isActive && Date.now() - gameState.makingHay.startTime >= 15000) {
                    gameState.inventory.hay++;
                    gameState.makingHay.isActive = false;
                }

                if (gameState.cuttingWood.isActive && Date.now() - gameState.cuttingWood.startTime >= 7000) {
                    gameState.inventory.wood += 4;
                    gameState.cuttingWood.isActive = false;
                }

                if (gameState.makingChickenFeed.isActive && Date.now() - gameState.makingChickenFeed.startTime >= 10000) {
                    gameState.inventory.chickenFeed++;
                    gameState.makingChickenFeed.isActive = false;
                }

                if (gameState.makingPigFeed.isActive && Date.now() - gameState.makingPigFeed.startTime >= 10000) {
                    gameState.inventory.pigFeed++;
                    gameState.makingPigFeed.isActive = false;
                }

                if (gameState.spinning.isActive && Date.now() - gameState.spinning.startTime >= 30000) {
                    gameState.inventory.yarn++;
                    gameState.spinning.isActive = false;
                }

                // New production machine timers
                if (gameState.makingCheese.isActive && Date.now() - gameState.makingCheese.startTime >= 60000) {
                    gameState.inventory.cheese++;
                    gameState.makingCheese.isActive = false;
                    updateQuitanda();
                }

                if (gameState.makingFlour.isActive && Date.now() - gameState.makingFlour.startTime >= 60000) {
                    gameState.inventory.flour++;
                    gameState.makingFlour.isActive = false;
                }

                if (gameState.roastingCoffee.isActive && Date.now() - gameState.roastingCoffee.startTime >= 30000) {
                    gameState.inventory.coffeeRoasted++;
                    gameState.roastingCoffee.isActive = false;
                }

                if (gameState.makingJuice.isActive && Date.now() - gameState.makingJuice.startTime >= 15000) {
                    gameState.inventory.grapeJuice++;
                    gameState.makingJuice.isActive = false;
                }

                // Compost timer
                if (gameState.makingCompost && gameState.makingCompost.isActive && Date.now() - gameState.makingCompost.startTime >= 30000) {
                    gameState.fertilizer += 8;
                    gameState.makingCompost.isActive = false;
                }

                // Tea cooking timer
                if (gameState.cookingTea.isActive && Date.now() - gameState.cookingTea.startTime >= 10000) {
                    gameState.inventory.tea = (gameState.inventory.tea || 0) + 1;
                    gameState.cookingTea.isActive = false;
                }

                // Fish cooking timer (30 seconds)
                if (gameState.cookingFish && gameState.cookingFish.isActive && Date.now() - gameState.cookingFish.startTime >= 30000) {
                    gameState.inventory.cookedFish = (gameState.inventory.cookedFish || 0) + 1;
                    gameState.cookingFish.isActive = false;
                }

                // Bread cooking timer (1 minute)
                if (gameState.cookingBread && gameState.cookingBread.isActive && Date.now() - gameState.cookingBread.startTime >= 60000) {
                    gameState.inventory.bread = (gameState.inventory.bread || 0) + 1;
                    gameState.cookingBread.isActive = false;
                }

                // Avatar sickness system
                if (!gameState.avatar.sick) {
                    // First sickness after 15 minutes
                    if (gameState.avatar.firstSicknessTime && Date.now() >= gameState.avatar.firstSicknessTime) {
                        gameState.avatar.sick = true;
                        gameState.avatar.sickTime = Date.now();
                        gameState.avatar.firstSicknessTime = null; // Remove first sickness timer
                        alert('Voc√™ ficou doente! Sua energia se recarrega automaticamente, mas voc√™ n√£o pode trabalhar. Fa√ßa um ch√° com ervas para se curar.');
                    }
                    // Random sickness after first one (0.01% chance per second - much less frequent)
                    else if (!gameState.avatar.firstSicknessTime && Math.random() < 0.0001) {
                        gameState.avatar.sick = true;
                        gameState.avatar.sickTime = Date.now();
                        alert('Voc√™ ficou doente! Sua energia se recarrega automaticamente, mas voc√™ n√£o pode trabalhar. Fa√ßa um ch√° com ervas para se curar.');
                    }
                }

                // Energy drain when sick (every 2 seconds)
                if (gameState.avatar.sick && Date.now() - gameState.avatar.sickTime > 2000) {
                    gameState.avatar.energy = Math.max(0, gameState.avatar.energy - 1);
                    gameState.avatar.sickTime = Date.now(); // Reset timer
                    
                    // Check for death when energy reaches 0
                    if (gameState.avatar.energy === 0) {
                        gameOver();
                        return;
                    }
                }

                // Lake fish respawn
                gameState.lake.forEach(fish => {
                    if (fish.caught && Date.now() >= fish.regrowTime) {
                        fish.caught = false;
                    }
                });

                // Mine rock rest recovery
                gameState.mine.forEach(rock => {
                    if (rock.restTime > 0 && Date.now() >= rock.restTime) {
                        rock.restTime = 0;
                    }
                });

                // Update forest tree resets
                ['apple', 'orange', 'banana'].forEach(treeType => {
                    const tree = gameState.forestTrees[treeType];
                    if (tree.clicks >= 4 && Date.now() - tree.lastReset >= 300000) {
                        tree.clicks = 0;
                        tree.lastReset = Date.now();
                    }
                });

                // Update chicken growth
                gameState.chickens.forEach(chicken => {
                    if (chicken.isChick && Date.now() >= chicken.growTime) {
                        chicken.isChick = false;
                        chicken.growTime = 0;
                    }
                });

                // Producer Fair payouts (Summer)
                if (gameState.season === 1 && gameState.producerFair.items.length > 0) {
                    if (Date.now() - gameState.producerFair.lastPayout >= 1740000) { // 29 minutes
                        const payout = gameState.producerFair.items.length * 50;
                        gameState.coins += payout;
                        gameState.producerFair.lastPayout = Date.now();
                        alert(`Feira do Produtor: Voc√™ recebeu ${payout} moedas pelos seus produtos expostos!`);
                    }
                }

                // Craft Table completion (Autumn)
                if (gameState.season === 2 && gameState.craftTable.making) {
                    const elapsed = Date.now() - gameState.craftTable.startTime;
                    let craftTime = 0;
                    
                    switch (gameState.craftTable.making) {
                        case 'pearlNecklace': craftTime = 10000; break;
                        case 'emeraldRing': craftTime = 20000; break;
                        case 'flowerBouquet': craftTime = 13000; break;
                    }
                    
                    if (elapsed >= craftTime) {
                        gameState.inventory[gameState.craftTable.making]++;
                        gameState.craftTable.making = null;
                        gameState.craftTable.startTime = 0;
                    }
                }

                // Bonfire timer (Winter)
                if (gameState.season === 3 && gameState.bonfire.lit) {
                    if (Date.now() - gameState.bonfire.litTime >= 3600000) { // 1 hour
                        gameState.bonfire.lit = false;
                        gameState.bonfire.litTime = 0;
                        alert('üî• A fogueira apagou! Os animais n√£o v√£o produzir at√© voc√™ acend√™-la novamente.');
                    }
                }

                // Greenhouse plots (Winter)
                if (gameState.season === 3 && gameState.structures.greenhouse) {
                    gameState.greenhousePlots.forEach(plot => {
                        if (plot.state === 'watered' && plot.plantTime > 0) {
                            const elapsed = Date.now() - plot.plantTime;
                            if (elapsed >= 30000) {
                                plot.state = 'ready';
                            }
                        }
                    });
                }

                // Winter clothing reset at season change
                if (gameState.season !== 3) {
                    if (gameState.dog.hasWarmClothes) {
                        gameState.dog.hasWarmClothes = false;
                    }
                    if (gameState.horse.hasWarmClothes) {
                        gameState.horse.hasWarmClothes = false;
                    }
                }

                // Mailbox messages
                // Newspaper every 20 minutes (1200000ms)
                if (Date.now() - gameState.mailbox.lastNewspaper >= 1200000) {
                    addNewspaper();
                }

                // Random motivational messages (every 5-15 minutes)
                const timeSinceLastMotivational = Date.now() - gameState.mailbox.lastMotivationalMessage;
                const randomInterval = 300000 + Math.random() * 600000; // 5-15 minutes
                if (timeSinceLastMotivational >= randomInterval) {
                    addMotivationalMessage();
                }
                
                updateDisplay();
                updatePlotsDisplay();
                updateAllStructures();
                updateAvatarDisplay();
            }, 1000);
            
            setInterval(() => {
                saveGame();
            }, 10000);
        }

        function saveGame() {
            localStorage.setItem('realFarmSave', JSON.stringify(gameState));
            
            const saveBtn = document.querySelector('.save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '‚úÖ Salvo!';
            saveBtn.style.background = '#4CAF50';
            
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = '#4CAF50';
            }, 1000);
        }

        function loadGame() {
            const saved = localStorage.getItem('realFarmSave');
            if (saved) {
                const loadedState = JSON.parse(saved);
                gameState = { ...gameState, ...loadedState };
                
                if (!gameState.plots || gameState.plots.length < 8) {
                    gameState.plots = [];
                    for (let i = 0; i < 8; i++) {
                        gameState.plots[i] = { state: 'empty', seed: null, plantTime: 0, progress: 0 };
                    }
                }
                
                if (!gameState.inventory) {
                    gameState.inventory = {};
                }
            }
        }

        window.onload = initGame;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a9f6f765b80094',t:'MTc1NDQzNTM5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
