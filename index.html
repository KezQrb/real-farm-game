<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Farm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            transition: background 0.5s ease;
        }
        
        body.raining {
            background: linear-gradient(135deg, #696969 0%, #808080 100%);
        }
        
        body.snowing {
            background: linear-gradient(135deg, #e6f3ff 0%, #b3d9ff 100%);
        }
        
        .header {
            background: rgba(139, 69, 19, 0.9);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .resources {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .resource {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .season-info {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .quitanda-center {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .farm-area {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .plot {
            width: 80px;
            height: 80px;
            border: 3px solid #8B4513;
            border-radius: 10px;
            background: #DEB887;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .plot:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .plot.fertilized {
            background: #8B4513;
        }
        
        .plot.planted {
            background: #228B22;
        }
        
        .plot.watered {
            background: #4169E1;
        }
        
        .plot.ready {
            background: #FFD700;
            animation: glow 1s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #FFD700; }
            to { box-shadow: 0 0 20px #FFD700; }
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .panel h3 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 5px;
        }
        
        .seeds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .seed-btn {
            background: #90EE90;
            border: 2px solid #228B22;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .seed-btn:hover {
            background: #7CFC00;
            transform: scale(1.05);
        }
        
        .seed-btn.selected {
            background: #FFD700;
            border-color: #FFA500;
        }
        
        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .inventory-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateX(8px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .quitanda-section {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #ddd;
        }

        .quitanda-items {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .sell-all-btn {
            background: #FF6347;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .sell-all-btn:hover {
            background: #FF4500;
            transform: scale(1.02);
        }
        
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: #E6F3FF;
            border-radius: 10px;
            border: 2px solid #4169E1;
        }
        
        .buy-btn {
            background: #4169E1;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .buy-btn:hover {
            background: #1E90FF;
            transform: scale(1.05);
        }
        
        .rain-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .raindrop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, #4169E1);
            animation: fall linear infinite;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 20px;
            animation: snowfall linear infinite;
        }
        
        @keyframes fall {
            from {
                transform: translateY(-100vh);
            }
            to {
                transform: translateY(100vh);
            }
        }
        
        @keyframes snowfall {
            from {
                transform: translateY(-100vh) rotate(0deg);
            }
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .well {
            width: 80px;
            height: 80px;
            background: #4169E1;
            border: 3px solid #1E90FF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            margin: 20px auto;
            transition: all 0.3s ease;
        }
        
        .well:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(65, 105, 225, 0.5);
        }
        
        .pet-house {
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .pet-info {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .friendship-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .friendship-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f);
            transition: width 0.5s ease;
        }
        
        .feed-btn {
            background: #FF6347;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .feed-btn:hover {
            background: #FF4500;
            transform: scale(1.05);
        }
        
        .feed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .orders-panel {
            background: #E6F3FF;
            border: 2px solid #4169E1;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .order-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .order-buttons {
            display: flex;
            gap: 5px;
        }
        
        .accept-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .reject-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .animal-structure {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .animal-structure h4 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .animals-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .flowers-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .animal-slot {
            width: 60px;
            height: 60px;
            border: 2px solid #8B4513;
            border-radius: 10px;
            background: #F5DEB3;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .animal-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .animal-slot.sick {
            background: #FFB6C1;
            animation: shake 0.5s ease-in-out infinite alternate;
        }

        .animal-slot.eating {
            background: #90EE90;
        }

        .animal-slot.resting {
            background: #DDA0DD;
        }

        @keyframes shake {
            from { transform: translateX(-2px); }
            to { transform: translateX(2px); }
        }

        .flower-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #228B22;
            border-radius: 15px;
            background: #98FB98;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .flower-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .flower-slot.empty {
            background: #DEB887;
            cursor: not-allowed;
        }

        .grass-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .grass-slot {
            width: 50px;
            height: 50px;
            border: 2px solid #228B22;
            border-radius: 10px;
            background: #90EE90;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .grass-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .grass-slot.empty {
            background: #DEB887;
            cursor: not-allowed;
        }

        .trees-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .tree-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #8B4513;
            border-radius: 15px;
            background: #228B22;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tree-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tree-count {
            font-size: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            padding: 2px 6px;
            margin-top: 2px;
        }

        .fish-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .fish-slot {
            width: 60px;
            height: 60px;
            border: 2px solid #4169E1;
            border-radius: 50%;
            background: #87CEEB;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fish-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(65, 105, 225, 0.5);
        }

        .fish-slot.empty {
            background: #B0C4DE;
            cursor: not-allowed;
        }

        .rocks-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .rock-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #696969;
            border-radius: 15px;
            background: #A9A9A9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .rock-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .rock-slot.resting {
            background: #808080;
            cursor: not-allowed;
        }

        .rock-hits {
            font-size: 10px;
            background: rgba(255,255,255,0.8);
            border-radius: 8px;
            padding: 1px 4px;
            margin-top: 2px;
        }

        .ingredient-slot {
            width: 50px;
            height: 50px;
            border: 2px solid #8B4513;
            border-radius: 8px;
            background: #F5DEB3;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .ingredient-slot:hover {
            background: #DEB887;
            transform: scale(1.05);
        }

        .ingredient-slot.filled {
            background: #90EE90;
            border-color: #228B22;
        }

        .craft-item {
            background: rgba(255,255,255,0.9);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .craft-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            background: rgba(255,255,255,1);
        }

        .craft-item.working {
            background: rgba(255,215,0,0.3);
            cursor: not-allowed;
        }

        .craft-emoji {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .craft-name {
            font-weight: bold;
            color: #8B4513;
            font-size: 14px;
        }

        .craft-recipe {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .craft-time {
            font-size: 11px;
            color: #999;
            font-style: italic;
        }

        .tool-status {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .tool-status.broken {
            background: rgba(255,0,0,0.1);
            color: #cc0000;
        }

        .mailbox {
            position: relative;
            background: #dc143c;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            margin-left: 20px;
        }

        .mailbox:hover {
            background: #b91c3c;
            transform: scale(1.05);
        }

        .mail-alert {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ffd700;
            color: #dc143c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            animation: pulse 1s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        .telephone {
            background: #2c2c2c;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            margin-right: 20px;
        }

        .telephone:hover {
            background: #1a1a1a;
            transform: scale(1.05);
        }

        .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-left: 20px;
        }

        .avatar {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            min-width: 120px;
        }

        .avatar-emoji {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .avatar.sick .avatar-emoji {
            animation: sickPulse 1s ease-in-out infinite alternate;
        }

        @keyframes sickPulse {
            from { 
                filter: hue-rotate(0deg);
                transform: scale(1);
            }
            to { 
                filter: hue-rotate(180deg);
                transform: scale(1.1);
            }
        }

        .avatar-name {
            color: white;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .energy-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 3px;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #44ff44);
            transition: width 0.5s ease;
        }

        .energy-text {
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .avatar-buttons {
            display: flex;
            gap: 5px;
        }

        .avatar-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .avatar-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .avatar-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .bees-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .bee-slot {
            width: 60px;
            height: 60px;
            border: 2px solid #ffd700;
            border-radius: 50%;
            background: #fff8dc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bee-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.5);
        }

        .bee-slot.ready {
            background: #ffd700;
            animation: honeyGlow 1s ease-in-out infinite alternate;
        }

        @keyframes honeyGlow {
            from { box-shadow: 0 0 5px #ffd700; }
            to { box-shadow: 0 0 20px #ffd700; }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .mail-item {
            background: #f0f8ff;
            border: 1px solid #4169e1;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .mail-header {
            font-weight: bold;
            color: #4169e1;
            margin-bottom: 10px;
        }

        .food-menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .food-item {
            background: #f0f8ff;
            border: 2px solid #4169e1;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .food-item:hover {
            background: #e6f3ff;
            transform: scale(1.05);
        }

        .food-item.disabled {
            background: #f5f5f5;
            border-color: #ccc;
            color: #999;
            cursor: not-allowed;
        }

        .machines-sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .machine {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            display: none;
        }

        .machine h4 {
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .machine-status {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 8px;
            margin: 8px 0;
            font-size: 14px;
        }

        .machine-status.working {
            background: #fff3cd;
            color: #856404;
        }

        .machine-status.ready {
            background: #d4edda;
            color: #155724;
            animation: pulse 1s ease-in-out infinite alternate;
        }

        .machine-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .machine-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .machine-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .recipe-info {
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            padding: 6px;
            margin: 6px 0;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .farm-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .resources {
                justify-content: center;
            }
            
            .machines-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="game-title">üöú Real Farm</div>
        
        <!-- Mailbox -->
        <div class="mailbox" id="mailbox" onclick="openMailbox()">
            üìÆ
            <span id="mailAlert" class="mail-alert" style="display: none;">!</span>
        </div>
        
        <div class="resources">
            <div class="resource">üí∞ <span id="coins">200</span></div>
            <div class="resource">ü™£ <span id="water">10</span></div>
            <div class="resource">üçÇ <span id="fertilizer">50</span></div>
            <div class="season-info">
                <span id="season">Primavera</span> - <span id="timer">60:00</span>
            </div>
            <button class="save-btn" onclick="saveGame()">üíæ Salvar</button>
        </div>
        
        <!-- Telephone -->
        <div class="telephone" id="telephone" onclick="usePhone()" style="display: none;">
            ‚òéÔ∏è
        </div>
        
        <!-- Avatar -->
        <div class="avatar-container">
            <div class="avatar" id="avatar">
                <div class="avatar-emoji" id="avatarEmoji">üë®‚Äçüåæ</div>
                <div class="avatar-name">Voc√™</div>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
                <div class="energy-text"><span id="energy">200</span>/200</div>
            </div>
            <div class="avatar-buttons">
                <button class="avatar-btn" onclick="restAvatar()" id="restBtn">üò¥ Descansar 5min</button>
                <button class="avatar-btn" onclick="openFoodMenu()" id="eatBtn">üçΩÔ∏è Comer</button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="panel">
                <h3>üå± Sementes</h3>
                <div class="seeds-grid" id="seedsGrid"></div>
            </div>

            <div class="panel">
                <h3>üèöÔ∏è Celeiro</h3>
                <div id="barn">
                    <div id="barnItems"></div>
                </div>
            </div>

            <div class="panel">
                <h3>üè¨ Mercadinho</h3>
                <div id="shop" style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    <!-- 1. Po√ßo de √Ågua -->
                    <div class="shop-item" id="wellShop" style="display: block;">
                        <span>üèóÔ∏è Po√ßo de √Ågua</span>
                        <button class="buy-btn" onclick="buyWell()">50üí∞</button>
                    </div>
                    
                    <!-- 2. Vara de Pesca -->
                    <div class="shop-item" id="fishingRodShop">
                        <span>üé£ Vara de Pesca</span>
                        <button class="buy-btn" onclick="buyFishingRod()">60üí∞</button>
                    </div>
                    
                    <!-- 3. Machado + Cortar Lenha -->
                    <div class="shop-item" id="axeAndWoodCutterShop">
                        <span>ü™ì Machado + Cortar Lenha</span>
                        <button class="buy-btn" onclick="buyAxeAndWoodCutter()">150üí∞</button>
                    </div>
                    
                    <!-- 4. Bosque -->
                    <div class="shop-item" id="forestShop">
                        <span>üå≥ Bosque</span>
                        <button class="buy-btn" onclick="buyForest()">300üí∞</button>
                    </div>
                    
                    <!-- 5. Fog√£o -->
                    <div class="shop-item" id="stoveShop">
                        <span>üî• Fog√£o com Forno</span>
                        <button class="buy-btn" onclick="buyStove()">250üí∞</button>
                    </div>
                    
                    <!-- 6. Campo de Grama -->
                    <div class="shop-item" id="grassFieldShop">
                        <span>üå± Campo de Grama</span>
                        <button class="buy-btn" onclick="buyGrassField()">75üí∞</button>
                    </div>
                    
                    <!-- 7. Secador de Grama -->
                    <div class="shop-item" id="grassDryerShop">
                        <span>üåæ Secador de Grama</span>
                        <button class="buy-btn" onclick="buyGrassDryer()">150üí∞</button>
                    </div>
                    
                    <!-- 8. Pasto de Vacas -->
                    <div class="shop-item" id="cowPastureShop">
                        <span>üêÑ Pasto de Vacas</span>
                        <button class="buy-btn" onclick="buyCowPasture()">200üí∞</button>
                    </div>
                    
                    <!-- 9. Vacas -->
                    <div class="shop-item" id="cowShop" style="display: none;">
                        <span>üêÑ Vaca</span>
                        <button class="buy-btn" onclick="buyCow()">95üí∞</button>
                    </div>
                    
                    <!-- 10. Composteira -->
                    <div class="shop-item" id="composterShop">
                        <span>üóëÔ∏è Composteira</span>
                        <button class="buy-btn" onclick="buyComposter()">180üí∞</button>
                    </div>
                    
                    <!-- 11. Colmeia -->
                    <div class="shop-item" id="beehiveShop">
                        <span>üçØ Colmeia</span>
                        <button class="buy-btn" onclick="buyBeehive()">120üí∞</button>
                    </div>
                    
                    <!-- Sementes de Flores para Colmeia -->
                    <div class="shop-item" id="tulipSeedShop" style="display: none;">
                        <span>üå∑ Semente de Tulipa</span>
                        <button class="buy-btn" onclick="buyFlowerSeed('tulipa')">15üí∞</button>
                    </div>
                    <div class="shop-item" id="lilySeedShop" style="display: none;">
                        <span>üå∫ Semente de L√≠rio</span>
                        <button class="buy-btn" onclick="buyFlowerSeed('lirio')">15üí∞</button>
                    </div>
                    <div class="shop-item" id="sakuraSeedShop" style="display: none;">
                        <span>üå∏ Semente de Sakura</span>
                        <button class="buy-btn" onclick="buyFlowerSeed('sakura')">15üí∞</button>
                    </div>
                    
                    <!-- 12. Misturador -->
                    <div class="shop-item" id="mixerShop">
                        <span>ü•£ Misturador</span>
                        <button class="buy-btn" onclick="buyMixer()">90üí∞</button>
                    </div>
                    
                    <!-- 13. Galinheiro -->
                    <div class="shop-item" id="chickenCoopShop">
                        <span>üêî Galinheiro</span>
                        <button class="buy-btn" onclick="buyChickenCoop()">80üí∞</button>
                    </div>
                    
                    <!-- 14. Galinhas -->
                    <div class="shop-item" id="chickenShop" style="display: none;">
                        <span>üêî Galinha</span>
                        <button class="buy-btn" onclick="buyChicken()">25üí∞</button>
                    </div>
                    
                    <!-- 15. Chiqueiro -->
                    <div class="shop-item" id="pigPenShop">
                        <span>üê∑ Chiqueiro</span>
                        <button class="buy-btn" onclick="buyPigPen()">130üí∞</button>
                    </div>
                    
                    <!-- 16. Porcos -->
                    <div class="shop-item" id="pigShop" style="display: none;">
                        <span>üê∑ Porco</span>
                        <button class="buy-btn" onclick="buyPig()">100üí∞</button>
                    </div>
                    
                    <!-- 17. Curral das Ovelhas -->
                    <div class="shop-item" id="sheepPenShop">
                        <span>üêë Curral das Ovelhas</span>
                        <button class="buy-btn" onclick="buySheepPen()">150üí∞</button>
                    </div>
                    
                    <!-- 18. Ovelhas -->
                    <div class="shop-item" id="sheepShop" style="display: none;">
                        <span>üêë Ovelha</span>
                        <button class="buy-btn" onclick="buySheep()">120üí∞</button>
                    </div>
                    <div class="shop-item" id="shearsShop" style="display: none;">
                        <span>‚úÇÔ∏è Tesoura de Tosquiar</span>
                        <button class="buy-btn" onclick="buyShears()">35üí∞</button>
                    </div>
                    
                    <!-- 19. Torra de Caf√© -->
                    <div class="shop-item" id="coffeeRoasterShop">
                        <span>‚òï Torra de Caf√©</span>
                        <button class="buy-btn" onclick="buyCoffeeRoaster()">250üí∞</button>
                    </div>
                    
                    <!-- 20. M√°quina de Suco -->
                    <div class="shop-item" id="juiceMachineShop">
                        <span>üßÉ M√°quina de Suco</span>
                        <button class="buy-btn" onclick="buyJuiceMachine()">120üí∞</button>
                    </div>
                    
                    <!-- 21. Queijeira -->
                    <div class="shop-item" id="cheeseMakerShop">
                        <span>üßÄ Queijeira</span>
                        <button class="buy-btn" onclick="buyCheeseMaker()">160üí∞</button>
                    </div>
                    
                    <!-- 22. M√°quina de Fiar -->
                    <div class="shop-item" id="spinningMachineShop">
                        <span>üß∂ M√°quina de Fiar</span>
                        <button class="buy-btn" onclick="buySpinningMachine()">140üí∞</button>
                    </div>
                    
                    <!-- 23. Moinho -->
                    <div class="shop-item" id="millShop">
                        <span>üåæ Moinho</span>
                        <button class="buy-btn" onclick="buyMill()">200üí∞</button>
                    </div>
                    
                    <!-- 24. Vacina -->
                    <div class="shop-item" id="vaccineShop">
                        <span>üíâ Vacina</span>
                        <button class="buy-btn" onclick="buyVaccine()">40üí∞</button>
                    </div>
                    
                    <!-- 25. Ra√ß√£o para Cachorro -->
                    <div class="shop-item" id="dogFoodShop">
                        <span>ü•© Ra√ß√£o para Cachorro</span>
                        <button class="buy-btn" onclick="buyDogFood()">30üí∞</button>
                    </div>
                    
                    <!-- 26. Casinha da Mocinha -->
                    <div class="shop-item" id="dogHouseShop">
                        <span>üè† Casinha do Cachorro</span>
                        <button class="buy-btn" onclick="buyDogHouse()">200üí∞</button>
                    </div>
                    
                    <!-- 27. Picareta -->
                    <div class="shop-item" id="pickaxeShop">
                        <span>‚õèÔ∏è Picareta</span>
                        <button class="buy-btn" onclick="buyPickaxe()">80üí∞</button>
                    </div>
                    
                    <!-- 28. Baia do Duque -->
                    <div class="shop-item" id="horseStableShop">
                        <span>üèá Baia para Cavalos</span>
                        <button class="buy-btn" onclick="buyHorseStable()">1000üí∞</button>
                    </div>
                    
                    <!-- 29. Telefone -->
                    <div class="shop-item" id="telephoneShop">
                        <span>‚òéÔ∏è Telefone</span>
                        <button class="buy-btn" onclick="buyTelephone()">300üí∞</button>
                    </div>
                    
                    <!-- 30. Caminhonete -->
                    <div class="shop-item" id="truckShop">
                        <span>üöö Caminhonete</span>
                        <button class="buy-btn" onclick="buyTruck()">2000üí∞</button>
                    </div>
                    
                    <!-- 31. Etanol -->
                    <div class="shop-item" id="ethanolShop" style="display: none;">
                        <span>‚õΩ Etanol</span>
                        <button class="buy-btn" onclick="buyEthanol()">25üí∞</button>
                    </div>
                    
                    <!-- Greenhouse (Winter only) -->
                    <div class="shop-item" id="greenhouseShop" style="display: none;">
                        <span>üè† Estufa</span>
                        <button class="buy-btn" onclick="buyGreenhouse()">500üí∞</button>
                    </div>
                    <div id="ordersPanel" style="display: none;">
                        <div class="orders-panel">
                            <h4>üìã Pedidos de Clientes</h4>
                            <div id="ordersList"></div>
                        </div>
                    </div>
                    
                    <div id="truckOrdersPanel" style="display: none;">
                        <div class="orders-panel">
                            <h4>üìû Pedidos Comerciais</h4>
                            <div id="truckOrdersList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dog House -->
            <div id="dogHouse" class="pet-house" style="display: none;">
                <h4>üêï Casinha da Mocinha</h4>
                <div class="pet-info">
                    <div>‚ù§Ô∏è Amizade: <span id="dogFriendship">0</span>%</div>
                    <div class="friendship-bar">
                        <div class="friendship-fill" id="dogFriendshipBar" style="width: 0%"></div>
                    </div>
                    
                    <!-- Dog Activity System -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0; gap: 10px;">
                        <!-- Food Slot -->
                        <div style="text-align: center;">
                            <div id="dogFoodSlot" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; transition: all 0.3s ease;" onclick="addFoodToDogSlot()">
                                <span id="dogFoodSlotContent">+</span>
                            </div>
                            <small style="color: #666; font-size: 10px;">Slot Ra√ß√£o</small>
                        </div>
                        
                        <!-- Dog Status -->
                        <div style="text-align: center;">
                            <div id="dogStatus" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; font-size: 32px;">
                                üêï
                            </div>
                            <small id="dogStatusText" style="color: #666; font-size: 10px;">Esperando</small>
                        </div>
                        
                        <!-- Treasure Chest -->
                        <div style="text-align: center;">
                            <div id="treasureChest" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; transition: all 0.3s ease;" onclick="openTreasureChest()">
                                üì¶
                            </div>
                            <small style="color: #666; font-size: 10px;">Ba√∫</small>
                        </div>
                    </div>
                    
                    <!-- Countdown Display -->
                    <div id="dogCountdown" style="text-align: center; margin: 10px 0; font-weight: bold; color: #8B4513;"></div>
                    
                    <!-- Legacy buttons (hidden) -->
                    <div style="display: none;">
                        <button class="feed-btn" onclick="feedDog()" id="feedDogBtn">ü•© Dar Ra√ß√£o</button>
                        <button class="feed-btn" onclick="giveBone()" id="giveBoneBtn">ü¶¥ Dar Osso</button>
                    </div>
                </div>
            </div>

            <!-- Horse Stable -->
            <div id="horseStable" class="pet-house" style="display: none;">
                <h4>üêé Baia do Duque</h4>
                <div class="pet-info">
                    <div>‚ù§Ô∏è Amizade: <span id="horseFriendship">0</span>%</div>
                    <div class="friendship-bar">
                        <div class="friendship-fill" id="horseFriendshipBar" style="width: 0%"></div>
                    </div>
                    
                    <!-- Horse Activity System -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0; gap: 10px;">
                        <!-- Hay Slot -->
                        <div style="text-align: center;">
                            <div id="horseHaySlot" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; transition: all 0.3s ease;" onclick="addHayToHorseSlot()">
                                <span id="horseHaySlotContent">+</span>
                            </div>
                            <small style="color: #666; font-size: 10px;">Slot Feno</small>
                        </div>
                        
                        <!-- Horse Status -->
                        <div style="text-align: center;">
                            <div id="horseStatus" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; font-size: 32px;">
                                üêé
                            </div>
                            <small id="horseStatusText" style="color: #666; font-size: 10px;">Esperando</small>
                        </div>
                        
                        <!-- Apple Slot -->
                        <div style="text-align: center;">
                            <div id="horseAppleSlot" style="width: 60px; height: 60px; border: 3px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; transition: all 0.3s ease;" onclick="addAppleToHorseSlot()">
                                <span id="horseAppleSlotContent">+</span>
                            </div>
                            <small style="color: #666; font-size: 10px;">Slot Ma√ß√£</small>
                        </div>
                    </div>
                    
                    <!-- Countdown Display -->
                    <div id="horseCountdown" style="text-align: center; margin: 10px 0; font-weight: bold; color: #8B4513;"></div>
                    
                    <!-- Legacy buttons (hidden) -->
                    <div style="display: none;">
                        <button class="feed-btn" onclick="feedHorse()" id="feedHorseBtn">üåæ Dar Feno</button>
                        <button class="feed-btn" onclick="giveApple()" id="giveAppleBtn">üçé Dar Ma√ß√£</button>
                    </div>
                </div>
            </div>

            <!-- Truck Area -->
            <div id="truckArea" class="animal-structure" style="display: none;">
                <h4>üöö Caminhonete</h4>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>‚õΩ Combust√≠vel: <span id="truckFuel">0</span>/10</div>
                    <button class="feed-btn" onclick="refuelTruck()" id="refuelBtn">‚õΩ Abastecer</button>
                </div>
                <div class="flowers-grid" id="truckGrid" style="grid-template-columns: repeat(4, 1fr);"></div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="feed-btn" onclick="deliverTruckOrder()" id="deliverTruckBtn" disabled>üöö Entregar Pedido</button>
                </div>
            </div>

            <!-- Beehive -->
            <div id="beehive" class="animal-structure" style="display: none;">
                <h4>üçØ Colmeia</h4>
                <div class="bees-grid" id="beesGrid"></div>
            </div>

        </div>

        <!-- Center Area -->
        <div class="farm-area">
            <h2 style="color: #8B4513; text-align: center; margin-bottom: 10px;">üå± Sua Fazenda</h2>
            <div class="farm-grid" id="farmGrid"></div>
            
            <!-- Well -->
            <div id="wellContainer" style="display: none;">
                <div class="well" onclick="collectWater()">üèóÔ∏è</div>
                <p style="text-align: center; color: #8B4513; font-weight: bold;">Po√ßo de √Ågua - Clique para coletar</p>
            </div>

            <!-- Chicken Coop -->
            <div id="chickenCoop" class="animal-structure" style="display: none;">
                <h4>üêî Galinheiro</h4>
                <div class="animals-grid" id="chickensGrid"></div>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                    <button class="feed-btn" onclick="feedAllChickens()">üåæ Alimentar Todas</button>
                    <button class="feed-btn" onclick="sacrificeChicken()" style="background: #dc3545; font-size: 12px; padding: 6px 10px;">üî™ Sacrificar</button>
                </div>
            </div>

            <!-- Pig Pen -->
            <div id="pigPen" class="animal-structure" style="display: none;">
                <h4>üê∑ Chiqueiro</h4>
                <div class="animals-grid" id="pigsGrid"></div>
                <button class="feed-btn" onclick="feedAllPigs()">üåæ Alimentar Todos</button>
            </div>

            <!-- Flower Field -->
            <div id="flowerField" class="animal-structure" style="display: none;">
                <h4>üå∏ Campo de Flores</h4>
                <div class="flowers-grid" id="flowersGrid"></div>
            </div>

            <!-- Sheep Pen -->
            <div id="sheepPen" class="animal-structure" style="display: none;">
                <h4>üêë Curral das Ovelhas</h4>
                <div class="animals-grid" id="sheepGrid"></div>
                <button class="feed-btn" onclick="feedAllSheep()">üåæ Alimentar Todas</button>
                <button class="feed-btn" onclick="shearAllSheep()">‚úÇÔ∏è Tosquiar Todas</button>
            </div>

            <!-- Cow Pasture -->
            <div id="cowPasture" class="animal-structure" style="display: none;">
                <h4>üêÑ Pasto de Vacas</h4>
                <div class="animals-grid" id="cowsGrid"></div>
                <button class="feed-btn" onclick="feedAllCows()">üåæ Alimentar Todas</button>
            </div>

            <!-- Grass Field -->
            <div id="grassField" class="animal-structure" style="display: none;">
                <h4>üå± Campo de Grama</h4>
                <div class="grass-grid" id="grassGrid"></div>
            </div>



            <!-- Producer Fair -->
            <div id="producerFair" class="animal-structure" style="display: none;">
                <h4>üè™ Feira do Produtor</h4>
                <p style="text-align: center; margin-bottom: 15px; color: #8B4513;">
                    Exponha seus produtos! Cada item gera 50 moedas a cada 15 minutos.
                </p>
                <div class="flowers-grid" id="fairGrid"></div>
                <div style="text-align: center; margin-top: 10px; font-weight: bold;">
                    Pr√≥ximo pagamento em: <span id="fairTimer">15:00</span>
                </div>
            </div>

            <!-- Craft Table -->
            <div id="craftTable" class="animal-structure" style="display: none;">
                <h4>üî® Mesa de Graft</h4>
                <p style="text-align: center; margin-bottom: 15px; color: #8B4513;">
                    Crie joias e buqu√™s especiais para vender na quitanda!
                </p>
                <div class="flowers-grid" id="craftGrid">
                    <div class="craft-item" onclick="craftPearlNecklace()">
                        <div class="craft-emoji">üìø</div>
                        <div class="craft-name">Colar de P√©rolas</div>
                        <div class="craft-recipe">6 P√©rolas</div>
                        <div class="craft-time">10s</div>
                    </div>
                    <div class="craft-item" onclick="craftEmeraldRing()">
                        <div class="craft-emoji">üíç</div>
                        <div class="craft-name">Anel de Esmeralda</div>
                        <div class="craft-recipe">1 Esmeralda</div>
                        <div class="craft-time">20s</div>
                    </div>
                    <div class="craft-item" onclick="craftFlowerBouquet()">
                        <div class="craft-emoji">üíê</div>
                        <div class="craft-name">Buqu√™ de Flores</div>
                        <div class="craft-recipe">1 Rosa + 1 Girassol + 1 Margarida</div>
                        <div class="craft-time">15s</div>
                    </div>
                </div>
                <div id="craftStatus" style="text-align: center; margin-top: 10px; font-weight: bold;">
                    Pronta para usar
                </div>
            </div>

            <!-- Bonfire -->
            <div id="bonfire" class="animal-structure" style="display: none;">
                <h4>üî• Fogueira</h4>
                <p style="text-align: center; margin-bottom: 15px; color: #8B4513;">
                    Mantenha os animais aquecidos no inverno para que produzam!
                </p>
                <div style="text-align: center; margin: 20px 0;">
                    <div id="bonfireFlame" style="font-size: 64px; margin: 20px 0;">üî•</div>
                    <div id="bonfireStatus" style="font-weight: bold; margin: 10px 0;">Fogueira apagada</div>
                    <div id="bonfireTimer" style="color: #666; margin: 5px 0;"></div>
                </div>
                <button class="feed-btn" onclick="lightBonfire()" id="lightBonfireBtn">üî• Acender Fogueira</button>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                    Receita: 3 Carv√µes + 4 Lenhas
                </div>
            </div>

            <!-- Greenhouse -->
            <div id="greenhouse" class="animal-structure" style="display: none;">
                <h4>üè† Estufa</h4>
                <p style="text-align: center; margin-bottom: 15px; color: #8B4513;">
                    Canteiros protegidos do frio do inverno!
                </p>
                <div class="farm-grid" id="greenhouseGrid" style="grid-template-columns: repeat(4, 1fr); gap: 10px;"></div>
            </div>

            <!-- Fish Lake -->
            <div id="fishLake" class="animal-structure">
                <h4>üé£ Lago dos Peixes</h4>
                <div class="fish-grid" id="fishGrid"></div>
                <div id="fishingRodStatus" class="tool-status" style="display: none;">
                    üé£ Vara de Pesca: <span id="rodUses">20</span> usos restantes
                </div>
            </div>

            <!-- Forest -->
            <div id="forest" class="animal-structure" style="display: none;">
                <h4>üå≥ Bosque</h4>
                <div class="trees-grid" id="treesGrid"></div>
                <div id="axeStatus" class="tool-status" style="display: none;">
                    ü™ì Machado: <span id="axeUses">50</span> usos restantes
                </div>
            </div>

            <!-- Mine -->
            <div id="mine" class="animal-structure">
                <h4>‚õèÔ∏è Mina</h4>
                <div class="rocks-grid" id="rocksGrid"></div>
                <div id="pickaxeStatus" class="tool-status" style="display: none;">
                    ‚õèÔ∏è Picareta: <span id="pickaxeUses">30</span> usos restantes
                </div>
                <div id="mineAccess" style="text-align: center; color: #cc0000; font-weight: bold;">
                    üîí Precisa de uma chave para entrar na mina!
                </div>
            </div>

            <!-- Quitanda na coluna central -->
            <div class="quitanda-center" style="margin-top: 20px;">
                <h3 style="color: #8B4513; text-align: center; margin-bottom: 20px;">üè™ Quitanda</h3>
                <div style="text-align: center; padding: 40px 20px; color: #8B4513;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üè™</div>
                    <h4 style="margin-bottom: 15px;">Quitanda Vazia</h4>
                    <p style="margin-bottom: 20px; line-height: 1.5;">
                        Todos os seus produtos agora ficam organizados no <strong>Celeiro</strong>!<br>
                        V√° at√© o celeiro na barra lateral esquerda para vender seus itens.
                    </p>
                    <div style="background: rgba(139, 69, 19, 0.1); border-radius: 10px; padding: 15px; margin: 20px 0;">
                        <strong>üí° Como vender:</strong><br>
                        ‚Ä¢ Clique em qualquer item no Celeiro para vender individualmente<br>
                        ‚Ä¢ Use o bot√£o "Vender Tudo" abaixo para vender todos os itens vend√°veis
                    </div>
                </div>
                <button class="sell-all-btn" onclick="sellAll()" style="margin-top: 25px;">üí∞ Vender Tudo do Celeiro</button>
            </div>
        </div>

        <!-- Right Sidebar - Machines -->
        <div class="machines-sidebar">
            <!-- Composter -->
            <div id="composter" class="machine">
                <h4>üóëÔ∏è Composteira</h4>
                <div class="recipe-info">Receita: 1 Flor + 1 Galho + 2 Estercos = 8 Adubos</div>
                <div class="machine-status">Flores: <span id="flowerStorage">0</span> | Galhos: <span id="branchStorage">0</span> | Estercos: <span id="manureStorage">0</span></div>
                <div id="composterStatus" class="machine-status">Pronta para usar</div>
                <button class="machine-btn" onclick="startComposting()" id="composterBtn">üóëÔ∏è Fazer Adubo</button>
            </div>

            <!-- Mixer -->
            <div id="mixer" class="machine">
                <h4>ü•£ Misturador</h4>
                <div class="recipe-info">
                    Ra√ß√£o Galinha: 1 Trigo (do Moinho) + 2 Milhos<br>
                    Ra√ß√£o Porco: 1 Milho + 1 Batata + 1 Cenoura + 1 Br√≥colis
                </div>
                
                <!-- Ingredient Slots -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">ü•ò Ingredientes:</h5>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px;">
                        <div id="mixerSlot0" class="ingredient-slot" onclick="addIngredientToMixer(0)">+</div>
                        <div id="mixerSlot1" class="ingredient-slot" onclick="addIngredientToMixer(1)">+</div>
                        <div id="mixerSlot2" class="ingredient-slot" onclick="addIngredientToMixer(2)">+</div>
                        <div id="mixerSlot3" class="ingredient-slot" onclick="addIngredientToMixer(3)">+</div>
                    </div>
                </div>
                
                <div id="mixerStatus" class="machine-status"></div>
                <button class="machine-btn" onclick="mixIngredients()" id="mixerBtn">ü•£ Misturar</button>
                <button class="machine-btn" onclick="clearMixerSlots()" style="background: #f44336;">üóëÔ∏è Limpar</button>
            </div>

            <!-- Coffee Roaster -->
            <div id="coffeeRoaster" class="machine">
                <h4>‚òï Torra de Caf√©</h4>
                <div class="recipe-info">Receita: 4 Caf√©s + 3 Lenhas = 1 Saco de Caf√©</div>
                
                <!-- Coffee Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">‚òï Gr√£os de Caf√©:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="coffeeSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addCoffeeToSlot()">
                            <span id="coffeeSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeCoffeeFromSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <!-- Wood Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">ü™µ Lenha:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="coffeeWoodSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addWoodToCoffeeSlot()">
                            <span id="coffeeWoodSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeWoodFromCoffeeSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div id="coffeeRoasterStatus" class="machine-status">Pronta para usar</div>
                <button class="machine-btn" onclick="roastCoffee()" id="coffeeRoasterBtn">‚òï Torrar Caf√©</button>
            </div>

            <!-- Juice Machine -->
            <div id="juiceMachine" class="machine">
                <h4>üßÉ M√°quina de Suco</h4>
                <div class="recipe-info">Receita: 2 Uvas = 1 Suco de Uva</div>
                
                <!-- Grape Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">üçá Uvas:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="grapeSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addGrapesToSlot()">
                            <span id="grapeSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeGrapesFromSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div class="machine-status">Armazenado: <span id="grapeStorage">0</span> Uvas</div>
                <div id="juiceMachineStatus" class="machine-status">Pronta para usar</div>
                <button class="machine-btn" onclick="makeJuice()" id="juiceMachineBtn">üßÉ Fazer Suco</button>
            </div>

            <!-- Mill -->
            <div id="mill" class="machine">
                <h4>üåæ Moinho</h4>
                <div class="recipe-info">Receita: 4 Trigos = 1 Saco de Farinha</div>
                
                <!-- Wheat Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">üåæ Trigo:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="wheatSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addWheatToSlot()">
                            <span id="wheatSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeWheatFromSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div class="machine-status">Armazenado: <span id="wheatStorage">0</span> Trigos</div>
                <div id="millStatus" class="machine-status">Pronto para usar</div>
                <button class="machine-btn" onclick="makeFlour()" id="millBtn">üåæ Moer</button>
            </div>

            <!-- Cheese Maker -->
            <div id="cheeseMaker" class="machine">
                <h4>üßÄ Queijeira</h4>
                <div class="recipe-info">Receita: 2 Leites = 1 Queijo</div>
                
                <!-- Milk Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">ü•õ Leite:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="milkSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addMilkToSlot()">
                            <span id="milkSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeMilkFromSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div class="machine-status">Armazenado: <span id="milkStorage">0</span> Leites</div>
                <div id="cheeseMakerStatus" class="machine-status">Pronta para usar</div>
                <button class="machine-btn" onclick="makeCheese()" id="cheeseMakerBtn">üßÄ Fazer Queijo</button>
            </div>

            <!-- Spinning Machine -->
            <div id="spinningMachine" class="machine">
                <h4>üß∂ M√°quina de Fiar</h4>
                <div class="recipe-info">Receita: 2 L√£s = 1 Novelo</div>
                
                <!-- Wool Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">üêë L√£:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="woolSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addWoolToSlot()">
                            <span id="woolSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeWoolFromSlot()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div class="machine-status">Armazenado: <span id="woolStorage">0</span> L√£s</div>
                <div id="spinningMachineStatus" class="machine-status">Pronta para usar</div>
                <button class="machine-btn" onclick="spinWool()" id="spinningMachineBtn">üß∂ Fiar</button>
            </div>

            <!-- Grass Dryer -->
            <div id="grassDryer" class="machine">
                <h4>üåæ Secador de Grama</h4>
                <div class="recipe-info">Adicione 4 ou 8 gramas por vez (30s cada secagem)</div>
                
                <!-- Grass Slot -->
                <div style="margin: 15px 0; text-align: center;">
                    <div id="grassDryerSlot" style="width: 80px; height: 80px; border: 3px solid #228B22; border-radius: 15px; background: #F5DEB3; display: inline-flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px;" onclick="addGrassToSlot()">
                        <span id="grassSlotContent">+</span>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Clique para adicionar grama (4 ou 8)</div>
                    <button class="machine-btn" onclick="dryGrassInSlot()" id="grassDryerBtn" disabled>üåæ Secar (30s)</button>
                </div>
                
                <!-- Hay Making Slot -->
                <div style="margin: 15px 0; text-align: center;">
                    <div id="hayMakingSlot" style="width: 80px; height: 80px; border: 3px solid #8B4513; border-radius: 15px; background: #F5DEB3; display: inline-flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px;" onclick="addDriedGrassToHaySlot()">
                        <span id="haySlotContent">+</span>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Clique para adicionar 4 gramas secas</div>
                    <button class="machine-btn" onclick="makeHayInSlot()" id="makeHayBtn" disabled>üåæ Fazer Feno (10s)</button>
                </div>
                
                <div class="machine-status">Grama: <span id="grassStorage">0</span> | Grama Seca: <span id="driedGrassStorage">0</span></div>
                <div id="grassDryerStatus" class="machine-status"></div>
            </div>

            <!-- Wood Cutter -->
            <div id="woodCutter" class="machine">
                <h4>ü™ì Cortador de Lenha</h4>
                <div class="recipe-info">Receita: 1 Tronco = 4 Lenhas</div>
                <div class="machine-status">Armazenado: <span id="trunkStorage">0</span> Troncos</div>
                <div id="woodCutterStatus" class="machine-status">Pronto para usar</div>
                <button class="machine-btn" onclick="cutWoodMachine()" id="woodCutterBtn">ü™ì Cortar Lenha</button>
            </div>

            <!-- Wood Cutting -->
            <div id="woodCutting" class="machine" style="display: none;">
                <h4>ü™ì Cortar Lenha</h4>
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0;">
                    <div id="woodCuttingSlot" style="width: 80px; height: 80px; border: 3px solid #8B4513; border-radius: 15px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; font-size: 32px; cursor: pointer; transition: all 0.3s ease;" onclick="addTrunkToSlot()">
                        <span id="woodSlotContent">+</span>
                    </div>
                    <button class="machine-btn" onclick="cutWoodInSlot()" id="cutWoodBtn" disabled>ü™ì Cortar (3s)</button>
                </div>
                <div id="woodCuttingStatus" style="text-align: center; font-weight: bold;">Adicione troncos para cortar em lenha</div>
            </div>

            <!-- Stove -->
            <div id="stove" class="machine">
                <h4>üî• Fog√£o com Forno</h4>
                
                <!-- Wood Slot -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">ü™µ Lenha:</h5>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="woodSlot" style="width: 60px; height: 60px; border: 2px solid #8B4513; border-radius: 10px; background: #F5DEB3; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addWoodToStove()">
                            <span id="woodSlotContent">+</span>
                        </div>
                        <button class="machine-btn" onclick="removeWoodFromStove()" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                    </div>
                </div>
                
                <!-- Ingredient Slots -->
                <div style="margin: 10px 0;">
                    <h5 style="color: #8B4513; margin-bottom: 5px;">ü•ò Ingredientes:</h5>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px;">
                        <div id="ingredientSlot0" class="ingredient-slot" onclick="addIngredientToStove(0)">+</div>
                        <div id="ingredientSlot1" class="ingredient-slot" onclick="addIngredientToStove(1)">+</div>
                        <div id="ingredientSlot2" class="ingredient-slot" onclick="addIngredientToStove(2)">+</div>
                        <div id="ingredientSlot3" class="ingredient-slot" onclick="addIngredientToStove(3)">+</div>
                    </div>
                </div>
                
                <div id="stoveStatus" class="machine-status">Pronto para usar</div>
                <button class="machine-btn" onclick="cookInStove()" id="stoveBtn">üî• Cozinhar</button>
                <button class="machine-btn" onclick="clearStoveSlots()" style="background: #f44336;">üóëÔ∏è Limpar</button>
            </div>
        </div>
    </div>

    <div class="rain-effect" id="rainEffect"></div>

    <!-- Mailbox Modal -->
    <div class="modal" id="mailboxModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeMailbox()">&times;</button>
            <h3>üìÆ Caixa de Correios</h3>
            <div id="mailContent"></div>
        </div>
    </div>

    <!-- Food Menu Modal -->
    <div class="modal" id="foodModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeFoodMenu()">&times;</button>
            <h3 id="foodModalTitle">üçΩÔ∏è Menu de Comida</h3>
            <div id="foodMenuContent" class="food-menu"></div>
        </div>
    </div>

    <!-- Stove Menu Modal -->
    <div class="modal" id="stoveModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeStoveMenu()">&times;</button>
            <h3>üî• Fog√£o com Forno</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>üî• Fog√£o (2 lenhas)</h4>
                    <div id="stoveRecipes" class="food-menu"></div>
                </div>
                <div>
                    <h4>üî• Forno (3 lenhas)</h4>
                    <div id="ovenRecipes" class="food-menu"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Treasure Chest Modal -->
    <div class="modal" id="treasureChestModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeTreasureChest()">&times;</button>
            <h3>üì¶ Ba√∫ de Tesouros da Mocinha</h3>
            <div id="treasureChestContent" class="food-menu"></div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            coins: 200,
            water: 10,
            fertilizer: 50,
            season: 0, // 0=Primavera, 1=Ver√£o, 2=Outono, 3=Inverno
            seasonTime: 3600, // 1 hora em segundos
            selectedSeed: null,
            hasWell: false,
            gameStartTime: Date.now(),
            achievements: {
                bronze: false,
                silver: false,
                gold: false
            },
            hasDogHouse: false,
            hasHorseStable: false,
            hasChickenCoop: false,
            hasPigPen: false,
            hasSheepPen: false,
            hasCowPasture: false,
            hasFlowerField: false,
            hasProducerFair: false,
            hasCraftTable: false,
            hasBonfire: false,
            hasGreenhouse: false,
            hasGrassField: false,
            hasForest: false,
            hasTelephone: false,
            hasTruck: false,

            hasShears: false,
            hasAxe: false,
            hasFishingRod: false,
            hasPickaxe: false,
            hasBeehive: false,
            axeUses: 0,
            fishingRodUses: 0,
            pickaxeUses: 0,
            mineAccess: false,
            avatar: {
                energy: 200,
                maxEnergy: 200,
                sick: false,
                sickTime: 0,
                resting: false,
                restStartTime: 0,
                firstSickness: Date.now() + 900000 // 15 minutes
            },
            beehive: {
                bees: [true, true, true],
                lastHarvest: 0,
                honeyTimer: 600, // 10 minutes in seconds
                flowerSlots: [null, null, null], // slots for flower seeds
                flowerGrowthTimes: [0, 0, 0], // when flowers were planted
                flowerExpireTimes: [0, 0, 0] // when flowers will expire
            },
            mailbox: {
                hasNewMail: false,
                mails: [],
                lastNewspaper: 0
            },
            dogFriendship: 0,
            horseFriendship: 0,
            dogLastFed: 0,
            horseLastFed: 0,
            dogFoodCount: 0,
            dogSystem: {
                state: 'waiting', // waiting, eating, hunting, resting
                foodInSlot: false,
                huntingStartTime: 0,
                restingStartTime: 0,
                treasureChest: [] // Array of treasures
            },
            horseSystem: {
                state: 'waiting', // waiting, eating, working, sick
                hayInSlot: false,
                appleInSlot: false,
                workingStartTime: 0,
                sickStartTime: 0,
                lastAppleTime: Date.now(),
                sickCheckTime: Date.now() + 1800000 // 30 minutes from now
            },
            chickens: [],
            pigs: [],
            sheep: [],
            cows: [],
            flowers: {
                rosa: 3,
                girassol: 3,
                margarida: 3,
                lastHarvest: 0
            },
            producerFair: {
                slots: [null, null, null],
                lastEarning: 0
            },
            craftTable: {
                working: false,
                startTime: 0,
                recipe: null
            },
            bonfire: {
                lit: false,
                startTime: 0,
                duration: 1500000 // 25 minutes
            },
            greenhousePlots: Array(12).fill().map(() => ({
                state: 'empty',
                seedType: null,
                plantTime: null
            })),
            grass: Array(20).fill(true),
            grassHarvested: 0,
            trees: {
                trunk: { clicks: 0, branches: 0 },
                apple: { fruits: 4, lastHarvest: 0 },
                orange: { fruits: 4, lastHarvest: 0 },
                banana: { fruits: 4, lastHarvest: 0 }
            },
            fish: Array(4).fill(true),
            fishCaught: 0,
            rocks: Array(3).fill().map(() => ({ hits: 0, resting: false, restTime: 0 })),
            plots: Array(8).fill().map(() => ({
                state: 'empty', // empty, fertilized, planted, watered, ready
                seedType: null,
                plantTime: null
            })),
            inventory: {
                farmProducts: {},
                fruitsVegetables: {},
                others: {}
            },
            barn: {
                bones: 0,
                keys: 0,
                hay: 0,
                coal: 0,
                tea: 0,
                wood: 0,
                dogFood: 0,
                vaccines: 0,
                ch√°: 0,
                salad: 0,
                stew: 0,
                steak: 0,
                chicken: 0,
                cookedFish: 0,
                rawChicken: 0,
                chickenFeed: 0,
                pigFeed: 0,
                animalFeed: 0,
                ethanol: 0
            },
            truck: {
                fuel: 0,
                maxFuel: 10,
                slots: [null, null, null, null],
                currentOrder: null
            },
            truckOrders: [],
            machineStorage: {
                composter: {
                    flowers: 0,
                    branches: 0,
                    manure: 0
                },
                mixer: {
                    chickenFeed: 0,
                    pigFeed: 0
                },
                coffeeRoaster: {
                    coffee: 0,
                    coffeeSlot: 0,
                    woodSlot: 0
                },
                juiceMachine: {
                    grapes: 0,
                    grapeSlot: 0
                },
                mill: {
                    wheat: 0,
                    wheatSlot: 0
                },
                cheeseMaker: {
                    cheese: 0,
                    milk: 0,
                    milkSlot: 0
                },
                spinningMachine: {
                    wool: 0,
                    woolSlot: 0
                },
                grassDryer: {
                    grass: 0,
                    driedGrass: 0
                },
                woodCutter: {
                    trunks: 0
                },
                stove: {
                    porkMeat: 0,
                    herbs: 0
                }
            },
            machines: {
                hasComposter: false,
                hasMixer: false,
                hasCoffeeRoaster: false,
                hasJuiceMachine: false,
                hasMill: false,
                hasCheeseMaker: false,
                hasSpinningMachine: false,
                hasGrassDryer: false,
                hasWoodCutter: false,
                hasStove: false,
                composter: { working: false, startTime: 0 },
                mixer: { working: false, startTime: 0, type: null },
                coffeeRoaster: { working: false, startTime: 0 },
                juiceMachine: { working: false, startTime: 0 },
                mill: { working: false, startTime: 0 },
                cheeseMaker: { working: false, startTime: 0 },
                spinningMachine: { working: false, startTime: 0 },
                grassDryer: { working: false, startTime: 0 },
                woodCutter: { working: false, startTime: 0 },
                stove: { 
                    working: false, 
                    startTime: 0, 
                    type: null,
                    ingredientSlots: [null, null, null, null],
                    woodSlot: 0
                }
            },
            orders: []
        };

        const seasons = ['Primavera', 'Ver√£o', 'Outono', 'Inverno'];
        const seasonEmojis = ['üå∏', '‚òÄÔ∏è', 'üçÇ', '‚ùÑÔ∏è'];
        
        const seeds = [
            {name: 'Trigo', emoji: 'üåæ', price: 10, category: 'farmProducts'},
            {name: 'Milho', emoji: 'üåΩ', price: 10, category: 'farmProducts'},
            {name: 'Caf√©', emoji: 'üî¥', price: 10, category: 'farmProducts'},
            {name: 'Batata', emoji: 'ü•î', price: 10, category: 'fruitsVegetables'},
            {name: 'Tomate', emoji: 'üçÖ', price: 10, category: 'fruitsVegetables'},
            {name: 'Cenoura', emoji: 'ü•ï', price: 10, category: 'fruitsVegetables'},
            {name: 'Ab√≥bora', emoji: 'üéÉ', price: 10, category: 'fruitsVegetables'},
            {name: 'Br√≥colis', emoji: 'ü•¶', price: 10, category: 'fruitsVegetables'},
            {name: 'Alface', emoji: 'ü•¨', price: 10, category: 'fruitsVegetables'},
            {name: 'Uva', emoji: 'üçá', price: 10, category: 'fruitsVegetables'}
        ];

        // Initialize game
        function initGame() {
            createFarmGrid();
            createSeedsGrid();
            updateUI();
            updateBarnDisplay();
            updateInventoryDisplay();
            updatePetUI();
            
            // Initialize flower field - always available
            gameState.hasFlowerField = true;
            document.getElementById('flowerField').style.display = 'block';
            updateFlowersDisplay();
            
            // Initialize fish lake and mine - always visible
            document.getElementById('fishLake').style.display = 'block';
            updateFishDisplay();
            updateRocksDisplay();
            
            loadGame();
            
            // Auto-save every 10 seconds
            setInterval(saveGame, 10000);
            
            // Season timer
            setInterval(updateSeasonTimer, 1000);
            
            // Rain system - every 10 minutes
            setInterval(startRain, 600000);
            
            // Check plant growth
            setInterval(checkPlantGrowth, 1000);
            
            // Update pet UI every second
            setInterval(updatePetUI, 1000);
            
            // Check animal health every 30 seconds
            setInterval(checkAnimalHealth, 30000);
            
            // Check chicken breeding every 20 minutes
            setInterval(checkChickenBreeding, 1200000);
            
            // Update displays every 5 seconds
            setInterval(() => {
                if (gameState.hasChickenCoop) updateChickensDisplay();
                if (gameState.hasPigPen) updatePigsDisplay();
                if (gameState.hasSheepPen) updateSheepDisplay();
                if (gameState.hasCowPasture) updateCowsDisplay();
                if (gameState.hasGrassField) updateGrassDisplay();
                if (gameState.hasForest) updateTreesDisplay();
                if (gameState.hasBeehive) updateBeehiveDisplay();
                if (gameState.hasProducerFair) updateProducerFairDisplay();
                if (gameState.hasCraftTable) updateCraftTableDisplay();
                if (gameState.hasBonfire) updateBonfireDisplay();
                if (gameState.hasGreenhouse) updateGreenhouseDisplay();
                if (gameState.hasTruck) updateTruckDisplay();
                if (gameState.hasTruck) updateTruckOrdersDisplay();
                if (gameState.machines.hasWoodCutting) updateWoodCuttingDisplay();
                if (gameState.machines.hasGrassDryer) updateGrassDryerDisplay();
                if (gameState.machines.hasComposter) updateComposterDisplay();
                if (gameState.machines.hasCoffeeRoaster) updateCoffeeRoasterDisplay();
                if (gameState.machines.hasJuiceMachine) updateJuiceMachineDisplay();
                if (gameState.machines.hasCheeseMaker) updateCheeseMakerDisplay();
                if (gameState.machines.hasSpinningMachine) updateSpinningMachineDisplay();
                if (gameState.machines.hasMill) updateMillDisplay();
                if (gameState.hasDogHouse) updateDogSystemDisplay();
                if (gameState.hasHorseStable) updateHorseSystemDisplay();
                updateFishDisplay();
                updateRocksDisplay();
                updateAvatarUI();
                updateMachineStorageDisplay();
                
                // Check horse sickness
                checkHorseSickness();
                
                // Update stove display if available
                if (gameState.machines && gameState.machines.hasStove) {
                    updateStoveDisplay();
                }
                
                // Update quitanda display
                updateQuitandaDisplay();
                
                // Update machine statuses
                if (gameState.machines) {
                    Object.keys(gameState.machines).forEach(key => {
                        if (key.startsWith('has') && gameState.machines[key]) {
                            const machineType = key.replace('has', '').toLowerCase();
                            if (machineType !== 'composter' && machineType !== 'mixer' && 
                                machineType !== 'coffeeroaster' && machineType !== 'juicemachine' &&
                                machineType !== 'mill' && machineType !== 'cheesemaker' &&
                                machineType !== 'spinningmachine' && machineType !== 'grassdryer' &&
                                machineType !== 'woodcutter' && machineType !== 'stove') return;
                            
                            const correctType = machineType === 'coffeeroaster' ? 'coffeeRoaster' :
                                              machineType === 'juicemachine' ? 'juiceMachine' :
                                              machineType === 'cheesemaker' ? 'cheeseMaker' :
                                              machineType === 'spinningmachine' ? 'spinningMachine' :
                                              machineType === 'grassdryer' ? 'grassDryer' :
                                              machineType === 'woodcutter' ? 'woodCutter' : machineType;
                            
                            updateMachineStatus(correctType);
                        }
                    });
                }
            }, 5000);
            
            // Avatar sickness check every 15 minutes
            setInterval(checkAvatarSickness, 900000);
            
            // Check achievements every minute
            setInterval(checkAchievements, 60000);
            
            // Send random mail every 10-20 minutes
            setInterval(() => {
                if (Math.random() < 0.3) sendRandomMail();
            }, 600000);
            
            // Send newspaper every 30 minutes
            setInterval(sendNewspaper, 1800000);
            
            // Check grass regrowth every minute
            setInterval(checkGrassRegrowth, 60000);
            
            // Check tree fruit regrowth every 5 minutes
            setInterval(checkTreeRegrowth, 300000);
            
            // Check fish respawn every 5 minutes
            setInterval(checkFishRespawn, 300000);
            
            // Check rock rest time every minute
            setInterval(checkRockRest, 60000);
            
            // Producer fair earnings every 15 minutes
            setInterval(checkProducerFairEarnings, 900000);
            
            // Check truck order expiration every minute
            setInterval(checkTruckOrderExpiration, 60000);
        }

        function createFarmGrid() {
            const farmGrid = document.getElementById('farmGrid');
            farmGrid.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.id = `plot-${i}`;
                plot.onclick = () => handlePlotClick(i);
                farmGrid.appendChild(plot);
            }
        }

        function createSeedsGrid() {
            const seedsGrid = document.getElementById('seedsGrid');
            seedsGrid.innerHTML = '';
            
            seeds.forEach((seed, index) => {
                const seedBtn = document.createElement('div');
                seedBtn.className = 'seed-btn';
                seedBtn.innerHTML = `${seed.emoji}<br>${seed.name}<br>üí∞${seed.price}`;
                seedBtn.onclick = () => selectSeed(index);
                seedsGrid.appendChild(seedBtn);
            });
        }

        function selectSeed(index) {
            gameState.selectedSeed = index;
            document.querySelectorAll('.seed-btn').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
        }

        function handlePlotClick(plotIndex) {
            // Disable farming in winter unless using greenhouse
            if (gameState.season === 3) {
                alert('‚ùÑÔ∏è Muito frio para plantar! Compre uma estufa no mercadinho!');
                return;
            }
            
            const plot = gameState.plots[plotIndex];
            
            if (plot.state === 'empty') {
                // Fertilize
                if (gameState.fertilizer > 0) {
                    gameState.fertilizer--;
                    plot.state = 'fertilized';
                    updatePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'fertilized') {
                // Plant
                if (gameState.selectedSeed !== null && gameState.coins >= seeds[gameState.selectedSeed].price) {
                    gameState.coins -= seeds[gameState.selectedSeed].price;
                    plot.state = 'planted';
                    plot.seedType = gameState.selectedSeed;
                    plot.plantTime = Date.now();
                    updatePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'planted') {
                // Water
                if (gameState.water > 0) {
                    gameState.water--;
                    plot.state = 'watered';
                    updatePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'ready') {
                // Harvest
                const seed = seeds[plot.seedType];
                let harvestAmount = gameState.season === 1 ? 2 : 1; // Double harvest in summer
                
                // Store all items in barn
                const barnKey = seed.name.toLowerCase().replace(' ', '');
                if (!gameState.barn[barnKey]) {
                    gameState.barn[barnKey] = 0;
                }
                gameState.barn[barnKey] += harvestAmount;
                
                // Reset plot
                plot.state = 'empty';
                plot.seedType = null;
                plot.plantTime = null;
                updatePlotDisplay(plotIndex);
                updateBarnDisplay();
                useEnergy(1);
                
                if (harvestAmount > 1) {
                    alert(`‚òÄÔ∏è B√¥nus do Ver√£o! Voc√™ colheu ${harvestAmount}x ${seed.name}!`);
                }
            }
        }

        function updatePlotDisplay(plotIndex) {
            const plotElement = document.getElementById(`plot-${plotIndex}`);
            const plot = gameState.plots[plotIndex];
            
            plotElement.className = `plot ${plot.state}`;
            
            switch (plot.state) {
                case 'empty':
                    plotElement.innerHTML = '';
                    break;
                case 'fertilized':
                    plotElement.innerHTML = 'üçÇ';
                    break;
                case 'planted':
                    plotElement.innerHTML = 'üå±';
                    break;
                case 'watered':
                    plotElement.innerHTML = 'üíß';
                    break;
                case 'ready':
                    plotElement.innerHTML = seeds[plot.seedType].emoji;
                    break;
            }
        }

        function checkPlantGrowth() {
            gameState.plots.forEach((plot, index) => {
                if (plot.state === 'watered' && plot.plantTime) {
                    const timePassed = Date.now() - plot.plantTime;
                    if (timePassed >= 30000) { // 30 seconds
                        plot.state = 'ready';
                        updatePlotDisplay(index);
                    }
                }
            });
            
            // Check greenhouse plots
            if (gameState.hasGreenhouse) {
                gameState.greenhousePlots.forEach((plot, index) => {
                    if (plot.state === 'watered' && plot.plantTime) {
                        const timePassed = Date.now() - plot.plantTime;
                        if (timePassed >= 30000) { // 30 seconds
                            plot.state = 'ready';
                            updateGreenhousePlotDisplay(index);
                        }
                    }
                });
            }
        }

        function updateSeasonTimer() {
            if (gameState.seasonTime > 0) {
                gameState.seasonTime--;
            }
            
            if (gameState.seasonTime <= 0) {
                gameState.season = (gameState.season + 1) % 4;
                gameState.seasonTime = 3600; // Reset to 1 hour
                
                // Handle seasonal features - Flower Field always available
                gameState.hasFlowerField = true;
                document.getElementById('flowerField').style.display = 'block';
                updateFlowersDisplay();
                
                if (gameState.season === 0) { // Spring
                    gameState.hasProducerFair = false;
                    gameState.hasCraftTable = false;
                    gameState.hasBonfire = false;
                    document.getElementById('producerFair').style.display = 'none';
                    document.getElementById('craftTable').style.display = 'none';
                    document.getElementById('bonfire').style.display = 'none';
                    document.getElementById('greenhouse').style.display = 'none';
                    document.getElementById('greenhouseShop').style.display = 'none';
                } else if (gameState.season === 1) { // Summer
                    gameState.hasProducerFair = true;
                    gameState.hasCraftTable = false;
                    gameState.hasBonfire = false;
                    gameState.producerFair.lastEarning = Date.now();
                    document.getElementById('producerFair').style.display = 'block';
                    document.getElementById('craftTable').style.display = 'none';
                    document.getElementById('bonfire').style.display = 'none';
                    document.getElementById('greenhouse').style.display = 'none';
                    document.getElementById('greenhouseShop').style.display = 'none';
                    updateProducerFairDisplay();
                } else if (gameState.season === 2) { // Autumn
                    gameState.hasProducerFair = false;
                    gameState.hasCraftTable = true;
                    gameState.hasBonfire = false;
                    document.getElementById('producerFair').style.display = 'none';
                    document.getElementById('craftTable').style.display = 'block';
                    document.getElementById('bonfire').style.display = 'none';
                    document.getElementById('greenhouse').style.display = 'none';
                    document.getElementById('greenhouseShop').style.display = 'none';
                    updateCraftTableDisplay();
                } else { // Winter
                    gameState.hasProducerFair = false;
                    gameState.hasCraftTable = false;
                    gameState.hasBonfire = true;
                    document.getElementById('producerFair').style.display = 'none';
                    document.getElementById('craftTable').style.display = 'none';
                    document.getElementById('bonfire').style.display = 'block';
                    document.getElementById('greenhouseShop').style.display = 'block';
                    if (gameState.hasGreenhouse) {
                        document.getElementById('greenhouse').style.display = 'block';
                        updateGreenhouseDisplay();
                    }
                    updateBonfireDisplay();
                }
            }
            
            const minutes = Math.floor(gameState.seasonTime / 60);
            const seconds = gameState.seasonTime % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('season').textContent = 
                `${seasonEmojis[gameState.season]} ${seasons[gameState.season]}`;
        }

        function startRain() {
            if (gameState.season === 3) { // Winter - snow instead of rain
                document.body.classList.add('snowing');
                createSnowEffect();
                
                // Snow doesn't water crops, but waters greenhouse if available
                if (gameState.hasGreenhouse) {
                    gameState.greenhousePlots.forEach((plot, index) => {
                        if (plot.state === 'planted') {
                            plot.state = 'watered';
                            updateGreenhousePlotDisplay(index);
                        }
                    });
                }
                
                setTimeout(() => {
                    document.body.classList.remove('snowing');
                    document.getElementById('rainEffect').innerHTML = '';
                }, 15000);
            } else {
                document.body.classList.add('raining');
                createRainEffect();
                
                // Auto-water all planted crops
                gameState.plots.forEach((plot, index) => {
                    if (plot.state === 'planted') {
                        plot.state = 'watered';
                        updatePlotDisplay(index);
                    }
                });
                
                setTimeout(() => {
                    document.body.classList.remove('raining');
                    document.getElementById('rainEffect').innerHTML = '';
                }, 15000);
            }
        }

        function createRainEffect() {
            const rainEffect = document.getElementById('rainEffect');
            rainEffect.innerHTML = '';
            
            for (let i = 0; i < 100; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                rainEffect.appendChild(drop);
            }
        }

        function createSnowEffect() {
            const rainEffect = document.getElementById('rainEffect');
            rainEffect.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '‚ùÑÔ∏è';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 2 + 's';
                rainEffect.appendChild(snowflake);
            }
        }

        function buyWell() {
            if (gameState.coins >= 50 && !gameState.hasWell) {
                gameState.coins -= 50;
                gameState.hasWell = true;
                document.getElementById('wellContainer').style.display = 'block';
                document.getElementById('wellShop').style.display = 'none';
                updateUI();
                alert('üèóÔ∏è Po√ßo constru√≠do! Agora voc√™ tem √°gua infinita!');
            }
        }

        function collectWater() {
            if (gameState.hasWell) {
                gameState.water += 4;
                updateUI();
            }
        }

        function buyDogHouse() {
            if (gameState.coins >= 200 && !gameState.hasDogHouse) {
                gameState.coins -= 200;
                gameState.hasDogHouse = true;
                document.getElementById('dogHouse').style.display = 'block';
                document.getElementById('dogHouseShop').style.display = 'none';
                updateUI();
                alert('üè† Casinha da Mocinha constru√≠da! Ela est√° esperando por voc√™!');
            }
        }

        function buyDogFood() {
            if (gameState.coins >= 30) {
                gameState.coins -= 30;
                gameState.barn.dogFood++;
                
                // Chance de ganhar osso a cada 2 ra√ß√µes
                if (gameState.barn.dogFood % 2 === 0) {
                    gameState.barn.bones++;
                    alert('ü¶¥ Voc√™ ganhou um osso de surpresa!');
                }
                
                updateUI();
                updateBarnDisplay();
            }
        }

        function buyHorseStable() {
            if (gameState.coins >= 1000 && !gameState.hasHorseStable) {
                gameState.coins -= 1000;
                gameState.hasHorseStable = true;
                document.getElementById('horseStable').style.display = 'block';
                document.getElementById('horseStableShop').style.display = 'none';
                updateUI();
                alert('üèá Baia do Duque constru√≠da! Ele est√° pronto para trabalhar!');
            }
        }

        function buyHay() {
            if (gameState.coins >= 20) {
                gameState.coins -= 20;
                gameState.barn.hay++;
                updateUI();
                updateBarnDisplay();
            }
        }

        function buyApple() {
            if (gameState.coins >= 15) {
                gameState.coins -= 15;
                gameState.barn.apples++;
                updateUI();
                updateBarnDisplay();
            }
        }

        function buyChickenCoop() {
            if (gameState.coins >= 80 && !gameState.hasChickenCoop) {
                gameState.coins -= 80;
                gameState.hasChickenCoop = true;
                document.getElementById('chickenCoop').style.display = 'block';
                document.getElementById('chickenShop').style.display = 'block';
                document.getElementById('chickenCoopShop').style.display = 'none';
                updateUI();
                updateChickensDisplay();
                alert('üêî Galinheiro constru√≠do! Agora voc√™ pode comprar galinhas!');
            }
        }

        function buyChicken() {
            if (gameState.coins >= 25 && gameState.chickens.length < 4) {
                gameState.coins -= 25;
                gameState.chickens.push({
                    id: Date.now(),
                    type: 'chicken',
                    emoji: 'üêî',
                    state: 'idle',
                    lastFed: 0,
                    eggs: 0,
                    sick: false,
                    sickTime: 0,
                    eating: false,
                    resting: false,
                    feedingSlot: null,
                    restStartTime: null
                });
                updateUI();
                updateChickensDisplay();
            }
        }

        function buyPigPen() {
            if (gameState.coins >= 130 && !gameState.hasPigPen) {
                gameState.coins -= 130;
                gameState.hasPigPen = true;
                document.getElementById('pigPen').style.display = 'block';
                document.getElementById('pigShop').style.display = 'block';
                document.getElementById('pigPenShop').style.display = 'none';
                updateUI();
                updatePigsDisplay();
                alert('üê∑ Chiqueiro constru√≠do! Agora voc√™ pode comprar porcos!');
            }
        }

        function buyPig() {
            if (gameState.coins >= 100 && gameState.pigs.length < 4) {
                gameState.coins -= 100;
                gameState.pigs.push({
                    id: Date.now(),
                    type: 'pig',
                    emoji: 'üê∑',
                    state: 'idle',
                    lastFed: 0,
                    meat: 0,
                    sick: false,
                    sickTime: 0,
                    eating: false,
                    resting: false,
                    feedingSlot: null,
                    restStartTime: null
                });
                updateUI();
                updatePigsDisplay();
            }
        }

        function buySheepPen() {
            if (gameState.coins >= 150 && !gameState.hasSheepPen) {
                gameState.coins -= 150;
                gameState.hasSheepPen = true;
                document.getElementById('sheepPen').style.display = 'block';
                document.getElementById('sheepShop').style.display = 'block';
                document.getElementById('shearsShop').style.display = 'block';
                document.getElementById('sheepPenShop').style.display = 'none';
                updateUI();
                updateSheepDisplay();
                alert('üêë Curral das Ovelhas constru√≠do! Agora voc√™ pode comprar ovelhas!');
            }
        }

        function buySheep() {
            if (gameState.coins >= 120 && gameState.sheep.length < 4) {
                gameState.coins -= 120;
                gameState.sheep.push({
                    id: Date.now(),
                    type: 'sheep',
                    emoji: 'üêë',
                    state: 'idle',
                    lastFed: 0,
                    wool: 0,
                    sick: false,
                    sickTime: 0,
                    eating: false,
                    resting: false,
                    feedingSlot: null,
                    restStartTime: null
                });
                updateUI();
                updateSheepDisplay();
            }
        }

        function buyShears() {
            if (gameState.coins >= 35 && !gameState.hasShears) {
                gameState.coins -= 35;
                gameState.hasShears = true;
                document.getElementById('shearsShop').style.display = 'none';
                updateUI();
                alert('‚úÇÔ∏è Tesoura de Tosquiar comprada! Agora voc√™ pode tosquiar as ovelhas!');
            }
        }

        function buyCowPasture() {
            if (gameState.coins >= 200 && !gameState.hasCowPasture) {
                gameState.coins -= 200;
                gameState.hasCowPasture = true;
                document.getElementById('cowPasture').style.display = 'block';
                document.getElementById('cowShop').style.display = 'block';
                document.getElementById('cowPastureShop').style.display = 'none';
                updateUI();
                updateCowsDisplay();
                alert('üêÑ Pasto de Vacas constru√≠do! Agora voc√™ pode comprar vacas!');
            }
        }

        function buyCow() {
            if (gameState.coins >= 95 && gameState.cows.length < 4) {
                gameState.coins -= 95;
                gameState.cows.push({
                    id: Date.now(),
                    type: 'cow',
                    emoji: 'üêÑ',
                    state: 'idle',
                    lastFed: 0,
                    milk: 0,
                    manure: 0,
                    sick: false,
                    sickTime: 0,
                    eating: false,
                    resting: false,
                    feedingSlot: null,
                    restStartTime: null
                });
                updateUI();
                updateCowsDisplay();
            }
        }

        function buyVaccine() {
            if (gameState.coins >= 40) {
                gameState.coins -= 40;
                gameState.barn.vaccines++;
                updateUI();
                updateBarnDisplay();
            }
        }

        function buyAnimalFeed() {
            if (gameState.coins >= 25) {
                gameState.coins -= 25;
                gameState.barn.animalFeed++;
                updateUI();
                updateBarnDisplay();
            }
        }

        function buyGrassField() {
            if (gameState.coins >= 75 && !gameState.hasGrassField) {
                gameState.coins -= 75;
                gameState.hasGrassField = true;
                document.getElementById('grassField').style.display = 'block';
                document.getElementById('grassFieldShop').style.display = 'none';
                updateUI();
                updateGrassDisplay();
                alert('üå± Campo de Grama comprado! Colete as gramas para ganhar flores!');
            }
        }

        function buyForest() {
            if (gameState.coins >= 300 && !gameState.hasForest) {
                gameState.coins -= 300;
                gameState.hasForest = true;
                document.getElementById('forest').style.display = 'block';
                document.getElementById('forestShop').style.display = 'none';
                updateUI();
                updateTreesDisplay();
                alert('üå≥ Bosque comprado! Colete frutas e troncos das √°rvores!');
            }
        }

        function buyAxeAndWoodCutter() {
            if (gameState.coins >= 150 && !gameState.hasAxe) {
                gameState.coins -= 150;
                gameState.hasAxe = true;
                gameState.axeUses = 50;
                gameState.machines.hasWoodCutting = true;
                document.getElementById('axeStatus').style.display = 'block';
                document.getElementById('woodCutting').style.display = 'block';
                document.getElementById('axeAndWoodCutterShop').style.display = 'none';
                updateUI();
                updateAxeStatus();
                updateWoodCuttingDisplay();
                alert('ü™ì Machado e Cortar Lenha comprados! Use o machado para coletar troncos!');
            }
        }

        function addTrunkToSlot() {
            if (!gameState.barn.trunks || gameState.barn.trunks === 0) {
                alert('Voc√™ n√£o tem troncos no celeiro!');
                return;
            }
            
            if (gameState.woodCuttingSlot && gameState.woodCuttingSlot.trunk) {
                alert('J√° h√° um tronco no slot!');
                return;
            }
            
            if (!gameState.woodCuttingSlot) {
                gameState.woodCuttingSlot = {};
            }
            
            gameState.barn.trunks--;
            gameState.woodCuttingSlot.trunk = 1;
            
            updateWoodCuttingDisplay();
            updateBarnDisplay();
            updateUI();
        }

        function cutWoodInSlot() {
            if (!gameState.woodCuttingSlot || !gameState.woodCuttingSlot.trunk) {
                alert('Adicione um tronco primeiro!');
                return;
            }
            
            if (gameState.woodCuttingSlot.cutting) {
                alert('J√° est√° cortando!');
                return;
            }
            
            gameState.woodCuttingSlot.cutting = true;
            gameState.woodCuttingSlot.startTime = Date.now();
            
            updateWoodCuttingDisplay();
            
            setTimeout(() => {
                gameState.woodCuttingSlot.cutting = false;
                gameState.woodCuttingSlot.trunk = 0;
                gameState.barn.wood += 4;
                
                updateWoodCuttingDisplay();
                updateBarnDisplay();
                alert('ü™µ Tronco cortado! +4 lenhas!');
            }, 3000); // 3 seconds
        }

        function updateWoodCuttingDisplay() {
            if (!gameState.machines || !gameState.machines.hasWoodCutting) return;
            
            const slot = document.getElementById('woodCuttingSlot');
            const content = document.getElementById('woodSlotContent');
            const button = document.getElementById('cutWoodBtn');
            const status = document.getElementById('woodCuttingStatus');
            
            if (!slot || !content || !button || !status) return;
            
            if (!gameState.woodCuttingSlot) {
                gameState.woodCuttingSlot = {};
            }
            
            if (gameState.woodCuttingSlot.cutting) {
                content.textContent = 'ü™ì';
                slot.style.background = '#FFD700';
                button.disabled = true;
                status.textContent = 'Cortando...';
                status.style.color = '#ff6b00';
            } else if (gameState.woodCuttingSlot.trunk) {
                content.textContent = 'üå≥';
                slot.style.background = '#90EE90';
                button.disabled = false;
                status.textContent = 'Tronco pronto para ser cortado!';
                status.style.color = '#228B22';
            } else {
                content.textContent = '+';
                slot.style.background = '#F5DEB3';
                button.disabled = true;
                status.textContent = 'Adicione troncos para cortar em lenha';
                status.style.color = '#8B4513';
            }
        }

        function buyFishingRod() {
            if (gameState.coins >= 60) {
                gameState.coins -= 60;
                gameState.hasFishingRod = true;
                gameState.fishingRodUses = 20;
                document.getElementById('fishingRodStatus').style.display = 'block';
                updateUI();
                updateFishingRodStatus();
                alert('üé£ Vara de pesca comprada! Agora voc√™ pode pescar no lago!');
            }
        }

        function buyPickaxe() {
            if (gameState.coins >= 80) {
                gameState.coins -= 80;
                gameState.hasPickaxe = true;
                gameState.pickaxeUses = 30;
                document.getElementById('pickaxeStatus').style.display = 'block';
                updateUI();
                updatePickaxeStatus();
                alert('‚õèÔ∏è Picareta comprada! Agora voc√™ pode minerar pedras preciosas!');
            }
        }

        function buyBeehive() {
            if (gameState.coins >= 120 && !gameState.hasBeehive) {
                gameState.coins -= 120;
                gameState.hasBeehive = true;
                gameState.beehive.lastHarvest = Date.now();
                document.getElementById('beehive').style.display = 'block';
                document.getElementById('beehiveShop').style.display = 'none';
                
                // Show flower seed shops
                document.getElementById('tulipSeedShop').style.display = 'block';
                document.getElementById('lilySeedShop').style.display = 'block';
                document.getElementById('sakuraSeedShop').style.display = 'block';
                
                updateUI();
                updateBeehiveDisplay();
                alert('üçØ Colmeia comprada! Plante flores para as abelhas produzirem mel a cada 10 minutos!');
            }
        }

        function buyFlowerSeed(type) {
            if (gameState.coins >= 15) {
                gameState.coins -= 15;
                
                const seedTypes = {
                    'tulipa': 'tulipSeeds',
                    'lirio': 'lilySeeds',
                    'sakura': 'sakuraSeeds'
                };
                
                if (!gameState.barn[seedTypes[type]]) {
                    gameState.barn[seedTypes[type]] = 0;
                }
                gameState.barn[seedTypes[type]]++;
                
                updateUI();
                updateBarnDisplay();
                
                const flowerNames = {
                    'tulipa': 'Tulipa',
                    'lirio': 'L√≠rio',
                    'sakura': 'Sakura'
                };
                
                alert(`üå± Semente de ${flowerNames[type]} comprada!`);
            }
        }

        function plantFlowerInBeehive(slotIndex) {
            // Show seed selection modal
            const modal = document.getElementById('foodModal');
            const content = document.getElementById('foodMenuContent');
            const title = document.getElementById('foodModalTitle');
            
            title.textContent = 'üå± Escolha uma semente para plantar';
            content.innerHTML = '';
            
            const seeds = [
                {type: 'tulipa', name: 'Tulipa', emoji: 'üå∑', available: gameState.barn.tulipSeeds || 0},
                {type: 'lirio', name: 'L√≠rio', emoji: 'üå∫', available: gameState.barn.lilySeeds || 0},
                {type: 'sakura', name: 'Sakura', emoji: 'üå∏', available: gameState.barn.sakuraSeeds || 0}
            ];
            
            let hasSeeds = false;
            
            seeds.forEach(seed => {
                if (seed.available > 0) {
                    hasSeeds = true;
                    const seedDiv = document.createElement('div');
                    seedDiv.className = 'food-item';
                    seedDiv.innerHTML = `${seed.emoji}<br>${seed.name}<br><small>Dispon√≠vel: ${seed.available}</small>`;
                    seedDiv.onclick = () => plantSeedInSlot(slotIndex, seed.type);
                    content.appendChild(seedDiv);
                }
            });
            
            if (!hasSeeds) {
                content.innerHTML = '<p>Voc√™ n√£o tem sementes de flores! Compre no mercadinho.</p>';
            }
            
            modal.style.display = 'flex';
        }

        function plantSeedInSlot(slotIndex, seedType) {
            const seedTypes = {
                'tulipa': 'tulipSeeds',
                'lirio': 'lilySeeds',
                'sakura': 'sakuraSeeds'
            };
            
            if (gameState.barn[seedTypes[seedType]] > 0) {
                gameState.barn[seedTypes[seedType]]--;
                
                const now = Date.now();
                gameState.beehive.flowerSlots[slotIndex] = seedType;
                gameState.beehive.flowerGrowthTimes[slotIndex] = now;
                gameState.beehive.flowerExpireTimes[slotIndex] = now + 1860000; // 31 minutes (1 min growth + 30 min life)
                
                updateBarnDisplay();
                updateBeehiveDisplay();
                closeFoodMenu();
                
                const flowerNames = {
                    'tulipa': 'Tulipa',
                    'lirio': 'L√≠rio',
                    'sakura': 'Sakura'
                };
                
                alert(`üå± Semente de ${flowerNames[seedType]} plantada! Crescer√° em 1 minuto.`);
            }
        }

        function buyComposter() {
            if (gameState.coins >= 180 && !gameState.machines.hasComposter) {
                gameState.coins -= 180;
                gameState.machines.hasComposter = true;
                document.getElementById('composter').style.display = 'block';
                document.getElementById('composterShop').style.display = 'none';
                updateUI();
                alert('üóëÔ∏è Composteira comprada! Agora voc√™ pode fazer adubo!');
            }
        }

        function buyMixer() {
            if (gameState.coins >= 90 && !gameState.machines.hasMixer) {
                gameState.coins -= 90;
                gameState.machines.hasMixer = true;
                document.getElementById('mixer').style.display = 'block';
                document.getElementById('mixerShop').style.display = 'none';
                updateUI();
                alert('ü•£ Misturador comprado! Agora voc√™ pode fazer ra√ß√µes!');
            }
        }

        function buyCoffeeRoaster() {
            if (gameState.coins >= 250 && !gameState.machines.hasCoffeeRoaster) {
                gameState.coins -= 250;
                gameState.machines.hasCoffeeRoaster = true;
                document.getElementById('coffeeRoaster').style.display = 'block';
                document.getElementById('coffeeRoasterShop').style.display = 'none';
                updateUI();
                alert('‚òï Torra de Caf√© comprada! Agora voc√™ pode torrar caf√©!');
            }
        }

        function buyJuiceMachine() {
            if (gameState.coins >= 120 && !gameState.machines.hasJuiceMachine) {
                gameState.coins -= 120;
                gameState.machines.hasJuiceMachine = true;
                document.getElementById('juiceMachine').style.display = 'block';
                document.getElementById('juiceMachineShop').style.display = 'none';
                updateUI();
                alert('üßÉ M√°quina de Suco comprada! Agora voc√™ pode fazer suco de uva!');
            }
        }

        function buyMill() {
            if (gameState.coins >= 200 && !gameState.machines.hasMill) {
                gameState.coins -= 200;
                gameState.machines.hasMill = true;
                document.getElementById('mill').style.display = 'block';
                document.getElementById('millShop').style.display = 'none';
                updateUI();
                alert('üåæ Moinho comprado! Agora voc√™ pode fazer farinha!');
            }
        }

        function buyCheeseMaker() {
            if (gameState.coins >= 160 && !gameState.machines.hasCheeseMaker) {
                gameState.coins -= 160;
                gameState.machines.hasCheeseMaker = true;
                document.getElementById('cheeseMaker').style.display = 'block';
                document.getElementById('cheeseMakerShop').style.display = 'none';
                updateUI();
                alert('üßÄ Queijeira comprada! Agora voc√™ pode fazer queijo!');
            }
        }

        function buySpinningMachine() {
            if (gameState.coins >= 140 && !gameState.machines.hasSpinningMachine) {
                gameState.coins -= 140;
                gameState.machines.hasSpinningMachine = true;
                document.getElementById('spinningMachine').style.display = 'block';
                document.getElementById('spinningMachineShop').style.display = 'none';
                updateUI();
                alert('üß∂ M√°quina de Fiar comprada! Agora voc√™ pode fazer novelos!');
            }
        }

        function buyGrassDryer() {
            if (gameState.coins >= 150 && !gameState.machines.hasGrassDryer) {
                gameState.coins -= 150;
                gameState.machines.hasGrassDryer = true;
                document.getElementById('grassDryer').style.display = 'block';
                document.getElementById('grassDryerShop').style.display = 'none';
                updateUI();
                alert('üåæ Secador de Grama comprado! Agora voc√™ pode secar grama e fazer feno!');
            }
        }

        function buyWoodCutter() {
            if (gameState.coins >= 85 && !gameState.machines.hasWoodCutter) {
                gameState.coins -= 85;
                gameState.machines.hasWoodCutter = true;
                document.getElementById('woodCutter').style.display = 'block';
                document.getElementById('woodCutterShop').style.display = 'none';
                updateUI();
                alert('ü™ì Cortador de Lenha comprado! Agora voc√™ pode cortar troncos em lenha!');
            }
        }

        function buyStove() {
            if (gameState.coins >= 250 && !gameState.machines.hasStove) {
                gameState.coins -= 250;
                gameState.machines.hasStove = true;
                document.getElementById('stove').style.display = 'block';
                document.getElementById('stoveShop').style.display = 'none';
                updateUI();
                alert('üî• Fog√£o com Forno comprado! Agora voc√™ pode cozinhar refei√ß√µes!');
            }
        }

        function buyGreenhouse() {
            if (gameState.coins >= 500 && !gameState.hasGreenhouse && gameState.season === 3) {
                gameState.coins -= 500;
                gameState.hasGreenhouse = true;
                document.getElementById('greenhouse').style.display = 'block';
                document.getElementById('greenhouseShop').style.display = 'none';
                createGreenhouseGrid();
                updateUI();
                alert('üè† Estufa comprada! Agora voc√™ pode plantar no inverno!');
            }
        }

        function buyTelephone() {
            if (gameState.coins >= 300 && !gameState.hasTelephone) {
                gameState.coins -= 300;
                gameState.hasTelephone = true;
                document.getElementById('telephone').style.display = 'block';
                document.getElementById('telephoneShop').style.display = 'none';
                updateUI();
                alert('‚òéÔ∏è Telefone comprado! Agora voc√™ pode fazer liga√ß√µes especiais!');
                
                // Start generating truck orders
                generateTruckOrders();
                setInterval(generateTruckOrders, 1800000); // Every 30 minutes
            }
        }

        function buyTruck() {
            if (gameState.coins >= 2000 && !gameState.hasTruck) {
                gameState.coins -= 2000;
                gameState.hasTruck = true;
                document.getElementById('truckArea').style.display = 'block';
                document.getElementById('truckShop').style.display = 'none';
                document.getElementById('ethanolShop').style.display = 'block';
                document.getElementById('truckOrdersPanel').style.display = 'block';
                updateUI();
                updateTruckDisplay();
                alert('üöö Caminhonete comprada! Agora voc√™ pode fazer entregas comerciais!');
            }
        }

        function buyEthanol() {
            if (gameState.coins >= 25) {
                gameState.coins -= 25;
                gameState.barn.ethanol++;
                updateUI();
                updateBarnDisplay();
            }
        }

        function refuelTruck() {
            if (gameState.barn.ethanol > 0 && gameState.truck.fuel < gameState.truck.maxFuel) {
                gameState.barn.ethanol--;
                gameState.truck.fuel++;
                updateBarnDisplay();
                updateTruckDisplay();
                updateUI();
            }
        }

        function generateTruckOrders() {
            if (!gameState.hasTelephone || gameState.truckOrders.length >= 3) return;
            
            const orderTypes = [
                {item: 'Saco de Farinha', quantity: 50, reward: 5000, emoji: 'üåæ', timeLimit: 3600000}, // 1 hour
                {item: 'Saco de Caf√©', quantity: 30, reward: 4500, emoji: '‚òï', timeLimit: 2700000}, // 45 minutes
                {item: 'Queijo', quantity: 25, reward: 3500, emoji: 'üßÄ', timeLimit: 3600000}, // 1 hour
                {item: 'Suco de Uva', quantity: 40, reward: 4000, emoji: 'üßÉ', timeLimit: 3000000}, // 50 minutes
                {item: 'Novelo', quantity: 20, reward: 2800, emoji: 'üß∂', timeLimit: 2400000}, // 40 minutes
                {item: 'P√£o', quantity: 35, reward: 3200, emoji: 'üçû', timeLimit: 3300000} // 55 minutes
            ];
            
            while (gameState.truckOrders.length < 3) {
                const randomOrder = orderTypes[Math.floor(Math.random() * orderTypes.length)];
                gameState.truckOrders.push({
                    id: Date.now() + Math.random(),
                    ...randomOrder,
                    client: `Comerciante ${Math.floor(Math.random() * 100) + 1}`,
                    startTime: Date.now()
                });
            }
            updateTruckOrdersDisplay();
        }

        function showTruckOrders() {
            if (gameState.truckOrders.length === 0) {
                alert('üìû N√£o h√° pedidos comerciais no momento.');
                return;
            }
            
            let orderText = "üìû PEDIDOS COMERCIAIS DISPON√çVEIS:\n\n";
            gameState.truckOrders.forEach((order, index) => {
                const timeLeft = order.timeLimit - (Date.now() - order.startTime);
                const minutesLeft = Math.max(0, Math.floor(timeLeft / 60000));
                orderText += `${index + 1}. ${order.client}\n`;
                orderText += `   ${order.emoji} ${order.quantity}x ${order.item}\n`;
                orderText += `   üí∞ ${order.reward} moedas\n`;
                orderText += `   ‚è∞ ${minutesLeft} minutos restantes\n\n`;
            });
            
            const choice = prompt(orderText + "Digite o n√∫mero do pedido para aceitar (ou 0 para cancelar):");
            const orderIndex = parseInt(choice) - 1;
            
            if (orderIndex >= 0 && orderIndex < gameState.truckOrders.length) {
                acceptTruckOrder(gameState.truckOrders[orderIndex].id);
            }
        }

        function acceptTruckOrder(orderId) {
            if (!gameState.hasTruck) {
                alert('üöö Voc√™ precisa de uma caminhonete para aceitar pedidos comerciais!');
                return;
            }
            
            if (gameState.truck.currentOrder) {
                alert('üöö Voc√™ j√° tem um pedido ativo na caminhonete!');
                return;
            }
            
            const order = gameState.truckOrders.find(o => o.id === orderId);
            if (order) {
                gameState.truck.currentOrder = order;
                gameState.truckOrders = gameState.truckOrders.filter(o => o.id !== orderId);
                
                updateTruckOrdersDisplay();
                updateTruckDisplay();
                alert(`üìû Pedido aceito! Carregue ${order.quantity}x ${order.item} na caminhonete.`);
            }
        }

        function loadTruckSlot(slotIndex) {
            if (!gameState.truck.currentOrder) {
                alert('üöö Voc√™ precisa aceitar um pedido comercial primeiro!');
                return;
            }
            
            const order = gameState.truck.currentOrder;
            const requiredItem = order.item;
            
            if (!gameState.inventory.others[requiredItem] || gameState.inventory.others[requiredItem] === 0) {
                alert(`üì¶ Voc√™ n√£o tem ${requiredItem} para carregar!`);
                return;
            }
            
            if (gameState.truck.slots[slotIndex]) {
                alert('üì¶ Este slot j√° est√° ocupado!');
                return;
            }
            
            // Calculate how many items to load (divide total by 4 slots)
            const itemsPerSlot = Math.ceil(order.quantity / 4);
            const itemsToLoad = Math.min(itemsPerSlot, gameState.inventory.others[requiredItem]);
            
            gameState.inventory.others[requiredItem] -= itemsToLoad;
            gameState.truck.slots[slotIndex] = {
                item: requiredItem,
                quantity: itemsToLoad,
                emoji: order.emoji
            };
            
            updateInventoryDisplay();
            updateTruckDisplay();
        }

        function unloadTruckSlot(slotIndex) {
            const slot = gameState.truck.slots[slotIndex];
            if (slot) {
                if (!gameState.inventory.others[slot.item]) {
                    gameState.inventory.others[slot.item] = 0;
                }
                gameState.inventory.others[slot.item] += slot.quantity;
                gameState.truck.slots[slotIndex] = null;
                
                updateInventoryDisplay();
                updateTruckDisplay();
            }
        }

        function deliverTruckOrder() {
            if (!gameState.truck.currentOrder) {
                alert('üöö N√£o h√° pedido ativo!');
                return;
            }
            
            if (gameState.truck.fuel < 3) {
                alert('‚õΩ Voc√™ precisa de pelo menos 3 de combust√≠vel para fazer a entrega!');
                return;
            }
            
            const order = gameState.truck.currentOrder;
            let totalLoaded = 0;
            
            gameState.truck.slots.forEach(slot => {
                if (slot && slot.item === order.item) {
                    totalLoaded += slot.quantity;
                }
            });
            
            if (totalLoaded < order.quantity) {
                alert(`üì¶ Voc√™ precisa carregar ${order.quantity}x ${order.item}! Carregado: ${totalLoaded}`);
                return;
            }
            
            // Check time limit
            const timeElapsed = Date.now() - order.startTime;
            if (timeElapsed > order.timeLimit) {
                alert('‚è∞ Tempo limite excedido! Pedido cancelado.');
                gameState.truck.currentOrder = null;
                gameState.truck.slots = [null, null, null, null];
                updateTruckDisplay();
                return;
            }
            
            // Successful delivery
            gameState.truck.fuel -= 3;
            gameState.coins += order.reward;
            gameState.truck.currentOrder = null;
            gameState.truck.slots = [null, null, null, null];
            
            updateUI();
            updateTruckDisplay();
            
            alert(`üöö Entrega realizada com sucesso! +${order.reward} moedas!`);
            
            // Generate new order
            setTimeout(generateTruckOrders, 5000);
        }

        function updateTruckDisplay() {
            if (!gameState.hasTruck) return;
            
            document.getElementById('truckFuel').textContent = gameState.truck.fuel;
            
            const grid = document.getElementById('truckGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const slot = document.createElement('div');
                slot.className = 'flower-slot';
                
                if (gameState.truck.slots[i]) {
                    const item = gameState.truck.slots[i];
                    slot.innerHTML = `${item.emoji}<br>${item.quantity}x`;
                    slot.onclick = () => unloadTruckSlot(i);
                    slot.title = 'Clique para descarregar';
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = 'üì¶<br>Vazio';
                    slot.onclick = () => loadTruckSlot(i);
                    slot.title = 'Clique para carregar';
                }
                
                grid.appendChild(slot);
            }
            
            // Update deliver button
            const deliverBtn = document.getElementById('deliverTruckBtn');
            deliverBtn.disabled = !gameState.truck.currentOrder || gameState.truck.fuel < 3;
            
            // Update refuel button
            const refuelBtn = document.getElementById('refuelBtn');
            refuelBtn.disabled = gameState.barn.ethanol === 0 || gameState.truck.fuel >= gameState.truck.maxFuel;
        }

        function updateTruckOrdersDisplay() {
            const ordersList = document.getElementById('truckOrdersList');
            ordersList.innerHTML = '';
            
            gameState.truckOrders.forEach(order => {
                const timeLeft = order.timeLimit - (Date.now() - order.startTime);
                const minutesLeft = Math.max(0, Math.floor(timeLeft / 60000));
                
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-item';
                orderDiv.style.borderColor = minutesLeft < 10 ? '#ff4444' : '#4169E1';
                
                orderDiv.innerHTML = `
                    <div>
                        <strong>${order.client}</strong><br>
                        ${order.emoji} ${order.quantity}x ${order.item}<br>
                        üí∞ ${order.reward} moedas<br>
                        <small style="color: ${minutesLeft < 10 ? '#ff4444' : '#666'};">‚è∞ ${minutesLeft} min restantes</small>
                    </div>
                    <div class="order-buttons">
                        <button class="accept-btn" onclick="acceptTruckOrder(${order.id})">üìû</button>
                        <button class="reject-btn" onclick="rejectTruckOrder(${order.id})">‚ùå</button>
                    </div>
                `;
                ordersList.appendChild(orderDiv);
            });
            
            // Show current order if any
            if (gameState.truck.currentOrder) {
                const currentDiv = document.createElement('div');
                currentDiv.className = 'order-item';
                currentDiv.style.backgroundColor = '#e8f5e8';
                currentDiv.style.borderColor = '#4CAF50';
                
                const order = gameState.truck.currentOrder;
                const timeLeft = order.timeLimit - (Date.now() - order.startTime);
                const minutesLeft = Math.max(0, Math.floor(timeLeft / 60000));
                
                currentDiv.innerHTML = `
                    <div>
                        <strong>üöö PEDIDO ATIVO</strong><br>
                        ${order.emoji} ${order.quantity}x ${order.item}<br>
                        üí∞ ${order.reward} moedas<br>
                        <small style="color: ${minutesLeft < 10 ? '#ff4444' : '#666'};">‚è∞ ${minutesLeft} min restantes</small>
                    </div>
                `;
                ordersList.appendChild(currentDiv);
            }
        }

        function rejectTruckOrder(orderId) {
            gameState.truckOrders = gameState.truckOrders.filter(o => o.id !== orderId);
            updateTruckOrdersDisplay();
            setTimeout(generateTruckOrders, 5000);
        }

        function checkTruckOrderExpiration() {
            if (!gameState.hasTelephone) return;
            
            const now = Date.now();
            let expiredOrders = 0;
            
            // Check regular truck orders
            gameState.truckOrders = gameState.truckOrders.filter(order => {
                const timeElapsed = now - order.startTime;
                if (timeElapsed > order.timeLimit) {
                    expiredOrders++;
                    return false;
                }
                return true;
            });
            
            // Check current truck order
            if (gameState.truck.currentOrder) {
                const timeElapsed = now - gameState.truck.currentOrder.startTime;
                if (timeElapsed > gameState.truck.currentOrder.timeLimit) {
                    gameState.truck.currentOrder = null;
                    gameState.truck.slots = [null, null, null, null];
                    expiredOrders++;
                    
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #ff4444;
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        z-index: 3000;
                        font-weight: bold;
                        font-size: 18px;
                        text-align: center;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    `;
                    alertDiv.textContent = '‚è∞ Pedido comercial expirou! A caminhonete foi esvaziada.';
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 4000);
                    
                    updateTruckDisplay();
                }
            }
            
            if (expiredOrders > 0) {
                updateTruckOrdersDisplay();
                // Generate new orders to replace expired ones
                setTimeout(generateTruckOrders, 5000);
            }
        }

        function usePhone() {
            if (!gameState.hasTelephone) return;
            
            const phoneOptions = [
                "üìû Ligar para o Veterin√°rio (Cura todos os animais doentes) - 100üí∞",
                "üìû Ligar para o Entregador (Entrega instant√¢nea de pedidos) - 50üí∞",
                "üìû Ligar para o Meteorologista (Causa chuva imediata) - 75üí∞",
                "üìû Ver Pedidos Comerciais",
                "üìû Cancelar"
            ];
            
            const choice = prompt("‚òéÔ∏è TELEFONE\n\nEscolha uma op√ß√£o:\n\n" + 
                phoneOptions.map((option, index) => `${index + 1}. ${option}`).join('\n'));
            
            switch(choice) {
                case '1':
                    callVeterinarian();
                    break;
                case '2':
                    callDelivery();
                    break;
                case '3':
                    callWeatherMan();
                    break;
                case '4':
                    showTruckOrders();
                    break;
                default:
                    break;
            }
        }

        function callVeterinarian() {
            if (gameState.coins >= 100) {
                gameState.coins -= 100;
                
                let curedCount = 0;
                const allAnimals = [
                    ...gameState.chickens,
                    ...gameState.pigs,
                    ...gameState.sheep,
                    ...gameState.cows
                ];
                
                allAnimals.forEach(animal => {
                    if (animal.sick) {
                        animal.sick = false;
                        animal.sickTime = 0;
                        curedCount++;
                    }
                });
                
                updateUI();
                updateChickensDisplay();
                updatePigsDisplay();
                updateSheepDisplay();
                updateCowsDisplay();
                
                if (curedCount > 0) {
                    alert(`üè• Veterin√°rio curou ${curedCount} animais doentes!`);
                } else {
                    alert('üè• Veterin√°rio: "Todos os seus animais est√£o saud√°veis!"');
                }
            } else {
                alert('üí∞ Voc√™ precisa de 100 moedas para chamar o veterin√°rio!');
            }
        }

        function callDelivery() {
            if (gameState.coins >= 50 && gameState.orders.length > 0) {
                gameState.coins -= 50;
                
                // Complete all current orders instantly
                let totalReward = 0;
                gameState.orders.forEach(order => {
                    totalReward += order.reward;
                });
                
                gameState.coins += totalReward;
                gameState.orders = [];
                
                updateUI();
                updateOrdersDisplay();
                generateOrders();
                
                alert(`üöö Entregador completou todos os pedidos instantaneamente! +${totalReward} moedas!`);
            } else if (gameState.orders.length === 0) {
                alert('üì¶ N√£o h√° pedidos para entregar!');
            } else {
                alert('üí∞ Voc√™ precisa de 50 moedas para chamar o entregador!');
            }
        }

        function callWeatherMan() {
            if (gameState.coins >= 75) {
                gameState.coins -= 75;
                updateUI();
                
                alert('üåßÔ∏è Meteorologista: "Chuva chegando em 5 segundos!"');
                
                setTimeout(() => {
                    startRain();
                }, 5000);
            } else {
                alert('üí∞ Voc√™ precisa de 75 moedas para chamar o meteorologista!');
            }
        }

        function lightBonfire() {
            if (gameState.barn.coal >= 3 && gameState.barn.wood >= 4 && !gameState.bonfire.lit) {
                gameState.barn.coal -= 3;
                gameState.barn.wood -= 4;
                gameState.bonfire.lit = true;
                gameState.bonfire.startTime = Date.now();
                
                updateBarnDisplay();
                updateBonfireDisplay();
                updateUI();
                
                // Auto-extinguish after 25 minutes
                setTimeout(() => {
                    if (gameState.bonfire.lit) {
                        gameState.bonfire.lit = false;
                        updateBonfireDisplay();
                        
                        // Alert player that bonfire went out
                        const alertDiv = document.createElement('div');
                        alertDiv.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: #ff4444;
                            color: white;
                            padding: 20px 30px;
                            border-radius: 15px;
                            z-index: 3000;
                            font-weight: bold;
                            font-size: 18px;
                            text-align: center;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        `;
                        alertDiv.textContent = 'üî• A fogueira apagou! Os animais n√£o produzir√£o at√© voc√™ acend√™-la novamente!';
                        document.body.appendChild(alertDiv);
                        
                        setTimeout(() => {
                            document.body.removeChild(alertDiv);
                        }, 5000);
                    }
                }, gameState.bonfire.duration);
                
                alert('üî• Fogueira acesa! Os animais ficar√£o aquecidos por 25 minutos!');
            } else if (gameState.bonfire.lit) {
                alert('A fogueira j√° est√° acesa!');
            } else {
                alert('Voc√™ precisa de 3 Carv√µes e 4 Lenhas para acender a fogueira!');
            }
        }

        function restAvatar() {
            if (!gameState.avatar.resting && !gameState.avatar.sick) {
                gameState.avatar.resting = true;
                gameState.avatar.restStartTime = Date.now();
                document.getElementById('restBtn').disabled = true;
                document.getElementById('restBtn').textContent = 'üò¥ Descansando...';
                
                setTimeout(() => {
                    if (gameState.avatar.resting) {
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, 
                            gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.5));
                        gameState.avatar.resting = false;
                        document.getElementById('restBtn').disabled = false;
                        document.getElementById('restBtn').textContent = 'üò¥ Descansar 5min';
                        updateAvatarUI();
                    }
                }, 300000); // 5 minutes
            }
        }

        function openFoodMenu() {
            const modal = document.getElementById('foodModal');
            const content = document.getElementById('foodMenuContent');
            const title = document.getElementById('foodModalTitle');
            
            title.textContent = 'üçΩÔ∏è Menu de Comida';
            content.innerHTML = '';
            
            // Available cooked meals
            const meals = [
                {name: 'ch√°', displayName: 'Ch√°', emoji: 'üçµ', effect: 'Cura doen√ßa'},
                {name: 'salada', displayName: 'Salada', emoji: 'ü•ó', effect: '+30% energia'},
                {name: 'stew', displayName: 'Ensopado', emoji: 'üç≤', effect: '+50% energia'},
                {name: 'steak', displayName: 'Bife', emoji: 'ü•©', effect: '+100% energia'},
                {name: 'chicken', displayName: 'Frango', emoji: 'üçó', effect: '+65% energia'},
                {name: 'cookedFish', displayName: 'Peixe Cozido', emoji: 'üêü', effect: '+80% energia'}
            ];
            
            let hasFood = false;
            
            meals.forEach(meal => {
                if (gameState.barn[meal.name] > 0) {
                    hasFood = true;
                    const foodItem = document.createElement('div');
                    
                    // If avatar is sick, only allow tea
                    if (gameState.avatar.sick && meal.name !== 'ch√°') {
                        foodItem.className = 'food-item disabled';
                        foodItem.innerHTML = `${meal.emoji}<br>${meal.displayName}<br><small>N√£o pode comer doente</small><br><small>Dispon√≠vel: ${gameState.barn[meal.name]}</small>`;
                    } else {
                        foodItem.className = 'food-item';
                        foodItem.innerHTML = `${meal.emoji}<br>${meal.displayName}<br><small>${meal.effect}</small><br><small>Dispon√≠vel: ${gameState.barn[meal.name]}</small>`;
                        foodItem.onclick = () => eatFood(meal.name, meal.displayName);
                    }
                    
                    content.appendChild(foodItem);
                }
            });
            
            if (!hasFood) {
                content.innerHTML = '<p>Voc√™ n√£o tem comida preparada! Use o fog√£o para cozinhar refei√ß√µes.</p>';
            }
            
            modal.style.display = 'flex';
        }

        function closeFoodMenu() {
            document.getElementById('foodModal').style.display = 'none';
        }

        function addWoodToStove() {
            if (gameState.barn.wood > 0) {
                gameState.barn.wood--;
                gameState.machines.stove.woodSlot++;
                updateBarnDisplay();
                updateStoveDisplay();
                updateUI();
            } else {
                alert('Voc√™ n√£o tem lenha!');
            }
        }

        function removeWoodFromStove() {
            if (gameState.machines.stove.woodSlot > 0) {
                gameState.barn.wood++;
                gameState.machines.stove.woodSlot--;
                updateBarnDisplay();
                updateStoveDisplay();
                updateUI();
            }
        }

        function addIngredientToStove(slotIndex) {
            if (gameState.machines.stove.ingredientSlots[slotIndex]) {
                alert('Este slot j√° est√° ocupado!');
                return;
            }

            // Show ingredient selection modal
            const modal = document.getElementById('foodModal');
            const content = document.getElementById('foodMenuContent');
            const title = document.getElementById('foodModalTitle');
            
            title.textContent = 'ü•ò Escolha um ingrediente';
            content.innerHTML = '';
            
            // Available ingredients
            const ingredients = [
                // Water
                {name: '√Ågua', emoji: 'üíß', source: 'water', available: gameState.water},
                // Herbs from stove storage
                {name: 'Ervas', emoji: 'üåø', source: 'stove.herbs', available: gameState.machineStorage.stove.herbs},
                // Vegetables from inventory
                {name: 'Tomate', emoji: 'üçÖ', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Tomate'] || 0},
                {name: 'Alface', emoji: 'ü•¨', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Alface'] || 0},
                {name: 'Br√≥colis', emoji: 'ü•¶', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Br√≥colis'] || 0},
                {name: 'Batata', emoji: 'ü•î', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Batata'] || 0},
                {name: 'Ab√≥bora', emoji: 'üéÉ', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Ab√≥bora'] || 0},
                // Proteins
                {name: 'Ovos', emoji: 'ü•ö', source: 'others', available: gameState.inventory.others['Ovos'] || 0},
                {name: 'Carne Su√≠na', emoji: 'ü•©', source: 'stove.porkMeat', available: gameState.machineStorage.stove.porkMeat},
                {name: 'Frango Cru', emoji: 'üêì', source: 'barn.rawChicken', available: gameState.barn.rawChicken || 0},
                {name: 'Peixe', emoji: 'üêü', source: 'others', available: gameState.inventory.others['Peixe'] || 0},
                // Dairy
                {name: 'Leite', emoji: 'ü•õ', source: 'others', available: gameState.inventory.others['Leite'] || 0},
                // Flour
                {name: 'Farinha', emoji: 'üåæ', source: 'others', available: gameState.inventory.others['Saco de Farinha'] || 0}
            ];
            
            let hasIngredients = false;
            
            ingredients.forEach(ingredient => {
                if (ingredient.available > 0) {
                    hasIngredients = true;
                    const ingredientDiv = document.createElement('div');
                    ingredientDiv.className = 'food-item';
                    ingredientDiv.innerHTML = `${ingredient.emoji}<br>${ingredient.name}<br><small>Dispon√≠vel: ${ingredient.available}</small>`;
                    ingredientDiv.onclick = () => selectIngredient(slotIndex, ingredient);
                    content.appendChild(ingredientDiv);
                }
            });
            
            if (!hasIngredients) {
                content.innerHTML = '<p>Voc√™ n√£o tem ingredientes dispon√≠veis!</p>';
            }
            
            modal.style.display = 'flex';
        }

        function selectIngredient(slotIndex, ingredient) {
            // Remove ingredient from source
            if (ingredient.source === 'water') {
                gameState.water--;
            } else if (ingredient.source === 'stove.herbs') {
                gameState.machineStorage.stove.herbs--;
            } else if (ingredient.source === 'stove.porkMeat') {
                gameState.machineStorage.stove.porkMeat--;
            } else if (ingredient.source === 'barn.rawChicken') {
                gameState.barn.rawChicken--;
            } else if (ingredient.source === 'fruitsVegetables') {
                gameState.inventory.fruitsVegetables[ingredient.name]--;
            } else if (ingredient.source === 'others') {
                if (ingredient.name === 'Farinha') {
                    gameState.inventory.others['Saco de Farinha']--;
                } else {
                    gameState.inventory.others[ingredient.name]--;
                }
            }
            
            // Add to stove slot
            gameState.machines.stove.ingredientSlots[slotIndex] = {
                name: ingredient.name,
                emoji: ingredient.emoji
            };
            
            updateStoveDisplay();
            updateInventoryDisplay();
            updateBarnDisplay();
            updateMachineStorageDisplay();
            updateUI();
            closeFoodMenu();
        }

        function cookInStove() {
            if (gameState.machines.stove.working) {
                alert('O fog√£o est√° ocupado!');
                return;
            }

            const slots = gameState.machines.stove.ingredientSlots;
            const woodSlot = gameState.machines.stove.woodSlot;
            
            // Check recipes
            const recipe = checkStoveRecipe(slots, woodSlot);
            
            if (!recipe) {
                alert('Receita inv√°lida ou lenha insuficiente!');
                return;
            }
            
            // Consume wood
            gameState.machines.stove.woodSlot -= recipe.woodNeeded;
            
            // Start cooking
            gameState.machines.stove.working = true;
            gameState.machines.stove.startTime = Date.now();
            gameState.machines.stove.type = recipe.name;
            
            // Clear ingredient slots
            gameState.machines.stove.ingredientSlots = [null, null, null, null];
            
            updateStoveDisplay();
            updateMachineStatus('stove');
            
            setTimeout(() => {
                gameState.machines.stove.working = false;
                
                // Add result to barn
                if (recipe.name === 'p√£o') {
                    gameState.barn.p√£o = (gameState.barn.p√£o || 0) + 1;
                } else if (recipe.name === 'birthdayCake') {
                    gameState.barn.birthdayCake = (gameState.barn.birthdayCake || 0) + 1;
                } else {
                    gameState.barn[recipe.name] = (gameState.barn[recipe.name] || 0) + 1;
                }
                updateBarnDisplay();
                
                updateMachineStatus('stove');
                alert(`üî• ${recipe.displayName} pronto!`);
            }, recipe.name === 'ch√°' ? 10000 : recipe.name === 'birthdayCake' ? 60000 : 30000); // 10s for tea, 60s for cake, 30s for others
        }

        function checkStoveRecipe(slots, wood) {
            const ingredients = slots.filter(slot => slot !== null).map(slot => slot.name);
            
            // Ch√°: √Ågua + 2 Ervas (2 lenhas)
            if (wood >= 2 && ingredients.includes('√Ågua') && 
                ingredients.filter(i => i === 'Ervas').length >= 2) {
                return {name: 'ch√°', displayName: 'Ch√°', woodNeeded: 2};
            }
            
            // Salada: Tomate + Alface + Br√≥colis (2 lenhas)
            if (wood >= 2 && ingredients.includes('Tomate') && 
                ingredients.includes('Alface') && ingredients.includes('Br√≥colis')) {
                return {name: 'salada', displayName: 'Salada', woodNeeded: 2};
            }
            
            // Ensopado: Ovos + Batata + Ab√≥bora (2 lenhas)
            if (wood >= 2 && ingredients.includes('Ovos') && 
                ingredients.includes('Batata') && ingredients.includes('Ab√≥bora')) {
                return {name: 'stew', displayName: 'Ensopado', woodNeeded: 2};
            }
            
            // Bife: Carne Su√≠na (2 lenhas)
            if (wood >= 2 && ingredients.includes('Carne Su√≠na')) {
                return {name: 'steak', displayName: 'Bife', woodNeeded: 2};
            }
            
            // Frango: Frango Cru (3 lenhas)
            if (wood >= 3 && ingredients.includes('Frango Cru')) {
                return {name: 'chicken', displayName: 'Frango', woodNeeded: 3};
            }
            
            // Peixe: Peixe (3 lenhas)
            if (wood >= 3 && ingredients.includes('Peixe')) {
                return {name: 'cookedFish', displayName: 'Peixe Cozido', woodNeeded: 3};
            }
            
            // P√£o: Ovos + Leite + Farinha (3 lenhas)
            if (wood >= 3 && ingredients.includes('Ovos') && 
                ingredients.includes('Leite') && ingredients.includes('Farinha')) {
                return {name: 'p√£o', displayName: 'P√£o', woodNeeded: 3};
            }
            
            // Bolo de Anivers√°rio: Ovos + Leite + Farinha + Cenoura (3 lenhas)
            if (wood >= 3 && ingredients.includes('Ovos') && 
                ingredients.includes('Leite') && ingredients.includes('Farinha') && 
                ingredients.includes('Cenoura')) {
                return {name: 'birthdayCake', displayName: 'Bolo de Anivers√°rio', woodNeeded: 3};
            }
            
            return null;
        }

        function clearStoveSlots() {
            // Return ingredients to inventory
            gameState.machines.stove.ingredientSlots.forEach(slot => {
                if (slot) {
                    if (slot.name === '√Ågua') {
                        gameState.water++;
                    } else if (slot.name === 'Ervas') {
                        gameState.machineStorage.stove.herbs++;
                    } else if (slot.name === 'Carne Su√≠na') {
                        gameState.machineStorage.stove.porkMeat++;
                    } else if (slot.name === 'Frango Cru') {
                        gameState.barn.rawChicken++;
                    } else if (['Tomate', 'Alface', 'Br√≥colis', 'Batata', 'Ab√≥bora', 'Cenoura'].includes(slot.name)) {
                        if (!gameState.inventory.fruitsVegetables[slot.name]) {
                            gameState.inventory.fruitsVegetables[slot.name] = 0;
                        }
                        gameState.inventory.fruitsVegetables[slot.name]++;
                    } else if (['Ovos', 'Peixe', 'Leite'].includes(slot.name)) {
                        if (!gameState.inventory.others[slot.name]) {
                            gameState.inventory.others[slot.name] = 0;
                        }
                        gameState.inventory.others[slot.name]++;
                    } else if (slot.name === 'Farinha') {
                        if (!gameState.inventory.others['Saco de Farinha']) {
                            gameState.inventory.others['Saco de Farinha'] = 0;
                        }
                        gameState.inventory.others['Saco de Farinha']++;
                    }
                }
            });
            
            // Return wood
            gameState.barn.wood += gameState.machines.stove.woodSlot;
            
            // Clear slots
            gameState.machines.stove.ingredientSlots = [null, null, null, null];
            gameState.machines.stove.woodSlot = 0;
            
            updateStoveDisplay();
            updateInventoryDisplay();
            updateBarnDisplay();
            updateMachineStorageDisplay();
            updateUI();
        }

        function updateStoveDisplay() {
            // Update wood slot
            const woodSlotContent = document.getElementById('woodSlotContent');
            const woodSlot = document.getElementById('woodSlot');
            if (gameState.machines.stove.woodSlot > 0) {
                woodSlotContent.textContent = `ü™µ ${gameState.machines.stove.woodSlot}`;
                woodSlot.style.background = '#90EE90';
            } else {
                woodSlotContent.textContent = '+';
                woodSlot.style.background = '#F5DEB3';
            }
            
            // Update ingredient slots
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`ingredientSlot${i}`);
                const ingredient = gameState.machines.stove.ingredientSlots[i];
                
                if (ingredient) {
                    slot.textContent = ingredient.emoji;
                    slot.classList.add('filled');
                    slot.onclick = () => removeIngredientFromStove(i);
                } else {
                    slot.textContent = '+';
                    slot.classList.remove('filled');
                    slot.onclick = () => addIngredientToStove(i);
                }
            }
        }

        function removeIngredientFromStove(slotIndex) {
            const ingredient = gameState.machines.stove.ingredientSlots[slotIndex];
            if (ingredient) {
                // Return ingredient to inventory
                if (ingredient.name === '√Ågua') {
                    gameState.water++;
                } else if (ingredient.name === 'Ervas') {
                    gameState.machineStorage.stove.herbs++;
                } else if (ingredient.name === 'Carne Su√≠na') {
                    gameState.machineStorage.stove.porkMeat++;
                } else if (ingredient.name === 'Frango Cru') {
                    gameState.barn.rawChicken++;
                } else if (['Tomate', 'Alface', 'Br√≥colis', 'Batata', 'Ab√≥bora', 'Cenoura'].includes(ingredient.name)) {
                    if (!gameState.inventory.fruitsVegetables[ingredient.name]) {
                        gameState.inventory.fruitsVegetables[ingredient.name] = 0;
                    }
                    gameState.inventory.fruitsVegetables[ingredient.name]++;
                } else if (['Ovos', 'Peixe', 'Leite'].includes(ingredient.name)) {
                    if (!gameState.inventory.others[ingredient.name]) {
                        gameState.inventory.others[ingredient.name] = 0;
                    }
                    gameState.inventory.others[ingredient.name]++;
                } else if (ingredient.name === 'Farinha') {
                    if (!gameState.inventory.others['Saco de Farinha']) {
                        gameState.inventory.others['Saco de Farinha'] = 0;
                    }
                    gameState.inventory.others['Saco de Farinha']++;
                }
                
                gameState.machines.stove.ingredientSlots[slotIndex] = null;
                
                updateStoveDisplay();
                updateInventoryDisplay();
                updateBarnDisplay();
                updateMachineStorageDisplay();
                updateUI();
            }
        }



        function drinkTea() {
            if (gameState.avatar.sick && gameState.barn.herbs > 0) {
                gameState.barn.herbs--;
                gameState.avatar.sick = false;
                gameState.avatar.sickTime = 0;
                
                // Stop resting if was resting
                if (gameState.avatar.resting) {
                    gameState.avatar.resting = false;
                    document.getElementById('restBtn').disabled = false;
                    document.getElementById('restBtn').textContent = 'üò¥ Descansar 5min';
                }
                
                updateAvatarUI();
                updateBarnDisplay();
                closeFoodMenu();
                alert('üçµ Voc√™ se curou com o ch√° de ervas!');
            }
        }

        function eatFood(foodType, displayName) {
            if (gameState.barn[foodType] > 0) {
                gameState.barn[foodType]--;
                
                switch(foodType) {
                    case 'ch√°':
                        if (gameState.avatar.sick) {
                            gameState.avatar.sick = false;
                            gameState.avatar.sickTime = 0;
                            
                            // Stop resting if was resting
                            if (gameState.avatar.resting) {
                                gameState.avatar.resting = false;
                                document.getElementById('restBtn').disabled = false;
                                document.getElementById('restBtn').textContent = 'üò¥ Descansar 5min';
                            }
                            
                            // Remove sick warning if exists
                            const sickWarning = document.getElementById('sickWarning');
                            if (sickWarning) {
                                document.body.removeChild(sickWarning);
                            }
                            
                            alert(`üçµ Voc√™ tomou ${displayName} e se curou!`);
                        } else {
                            alert(`üçµ Voc√™ tomou ${displayName}!`);
                        }
                        break;
                    case 'salada':
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, 
                            gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.3));
                        alert(`ü•ó Voc√™ comeu ${displayName} e recuperou 30% da energia!`);
                        break;
                    case 'stew':
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, 
                            gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.5));
                        alert(`üç≤ Voc√™ comeu ${displayName} e recuperou 50% da energia!`);
                        break;
                    case 'steak':
                        gameState.avatar.energy = gameState.avatar.maxEnergy;
                        alert(`ü•© Voc√™ comeu ${displayName} e recuperou 100% da energia!`);
                        break;
                    case 'chicken':
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, 
                            gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.65));
                        alert(`üçó Voc√™ comeu ${displayName} e recuperou 65% da energia!`);
                        break;
                    case 'cookedFish':
                        gameState.avatar.energy = Math.min(gameState.avatar.maxEnergy, 
                            gameState.avatar.energy + Math.floor(gameState.avatar.maxEnergy * 0.8));
                        alert(`üêü Voc√™ comeu ${displayName} e recuperou 80% da energia!`);
                        break;
                }
                
                updateAvatarUI();
                updateBarnDisplay();
                closeFoodMenu();
            }
        }

        function openMailbox() {
            const modal = document.getElementById('mailboxModal');
            const content = document.getElementById('mailContent');
            
            content.innerHTML = '';
            
            if (gameState.mailbox.mails.length === 0) {
                content.innerHTML = '<p>üì≠ Nenhuma correspond√™ncia no momento.</p>';
            } else {
                gameState.mailbox.mails.forEach((mail, index) => {
                    const mailDiv = document.createElement('div');
                    mailDiv.className = 'mail-item';
                    mailDiv.innerHTML = `
                        <div class="mail-header">${mail.subject}</div>
                        <div>${mail.content}</div>
                        <small>Recebido: ${new Date(mail.timestamp).toLocaleString()}</small>
                    `;
                    content.appendChild(mailDiv);
                });
            }
            
            gameState.mailbox.hasNewMail = false;
            document.getElementById('mailAlert').style.display = 'none';
            modal.style.display = 'flex';
        }

        function closeMailbox() {
            document.getElementById('mailboxModal').style.display = 'none';
        }

        function updateBeehiveDisplay() {
            const grid = document.getElementById('beesGrid');
            grid.innerHTML = '';
            
            const now = Date.now();
            const timeSinceHarvest = now - gameState.beehive.lastHarvest;
            const canHarvest = timeSinceHarvest >= 600000; // 10 minutes
            
            for (let i = 0; i < 3; i++) {
                // Create container for bee and flower slot
                const container = document.createElement('div');
                container.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 5px;';
                
                // Bee slot
                const beeSlot = document.createElement('div');
                beeSlot.className = 'bee-slot';
                
                // Check if there's a flower and if it's still alive
                const flowerSlot = gameState.beehive.flowerSlots[i];
                const flowerExpired = flowerSlot && now > gameState.beehive.flowerExpireTimes[i];
                
                if (flowerExpired) {
                    // Remove expired flower
                    gameState.beehive.flowerSlots[i] = null;
                    gameState.beehive.flowerGrowthTimes[i] = 0;
                    gameState.beehive.flowerExpireTimes[i] = 0;
                }
                
                const hasActiveFlower = gameState.beehive.flowerSlots[i] && !flowerExpired;
                
                if (canHarvest && hasActiveFlower) {
                    beeSlot.classList.add('ready');
                    beeSlot.innerHTML = 'üçØ';
                    beeSlot.onclick = () => harvestHoney();
                } else if (hasActiveFlower && !canHarvest) {
                    // Show pollination countdown
                    const remaining = 600000 - timeSinceHarvest; // 10 minutes
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    beeSlot.innerHTML = 'üêù';
                    beeSlot.title = `Polenizando... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    beeSlot.innerHTML = 'üêù';
                }
                
                container.appendChild(beeSlot);
                
                // Flower slot
                const flowerSlot2 = document.createElement('div');
                flowerSlot2.className = 'bee-slot';
                flowerSlot2.style.cssText = 'width: 40px; height: 40px; font-size: 16px; border: 2px solid #228B22;';
                
                if (gameState.beehive.flowerSlots[i]) {
                    const flower = gameState.beehive.flowerSlots[i];
                    const timeSincePlanted = now - gameState.beehive.flowerGrowthTimes[i];
                    const timeUntilExpire = gameState.beehive.flowerExpireTimes[i] - now;
                    
                    if (timeSincePlanted >= 60000) { // 1 minute - flower grown
                        const flowerEmojis = {
                            'tulipa': 'üå∑',
                            'lirio': 'üå∫',
                            'sakura': 'üå∏'
                        };
                        flowerSlot2.innerHTML = flowerEmojis[flower];
                        flowerSlot2.style.background = '#90EE90';
                        
                        // Show time until expire
                        const minutesLeft = Math.floor(timeUntilExpire / 60000);
                        flowerSlot2.title = `${minutesLeft} min restantes`;
                    } else { // Still growing
                        flowerSlot2.innerHTML = 'üå±';
                        flowerSlot2.style.background = '#FFD700';
                        const secondsLeft = Math.ceil((60000 - timeSincePlanted) / 1000);
                        flowerSlot2.title = `Crescendo... ${secondsLeft}s`;
                    }
                } else {
                    flowerSlot2.innerHTML = '+';
                    flowerSlot2.style.background = '#F5DEB3';
                    flowerSlot2.onclick = () => plantFlowerInBeehive(i);
                    flowerSlot2.title = 'Clique para plantar semente';
                }
                
                container.appendChild(flowerSlot2);
                grid.appendChild(container);
            }
            
            // Remove any existing status div to prevent duplicates
            const existingStatus = grid.parentElement.querySelector('.beehive-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            // Add pollination status below the beehive
            const statusDiv = document.createElement('div');
            statusDiv.className = 'beehive-status';
            statusDiv.style.cssText = 'text-align: center; margin-top: 10px; font-weight: bold; color: #8B4513;';
            
            // Count active flowers (grown and not expired)
            const activeFlowers = gameState.beehive.flowerSlots.filter((slot, i) => {
                if (!slot) return false;
                const flowerExpired = now > gameState.beehive.flowerExpireTimes[i];
                const timeSincePlanted = now - gameState.beehive.flowerGrowthTimes[i];
                return !flowerExpired && timeSincePlanted >= 60000;
            }).length;
            
            if (canHarvest && activeFlowers > 0) {
                statusDiv.textContent = 'üçØ Mel pronto para coleta!';
                statusDiv.style.color = '#FFD700';
            } else if (activeFlowers > 0 && !canHarvest) {
                const remaining = 600000 - timeSinceHarvest;
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                statusDiv.textContent = `üêù Polenizando... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                statusDiv.style.color = '#ff6b00';
            } else {
                statusDiv.textContent = 'üêù Plante flores para produzir mel';
                statusDiv.style.color = '#8B4513';
            }
            
            grid.parentElement.appendChild(statusDiv);
        }

        function harvestHoney() {
            const now = Date.now();
            if (now - gameState.beehive.lastHarvest >= 600000) { // 10 minutes
                // Count how many active flowers there are
                let activeFlowers = 0;
                for (let i = 0; i < 3; i++) {
                    const flowerSlot = gameState.beehive.flowerSlots[i];
                    const flowerExpired = flowerSlot && now > gameState.beehive.flowerExpireTimes[i];
                    const timeSincePlanted = now - gameState.beehive.flowerGrowthTimes[i];
                    
                    if (flowerSlot && !flowerExpired && timeSincePlanted >= 60000) {
                        activeFlowers++;
                    }
                }
                
                if (activeFlowers > 0) {
                    gameState.beehive.lastHarvest = now;
                    gameState.barn.mel = (gameState.barn.mel || 0) + activeFlowers;
                    updateBeehiveDisplay();
                    updateBarnDisplay();
                    useEnergy(1);
                    alert(`üçØ Voc√™ coletou ${activeFlowers} pote(s) de mel!`);
                } else {
                    alert('üêù As abelhas precisam de flores para produzir mel!');
                }
            }
        }

        function updateAvatarUI() {
            const energyPercent = (gameState.avatar.energy / gameState.avatar.maxEnergy) * 100;
            document.getElementById('energyFill').style.width = energyPercent + '%';
            document.getElementById('energy').textContent = gameState.avatar.energy;
            
            const avatar = document.getElementById('avatar');
            const avatarEmoji = document.getElementById('avatarEmoji');
            
            if (gameState.avatar.sick) {
                avatar.classList.add('sick');
                avatarEmoji.textContent = 'ü§í';
            } else {
                avatar.classList.remove('sick');
                avatarEmoji.textContent = 'üë®‚Äçüåæ';
            }
            
            // Energy warnings
            if (gameState.avatar.energy <= 20 && !gameState.avatar.sick) {
                if (!document.getElementById('energyWarning')) {
                    alert('‚ö†Ô∏è Sua energia est√° baixa! Descanse ou coma algo!');
                    const warning = document.createElement('div');
                    warning.id = 'energyWarning';
                    warning.style.display = 'none';
                    document.body.appendChild(warning);
                }
            }
            
            if (gameState.avatar.sick && !document.getElementById('sickWarning')) {
                alert('ü§í Voc√™ est√° doente! Tome ch√° de ervas para se curar!');
                const warning = document.createElement('div');
                warning.id = 'sickWarning';
                warning.style.display = 'none';
                document.body.appendChild(warning);
            }
        }

        function useEnergy(amount) {
            if (gameState.avatar.resting) return;
            
            gameState.avatar.energy = Math.max(0, gameState.avatar.energy - amount);
            updateAvatarUI();
            
            if (gameState.avatar.energy === 0) {
                alert('üíÄ Voc√™ morreu de exaust√£o! O jogo ser√° reiniciado.');
                localStorage.removeItem('realFarmSave');
                location.reload();
            }
        }

        function checkAvatarSickness() {
            const now = Date.now();
            
            // Only get sick if not already sick and every 15 minutes
            if (!gameState.avatar.sick) {
                gameState.avatar.sick = true;
                gameState.avatar.sickTime = now;
                updateAvatarUI();
            }
            
            // Lose energy while sick - 2 energy every check (15 minutes)
            if (gameState.avatar.sick) {
                gameState.avatar.energy = Math.max(0, gameState.avatar.energy - 2);
                updateAvatarUI();
                
                if (gameState.avatar.energy === 0) {
                    alert('üíÄ Voc√™ morreu de doen√ßa! O jogo ser√° reiniciado.');
                    localStorage.removeItem('realFarmSave');
                    location.reload();
                }
            }
        }

        function sendRandomMail() {
            const motivationalMessages = [
                "Continue assim, fazendeiro! Sua dedica√ß√£o est√° dando frutos! üå±",
                "O trabalho duro sempre compensa. Sua fazenda est√° florescendo! üåª",
                "Cada semente plantada √© um passo em dire√ß√£o ao sucesso! üåæ",
                "Voc√™ est√° fazendo um trabalho incr√≠vel! A comunidade est√° orgulhosa! üëè",
                "Lembre-se: grandes fazendeiros come√ßaram pequenos. Continue crescendo! üöú"
            ];
            
            const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            
            gameState.mailbox.mails.push({
                subject: "üíå Mensagem Motivacional",
                content: message,
                timestamp: Date.now()
            });
            
            gameState.mailbox.hasNewMail = true;
            document.getElementById('mailAlert').style.display = 'flex';
        }

        function sendNewspaper() {
            const now = Date.now();
            if (now - gameState.mailbox.lastNewspaper >= 1800000) { // 30 minutes
                const crops = ['Trigo', 'Milho', 'Tomate', 'Batata', 'Cenoura', 'Ab√≥bora', 'Br√≥colis', 'Alface', 'Uva', 'Caf√©'];
                const randomCrop = crops[Math.floor(Math.random() * crops.length)];
                const bonus = Math.floor(Math.random() * 20) + 10; // 10-30% bonus
                
                // Set newspaper bonus
                gameState.newspaperBonus = {
                    product: randomCrop,
                    bonus: bonus,
                    timestamp: now
                };
                
                const newspaper = `üì∞ JORNAL DOS AGRICULTORES
                
Produto em alta hoje: ${randomCrop}
B√¥nus de venda: +${bonus}%

Dica do dia: Mantenha seus animais bem alimentados para maior produtividade!

Previs√£o do tempo: ${Math.random() > 0.5 ? 'Ensolarado ‚òÄÔ∏è' : 'Possibilidade de chuva üåßÔ∏è'}`;
                
                gameState.mailbox.mails.push({
                    subject: "üì∞ Jornal dos Agricultores",
                    content: newspaper,
                    timestamp: now
                });
                
                gameState.mailbox.lastNewspaper = now;
                gameState.mailbox.hasNewMail = true;
                document.getElementById('mailAlert').style.display = 'flex';
            }
        }

        function checkAchievements() {
            const now = Date.now();
            const gameTime = now - gameState.gameStartTime;
            
            // Bronze Medal - 30 minutes (1,800,000 ms)
            if (!gameState.achievements.bronze && gameTime >= 1800000) {
                gameState.achievements.bronze = true;
                addToInventory('others', 'Pedra de Prata', 1);
                
                gameState.mailbox.mails.push({
                    subject: "ü•â MEDALHA DE BRONZE CONQUISTADA!",
                    content: `Parab√©ns, fazendeiro! üéâ

Voc√™ jogou por 30 minutos e conquistou sua primeira medalha!

ü•â MEDALHA DE BRONZE
üéÅ Pr√™mio: Pedra de Prata (1.000 moedas)

Continue assim! Grandes conquistas te aguardam!`,
                    timestamp: now
                });
                
                gameState.mailbox.hasNewMail = true;
                document.getElementById('mailAlert').style.display = 'flex';
                updateInventoryDisplay();
                
                // Show achievement notification
                showAchievementNotification('ü•â MEDALHA DE BRONZE CONQUISTADA!', 'Pr√™mio: Pedra de Prata');
            }
            
            // Silver Medal - 1.5 hours (5,400,000 ms)
            if (!gameState.achievements.silver && gameTime >= 5400000) {
                gameState.achievements.silver = true;
                addToInventory('others', 'Pedra de Ouro', 1);
                
                gameState.mailbox.mails.push({
                    subject: "ü•à MEDALHA DE PRATA CONQUISTADA!",
                    content: `Incr√≠vel, fazendeiro! üåü

Voc√™ jogou por 1 hora e 30 minutos! Sua dedica√ß√£o √© admir√°vel!

ü•à MEDALHA DE PRATA
üéÅ Pr√™mio: Pedra de Ouro (100.000 moedas)

Voc√™ est√° se tornando um verdadeiro mestre da agricultura!`,
                    timestamp: now
                });
                
                gameState.mailbox.hasNewMail = true;
                document.getElementById('mailAlert').style.display = 'flex';
                updateInventoryDisplay();
                
                showAchievementNotification('ü•à MEDALHA DE PRATA CONQUISTADA!', 'Pr√™mio: Pedra de Ouro');
            }
            
            // Gold Medal - 3 hours (10,800,000 ms)
            if (!gameState.achievements.gold && gameTime >= 10800000) {
                gameState.achievements.gold = true;
                addToInventory('others', 'Pedra de Diamante', 1);
                
                gameState.mailbox.mails.push({
                    subject: "ü•á MEDALHA DE OURO CONQUISTADA!",
                    content: `EXTRAORDIN√ÅRIO, FAZENDEIRO! üëë

Voc√™ jogou por 3 horas completas! Voc√™ √© um verdadeiro MESTRE!

ü•á MEDALHA DE OURO
üéÅ Pr√™mio: Pedra de Diamante (1.000.000 moedas)

Voc√™ alcan√ßou o mais alto n√≠vel de dedica√ß√£o! 
Parab√©ns por sua perseveran√ßa e paix√£o pela agricultura!`,
                    timestamp: now
                });
                
                gameState.mailbox.hasNewMail = true;
                document.getElementById('mailAlert').style.display = 'flex';
                updateInventoryDisplay();
                
                showAchievementNotification('ü•á MEDALHA DE OURO CONQUISTADA!', 'Pr√™mio: Pedra de Diamante');
            }
        }

        function showAchievementNotification(title, subtitle) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                color: #8B4513;
                padding: 30px 40px;
                border-radius: 20px;
                z-index: 4000;
                font-weight: bold;
                font-size: 20px;
                text-align: center;
                box-shadow: 0 8px 30px rgba(255, 215, 0, 0.5);
                border: 3px solid #ffa500;
                animation: achievementPulse 2s ease-in-out;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">${title}</div>
                <div style="font-size: 16px; color: #666;">${subtitle}</div>
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes achievementPulse {
                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
                document.head.removeChild(style);
            }, 5000);
        }

        function sellAll() {
            let totalEarnings = 0;
            let springBonus = gameState.season === 0 ? 1.1 : 1; // 10% bonus na primavera
            let itemsSold = 0;
            let hasNewspaperBonus = false;
            
            // Item prices for non-seed items
            const itemPrices = {
                'CD': 50,
                'Bola': 40,
                'Sapato': 35,
                'Mel': 60,
                'P√©rola': 100,
                'Esmeralda': 200,
                'Rubi': 180,
                'Safira': 160,
                'Flor': 25,
                'Rosa': 30,
                'Girassol': 35,
                'Margarida': 25,
                'Grama': 5,
                'Ma√ß√£': 15,
                'Laranja': 18,
                'Banana': 12,
                'Peixe': 25,
                'Lenha': 8,
                'Ovos': 20,
                'Carne Su√≠na': 45,
                'Leite': 25,
                'Esterco': 15,
                'L√£': 30,
                'Saco de Caf√©': 120,
                'Suco de Uva': 80,
                'Saco de Farinha': 100,
                'Queijo': 90,
                'Novelo': 70,
                'P√£o': 50,
                'Colar de P√©rolas': 400,
                'Anel de Esmeralda': 350,
                'Buqu√™ de Flores': 200,
                'Pedra de Prata': 1000,
                'Pedra de Ouro': 100000,
                'Pedra de Diamante': 1000000,
                'Ab√≥bora': 27
            };
            
            Object.keys(gameState.inventory).forEach(category => {
                Object.keys(gameState.inventory[category]).forEach(item => {
                    const quantity = gameState.inventory[category][item];
                    if (quantity > 0) {
                        let price = 0;
                        let newspaperBonus = 1;
                        
                        // Check newspaper bonus
                        if (gameState.newspaperBonus && gameState.newspaperBonus.product === item) {
                            const now = Date.now();
                            // Bonus lasts for 30 minutes
                            if (now - gameState.newspaperBonus.timestamp <= 1800000) {
                                newspaperBonus = 1 + (gameState.newspaperBonus.bonus / 100);
                                hasNewspaperBonus = true;
                            }
                        }
                        
                        const seed = seeds.find(s => s.name === item);
                        
                        if (seed) {
                            price = seed.price * 2; // Sell for double the buy price
                        } else {
                            price = itemPrices[item] || 10;
                        }
                        
                        totalEarnings += Math.floor(quantity * price * springBonus * newspaperBonus);
                        itemsSold += quantity;
                        gameState.inventory[category][item] = 0;
                    }
                });
            });
            
            gameState.coins += totalEarnings;
            updateUI();
            updateInventoryDisplay();
            
            if (totalEarnings > 0) {
                let message = `üí∞ Vendeu ${itemsSold} itens por ${totalEarnings} moedas!`;
                if (springBonus > 1) message += ' (B√¥nus da Primavera: +10%)';
                if (hasNewspaperBonus) message += ` (Jornal: +${gameState.newspaperBonus.bonus}%)`;
                
                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #4CAF50;
                    color: white;
                    padding: 20px 30px;
                    border-radius: 15px;
                    z-index: 3000;
                    font-weight: bold;
                    font-size: 18px;
                    text-align: center;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                `;
                alertDiv.textContent = message;
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 3000);
            } else {
                alert('üì¶ N√£o h√° itens para vender na quitanda!');
            }
        }

        function feedDog() {
            const now = Date.now();
            if (gameState.hasDogHouse && gameState.barn.dogFood > 0 && 
                (now - gameState.dogLastFed) >= 300000) { // 5 minutos
                gameState.barn.dogFood--;
                gameState.dogLastFed = now;
                
                // Start treasure hunting after feeding
                if (gameState.dogFriendship >= 100) {
                    setTimeout(findTreasure, 180000); // 3 minutos
                }
                
                updatePetUI();
                updateBarnDisplay();
                updateUI();
            }
        }

        function giveBone() {
            const now = Date.now();
            if (gameState.hasDogHouse && gameState.barn.bones > 0 && 
                (now - gameState.dogLastFed) >= 1200000) { // 20 minutos
                gameState.barn.bones--;
                gameState.dogFriendship = Math.min(100, gameState.dogFriendship + 10);
                
                updatePetUI();
                updateBarnDisplay();
                updateUI();
            }
        }

        function feedHorse() {
            const now = Date.now();
            if (gameState.hasHorseStable && gameState.barn.hay >= 2 && 
                (now - gameState.horseLastFed) >= 300000) { // 5 minutos
                gameState.barn.hay -= 2;
                gameState.horseLastFed = now;
                gameState.horseFriendship = Math.min(100, gameState.horseFriendship + 5);
                
                // Enable orders panel when friendship reaches 100%
                if (gameState.horseFriendship >= 100) {
                    document.getElementById('ordersPanel').style.display = 'block';
                    generateOrders();
                }
                
                updatePetUI();
                updateBarnDisplay();
                updateUI();
            }
        }

        function giveApple() {
            if (gameState.hasHorseStable && gameState.inventory.fruitsVegetables['Ma√ß√£'] > 0) {
                gameState.inventory.fruitsVegetables['Ma√ß√£']--;
                gameState.horseFriendship = Math.min(100, gameState.horseFriendship + 15);
                
                updatePetUI();
                updateInventoryDisplay();
                updateUI();
            }
        }

        function addFoodToDogSlot() {
            if (gameState.barn.dogFood === 0) {
                alert('Voc√™ n√£o tem ra√ß√£o para cachorro!');
                return;
            }
            
            if (gameState.dogSystem.foodInSlot) {
                alert('J√° h√° ra√ß√£o no slot!');
                return;
            }
            
            if (gameState.dogSystem.state !== 'waiting') {
                alert('Mocinha est√° ocupada!');
                return;
            }
            
            gameState.barn.dogFood--;
            gameState.dogSystem.foodInSlot = true;
            gameState.dogSystem.state = 'eating';
            
            updateBarnDisplay();
            updateDogSystemDisplay();
            updateUI();
            
            // Food disappears after 10 seconds and dog starts hunting
            setTimeout(() => {
                gameState.dogSystem.foodInSlot = false;
                gameState.dogSystem.state = 'hunting';
                gameState.dogSystem.huntingStartTime = Date.now();
                
                updateDogSystemDisplay();
                
                // Hunting lasts 10 minutes
                setTimeout(() => {
                    // Generate treasure and add to chest
                    const treasures = [
                        {name: 'CD', emoji: 'üíø'},
                        {name: 'Bola', emoji: '‚öΩ'},
                        {name: 'Sapato', emoji: 'üëü'}
                    ];
                    
                    const randomTreasure = treasures[Math.floor(Math.random() * treasures.length)];
                    
                    // Higher chance for key if friendship >= 100
                    if (gameState.dogFriendship >= 100 && Math.random() < 0.3) {
                        gameState.dogSystem.treasureChest.push({name: 'Chave', emoji: 'üóùÔ∏è'});
                    } else {
                        gameState.dogSystem.treasureChest.push(randomTreasure);
                    }
                    
                    // Dog returns and starts resting
                    gameState.dogSystem.state = 'resting';
                    gameState.dogSystem.restingStartTime = Date.now();
                    
                    updateDogSystemDisplay();
                    
                    // Show treasure chest glow
                    const chest = document.getElementById('treasureChest');
                    chest.style.background = '#FFD700';
                    chest.style.boxShadow = '0 0 15px #FFD700';
                    
                    // Rest for 5 minutes
                    setTimeout(() => {
                        gameState.dogSystem.state = 'waiting';
                        updateDogSystemDisplay();
                    }, 300000); // 5 minutes
                    
                }, 600000); // 10 minutes
            }, 10000); // 10 seconds
        }

        function addHayToHorseSlot() {
            if (gameState.barn.hay === 0) {
                alert('Voc√™ n√£o tem feno!');
                return;
            }
            
            if (gameState.horseSystem.hayInSlot) {
                alert('J√° h√° feno no slot!');
                return;
            }
            
            if (gameState.horseSystem.state !== 'waiting') {
                alert('Duque est√° ocupado!');
                return;
            }
            
            gameState.barn.hay--;
            gameState.horseSystem.hayInSlot = true;
            gameState.horseSystem.state = 'eating';
            gameState.horseFriendship = Math.min(100, gameState.horseFriendship + 5);
            
            updateBarnDisplay();
            updateHorseSystemDisplay();
            updateUI();
            
            // Hay disappears after 10 seconds
            setTimeout(() => {
                gameState.horseSystem.hayInSlot = false;
                
                // If friendship >= 100, start working for 15 minutes
                if (gameState.horseFriendship >= 100) {
                    gameState.horseSystem.state = 'working';
                    gameState.horseSystem.workingStartTime = Date.now();
                    
                    // Auto-complete orders while working
                    const workInterval = setInterval(() => {
                        if (gameState.horseSystem.state === 'working' && gameState.orders.length > 0) {
                            const order = gameState.orders[0];
                            const seed = seeds.find(s => s.name === order.item);
                            const category = seed.category;
                            
                            if (gameState.inventory[category][order.item] >= order.quantity) {
                                gameState.inventory[category][order.item] -= order.quantity;
                                gameState.coins += order.reward;
                                gameState.orders.shift();
                                
                                updateInventoryDisplay();
                                updateOrdersDisplay();
                                updateUI();
                                
                                alert(`üêé Duque entregou: ${order.quantity}x ${order.item} por ${order.reward} moedas!`);
                                generateOrders();
                            }
                        }
                    }, 30000); // Check every 30 seconds
                    
                    // Stop working after 15 minutes
                    setTimeout(() => {
                        clearInterval(workInterval);
                        gameState.horseSystem.state = 'waiting';
                        updateHorseSystemDisplay();
                    }, 900000); // 15 minutes
                } else {
                    gameState.horseSystem.state = 'waiting';
                }
                
                updateHorseSystemDisplay();
            }, 10000); // 10 seconds
        }

        function addAppleToHorseSlot() {
            if (!gameState.inventory.fruitsVegetables['Ma√ß√£'] || gameState.inventory.fruitsVegetables['Ma√ß√£'] === 0) {
                alert('Voc√™ n√£o tem ma√ß√£s!');
                return;
            }
            
            if (gameState.horseSystem.appleInSlot) {
                alert('J√° h√° ma√ß√£ no slot!');
                return;
            }
            
            if (gameState.horseSystem.state === 'sick') {
                alert('Duque est√° doente e n√£o pode comer!');
                return;
            }
            
            gameState.inventory.fruitsVegetables['Ma√ß√£']--;
            gameState.horseSystem.appleInSlot = true;
            gameState.horseFriendship = Math.min(100, gameState.horseFriendship + 15);
            gameState.horseSystem.lastAppleTime = Date.now();
            gameState.horseSystem.sickCheckTime = Date.now() + 1800000; // Reset sick check to 30 minutes from now
            
            updateInventoryDisplay();
            updateHorseSystemDisplay();
            updateUI();
            
            // Apple disappears after 10 seconds
            setTimeout(() => {
                gameState.horseSystem.appleInSlot = false;
                updateHorseSystemDisplay();
            }, 10000); // 10 seconds
        }

        function openTreasureChest() {
            const modal = document.getElementById('treasureChestModal');
            const content = document.getElementById('treasureChestContent');
            
            content.innerHTML = '';
            
            if (gameState.dogSystem.treasureChest.length === 0) {
                content.innerHTML = '<p>üì¶ O ba√∫ est√° vazio. Alimente a Mocinha para ela ca√ßar tesouros!</p>';
            } else {
                gameState.dogSystem.treasureChest.forEach((treasure, index) => {
                    const treasureDiv = document.createElement('div');
                    treasureDiv.className = 'food-item';
                    treasureDiv.innerHTML = `${treasure.emoji}<br>${treasure.name}<br><small>Clique para coletar</small>`;
                    treasureDiv.onclick = () => collectTreasure(index);
                    content.appendChild(treasureDiv);
                });
            }
            
            modal.style.display = 'flex';
        }

        function closeTreasureChest() {
            document.getElementById('treasureChestModal').style.display = 'none';
        }

        function collectTreasure(index) {
            const treasure = gameState.dogSystem.treasureChest[index];
            
            if (treasure.name === 'Chave') {
                gameState.barn.keys++;
                updateBarnDisplay();
            } else {
                if (!gameState.inventory.others[treasure.name]) {
                    gameState.inventory.others[treasure.name] = 0;
                }
                gameState.inventory.others[treasure.name]++;
                updateInventoryDisplay();
            }
            
            // Remove treasure from chest
            gameState.dogSystem.treasureChest.splice(index, 1);
            
            // Update chest appearance if empty
            if (gameState.dogSystem.treasureChest.length === 0) {
                const chest = document.getElementById('treasureChest');
                chest.style.background = '#F5DEB3';
                chest.style.boxShadow = 'none';
            }
            
            // Refresh modal content
            openTreasureChest();
            
            alert(`${treasure.emoji} ${treasure.name} coletado!`);
        }

        function updateDogSystemDisplay() {
            const foodSlot = document.getElementById('dogFoodSlot');
            const foodSlotContent = document.getElementById('dogFoodSlotContent');
            const dogStatus = document.getElementById('dogStatus');
            const dogStatusText = document.getElementById('dogStatusText');
            const countdown = document.getElementById('dogCountdown');
            
            // Update food slot
            if (gameState.dogSystem.foodInSlot) {
                foodSlotContent.textContent = 'ü•©';
                foodSlot.style.background = '#90EE90';
            } else {
                foodSlotContent.textContent = '+';
                foodSlot.style.background = '#F5DEB3';
            }
            
            // Update dog status and countdown
            const now = Date.now();
            
            switch (gameState.dogSystem.state) {
                case 'waiting':
                    dogStatus.innerHTML = 'üêï';
                    dogStatusText.textContent = 'Esperando';
                    countdown.textContent = '';
                    break;
                    
                case 'eating':
                    dogStatus.innerHTML = 'üçΩÔ∏è';
                    dogStatusText.textContent = 'Comendo';
                    countdown.textContent = 'Comendo ra√ß√£o...';
                    break;
                    
                case 'hunting':
                    dogStatus.innerHTML = 'üèÉ';
                    dogStatusText.textContent = 'Ca√ßando';
                    const huntingElapsed = now - gameState.dogSystem.huntingStartTime;
                    const huntingRemaining = Math.max(0, 600000 - huntingElapsed); // 10 minutes
                    const huntingMinutes = Math.floor(huntingRemaining / 60000);
                    const huntingSeconds = Math.floor((huntingRemaining % 60000) / 1000);
                    countdown.textContent = `üèÉ Ca√ßando: ${huntingMinutes}:${huntingSeconds.toString().padStart(2, '0')}`;
                    break;
                    
                case 'resting':
                    dogStatus.innerHTML = 'üò¥';
                    dogStatusText.textContent = 'Descansando';
                    const restingElapsed = now - gameState.dogSystem.restingStartTime;
                    const restingRemaining = Math.max(0, 300000 - restingElapsed); // 5 minutes
                    const restingMinutes = Math.floor(restingRemaining / 60000);
                    const restingSeconds = Math.floor((restingRemaining % 60000) / 1000);
                    countdown.textContent = `üò¥ Descansando: ${restingMinutes}:${restingSeconds.toString().padStart(2, '0')}`;
                    break;
            }
        }

        function updateHorseSystemDisplay() {
            const haySlot = document.getElementById('horseHaySlot');
            const haySlotContent = document.getElementById('horseHaySlotContent');
            const appleSlot = document.getElementById('horseAppleSlot');
            const appleSlotContent = document.getElementById('horseAppleSlotContent');
            const horseStatus = document.getElementById('horseStatus');
            const horseStatusText = document.getElementById('horseStatusText');
            const countdown = document.getElementById('horseCountdown');
            
            // Update hay slot
            if (gameState.horseSystem.hayInSlot) {
                haySlotContent.textContent = 'üåæ';
                haySlot.style.background = '#90EE90';
            } else {
                haySlotContent.textContent = '+';
                haySlot.style.background = '#F5DEB3';
            }
            
            // Update apple slot
            if (gameState.horseSystem.appleInSlot) {
                appleSlotContent.textContent = 'üçé';
                appleSlot.style.background = '#90EE90';
            } else {
                appleSlotContent.textContent = '+';
                appleSlot.style.background = '#F5DEB3';
            }
            
            // Update horse status and countdown
            const now = Date.now();
            
            switch (gameState.horseSystem.state) {
                case 'waiting':
                    horseStatus.innerHTML = 'üêé';
                    horseStatusText.textContent = 'Esperando';
                    countdown.textContent = '';
                    break;
                    
                case 'eating':
                    horseStatus.innerHTML = 'üçΩÔ∏è';
                    horseStatusText.textContent = 'Comendo';
                    countdown.textContent = 'Comendo...';
                    break;
                    
                case 'working':
                    horseStatus.innerHTML = 'üöö';
                    horseStatusText.textContent = 'Trabalhando';
                    const workingElapsed = now - gameState.horseSystem.workingStartTime;
                    const workingRemaining = Math.max(0, 900000 - workingElapsed); // 15 minutes
                    const workingMinutes = Math.floor(workingRemaining / 60000);
                    const workingSeconds = Math.floor((workingRemaining % 60000) / 1000);
                    countdown.textContent = `üöö Entregando pedidos: ${workingMinutes}:${workingSeconds.toString().padStart(2, '0')}`;
                    break;
                    
                case 'sick':
                    horseStatus.innerHTML = 'ü§í';
                    horseStatusText.textContent = 'Doente';
                    const sickElapsed = now - gameState.horseSystem.sickStartTime;
                    const sickRemaining = Math.max(0, 1800000 - sickElapsed); // 30 minutes
                    const sickMinutes = Math.floor(sickRemaining / 60000);
                    const sickSeconds = Math.floor((sickRemaining % 60000) / 1000);
                    countdown.textContent = `ü§í Doente: ${sickMinutes}:${sickSeconds.toString().padStart(2, '0')}`;
                    break;
            }
        }

        function findTreasure() {
            const treasures = ['üíø', '‚öΩ', 'üëü'];
            const randomTreasure = treasures[Math.floor(Math.random() * treasures.length)];
            const treasureNames = {
                'üíø': 'CD',
                '‚öΩ': 'Bola', 
                'üëü': 'Sapato'
            };
            
            // Higher chance for key if friendship with bone
            const keyChance = gameState.dogFriendship >= 100 ? 0.3 : 0.1;
            
            if (Math.random() < keyChance) {
                gameState.barn.keys++;
                alert('üóùÔ∏è Mocinha encontrou uma Chave!');
                updateBarnDisplay();
            } else {
                const treasureName = treasureNames[randomTreasure];
                if (!gameState.inventory.others[treasureName]) {
                    gameState.inventory.others[treasureName] = 0;
                }
                gameState.inventory.others[treasureName]++;
                alert(`${randomTreasure} Mocinha encontrou: ${treasureName}!`);
                updateInventoryDisplay();
            }
        }

        function sellItem(category, item) {
            if (gameState.inventory[category][item] > 0) {
                let price = 0;
                let springBonus = gameState.season === 0 ? 1.1 : 1;
                let newspaperBonus = 1;
                
                // Check newspaper bonus
                if (gameState.newspaperBonus && gameState.newspaperBonus.product === item) {
                    const now = Date.now();
                    // Bonus lasts for 30 minutes
                    if (now - gameState.newspaperBonus.timestamp <= 1800000) {
                        newspaperBonus = 1 + (gameState.newspaperBonus.bonus / 100);
                    }
                }
                
                // Find seed price
                const seed = seeds.find(s => s.name === item);
                if (seed) {
                    price = seed.price * 2; // Sell for double the buy price
                } else {
                    // Prices for non-seed items
                    const itemPrices = {
                        'CD': 50,
                        'Bola': 40,
                        'Sapato': 35,
                        'Mel': 60,
                        'P√©rola': 100,
                        'Esmeralda': 200,
                        'Rubi': 180,
                        'Safira': 160,
                        'Flor': 25,
                        'Rosa': 30,
                        'Girassol': 35,
                        'Margarida': 25,
                        'Grama': 5,
                        'Ma√ß√£': 15,
                        'Laranja': 18,
                        'Banana': 12,
                        'Peixe': 25,
                        'Lenha': 8,
                        'Ovos': 20,
                        'Carne Su√≠na': 45,
                        'Leite': 25,
                        'Esterco': 15,
                        'L√£': 30,
                        'Saco de Caf√©': 120,
                        'Suco de Uva': 80,
                        'Saco de Farinha': 100,
                        'Queijo': 90,
                        'Novelo': 70,
                        'P√£o': 50,
                        'Ab√≥bora': 27
                    };
                    price = itemPrices[item] || 10;
                }
                
                const finalPrice = Math.floor(price * springBonus * newspaperBonus);
                gameState.coins += finalPrice;
                gameState.inventory[category][item]--;
                
                updateUI();
                updateInventoryDisplay();
                
                let message = `üí∞ Vendeu ${item} por ${finalPrice} moedas!`;
                if (springBonus > 1) message += ' (B√¥nus Primavera: +10%)';
                if (newspaperBonus > 1) message += ` (Jornal: +${gameState.newspaperBonus.bonus}%)`;
                
                // Show brief alert
                const alertDiv = document.createElement('div');
                alertDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4CAF50;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 10px;
                    z-index: 3000;
                    font-weight: bold;
                `;
                alertDiv.textContent = message;
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 2000);
            }
        }

        function generateOrders() {
            if (gameState.orders.length < 3) {
                const orderTypes = [
                    {item: 'Trigo', quantity: 5, reward: 100, emoji: 'üåæ'},
                    {item: 'Milho', quantity: 3, reward: 80, emoji: 'üåΩ'},
                    {item: 'Tomate', quantity: 4, reward: 90, emoji: 'üçÖ'},
                    {item: 'Batata', quantity: 6, reward: 120, emoji: 'ü•î'},
                    {item: 'Cenoura', quantity: 4, reward: 85, emoji: 'ü•ï'}
                ];
                
                while (gameState.orders.length < 3) {
                    const randomOrder = orderTypes[Math.floor(Math.random() * orderTypes.length)];
                    gameState.orders.push({
                        id: Date.now() + Math.random(),
                        ...randomOrder,
                        client: `Cliente ${Math.floor(Math.random() * 100) + 1}`
                    });
                }
                updateOrdersDisplay();
            }
        }

        function acceptOrder(orderId) {
            const order = gameState.orders.find(o => o.id === orderId);
            if (order) {
                const seed = seeds.find(s => s.name === order.item);
                const category = seed.category;
                
                if (gameState.inventory[category][order.item] >= order.quantity) {
                    gameState.inventory[category][order.item] -= order.quantity;
                    gameState.coins += order.reward;
                    gameState.orders = gameState.orders.filter(o => o.id !== orderId);
                    
                    // Horse delivery time
                    setTimeout(() => {
                        alert(`üêé Duque entregou o pedido! +${order.reward} moedas!`);
                        generateOrders(); // Generate new order
                    }, 60000); // 1 minuto
                    
                    updateInventoryDisplay();
                    updateOrdersDisplay();
                    updateUI();
                } else {
                    alert(`Voc√™ precisa de ${order.quantity}x ${order.item} para este pedido!`);
                }
            }
        }

        function rejectOrder(orderId) {
            gameState.orders = gameState.orders.filter(o => o.id !== orderId);
            updateOrdersDisplay();
            generateOrders();
        }

        function updateOrdersDisplay() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '';
            
            gameState.orders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-item';
                orderDiv.innerHTML = `
                    <div>
                        <strong>${order.client}</strong><br>
                        ${order.emoji} ${order.quantity}x ${order.item}<br>
                        üí∞ ${order.reward} moedas
                    </div>
                    <div class="order-buttons">
                        <button class="accept-btn" onclick="acceptOrder(${order.id})">‚úÖ</button>
                        <button class="reject-btn" onclick="rejectOrder(${order.id})">‚ùå</button>
                    </div>
                `;
                ordersList.appendChild(orderDiv);
            });
        }

        function updateInventoryDisplay() {
            const categories = ['farmProducts', 'fruitsVegetables', 'others'];
            const containers = ['farmProducts', 'fruitsVegetables', 'others'];
            
            // Item prices for display
            const itemPrices = {
                'CD': 50,
                'Bola': 40,
                'Sapato': 35,
                'Mel': 60,
                'P√©rola': 100,
                'Esmeralda': 200,
                'Rubi': 180,
                'Safira': 160,
                'Flor': 25,
                'Rosa': 30,
                'Girassol': 35,
                'Margarida': 25,
                'Grama': 5,
                'Ma√ß√£': 15,
                'Laranja': 18,
                'Banana': 12,
                'Peixe': 25,
                'Lenha': 8,
                'Ovos': 20,
                'Carne Su√≠na': 45,
                'Leite': 25,
                'Esterco': 15,
                'L√£': 30,
                'Saco de Caf√©': 120,
                'Suco de Uva': 80,
                'Saco de Farinha': 100,
                'Queijo': 90,
                'Novelo': 70,
                'P√£o': 50,
                'Colar de P√©rolas': 400,
                'Anel de Esmeralda': 350,
                'Buqu√™ de Flores': 200,
                'Pedra de Prata': 1000,
                'Pedra de Ouro': 100000,
                'Pedra de Diamante': 1000000,
                'Ab√≥bora': 27
            };
            
            categories.forEach((category, index) => {
                const container = document.getElementById(containers[index]);
                container.innerHTML = '';
                
                Object.keys(gameState.inventory[category]).forEach(item => {
                    const quantity = gameState.inventory[category][item];
                    if (quantity > 0) {
                        const seed = seeds.find(s => s.name === item);
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'inventory-item';
                        itemDiv.style.cursor = 'pointer';
                        itemDiv.title = 'Clique para vender';
                        
                        let emoji = seed ? seed.emoji : '';
                        let price = 0;
                        
                        // Set emoji for special items
                        const specialEmojis = {
                            'CD': 'üíø',
                            'Bola': '‚öΩ',
                            'Sapato': 'üëü',
                            'Mel': 'üçØ',
                            'P√©rola': 'üíé',
                            'Esmeralda': 'üíö',
                            'Rubi': '‚ù§Ô∏è',
                            'Safira': 'üíô',
                            'Flor': 'üå∏',
                            'Rosa': 'üåπ',
                            'Girassol': 'üåª',
                            'Margarida': 'üåº',
                            'Grama': 'üå±',
                            'Ma√ß√£': 'üçé',
                            'Laranja': 'üçä',
                            'Banana': 'üçå',
                            'Peixe': 'üêü',
                            'Lenha': 'ü™µ',
                            'Ovos': 'ü•ö',
                            'Carne Su√≠na': 'ü•©',
                            'Leite': 'ü•õ',
                            'Esterco': 'üí©',
                            'L√£': 'üêë',
                            'Saco de Caf√©': '‚òï',
                            'Suco de Uva': 'üßÉ',
                            'Saco de Farinha': 'üåæ',
                            'Queijo': 'üßÄ',
                            'Novelo': 'üß∂',
                            'P√£o': 'üçû',
                            'Colar de P√©rolas': 'üìø',
                            'Anel de Esmeralda': 'üíç',
                            'Buqu√™ de Flores': 'üíê',
                            'Pedra de Prata': 'ü•à',
                            'Pedra de Ouro': 'ü•á',
                            'Pedra de Diamante': 'üíé'
                        };
                        
                        if (specialEmojis[item]) {
                            emoji = specialEmojis[item];
                        }
                        
                        // Calculate price
                        if (seed) {
                            price = seed.price * 2;
                        } else {
                            price = itemPrices[item] || 10;
                        }
                        
                        let springBonus = gameState.season === 0 ? 1.1 : 1;
                        let newspaperBonus = 1;
                        
                        // Check newspaper bonus
                        if (gameState.newspaperBonus && gameState.newspaperBonus.product === item) {
                            const now = Date.now();
                            // Bonus lasts for 30 minutes
                            if (now - gameState.newspaperBonus.timestamp <= 1800000) {
                                newspaperBonus = 1 + (gameState.newspaperBonus.bonus / 100);
                            }
                        }
                        
                        let finalPrice = Math.floor(price * springBonus * newspaperBonus);
                        
                        let priceText = `üí∞ ${finalPrice} cada`;
                        if (newspaperBonus > 1) {
                            priceText += ` üì∞`;
                        }
                        
                        itemDiv.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                                <span>${emoji} ${item}</span>
                                <small style="color: #666;">${priceText}</small>
                            </div>
                            <span style="font-weight: bold;">${quantity}x</span>
                        `;
                        itemDiv.onclick = () => sellItem(category, item);
                        container.appendChild(itemDiv);
                    }
                });
            });
        }

        // Machine Functions
        function startComposting() {
            if (gameState.machines.composter.working) return;
            
            if (gameState.machineStorage.composter.flowers >= 1 && 
                gameState.machineStorage.composter.branches >= 1 && 
                gameState.machineStorage.composter.manure >= 2) {
                
                gameState.machineStorage.composter.flowers--;
                gameState.machineStorage.composter.branches--;
                gameState.machineStorage.composter.manure -= 2;
                
                gameState.machines.composter.working = true;
                gameState.machines.composter.startTime = Date.now();
                
                updateMachineStorageDisplay();
                updateMachineStatus('composter');
                
                setTimeout(() => {
                    gameState.machines.composter.working = false;
                    gameState.barn.adubo = (gameState.barn.adubo || 0) + 8;
                    updateBarnDisplay();
                    updateMachineStatus('composter');
                    alert('üóëÔ∏è Compostagem conclu√≠da! +8 Adubos!');
                }, 60000); // 1 minute
            } else {
                alert('Voc√™ precisa de: 1 Flor, 1 Galho e 2 Estercos (na Composteira)!');
            }
        }

        function addIngredientToMixer(slotIndex) {
            if (gameState.machines.mixer.ingredientSlots[slotIndex]) {
                alert('Este slot j√° est√° ocupado!');
                return;
            }

            // Show ingredient selection modal
            const modal = document.getElementById('foodModal');
            const content = document.getElementById('foodMenuContent');
            const title = document.getElementById('foodModalTitle');
            
            title.textContent = 'ü•£ Escolha um ingrediente';
            content.innerHTML = '';
            
            // Available ingredients for mixer
            const ingredients = [
                // From mill storage
                {name: 'Trigo', emoji: 'üåæ', source: 'mill.wheat', available: gameState.machineStorage.mill.wheat},
                // From inventory
                {name: 'Milho', emoji: 'üåΩ', source: 'farmProducts', available: gameState.inventory.farmProducts['Milho'] || 0},
                {name: 'Batata', emoji: 'ü•î', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Batata'] || 0},
                {name: 'Cenoura', emoji: 'ü•ï', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Cenoura'] || 0},
                {name: 'Br√≥colis', emoji: 'ü•¶', source: 'fruitsVegetables', available: gameState.inventory.fruitsVegetables['Br√≥colis'] || 0}
            ];
            
            let hasIngredients = false;
            
            ingredients.forEach(ingredient => {
                if (ingredient.available > 0) {
                    hasIngredients = true;
                    const ingredientDiv = document.createElement('div');
                    ingredientDiv.className = 'food-item';
                    ingredientDiv.innerHTML = `${ingredient.emoji}<br>${ingredient.name}<br><small>Dispon√≠vel: ${ingredient.available}</small>`;
                    ingredientDiv.onclick = () => selectMixerIngredient(slotIndex, ingredient);
                    content.appendChild(ingredientDiv);
                }
            });
            
            if (!hasIngredients) {
                content.innerHTML = '<p>Voc√™ n√£o tem ingredientes dispon√≠veis!</p>';
            }
            
            modal.style.display = 'flex';
        }

        function selectMixerIngredient(slotIndex, ingredient) {
            // Remove ingredient from source
            if (ingredient.source === 'mill.wheat') {
                gameState.machineStorage.mill.wheat--;
            } else if (ingredient.source === 'farmProducts') {
                gameState.inventory.farmProducts[ingredient.name]--;
            } else if (ingredient.source === 'fruitsVegetables') {
                gameState.inventory.fruitsVegetables[ingredient.name]--;
            }
            
            // Add to mixer slot
            gameState.machines.mixer.ingredientSlots[slotIndex] = {
                name: ingredient.name,
                emoji: ingredient.emoji
            };
            
            updateMixerDisplay();
            updateInventoryDisplay();
            updateMachineStorageDisplay();
            closeFoodMenu();
        }

        function mixIngredients() {
            if (gameState.machines.mixer.working) {
                alert('O misturador est√° ocupado!');
                return;
            }

            const slots = gameState.machines.mixer.ingredientSlots;
            
            // Check recipes
            const recipe = checkMixerRecipe(slots);
            
            if (!recipe) {
                alert('Receita inv√°lida! Verifique os ingredientes.');
                return;
            }
            
            // Start mixing
            gameState.machines.mixer.working = true;
            gameState.machines.mixer.startTime = Date.now();
            gameState.machines.mixer.type = recipe.name;
            
            // Clear ingredient slots
            gameState.machines.mixer.ingredientSlots = [null, null, null, null];
            
            updateMixerDisplay();
            updateMachineStatus('mixer');
            
            setTimeout(() => {
                gameState.machines.mixer.working = false;
                
                if (recipe.name === 'chicken') {
                    gameState.barn.chickenFeed++;
                    alert('üêî Ra√ß√£o para galinhas pronta!');
                } else if (recipe.name === 'pig') {
                    gameState.barn.pigFeed++;
                    alert('üê∑ Ra√ß√£o para porcos pronta!');
                }
                
                updateBarnDisplay();
                updateMachineStatus('mixer');
            }, 15000); // 15 seconds
        }

        function checkMixerRecipe(slots) {
            const ingredients = slots.filter(slot => slot !== null).map(slot => slot.name);
            
            // Ra√ß√£o Galinha: 1 Trigo + 2 Milhos
            const wheatCount = ingredients.filter(i => i === 'Trigo').length;
            const cornCount = ingredients.filter(i => i === 'Milho').length;
            
            if (wheatCount >= 1 && cornCount >= 2 && ingredients.length === 3) {
                return {name: 'chicken', displayName: 'Ra√ß√£o Galinha'};
            }
            
            // Ra√ß√£o Porco: 1 Milho + 1 Batata + 1 Cenoura + 1 Br√≥colis
            if (ingredients.includes('Milho') && 
                ingredients.includes('Batata') && 
                ingredients.includes('Cenoura') && 
                ingredients.includes('Br√≥colis') &&
                ingredients.length === 4) {
                return {name: 'pig', displayName: 'Ra√ß√£o Porco'};
            }
            
            return null;
        }

        function clearMixerSlots() {
            // Return ingredients to inventory
            gameState.machines.mixer.ingredientSlots.forEach(slot => {
                if (slot) {
                    if (slot.name === 'Trigo') {
                        gameState.machineStorage.mill.wheat++;
                    } else if (slot.name === 'Milho') {
                        if (!gameState.inventory.farmProducts['Milho']) {
                            gameState.inventory.farmProducts['Milho'] = 0;
                        }
                        gameState.inventory.farmProducts['Milho']++;
                    } else if (['Batata', 'Cenoura', 'Br√≥colis'].includes(slot.name)) {
                        if (!gameState.inventory.fruitsVegetables[slot.name]) {
                            gameState.inventory.fruitsVegetables[slot.name] = 0;
                        }
                        gameState.inventory.fruitsVegetables[slot.name]++;
                    }
                }
            });
            
            // Clear slots
            gameState.machines.mixer.ingredientSlots = [null, null, null, null];
            
            updateMixerDisplay();
            updateInventoryDisplay();
            updateMachineStorageDisplay();
        }

        function updateMixerDisplay() {
            // Update ingredient slots
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`mixerSlot${i}`);
                const ingredient = gameState.machines.mixer.ingredientSlots[i];
                
                if (ingredient) {
                    slot.textContent = ingredient.emoji;
                    slot.classList.add('filled');
                    slot.onclick = () => removeIngredientFromMixer(i);
                } else {
                    slot.textContent = '+';
                    slot.classList.remove('filled');
                    slot.onclick = () => addIngredientToMixer(i);
                }
            }
        }

        function removeIngredientFromMixer(slotIndex) {
            const ingredient = gameState.machines.mixer.ingredientSlots[slotIndex];
            if (ingredient) {
                // Return ingredient to inventory
                if (ingredient.name === 'Trigo') {
                    gameState.machineStorage.mill.wheat++;
                } else if (ingredient.name === 'Milho') {
                    if (!gameState.inventory.farmProducts['Milho']) {
                        gameState.inventory.farmProducts['Milho'] = 0;
                    }
                    gameState.inventory.farmProducts['Milho']++;
                } else if (['Batata', 'Cenoura', 'Br√≥colis'].includes(ingredient.name)) {
                    if (!gameState.inventory.fruitsVegetables[ingredient.name]) {
                        gameState.inventory.fruitsVegetables[ingredient.name] = 0;
                    }
                    gameState.inventory.fruitsVegetables[ingredient.name]++;
                }
                
                gameState.machines.mixer.ingredientSlots[slotIndex] = null;
                
                updateMixerDisplay();
                updateInventoryDisplay();
                updateMachineStorageDisplay();
            }
        }

        function addCoffeeToSlot() {
            if (gameState.machineStorage.coffeeRoaster.coffee > 0 && 
                gameState.machineStorage.coffeeRoaster.coffeeSlot < 4) {
                gameState.machineStorage.coffeeRoaster.coffee--;
                gameState.machineStorage.coffeeRoaster.coffeeSlot++;
                updateCoffeeRoasterDisplay();
                updateMachineStorageDisplay();
            } else if (gameState.machineStorage.coffeeRoaster.coffee === 0) {
                alert('Voc√™ n√£o tem gr√£os de caf√©! Plante caf√© na fazenda.');
            } else {
                alert('O slot j√° tem 4 gr√£os de caf√©!');
            }
        }

        function removeCoffeeFromSlot() {
            if (gameState.machineStorage.coffeeRoaster.coffeeSlot > 0) {
                gameState.machineStorage.coffeeRoaster.coffee++;
                gameState.machineStorage.coffeeRoaster.coffeeSlot--;
                updateCoffeeRoasterDisplay();
                updateMachineStorageDisplay();
            }
        }

        function addWoodToCoffeeSlot() {
            if (gameState.barn.wood > 0 && 
                gameState.machineStorage.coffeeRoaster.woodSlot < 3) {
                gameState.barn.wood--;
                gameState.machineStorage.coffeeRoaster.woodSlot++;
                updateCoffeeRoasterDisplay();
                updateBarnDisplay();
                updateUI();
            } else if (gameState.barn.wood === 0) {
                alert('Voc√™ n√£o tem lenha! Corte troncos no bosque.');
            } else {
                alert('O slot j√° tem 3 lenhas!');
            }
        }

        function removeWoodFromCoffeeSlot() {
            if (gameState.machineStorage.coffeeRoaster.woodSlot > 0) {
                gameState.barn.wood++;
                gameState.machineStorage.coffeeRoaster.woodSlot--;
                updateCoffeeRoasterDisplay();
                updateBarnDisplay();
                updateUI();
            }
        }

        function updateCoffeeRoasterDisplay() {
            // Update coffee slot
            const coffeeSlot = document.getElementById('coffeeSlotContent');
            if (gameState.machineStorage.coffeeRoaster.coffeeSlot > 0) {
                coffeeSlot.textContent = `‚òï ${gameState.machineStorage.coffeeRoaster.coffeeSlot}`;
                document.getElementById('coffeeSlot').style.background = '#90EE90';
            } else {
                coffeeSlot.textContent = '+';
                document.getElementById('coffeeSlot').style.background = '#F5DEB3';
            }
            
            // Update wood slot
            const woodSlot = document.getElementById('coffeeWoodSlotContent');
            if (gameState.machineStorage.coffeeRoaster.woodSlot > 0) {
                woodSlot.textContent = `ü™µ ${gameState.machineStorage.coffeeRoaster.woodSlot}`;
                document.getElementById('coffeeWoodSlot').style.background = '#90EE90';
            } else {
                woodSlot.textContent = '+';
                document.getElementById('coffeeWoodSlot').style.background = '#F5DEB3';
            }
        }

        function roastCoffee() {
            if (gameState.machines.coffeeRoaster.working) return;
            
            if (gameState.machineStorage.coffeeRoaster.coffeeSlot >= 4 && 
                gameState.machineStorage.coffeeRoaster.woodSlot >= 3) {
                
                gameState.machineStorage.coffeeRoaster.coffeeSlot -= 4;
                gameState.machineStorage.coffeeRoaster.woodSlot -= 3;
                
                gameState.machines.coffeeRoaster.working = true;
                gameState.machines.coffeeRoaster.startTime = Date.now();
                
                updateCoffeeRoasterDisplay();
                updateMachineStatus('coffeeRoaster');
                
                setTimeout(() => {
                    gameState.machines.coffeeRoaster.working = false;
                    gameState.barn.sacodecaf√© = (gameState.barn.sacodecaf√© || 0) + 1;
                    updateBarnDisplay();
                    updateMachineStatus('coffeeRoaster');
                    updateCoffeeRoasterDisplay();
                    alert('‚òï Saco de Caf√© pronto!');
                }, 60000); // 1 minute
            } else {
                alert('Voc√™ precisa de: 4 Caf√©s e 3 Lenhas nos slots!');
            }
        }

        function addGrapesToSlot() {
            if (gameState.machineStorage.juiceMachine.grapes > 0 && 
                gameState.machineStorage.juiceMachine.grapeSlot < 2) {
                gameState.machineStorage.juiceMachine.grapes--;
                gameState.machineStorage.juiceMachine.grapeSlot++;
                updateJuiceMachineDisplay();
                updateMachineStorageDisplay();
            } else if (gameState.machineStorage.juiceMachine.grapes === 0) {
                alert('Voc√™ n√£o tem uvas! Plante uvas na fazenda.');
            } else {
                alert('O slot j√° tem 2 uvas!');
            }
        }

        function removeGrapesFromSlot() {
            if (gameState.machineStorage.juiceMachine.grapeSlot > 0) {
                gameState.machineStorage.juiceMachine.grapes++;
                gameState.machineStorage.juiceMachine.grapeSlot--;
                updateJuiceMachineDisplay();
                updateMachineStorageDisplay();
            }
        }

        function updateJuiceMachineDisplay() {
            // Update grape slot
            const grapeSlot = document.getElementById('grapeSlotContent');
            if (gameState.machineStorage.juiceMachine.grapeSlot > 0) {
                grapeSlot.textContent = `üçá ${gameState.machineStorage.juiceMachine.grapeSlot}`;
                document.getElementById('grapeSlot').style.background = '#90EE90';
            } else {
                grapeSlot.textContent = '+';
                document.getElementById('grapeSlot').style.background = '#F5DEB3';
            }
        }

        function makeJuice() {
            if (gameState.machines.juiceMachine.working) return;
            
            if (gameState.machineStorage.juiceMachine.grapeSlot >= 2) {
                gameState.machineStorage.juiceMachine.grapeSlot -= 2;
                
                gameState.machines.juiceMachine.working = true;
                gameState.machines.juiceMachine.startTime = Date.now();
                
                updateJuiceMachineDisplay();
                updateMachineStatus('juiceMachine');
                
                setTimeout(() => {
                    gameState.machines.juiceMachine.working = false;
                    gameState.barn.sucodeuva = (gameState.barn.sucodeuva || 0) + 1;
                    updateBarnDisplay();
                    updateMachineStatus('juiceMachine');
                    updateJuiceMachineDisplay();
                    alert('üßÉ Suco de Uva pronto!');
                }, 10000); // 10 seconds
            } else {
                alert('Voc√™ precisa de: 2 Uvas no slot!');
            }
        }

        function addWheatToSlot() {
            if (gameState.machineStorage.mill.wheat > 0 && 
                gameState.machineStorage.mill.wheatSlot < 4) {
                gameState.machineStorage.mill.wheat--;
                gameState.machineStorage.mill.wheatSlot++;
                updateMillDisplay();
                updateMachineStorageDisplay();
            } else if (gameState.machineStorage.mill.wheat === 0) {
                alert('Voc√™ n√£o tem trigo! Plante trigo na fazenda.');
            } else {
                alert('O slot j√° tem 4 trigos!');
            }
        }

        function removeWheatFromSlot() {
            if (gameState.machineStorage.mill.wheatSlot > 0) {
                gameState.machineStorage.mill.wheat++;
                gameState.machineStorage.mill.wheatSlot--;
                updateMillDisplay();
                updateMachineStorageDisplay();
            }
        }

        function updateMillDisplay() {
            // Update wheat slot
            const wheatSlot = document.getElementById('wheatSlotContent');
            if (gameState.machineStorage.mill.wheatSlot > 0) {
                wheatSlot.textContent = `üåæ ${gameState.machineStorage.mill.wheatSlot}`;
                document.getElementById('wheatSlot').style.background = '#90EE90';
            } else {
                wheatSlot.textContent = '+';
                document.getElementById('wheatSlot').style.background = '#F5DEB3';
            }
        }

        function makeFlour() {
            if (gameState.machines.mill.working) return;
            
            if (gameState.machineStorage.mill.wheatSlot >= 4) {
                gameState.machineStorage.mill.wheatSlot -= 4;
                
                gameState.machines.mill.working = true;
                gameState.machines.mill.startTime = Date.now();
                
                updateMillDisplay();
                updateMachineStatus('mill');
                
                setTimeout(() => {
                    gameState.machines.mill.working = false;
                    gameState.barn.sacodefarinha = (gameState.barn.sacodefarinha || 0) + 1;
                    updateBarnDisplay();
                    updateMachineStatus('mill');
                    updateMillDisplay();
                    alert('üåæ Saco de Farinha pronto!');
                }, 60000); // 1 minute
            } else {
                alert('Voc√™ precisa de: 4 Trigos no slot!');
            }
        }

        function addMilkToSlot() {
            if (gameState.inventory.others['Leite'] > 0 && 
                gameState.machineStorage.cheeseMaker.milkSlot < 2) {
                gameState.inventory.others['Leite']--;
                gameState.machineStorage.cheeseMaker.milkSlot++;
                updateCheeseMakerDisplay();
                updateInventoryDisplay();
                updateMachineStorageDisplay();
            } else if (gameState.inventory.others['Leite'] === 0 || !gameState.inventory.others['Leite']) {
                alert('Voc√™ n√£o tem leite! Ordenhes as vacas.');
            } else {
                alert('O slot j√° tem 2 leites!');
            }
        }

        function removeMilkFromSlot() {
            if (gameState.machineStorage.cheeseMaker.milkSlot > 0) {
                if (!gameState.inventory.others['Leite']) {
                    gameState.inventory.others['Leite'] = 0;
                }
                gameState.inventory.others['Leite']++;
                gameState.machineStorage.cheeseMaker.milkSlot--;
                updateCheeseMakerDisplay();
                updateInventoryDisplay();
                updateMachineStorageDisplay();
            }
        }

        function updateCheeseMakerDisplay() {
            // Update milk slot
            const milkSlot = document.getElementById('milkSlotContent');
            if (gameState.machineStorage.cheeseMaker.milkSlot > 0) {
                milkSlot.textContent = `ü•õ ${gameState.machineStorage.cheeseMaker.milkSlot}`;
                document.getElementById('milkSlot').style.background = '#90EE90';
            } else {
                milkSlot.textContent = '+';
                document.getElementById('milkSlot').style.background = '#F5DEB3';
            }
        }

        function makeCheese() {
            if (gameState.machines.cheeseMaker.working) return;
            
            if (gameState.machineStorage.cheeseMaker.milkSlot >= 2) {
                gameState.machineStorage.cheeseMaker.milkSlot -= 2;
                
                gameState.machines.cheeseMaker.working = true;
                gameState.machines.cheeseMaker.startTime = Date.now();
                
                updateCheeseMakerDisplay();
                updateMachineStatus('cheeseMaker');
                
                setTimeout(() => {
                    gameState.machines.cheeseMaker.working = false;
                    gameState.barn.queijo = (gameState.barn.queijo || 0) + 1;
                    updateBarnDisplay();
                    updateMachineStatus('cheeseMaker');
                    updateCheeseMakerDisplay();
                    alert('üßÄ Queijo pronto!');
                }, 60000); // 1 minute
            } else {
                alert('Voc√™ precisa de: 2 Leites no slot!');
            }
        }

        function addWoolToSlot() {
            if (gameState.machineStorage.spinningMachine.wool > 0 && 
                gameState.machineStorage.spinningMachine.woolSlot < 2) {
                gameState.machineStorage.spinningMachine.wool--;
                gameState.machineStorage.spinningMachine.woolSlot++;
                updateSpinningMachineDisplay();
                updateMachineStorageDisplay();
            } else if (gameState.machineStorage.spinningMachine.wool === 0) {
                alert('Voc√™ n√£o tem l√£! Tosquie as ovelhas.');
            } else {
                alert('O slot j√° tem 2 l√£s!');
            }
        }

        function removeWoolFromSlot() {
            if (gameState.machineStorage.spinningMachine.woolSlot > 0) {
                gameState.machineStorage.spinningMachine.wool++;
                gameState.machineStorage.spinningMachine.woolSlot--;
                updateSpinningMachineDisplay();
                updateMachineStorageDisplay();
            }
        }

        function updateSpinningMachineDisplay() {
            // Update wool slot
            const woolSlot = document.getElementById('woolSlotContent');
            if (gameState.machineStorage.spinningMachine.woolSlot > 0) {
                woolSlot.textContent = `üêë ${gameState.machineStorage.spinningMachine.woolSlot}`;
                document.getElementById('woolSlot').style.background = '#90EE90';
            } else {
                woolSlot.textContent = '+';
                document.getElementById('woolSlot').style.background = '#F5DEB3';
            }
        }

        function spinWool() {
            if (gameState.machines.spinningMachine.working) return;
            
            if (gameState.machineStorage.spinningMachine.woolSlot >= 2) {
                gameState.machineStorage.spinningMachine.woolSlot -= 2;
                
                gameState.machines.spinningMachine.working = true;
                gameState.machines.spinningMachine.startTime = Date.now();
                
                updateSpinningMachineDisplay();
                updateMachineStatus('spinningMachine');
                
                setTimeout(() => {
                    gameState.machines.spinningMachine.working = false;
                    gameState.barn.novelo = (gameState.barn.novelo || 0) + 1;
                    updateBarnDisplay();
                    updateMachineStatus('spinningMachine');
                    updateSpinningMachineDisplay();
                    alert('üß∂ Novelo pronto!');
                }, 60000); // 1 minute
            } else {
                alert('Voc√™ precisa de: 2 L√£s no slot!');
            }
        }

        function addGrassToSlot() {
            // This function is no longer needed since grass goes directly to slot when harvested
            alert('A grama √© adicionada automaticamente quando voc√™ coleta no campo de grama!');
        }

        function dryGrassInSlot() {
            if (!gameState.grassDryerSlot || gameState.grassDryerSlot.grass === 0) {
                alert('Adicione grama primeiro!');
                return;
            }
            
            if (gameState.grassDryerSlot.drying) {
                alert('J√° est√° secando!');
                return;
            }
            
            gameState.grassDryerSlot.drying = true;
            gameState.grassDryerSlot.startTime = Date.now();
            
            updateGrassDryerDisplay();
            
            setTimeout(() => {
                const grassAmount = gameState.grassDryerSlot.grass;
                gameState.grassDryerSlot.drying = false;
                gameState.grassDryerSlot.grass = 0;
                gameState.machineStorage.grassDryer.driedGrass += grassAmount;
                
                updateGrassDryerDisplay();
                updateMachineStorageDisplay();
                alert(`üåæ ${grassAmount} gramas secas prontas!`);
            }, 30000); // 30 seconds
        }

        function updateGrassDryerDisplay() {
            if (!gameState.machines.hasGrassDryer) return;
            
            const slot = document.getElementById('grassDryerSlot');
            const content = document.getElementById('grassSlotContent');
            const button = document.getElementById('grassDryerBtn');
            const status = document.getElementById('grassDryerStatus');
            
            const haySlot = document.getElementById('hayMakingSlot');
            const hayContent = document.getElementById('haySlotContent');
            const hayButton = document.getElementById('makeHayBtn');
            
            if (!gameState.grassDryerSlot) {
                gameState.grassDryerSlot = {};
            }
            
            if (!gameState.hayMakingSlot) {
                gameState.hayMakingSlot = {};
            }
            
            // Update grass drying slot
            if (gameState.grassDryerSlot.drying) {
                const elapsed = Date.now() - gameState.grassDryerSlot.startTime;
                const remaining = Math.max(0, 30000 - elapsed);
                const seconds = Math.ceil(remaining / 1000);
                
                content.textContent = 'üåæ';
                slot.style.background = '#FFD700';
                button.disabled = true;
                status.textContent = `Secando... ${seconds}s restantes`;
                status.className = 'machine-status working';
            } else if (gameState.grassDryerSlot.grass > 0) {
                content.textContent = `üå±\n${gameState.grassDryerSlot.grass}x`;
                slot.style.background = '#90EE90';
                button.disabled = false;
                status.textContent = '';
                status.className = 'machine-status';
            } else {
                content.textContent = '+';
                slot.style.background = '#F5DEB3';
                button.disabled = true;
                status.textContent = '';
                status.className = 'machine-status';
            }
            
            // Update hay making slot
            if (gameState.hayMakingSlot.making) {
                const elapsed = Date.now() - gameState.hayMakingSlot.startTime;
                const remaining = Math.max(0, 10000 - elapsed);
                const seconds = Math.ceil(remaining / 1000);
                
                hayContent.textContent = 'üåæ';
                haySlot.style.background = '#FFD700';
                hayButton.disabled = true;
                status.textContent = `Fazendo feno... ${seconds}s restantes`;
                status.className = 'machine-status working';
            } else if (gameState.hayMakingSlot.driedGrass > 0) {
                hayContent.textContent = `üåæ\n4x`;
                haySlot.style.background = '#90EE90';
                hayButton.disabled = false;
                if (!gameState.grassDryerSlot.drying) {
                    status.textContent = '';
                    status.className = 'machine-status';
                }
            } else {
                hayContent.textContent = '+';
                haySlot.style.background = '#F5DEB3';
                hayButton.disabled = true;
            }
        }

        function addDriedGrassToHaySlot() {
            if (gameState.machineStorage.grassDryer.driedGrass < 4) {
                alert('Voc√™ precisa de pelo menos 4 gramas secas (que passaram pelo secador)!');
                return;
            }
            
            if (gameState.hayMakingSlot && gameState.hayMakingSlot.driedGrass > 0) {
                alert('J√° h√° grama seca no slot!');
                return;
            }
            
            if (!gameState.hayMakingSlot) {
                gameState.hayMakingSlot = {};
            }
            
            gameState.machineStorage.grassDryer.driedGrass -= 4;
            gameState.hayMakingSlot.driedGrass = 4;
            
            updateGrassDryerDisplay();
            updateMachineStorageDisplay();
        }

        function makeHayInSlot() {
            if (!gameState.hayMakingSlot || gameState.hayMakingSlot.driedGrass === 0) {
                alert('Adicione 4 gramas secas primeiro!');
                return;
            }
            
            if (gameState.hayMakingSlot.making) {
                alert('J√° est√° fazendo feno!');
                return;
            }
            
            gameState.hayMakingSlot.making = true;
            gameState.hayMakingSlot.startTime = Date.now();
            
            updateGrassDryerDisplay();
            
            setTimeout(() => {
                gameState.hayMakingSlot.making = false;
                gameState.hayMakingSlot.driedGrass = 0;
                gameState.barn.hay++;
                
                updateGrassDryerDisplay();
                updateBarnDisplay();
                alert('üåæ Feno pronto!');
            }, 10000); // 10 seconds
        }

        function cutWoodMachine() {
            if (gameState.machines.woodCutter.working) return;
            
            if (gameState.machineStorage.woodCutter.trunks >= 1) {
                gameState.machineStorage.woodCutter.trunks--;
                
                gameState.machines.woodCutter.working = true;
                gameState.machines.woodCutter.startTime = Date.now();
                
                updateMachineStatus('woodCutter');
                
                setTimeout(() => {
                    gameState.machines.woodCutter.working = false;
                    gameState.barn.wood += 4;
                    updateBarnDisplay();
                    updateMachineStatus('woodCutter');
                }, 5000); // 5 seconds
            } else {
                alert('Voc√™ precisa de: 1 Tronco (no Cortador)!');
            }
        }

        function updateMachineStatus(machineType) {
            const machine = gameState.machines[machineType];
            const statusElement = document.getElementById(machineType + 'Status');
            const btnElement = document.getElementById(machineType + 'Btn');
            
            if (machine.working) {
                const elapsed = Date.now() - machine.startTime;
                let duration;
                
                switch(machineType) {
                    case 'composter': duration = 60000; break;
                    case 'mixer': duration = machine.type === 'chicken' ? 10000 : 15000; break;
                    case 'coffeeRoaster': duration = 30000; break;
                    case 'juiceMachine': duration = 10000; break;
                    case 'mill': duration = 60000; break;
                    case 'cheeseMaker': duration = 60000; break;
                    case 'spinningMachine': duration = 60000; break;
                    case 'grassDryer': duration = machine.type === 'hay' ? 10000 : 30000; break;
                    case 'woodCutter': duration = 5000; break;
                    case 'stove': duration = machine.type === 'ch√°' ? 10000 : 30000; break;
                }
                
                const remaining = Math.max(0, duration - elapsed);
                const seconds = Math.ceil(remaining / 1000);
                
                statusElement.textContent = `Trabalhando... ${seconds}s`;
                statusElement.className = 'machine-status working';
                if (btnElement) btnElement.disabled = true;
            } else {
                statusElement.textContent = 'Pronto para usar';
                statusElement.className = 'machine-status';
                if (btnElement) btnElement.disabled = false;
            }
        }

        function updateBarnDisplay() {
            const barnItems = document.getElementById('barnItems');
            barnItems.innerHTML = '';
            
            const barnContents = [
                {name: 'Ossos', emoji: 'ü¶¥', quantity: gameState.barn.bones},
                {name: 'Chaves', emoji: 'üóùÔ∏è', quantity: gameState.barn.keys},
                {name: 'Troncos', emoji: 'üå≥', quantity: gameState.barn.trunks || 0},
                {name: 'Feno', emoji: 'üåæ', quantity: gameState.barn.hay},
                {name: 'Carv√£o', emoji: '‚ö´', quantity: gameState.barn.coal},
                {name: 'Lenha', emoji: 'ü™µ', quantity: gameState.barn.wood},
                {name: 'Etanol', emoji: '‚õΩ', quantity: gameState.barn.ethanol || 0},
                {name: 'Ra√ß√£o Cachorro', emoji: 'ü•©', quantity: gameState.barn.dogFood},
                {name: 'Vacinas', emoji: 'üíâ', quantity: gameState.barn.vaccines},
                {name: 'Ra√ß√£o Galinha', emoji: 'üêî', quantity: gameState.barn.chickenFeed || 0},
                {name: 'Ra√ß√£o Porco', emoji: 'üê∑', quantity: gameState.barn.pigFeed || 0},
                {name: 'Frango Cru', emoji: 'üêì', quantity: gameState.barn.rawChicken || 0},
                {name: 'Ch√°', emoji: 'üçµ', quantity: gameState.barn.ch√° || 0},
                {name: 'Salada', emoji: 'ü•ó', quantity: gameState.barn.salada || 0},
                {name: 'Ensopado', emoji: 'üç≤', quantity: gameState.barn.stew || 0},
                {name: 'Bife', emoji: 'ü•©', quantity: gameState.barn.steak || 0},
                {name: 'Frango', emoji: 'üçó', quantity: gameState.barn.chicken || 0},
                {name: 'Peixe Cozido', emoji: 'üêü', quantity: gameState.barn.cookedFish || 0},
                {name: 'Bolo de Anivers√°rio', emoji: 'üéÇ', quantity: gameState.barn.birthdayCake || 0},
                {name: 'Semente Tulipa', emoji: 'üå∑', quantity: gameState.barn.tulipSeeds || 0},
                {name: 'Semente L√≠rio', emoji: 'üå∫', quantity: gameState.barn.lilySeeds || 0},
                {name: 'Semente Sakura', emoji: 'üå∏', quantity: gameState.barn.sakuraSeeds || 0},
                {name: 'Colar de P√©rolas', emoji: 'üìø', quantity: gameState.barn.colardep√©rolas || 0},
                {name: 'Anel de Esmeralda', emoji: 'üíç', quantity: gameState.barn.aneldeesmeralda || 0},
                {name: 'Buqu√™ de Flores', emoji: 'üíê', quantity: gameState.barn.buqu√™deflores || 0}
            ];
            
            barnContents.forEach(item => {
                if (item.quantity > 0) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-item';
                    itemDiv.innerHTML = `
                        <span>${item.emoji} ${item.name}</span>
                        <span>${item.quantity}x</span>
                    `;
                    barnItems.appendChild(itemDiv);
                }
            });
            
            // Update mine access
            if (gameState.barn.keys > 0 && !gameState.mineAccess) {
                gameState.mineAccess = true;
                document.getElementById('mineAccess').innerHTML = 'üîì Mina liberada! Use uma chave para 9 batidas nas rochas.';
                document.getElementById('mineAccess').style.color = '#228B22';
            }
        }

        function updateGrassDisplay() {
            const grid = document.getElementById('grassGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'grass-slot';
                
                if (gameState.grass[i]) {
                    slot.innerHTML = 'üå±';
                    slot.onclick = () => harvestGrass(i);
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = '';
                }
                
                grid.appendChild(slot);
            }
        }

        function updateTreesDisplay() {
            const grid = document.getElementById('treesGrid');
            grid.innerHTML = '';
            
            const trees = [
                {type: 'trunk', emoji: 'üå≥', name: 'Troncos'},
                {type: 'apple', emoji: 'üçé', name: 'Ma√ß√£s'},
                {type: 'orange', emoji: 'üçä', name: 'Laranjas'},
                {type: 'banana', emoji: 'üçå', name: 'Bananas'}
            ];
            
            trees.forEach(tree => {
                const slot = document.createElement('div');
                slot.className = 'tree-slot';
                slot.innerHTML = tree.emoji;
                
                if (tree.type === 'trunk') {
                    const count = document.createElement('div');
                    count.className = 'tree-count';
                    count.textContent = `${gameState.trees.trunk.clicks} cliques`;
                    slot.appendChild(count);
                    slot.onclick = () => harvestTrunk();
                } else {
                    const count = document.createElement('div');
                    count.className = 'tree-count';
                    count.textContent = `${gameState.trees[tree.type].fruits}/4`;
                    slot.appendChild(count);
                    slot.onclick = () => harvestFruit(tree.type);
                }
                
                grid.appendChild(slot);
            });
        }

        function updateFishDisplay() {
            const grid = document.getElementById('fishGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const slot = document.createElement('div');
                slot.className = 'fish-slot';
                
                if (gameState.fish[i]) {
                    slot.innerHTML = 'üêü';
                    slot.onclick = () => catchFish(i);
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = '';
                }
                
                grid.appendChild(slot);
            }
        }

        function updateRocksDisplay() {
            const grid = document.getElementById('rocksGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const slot = document.createElement('div');
                slot.className = 'rock-slot';
                
                if (gameState.rocks[i].resting) {
                    slot.classList.add('resting');
                    slot.innerHTML = 'üí§';
                } else {
                    slot.innerHTML = 'ü™®';
                    const hits = document.createElement('div');
                    hits.className = 'rock-hits';
                    hits.textContent = `${gameState.rocks[i].hits}/3`;
                    slot.appendChild(hits);
                }
                
                slot.onclick = () => mineRock(i);
                grid.appendChild(slot);
            }
        }

        function updateAxeStatus() {
            document.getElementById('axeUses').textContent = gameState.axeUses;
            if (gameState.axeUses <= 0) {
                document.getElementById('axeStatus').classList.add('broken');
                document.getElementById('axeStatus').innerHTML = 'ü™ì Machado quebrado! Compre outro no mercadinho.';
                document.getElementById('axeAndWoodCutterShop').style.display = 'block';
                gameState.hasAxe = false;
            }
        }

        function updateFishingRodStatus() {
            document.getElementById('rodUses').textContent = gameState.fishingRodUses;
            if (gameState.fishingRodUses <= 0) {
                document.getElementById('fishingRodStatus').classList.add('broken');
                document.getElementById('fishingRodStatus').innerHTML = 'üé£ Vara quebrada! Compre outra no mercadinho.';
                gameState.hasFishingRod = false;
            }
        }

        function updatePickaxeStatus() {
            document.getElementById('pickaxeUses').textContent = gameState.pickaxeUses;
            if (gameState.pickaxeUses <= 0) {
                document.getElementById('pickaxeStatus').classList.add('broken');
                document.getElementById('pickaxeStatus').innerHTML = '‚õèÔ∏è Picareta quebrada! Compre outra no mercadinho.';
                gameState.hasPickaxe = false;
            }
        }

        function updateChickensDisplay() {
            const grid = document.getElementById('chickensGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                // Create container for animal and feeding slot
                const container = document.createElement('div');
                container.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 5px;';
                
                // Animal slot
                const animalSlot = document.createElement('div');
                animalSlot.className = 'animal-slot';
                
                if (gameState.chickens[i]) {
                    const chicken = gameState.chickens[i];
                    animalSlot.innerHTML = chicken.eating ? 'üçΩÔ∏è' : chicken.resting ? 'üò¥' : chicken.emoji;
                    
                    if (chicken.sick) animalSlot.classList.add('sick');
                    if (chicken.eating) animalSlot.classList.add('eating');
                    if (chicken.resting) animalSlot.classList.add('resting');
                    
                    animalSlot.onclick = () => handleAnimalClick('chicken', i);
                } else {
                    animalSlot.innerHTML = '';
                }
                
                container.appendChild(animalSlot);
                
                // Feeding slot
                const feedingSlot = document.createElement('div');
                feedingSlot.className = 'animal-slot';
                feedingSlot.style.cssText = 'width: 40px; height: 40px; font-size: 16px; border: 2px solid #8B4513;';
                
                if (gameState.chickens[i]) {
                    const chicken = gameState.chickens[i];
                    if (chicken.feedingSlot && chicken.feedingSlot.food) {
                        feedingSlot.innerHTML = 'üêî';
                        feedingSlot.style.background = '#90EE90';
                        feedingSlot.title = 'Ra√ß√£o adicionada';
                    } else if (!chicken.resting && !chicken.eating && !chicken.sick) {
                        feedingSlot.innerHTML = '+';
                        feedingSlot.style.background = '#F5DEB3';
                        feedingSlot.onclick = () => addFoodToAnimalSlot('chicken', i);
                        feedingSlot.title = 'Clique para adicionar ra√ß√£o';
                    } else {
                        feedingSlot.innerHTML = '';
                        feedingSlot.style.background = '#F5DEB3';
                    }
                    
                    // Show countdown if resting
                    if (chicken.resting && chicken.restStartTime) {
                        const elapsed = Date.now() - chicken.restStartTime;
                        const remaining = Math.max(0, 300000 - elapsed); // 5 minutes
                        const minutes = Math.floor(remaining / 60000);
                        const seconds = Math.floor((remaining % 60000) / 1000);
                        
                        const countdown = document.createElement('div');
                        countdown.style.cssText = 'font-size: 10px; color: #666; text-align: center; margin-top: 2px;';
                        countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        container.appendChild(countdown);
                    }
                } else {
                    feedingSlot.innerHTML = '';
                    feedingSlot.style.background = '#F5DEB3';
                }
                
                container.appendChild(feedingSlot);
                grid.appendChild(container);
            }
        }

        function updatePigsDisplay() {
            const grid = document.getElementById('pigsGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                // Create container for animal and feeding slot
                const container = document.createElement('div');
                container.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 5px;';
                
                // Animal slot
                const animalSlot = document.createElement('div');
                animalSlot.className = 'animal-slot';
                
                if (gameState.pigs[i]) {
                    const pig = gameState.pigs[i];
                    animalSlot.innerHTML = pig.eating ? 'üçΩÔ∏è' : pig.resting ? 'üò¥' : pig.emoji;
                    
                    if (pig.sick) animalSlot.classList.add('sick');
                    if (pig.eating) animalSlot.classList.add('eating');
                    if (pig.resting) animalSlot.classList.add('resting');
                    
                    animalSlot.onclick = () => handleAnimalClick('pig', i);
                } else {
                    animalSlot.innerHTML = '';
                }
                
                container.appendChild(animalSlot);
                
                // Feeding slot
                const feedingSlot = document.createElement('div');
                feedingSlot.className = 'animal-slot';
                feedingSlot.style.cssText = 'width: 40px; height: 40px; font-size: 16px; border: 2px solid #8B4513;';
                
                if (gameState.pigs[i]) {
                    const pig = gameState.pigs[i];
                    if (pig.feedingSlot && pig.feedingSlot.food) {
                        feedingSlot.innerHTML = 'üê∑';
                        feedingSlot.style.background = '#90EE90';
                        feedingSlot.title = 'Ra√ß√£o adicionada';
                    } else if (!pig.resting && !pig.eating && !pig.sick) {
                        feedingSlot.innerHTML = '+';
                        feedingSlot.style.background = '#F5DEB3';
                        feedingSlot.onclick = () => addFoodToAnimalSlot('pig', i);
                        feedingSlot.title = 'Clique para adicionar ra√ß√£o';
                    } else {
                        feedingSlot.innerHTML = '';
                        feedingSlot.style.background = '#F5DEB3';
                    }
                    
                    // Show countdown if resting
                    if (pig.resting && pig.restStartTime) {
                        const elapsed = Date.now() - pig.restStartTime;
                        const remaining = Math.max(0, 300000 - elapsed); // 5 minutes
                        const minutes = Math.floor(remaining / 60000);
                        const seconds = Math.floor((remaining % 60000) / 1000);
                        
                        const countdown = document.createElement('div');
                        countdown.style.cssText = 'font-size: 10px; color: #666; text-align: center; margin-top: 2px;';
                        countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        container.appendChild(countdown);
                    }
                } else {
                    feedingSlot.innerHTML = '';
                    feedingSlot.style.background = '#F5DEB3';
                }
                
                container.appendChild(feedingSlot);
                grid.appendChild(container);
            }
        }

        function updateSheepDisplay() {
            const grid = document.getElementById('sheepGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                // Create container for animal and feeding slot
                const container = document.createElement('div');
                container.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 5px;';
                
                // Animal slot
                const animalSlot = document.createElement('div');
                animalSlot.className = 'animal-slot';
                
                if (gameState.sheep[i]) {
                    const sheep = gameState.sheep[i];
                    animalSlot.innerHTML = sheep.eating ? 'üçΩÔ∏è' : sheep.resting ? 'üò¥' : sheep.emoji;
                    
                    if (sheep.sick) animalSlot.classList.add('sick');
                    if (sheep.eating) animalSlot.classList.add('eating');
                    if (sheep.resting) animalSlot.classList.add('resting');
                    
                    animalSlot.onclick = () => handleAnimalClick('sheep', i);
                } else {
                    animalSlot.innerHTML = '';
                }
                
                container.appendChild(animalSlot);
                
                // Feeding slot
                const feedingSlot = document.createElement('div');
                feedingSlot.className = 'animal-slot';
                feedingSlot.style.cssText = 'width: 40px; height: 40px; font-size: 16px; border: 2px solid #8B4513;';
                
                if (gameState.sheep[i]) {
                    const sheep = gameState.sheep[i];
                    if (sheep.feedingSlot && sheep.feedingSlot.food) {
                        feedingSlot.innerHTML = 'üåæ';
                        feedingSlot.style.background = '#90EE90';
                        feedingSlot.title = 'Feno adicionado';
                    } else if (!sheep.resting && !sheep.eating && !sheep.sick) {
                        feedingSlot.innerHTML = '+';
                        feedingSlot.style.background = '#F5DEB3';
                        feedingSlot.onclick = () => addFoodToAnimalSlot('sheep', i);
                        feedingSlot.title = 'Clique para adicionar feno';
                    } else {
                        feedingSlot.innerHTML = '';
                        feedingSlot.style.background = '#F5DEB3';
                    }
                    
                    // Show countdown if resting
                    if (sheep.resting && sheep.restStartTime) {
                        const elapsed = Date.now() - sheep.restStartTime;
                        const remaining = Math.max(0, 300000 - elapsed); // 5 minutes
                        const minutes = Math.floor(remaining / 60000);
                        const seconds = Math.floor((remaining % 60000) / 1000);
                        
                        const countdown = document.createElement('div');
                        countdown.style.cssText = 'font-size: 10px; color: #666; text-align: center; margin-top: 2px;';
                        countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        container.appendChild(countdown);
                    }
                } else {
                    feedingSlot.innerHTML = '';
                    feedingSlot.style.background = '#F5DEB3';
                }
                
                container.appendChild(feedingSlot);
                grid.appendChild(container);
            }
        }

        function updateCowsDisplay() {
            const grid = document.getElementById('cowsGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                // Create container for animal and feeding slot
                const container = document.createElement('div');
                container.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 5px;';
                
                // Animal slot
                const animalSlot = document.createElement('div');
                animalSlot.className = 'animal-slot';
                
                if (gameState.cows[i]) {
                    const cow = gameState.cows[i];
                    animalSlot.innerHTML = cow.eating ? 'üçΩÔ∏è' : cow.resting ? 'üò¥' : cow.emoji;
                    
                    if (cow.sick) animalSlot.classList.add('sick');
                    if (cow.eating) animalSlot.classList.add('eating');
                    if (cow.resting) animalSlot.classList.add('resting');
                    
                    animalSlot.onclick = () => handleAnimalClick('cow', i);
                } else {
                    animalSlot.innerHTML = '';
                }
                
                container.appendChild(animalSlot);
                
                // Feeding slot
                const feedingSlot = document.createElement('div');
                feedingSlot.className = 'animal-slot';
                feedingSlot.style.cssText = 'width: 40px; height: 40px; font-size: 16px; border: 2px solid #8B4513;';
                
                if (gameState.cows[i]) {
                    const cow = gameState.cows[i];
                    if (cow.feedingSlot && cow.feedingSlot.food) {
                        feedingSlot.innerHTML = 'üåæ';
                        feedingSlot.style.background = '#90EE90';
                        feedingSlot.title = 'Feno adicionado';
                    } else if (!cow.resting && !cow.eating && !cow.sick) {
                        feedingSlot.innerHTML = '+';
                        feedingSlot.style.background = '#F5DEB3';
                        feedingSlot.onclick = () => addFoodToAnimalSlot('cow', i);
                        feedingSlot.title = 'Clique para adicionar feno';
                    } else {
                        feedingSlot.innerHTML = '';
                        feedingSlot.style.background = '#F5DEB3';
                    }
                    
                    // Show countdown if resting
                    if (cow.resting && cow.restStartTime) {
                        const elapsed = Date.now() - cow.restStartTime;
                        const remaining = Math.max(0, 300000 - elapsed); // 5 minutes
                        const minutes = Math.floor(remaining / 60000);
                        const seconds = Math.floor((remaining % 60000) / 1000);
                        
                        const countdown = document.createElement('div');
                        countdown.style.cssText = 'font-size: 10px; color: #666; text-align: center; margin-top: 2px;';
                        countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        container.appendChild(countdown);
                    }
                } else {
                    feedingSlot.innerHTML = '';
                    feedingSlot.style.background = '#F5DEB3';
                }
                
                container.appendChild(feedingSlot);
                grid.appendChild(container);
            }
        }

        function updateFlowersDisplay() {
            const grid = document.getElementById('flowersGrid');
            grid.innerHTML = '';
            
            const flowerTypes = [
                {type: 'rosa', emoji: 'üåπ', name: 'Rosa'},
                {type: 'girassol', emoji: 'üåª', name: 'Girassol'},
                {type: 'margarida', emoji: 'üåº', name: 'Margarida'}
            ];
            
            flowerTypes.forEach(flower => {
                const slot = document.createElement('div');
                slot.className = 'flower-slot';
                
                if (gameState.flowers[flower.type] > 0) {
                    slot.innerHTML = `${flower.emoji}<br>${gameState.flowers[flower.type]}x`;
                    slot.onclick = () => harvestFlower(flower.type);
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = 'üå±<br>Crescendo...';
                }
                
                grid.appendChild(slot);
            });
        }

        function updateProducerFairDisplay() {
            const grid = document.getElementById('fairGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const slot = document.createElement('div');
                slot.className = 'flower-slot';
                
                if (gameState.producerFair.slots[i]) {
                    const item = gameState.producerFair.slots[i];
                    slot.innerHTML = `${item.emoji}<br>${item.name}`;
                    slot.onclick = () => removeFromFair(i);
                    slot.title = 'Clique para remover';
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = 'üì¶<br>Vazio';
                    slot.onclick = () => openFairItemSelector(i);
                    slot.title = 'Clique para adicionar item';
                }
                
                grid.appendChild(slot);
            }
            
            // Update timer
            const now = Date.now();
            const timeSinceEarning = now - gameState.producerFair.lastEarning;
            const remaining = 900000 - timeSinceEarning; // 15 minutes
            
            if (remaining > 0) {
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                document.getElementById('fairTimer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('fairTimer').textContent = 'Pronto para pagamento!';
            }
        }

        function openFairItemSelector(slotIndex) {
            const modal = document.getElementById('foodModal');
            const content = document.getElementById('foodMenuContent');
            const title = document.getElementById('foodModalTitle');
            
            title.textContent = 'üè™ Escolha um produto para expor';
            content.innerHTML = '';
            
            let hasItems = false;
            
            // Check all inventory categories
            Object.keys(gameState.inventory).forEach(category => {
                Object.keys(gameState.inventory[category]).forEach(item => {
                    const quantity = gameState.inventory[category][item];
                    if (quantity > 0) {
                        hasItems = true;
                        const seed = seeds.find(s => s.name === item);
                        let emoji = seed ? seed.emoji : '';
                        
                        // Set emoji for special items
                        const specialEmojis = {
                            'CD': 'üíø', 'Bola': '‚öΩ', 'Sapato': 'üëü', 'Pote de Mel': 'üçØ',
                            'P√©rola': 'üíé', 'Esmeralda': 'üíö', 'Rubi': '‚ù§Ô∏è', 'Safira': 'üíô',
                            'Flor': 'üå∏', 'Rosa': 'üåπ', 'Girassol': 'üåª', 'Margarida': 'üåº',
                            'Grama': 'üå±', 'Ma√ß√£': 'üçé', 'Laranja': 'üçä', 'Banana': 'üçå',
                            'Peixe': 'üêü', 'Lenha': 'ü™µ', 'Ovos': 'ü•ö', 'Carne Su√≠na': 'ü•©',
                            'Leite': 'ü•õ', 'Esterco': 'üí©', 'L√£': 'üêë', 'Saco de Caf√©': '‚òï',
                            'Suco de Uva': 'üßÉ', 'Saco de Farinha': 'üåæ', 'Queijo': 'üßÄ',
                            'Novelo': 'üß∂', 'P√£o': 'üçû'
                        };
                        
                        if (specialEmojis[item]) {
                            emoji = specialEmojis[item];
                        }
                        
                        const foodItem = document.createElement('div');
                        foodItem.className = 'food-item';
                        foodItem.innerHTML = `${emoji}<br>${item}<br><small>Dispon√≠vel: ${quantity}</small>`;
                        foodItem.onclick = () => addToFair(slotIndex, category, item, emoji);
                        content.appendChild(foodItem);
                    }
                });
            });
            
            if (!hasItems) {
                content.innerHTML = '<p>Voc√™ n√£o tem produtos para expor!</p>';
            }
            
            modal.style.display = 'flex';
        }

        function addToFair(slotIndex, category, itemName, emoji) {
            if (gameState.inventory[category][itemName] > 0) {
                gameState.inventory[category][itemName]--;
                gameState.producerFair.slots[slotIndex] = {
                    name: itemName,
                    emoji: emoji,
                    category: category
                };
                
                updateInventoryDisplay();
                updateProducerFairDisplay();
                closeFoodMenu();
                alert(`üè™ ${itemName} foi exposto na feira!`);
            }
        }

        function removeFromFair(slotIndex) {
            const item = gameState.producerFair.slots[slotIndex];
            if (item) {
                // Return item to inventory
                if (!gameState.inventory[item.category][item.name]) {
                    gameState.inventory[item.category][item.name] = 0;
                }
                gameState.inventory[item.category][item.name]++;
                
                gameState.producerFair.slots[slotIndex] = null;
                
                updateInventoryDisplay();
                updateProducerFairDisplay();
                alert(`üì¶ ${item.name} foi removido da feira!`);
            }
        }

        function checkProducerFairEarnings() {
            if (!gameState.hasProducerFair) return;
            
            const now = Date.now();
            if (now - gameState.producerFair.lastEarning >= 900000) { // 15 minutes
                let earnings = 0;
                let itemCount = 0;
                
                gameState.producerFair.slots.forEach(slot => {
                    if (slot) {
                        earnings += 50;
                        itemCount++;
                    }
                });
                
                if (earnings > 0) {
                    gameState.coins += earnings;
                    gameState.producerFair.lastEarning = now;
                    updateUI();
                    
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #4CAF50;
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        z-index: 3000;
                        font-weight: bold;
                        font-size: 18px;
                        text-align: center;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    `;
                    alertDiv.textContent = `üè™ Feira do Produtor: +${earnings} moedas por ${itemCount} produtos!`;
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 4000);
                }
            }
        }

        function updateCraftTableDisplay() {
            const status = document.getElementById('craftStatus');
            const craftItems = document.querySelectorAll('.craft-item');
            
            if (gameState.craftTable.working) {
                const elapsed = Date.now() - gameState.craftTable.startTime;
                let duration;
                
                switch(gameState.craftTable.recipe) {
                    case 'pearl': duration = 10000; break; // 10 seconds
                    case 'emerald': duration = 20000; break; // 20 seconds
                    case 'bouquet': duration = 15000; break; // 15 seconds
                }
                
                const remaining = Math.max(0, duration - elapsed);
                const seconds = Math.ceil(remaining / 1000);
                
                status.textContent = `Trabalhando... ${seconds}s`;
                status.style.color = '#ff6b00';
                
                craftItems.forEach(item => {
                    item.classList.add('working');
                });
            } else {
                status.textContent = 'Pronta para usar';
                status.style.color = '#8B4513';
                
                craftItems.forEach(item => {
                    item.classList.remove('working');
                });
            }
        }

        function updateBonfireDisplay() {
            const flame = document.getElementById('bonfireFlame');
            const status = document.getElementById('bonfireStatus');
            const timer = document.getElementById('bonfireTimer');
            const button = document.getElementById('lightBonfireBtn');
            
            if (gameState.bonfire.lit) {
                const elapsed = Date.now() - gameState.bonfire.startTime;
                const remaining = Math.max(0, gameState.bonfire.duration - elapsed);
                
                if (remaining > 0) {
                    flame.innerHTML = 'üî•';
                    flame.style.animation = 'pulse 1s ease-in-out infinite alternate';
                    status.textContent = 'Fogueira acesa - Animais aquecidos';
                    status.style.color = '#ff6b00';
                    
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    timer.textContent = `Tempo restante: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    button.disabled = true;
                    button.textContent = 'üî• Fogueira Acesa';
                } else {
                    gameState.bonfire.lit = false;
                    updateBonfireDisplay();
                }
            } else {
                flame.innerHTML = 'üå´Ô∏è';
                flame.style.animation = 'none';
                status.textContent = 'Fogueira apagada - Animais com frio';
                status.style.color = '#666';
                timer.textContent = '';
                
                button.disabled = false;
                button.textContent = 'üî• Acender Fogueira';
            }
        }

        function createGreenhouseGrid() {
            const grid = document.getElementById('greenhouseGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.id = `greenhouse-plot-${i}`;
                plot.onclick = () => handleGreenhousePlotClick(i);
                grid.appendChild(plot);
            }
            updateGreenhouseDisplay();
        }

        function updateGreenhouseDisplay() {
            if (!gameState.hasGreenhouse) return;
            
            gameState.greenhousePlots.forEach((plot, index) => {
                updateGreenhousePlotDisplay(index);
            });
        }

        function updateGreenhousePlotDisplay(plotIndex) {
            const plotElement = document.getElementById(`greenhouse-plot-${plotIndex}`);
            if (!plotElement) return;
            
            const plot = gameState.greenhousePlots[plotIndex];
            
            plotElement.className = `plot ${plot.state}`;
            
            switch (plot.state) {
                case 'empty':
                    plotElement.innerHTML = '';
                    break;
                case 'fertilized':
                    plotElement.innerHTML = 'üçÇ';
                    break;
                case 'planted':
                    plotElement.innerHTML = 'üå±';
                    break;
                case 'watered':
                    plotElement.innerHTML = 'üíß';
                    break;
                case 'ready':
                    plotElement.innerHTML = seeds[plot.seedType].emoji;
                    break;
            }
        }

        function handleGreenhousePlotClick(plotIndex) {
            const plot = gameState.greenhousePlots[plotIndex];
            
            if (plot.state === 'empty') {
                // Fertilize
                if (gameState.fertilizer > 0) {
                    gameState.fertilizer--;
                    plot.state = 'fertilized';
                    updateGreenhousePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'fertilized') {
                // Plant
                if (gameState.selectedSeed !== null && gameState.coins >= seeds[gameState.selectedSeed].price) {
                    gameState.coins -= seeds[gameState.selectedSeed].price;
                    plot.state = 'planted';
                    plot.seedType = gameState.selectedSeed;
                    plot.plantTime = Date.now();
                    updateGreenhousePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'planted') {
                // Water
                if (gameState.water > 0) {
                    gameState.water--;
                    plot.state = 'watered';
                    updateGreenhousePlotDisplay(plotIndex);
                    updateUI();
                    useEnergy(1);
                }
            } else if (plot.state === 'ready') {
                // Harvest
                const seed = seeds[plot.seedType];
                let harvestAmount = 1; // No season bonus in greenhouse
                
                // Store all items in barn
                const barnKey = seed.name.toLowerCase().replace(' ', '');
                if (!gameState.barn[barnKey]) {
                    gameState.barn[barnKey] = 0;
                }
                gameState.barn[barnKey] += harvestAmount;
                
                // Reset plot
                plot.state = 'empty';
                plot.seedType = null;
                plot.plantTime = null;
                updateGreenhousePlotDisplay(plotIndex);
                updateBarnDisplay();
                useEnergy(1);
            }
        }

        function craftPearlNecklace() {
            if (gameState.craftTable.working) {
                alert('A mesa est√° ocupada!');
                return;
            }
            
            if (gameState.inventory.others['P√©rola'] >= 6) {
                gameState.inventory.others['P√©rola'] -= 6;
                gameState.craftTable.working = true;
                gameState.craftTable.startTime = Date.now();
                gameState.craftTable.recipe = 'pearl';
                
                updateInventoryDisplay();
                updateCraftTableDisplay();
                
                setTimeout(() => {
                    gameState.craftTable.working = false;
                    gameState.barn.colardep√©rolas = (gameState.barn.colardep√©rolas || 0) + 1;
                    updateBarnDisplay();
                    updateCraftTableDisplay();
                    alert('üìø Colar de P√©rolas criado!');
                }, 10000); // 10 seconds
            } else {
                alert('Voc√™ precisa de 6 P√©rolas!');
            }
        }

        function craftEmeraldRing() {
            if (gameState.craftTable.working) {
                alert('A mesa est√° ocupada!');
                return;
            }
            
            if (gameState.inventory.others['Esmeralda'] >= 1) {
                gameState.inventory.others['Esmeralda']--;
                gameState.craftTable.working = true;
                gameState.craftTable.startTime = Date.now();
                gameState.craftTable.recipe = 'emerald';
                
                updateInventoryDisplay();
                updateCraftTableDisplay();
                
                setTimeout(() => {
                    gameState.craftTable.working = false;
                    gameState.barn.aneldeesmeralda = (gameState.barn.aneldeesmeralda || 0) + 1;
                    updateBarnDisplay();
                    updateCraftTableDisplay();
                    alert('üíç Anel de Esmeralda criado!');
                }, 20000); // 20 seconds
            } else {
                alert('Voc√™ precisa de 1 Esmeralda!');
            }
        }

        function craftFlowerBouquet() {
            if (gameState.craftTable.working) {
                alert('A mesa est√° ocupada!');
                return;
            }
            
            if (gameState.inventory.others['Rosa'] >= 1 && 
                gameState.inventory.others['Girassol'] >= 1 && 
                gameState.inventory.others['Margarida'] >= 1) {
                
                gameState.inventory.others['Rosa']--;
                gameState.inventory.others['Girassol']--;
                gameState.inventory.others['Margarida']--;
                gameState.craftTable.working = true;
                gameState.craftTable.startTime = Date.now();
                gameState.craftTable.recipe = 'bouquet';
                
                updateInventoryDisplay();
                updateCraftTableDisplay();
                
                setTimeout(() => {
                    gameState.craftTable.working = false;
                    gameState.barn.buqu√™deflores = (gameState.barn.buqu√™deflores || 0) + 1;
                    updateBarnDisplay();
                    updateCraftTableDisplay();
                    alert('üíê Buqu√™ de Flores criado!');
                }, 15000); // 15 seconds
            } else {
                alert('Voc√™ precisa de: 1 Rosa, 1 Girassol e 1 Margarida!');
            }
        }

        function harvestFlower(type) {
            if (gameState.flowers[type] > 0) {
                gameState.flowers[type]--;
                
                // Add flower to barn
                const flowerKey = type.toLowerCase();
                if (!gameState.barn[flowerKey]) {
                    gameState.barn[flowerKey] = 0;
                }
                gameState.barn[flowerKey]++;
                
                // Track total flowers harvested for herb drops
                if (!gameState.flowersHarvested) gameState.flowersHarvested = 0;
                gameState.flowersHarvested++;
                
                // Check if should drop herb (every 4 flowers)
                if (gameState.flowersHarvested % 4 === 0) {
                    gameState.barn.ervas = (gameState.barn.ervas || 0) + 1;
                    alert('üåø Uma erva apareceu no celeiro!');
                }
                
                updateFlowersDisplay();
                updateBarnDisplay();
                useEnergy(1);
                
                // Regrow after 5 minutes
                setTimeout(() => {
                    gameState.flowers[type] = Math.min(3, gameState.flowers[type] + 1);
                    updateFlowersDisplay();
                }, 300000);
            }
        }

        function updatePetUI() {
            // Update dog UI
            if (gameState.hasDogHouse) {
                document.getElementById('dogFriendship').textContent = gameState.dogFriendship;
                document.getElementById('dogFriendshipBar').style.width = gameState.dogFriendship + '%';
                
                const dogLastFedTime = gameState.dogLastFed > 0 ? 
                    new Date(gameState.dogLastFed).toLocaleTimeString() : 'Nunca';
                document.getElementById('dogLastFed').textContent = dogLastFedTime;
                
                const now = Date.now();
                const canFeed = (now - gameState.dogLastFed) >= 300000;
                const canGiveBone = (now - gameState.dogLastFed) >= 1200000;
                
                document.getElementById('feedDogBtn').disabled = !canFeed || gameState.barn.dogFood === 0;
                document.getElementById('giveBoneBtn').disabled = !canGiveBone || gameState.barn.bones === 0;
            }
            
            // Update horse UI
            if (gameState.hasHorseStable) {
                document.getElementById('horseFriendship').textContent = gameState.horseFriendship;
                document.getElementById('horseFriendshipBar').style.width = gameState.horseFriendship + '%';
                
                const horseLastFedTime = gameState.horseLastFed > 0 ? 
                    new Date(gameState.horseLastFed).toLocaleTimeString() : 'Nunca';
                document.getElementById('horseLastFed').textContent = horseLastFedTime;
                
                const now = Date.now();
                const canFeedHorse = (now - gameState.horseLastFed) >= 300000;
                
                document.getElementById('feedHorseBtn').disabled = !canFeedHorse || gameState.barn.hay < 2;
                document.getElementById('giveAppleBtn').disabled = !gameState.inventory.fruitsVegetables['Ma√ß√£'] || gameState.inventory.fruitsVegetables['Ma√ß√£'] === 0;
            }
        }

        function updateMachineStorageDisplay() {
            // Update Composter storage
            if (document.getElementById('flowerStorage')) {
                document.getElementById('flowerStorage').textContent = gameState.machineStorage.composter.flowers;
            }
            if (document.getElementById('branchStorage')) {
                document.getElementById('branchStorage').textContent = gameState.machineStorage.composter.branches;
            }
            if (document.getElementById('manureStorage')) {
                document.getElementById('manureStorage').textContent = gameState.machineStorage.composter.manure;
            }
            
            // Update Coffee Roaster storage
            if (document.getElementById('coffeeStorage')) {
                document.getElementById('coffeeStorage').textContent = gameState.machineStorage.coffeeRoaster.coffee;
            }
            
            // Update Juice Machine storage
            if (document.getElementById('grapeStorage')) {
                document.getElementById('grapeStorage').textContent = gameState.machineStorage.juiceMachine.grapes;
            }
            
            // Update Mill storage
            if (document.getElementById('wheatStorage')) {
                document.getElementById('wheatStorage').textContent = gameState.machineStorage.mill.wheat;
            }
            
            // Update Spinning Machine storage
            if (document.getElementById('woolStorage')) {
                document.getElementById('woolStorage').textContent = gameState.machineStorage.spinningMachine.wool;
            }
            
            // Update Cheese Maker storage
            if (document.getElementById('milkStorage')) {
                document.getElementById('milkStorage').textContent = gameState.machineStorage.cheeseMaker.milk;
            }
            
            // Update Grass Dryer storage
            if (document.getElementById('grassStorage')) {
                document.getElementById('grassStorage').textContent = gameState.machineStorage.grassDryer.grass;
            }
            if (document.getElementById('driedGrassStorage')) {
                document.getElementById('driedGrassStorage').textContent = gameState.machineStorage.grassDryer.driedGrass;
            }
            
            // Update Wood Cutter storage
            if (document.getElementById('trunkStorage')) {
                document.getElementById('trunkStorage').textContent = gameState.machineStorage.woodCutter.trunks;
            }
        }

        function updateUI() {
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('water').textContent = gameState.water;
            document.getElementById('fertilizer').textContent = gameState.fertilizer;
            
            // Update all plots
            gameState.plots.forEach((plot, index) => {
                updatePlotDisplay(index);
            });
            
            // Update machine storage displays
            updateMachineStorageDisplay();
        }

        function saveGame() {
            localStorage.setItem('realFarmSave', JSON.stringify(gameState));
            console.log('Jogo salvo automaticamente!');
        }

        function handleAnimalClick(type, index) {
            const animals = gameState[type + 's'];
            const animal = animals[index];
            
            if (!animal) return;
            
            if (animal.sick && gameState.barn.vaccines > 0) {
                gameState.barn.vaccines--;
                animal.sick = false;
                animal.sickTime = 0;
                updateBarnDisplay();
                alert(`üíâ ${animal.emoji} foi curado!`);
            } else if (type === 'chicken' && !animal.sick) {
                // Option to sacrifice chicken for raw chicken
                if (confirm('Deseja sacrificar esta galinha para obter frango cru?')) {
                    gameState.barn.rawChicken++;
                    gameState.chickens.splice(index, 1);
                    updateChickensDisplay();
                    updateBarnDisplay();
                    alert('üêì Voc√™ obteve 1 frango cru!');
                }
            }
        }

        function addFoodToAnimalSlot(animalType, index) {
            const animals = gameState[animalType + 's'];
            const animal = animals[index];
            
            if (!animal || animal.resting || animal.eating || animal.sick) {
                return;
            }
            
            let foodType, foodAvailable;
            
            if (animalType === 'chicken') {
                foodType = 'chickenFeed';
                foodAvailable = gameState.barn.chickenFeed || 0;
            } else if (animalType === 'pig') {
                foodType = 'pigFeed';
                foodAvailable = gameState.barn.pigFeed || 0;
            } else if (animalType === 'sheep' || animalType === 'cow') {
                foodType = 'hay';
                foodAvailable = gameState.barn.hay || 0;
            }
            
            if (foodAvailable === 0) {
                const foodNames = {
                    chickenFeed: 'ra√ß√£o para galinhas',
                    pigFeed: 'ra√ß√£o para porcos',
                    hay: 'feno'
                };
                alert(`Voc√™ n√£o tem ${foodNames[foodType]}!`);
                return;
            }
            
            // Add food to slot
            gameState.barn[foodType]--;
            animal.feedingSlot = { food: true, startTime: Date.now() };
            animal.eating = true;
            
            updateBarnDisplay();
            updateUI();
            
            // Update display
            if (animalType === 'chicken') updateChickensDisplay();
            else if (animalType === 'pig') updatePigsDisplay();
            else if (animalType === 'sheep') updateSheepDisplay();
            else if (animalType === 'cow') updateCowsDisplay();
            
            // Food disappears after 10 seconds and animal produces
            setTimeout(() => {
                animal.feedingSlot = null;
                animal.eating = false;
                
                // Check if bonfire is lit in winter for production
                const canProduce = gameState.season !== 3 || gameState.bonfire.lit;
                
                if (canProduce) {
                    // Produce items - all go to barn now
                    if (animalType === 'chicken') {
                        gameState.barn.ovos = (gameState.barn.ovos || 0) + 3;
                        // 20% chance to produce raw chicken
                        if (Math.random() < 0.2) {
                            gameState.barn.rawChicken = (gameState.barn.rawChicken || 0) + 1;
                        }
                    } else if (animalType === 'pig') {
                        gameState.barn.carnesu√≠na = (gameState.barn.carnesu√≠na || 0) + 1;
                    } else if (animalType === 'sheep') {
                        gameState.barn.l√£ = (gameState.barn.l√£ || 0) + 2;
                    } else if (animalType === 'cow') {
                        gameState.barn.leite = (gameState.barn.leite || 0) + 3;
                        gameState.barn.esterco = (gameState.barn.esterco || 0) + 1;
                    }
                    
                    updateBarnDisplay();
                    
                    // Show production notification
                    const products = {
                        chicken: '3 Ovos',
                        pig: '1 Carne Su√≠na',
                        sheep: '2 L√£s',
                        cow: '3 Leites + 1 Esterco'
                    };
                    
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #4CAF50;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 10px;
                        z-index: 3000;
                        font-weight: bold;
                    `;
                    alertDiv.textContent = `${animal.emoji} produziu: ${products[animalType]}!`;
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 3000);
                } else {
                    // Show cold message
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #4169e1;
                        color: white;
                        padding: 15px 20px;
                        border-radius: 10px;
                        z-index: 3000;
                        font-weight: bold;
                        max-width: 300px;
                    `;
                    alertDiv.textContent = '‚ùÑÔ∏è Os animais est√£o com muito frio para produzir! Acenda a fogueira!';
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 4000);
                }
                
                // Start resting for 5 minutes
                animal.resting = true;
                animal.restStartTime = Date.now();
                
                // Update display
                if (animalType === 'chicken') updateChickensDisplay();
                else if (animalType === 'pig') updatePigsDisplay();
                else if (animalType === 'sheep') updateSheepDisplay();
                else if (animalType === 'cow') updateCowsDisplay();
                
                // Stop resting after 5 minutes
                setTimeout(() => {
                    animal.resting = false;
                    animal.restStartTime = null;
                    
                    // Update display
                    if (animalType === 'chicken') updateChickensDisplay();
                    else if (animalType === 'pig') updatePigsDisplay();
                    else if (animalType === 'sheep') updateSheepDisplay();
                    else if (animalType === 'cow') updateCowsDisplay();
                }, 300000); // 5 minutes
                
            }, 10000); // 10 seconds
        }

        function feedAllChickens() {
            if (gameState.barn.chickenFeed === 0) {
                alert('Voc√™ precisa de ra√ß√£o para galinhas!');
                return;
            }
            
            let fedCount = 0;
            gameState.chickens.forEach((chicken, index) => {
                if (!chicken.sick && !chicken.resting && !chicken.eating && !chicken.feedingSlot && gameState.barn.chickenFeed > 0) {
                    addFoodToAnimalSlot('chicken', index);
                    fedCount++;
                }
            });
            
            if (fedCount === 0) {
                alert('Nenhuma galinha pode ser alimentada no momento!');
            }
        }

        function feedAllPigs() {
            if (gameState.barn.pigFeed === 0) {
                alert('Voc√™ precisa de ra√ß√£o para porcos!');
                return;
            }
            
            let fedCount = 0;
            gameState.pigs.forEach((pig, index) => {
                if (!pig.sick && !pig.resting && !pig.eating && !pig.feedingSlot && gameState.barn.pigFeed > 0) {
                    addFoodToAnimalSlot('pig', index);
                    fedCount++;
                }
            });
            
            if (fedCount === 0) {
                alert('Nenhum porco pode ser alimentado no momento!');
            }
        }

        function feedAllSheep() {
            if (gameState.barn.hay === 0) {
                alert('Voc√™ precisa de feno!');
                return;
            }
            
            let fedCount = 0;
            gameState.sheep.forEach((sheep, index) => {
                if (!sheep.sick && !sheep.resting && !sheep.eating && !sheep.feedingSlot && gameState.barn.hay > 0) {
                    addFoodToAnimalSlot('sheep', index);
                    fedCount++;
                }
            });
            
            if (fedCount === 0) {
                alert('Nenhuma ovelha pode ser alimentada no momento!');
            }
        }

        function feedAllCows() {
            if (gameState.barn.hay === 0) {
                alert('Voc√™ precisa de feno!');
                return;
            }
            
            let fedCount = 0;
            gameState.cows.forEach((cow, index) => {
                if (!cow.sick && !cow.resting && !cow.eating && !cow.feedingSlot && gameState.barn.hay > 0) {
                    addFoodToAnimalSlot('cow', index);
                    fedCount++;
                }
            });
            
            if (fedCount === 0) {
                alert('Nenhuma vaca pode ser alimentada no momento!');
            }
        }

        function shearAllSheep() {
            if (!gameState.hasShears) {
                alert('Voc√™ precisa de uma tesoura de tosquiar!');
                return;
            }
            
            gameState.sheep.forEach(sheep => {
                if (sheep.wool > 0) {
                    if (!gameState.inventory.others['L√£']) {
                        gameState.inventory.others['L√£'] = 0;
                    }
                    gameState.inventory.others['L√£'] += sheep.wool;
                    sheep.wool = 0;
                }
            });
            
            updateInventoryDisplay();
        }



        function addToInventory(category, item, quantity) {
            if (!gameState.inventory[category][item]) {
                gameState.inventory[category][item] = 0;
            }
            gameState.inventory[category][item] += quantity;
        }

        // Animal sickness system
        function checkAnimalHealth() {
            const allAnimals = [
                ...gameState.chickens,
                ...gameState.pigs,
                ...gameState.sheep,
                ...gameState.cows
            ];
            
            allAnimals.forEach(animal => {
                if (animal.sick) {
                    // Check if animal dies after 20 minutes
                    if (Date.now() - animal.sickTime > 1200000) {
                        removeAnimal(animal);
                        alert(`üíÄ ${animal.emoji} morreu por falta de tratamento!`);
                    }
                } else {
                    // Random chance to get sick
                    if (Math.random() < 0.001) { // 0.1% chance per check
                        animal.sick = true;
                        animal.sickTime = Date.now();
                    }
                }
            });
        }

        function removeAnimal(deadAnimal) {
            ['chickens', 'pigs', 'sheep', 'cows'].forEach(type => {
                gameState[type] = gameState[type].filter(animal => animal.id !== deadAnimal.id);
            });
            
            updateChickensDisplay();
            updatePigsDisplay();
            updateSheepDisplay();
            updateCowsDisplay();
        }

        // Chicken breeding system
        function checkChickenBreeding() {
            // Count adult chickens only
            const adultChickens = gameState.chickens.filter(chicken => chicken.state !== 'baby');
            
            if (adultChickens.length >= 2 && adultChickens.length <= 3) {
                if (Math.random() < 0.2 && gameState.chickens.length < 4) { // 20% chance
                    // Add baby chicken that grows in 20 minutes
                    const baby = {
                        id: Date.now(),
                        type: 'chicken',
                        emoji: 'üê£',
                        state: 'baby',
                        lastFed: 0,
                        eggs: 0,
                        sick: false,
                        sickTime: 0,
                        eating: false,
                        resting: false,
                        feedingSlot: null,
                        restStartTime: null
                    };
                    
                    gameState.chickens.push(baby);
                    
                    // Show breeding notification
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #4CAF50;
                        color: white;
                        padding: 15px 20px;
                        border-radius: 10px;
                        z-index: 3000;
                        font-weight: bold;
                    `;
                    alertDiv.textContent = 'üê£ Um pintinho nasceu no galinheiro!';
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 4000);
                    
                    setTimeout(() => {
                        baby.emoji = 'üêî';
                        baby.state = 'adult';
                        updateChickensDisplay();
                        
                        // Show growth notification
                        const growthDiv = document.createElement('div');
                        growthDiv.style.cssText = `
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            background: #4CAF50;
                            color: white;
                            padding: 15px 20px;
                            border-radius: 10px;
                            z-index: 3000;
                            font-weight: bold;
                        `;
                        growthDiv.textContent = 'üêî O pintinho cresceu e virou uma galinha adulta!';
                        document.body.appendChild(growthDiv);
                        
                        setTimeout(() => {
                            document.body.removeChild(growthDiv);
                        }, 4000);
                    }, 1200000); // 20 minutes
                    
                    updateChickensDisplay();
                }
            }
        }

        function sacrificeChicken() {
            // Find adult chickens only
            const adultChickens = gameState.chickens.filter(chicken => chicken.state !== 'baby');
            
            if (adultChickens.length === 0) {
                alert('üêî N√£o h√° galinhas adultas para sacrificar!');
                return;
            }
            
            if (confirm('üî™ Tem certeza que deseja sacrificar uma galinha? Ela se tornar√° frango cru.')) {
                // Find the first adult chicken and remove it
                const chickenIndex = gameState.chickens.findIndex(chicken => chicken.state !== 'baby');
                
                if (chickenIndex !== -1) {
                    gameState.chickens.splice(chickenIndex, 1);
                    gameState.barn.rawChicken = (gameState.barn.rawChicken || 0) + 1;
                    
                    updateChickensDisplay();
                    updateBarnDisplay();
                    
                    // Show sacrifice notification
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #dc3545;
                        color: white;
                        padding: 15px 20px;
                        border-radius: 10px;
                        z-index: 3000;
                        font-weight: bold;
                    `;
                    alertDiv.textContent = 'üêì Galinha sacrificada! +1 Frango Cru obtido.';
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 4000);
                }
            }
        }

        function harvestGrass(index) {
            if (gameState.grass[index]) {
                gameState.grass[index] = false;
                gameState.grassHarvested++;
                
                // Store grass directly in the green slot of Grass Dryer
                if (!gameState.grassDryerSlot) {
                    gameState.grassDryerSlot = { grass: 0 };
                }
                gameState.grassDryerSlot.grass++;
                
                // Drop flower every 8 grasses for composter
                if (gameState.grassHarvested % 8 === 0) {
                    gameState.machineStorage.composter.flowers++;
                    alert('üå∏ Uma flor apareceu na composteira!');
                }
                
                updateGrassDisplay();
                updateGrassDryerDisplay();
                updateMachineStorageDisplay();
                useEnergy(1);
            }
        }

        function harvestTrunk() {
            if (gameState.hasAxe && gameState.axeUses > 0) {
                gameState.axeUses--;
                gameState.trees.trunk.clicks++;
                gameState.barn.trunks = (gameState.barn.trunks || 0) + 1;
                
                // Drop branches every 3 clicks for composter
                if (gameState.trees.trunk.clicks % 3 === 0) {
                    gameState.machineStorage.composter.branches += 2;
                    alert('üåø 2 galhos apareceram na composteira!');
                }
                
                updateAxeStatus();
                updateTreesDisplay();
                updateBarnDisplay();
                useEnergy(1);
            } else if (!gameState.hasAxe) {
                alert('Voc√™ precisa de um machado para cortar troncos!');
            }
        }

        function harvestFruit(type) {
            if (gameState.trees[type].fruits > 0) {
                gameState.trees[type].fruits--;
                
                const fruitKeys = {
                    apple: 'ma√ß√£',
                    orange: 'laranja', 
                    banana: 'banana'
                };
                
                const fruitKey = fruitKeys[type];
                if (!gameState.barn[fruitKey]) {
                    gameState.barn[fruitKey] = 0;
                }
                gameState.barn[fruitKey]++;
                
                updateTreesDisplay();
                updateBarnDisplay();
                useEnergy(1);
            }
        }



        function catchFish(index) {
            if (gameState.hasFishingRod && gameState.fishingRodUses > 0 && gameState.fish[index]) {
                gameState.fishingRodUses--;
                gameState.fish[index] = false;
                gameState.fishCaught++;
                
                gameState.barn.peixe = (gameState.barn.peixe || 0) + 1;
                
                // Drop pearl every 5 fish
                if (gameState.fishCaught % 5 === 0) {
                    gameState.barn.p√©rola = (gameState.barn.p√©rola || 0) + 1;
                    alert('üíé Uma p√©rola apareceu!');
                }
                
                updateFishingRodStatus();
                updateFishDisplay();
                updateBarnDisplay();
                useEnergy(1);
            } else if (!gameState.hasFishingRod) {
                alert('Voc√™ precisa de uma vara de pesca!');
            }
        }

        function mineRock(index) {
            if (!gameState.mineAccess || gameState.barn.keys === 0) {
                alert('Voc√™ precisa de uma chave para entrar na mina!');
                return;
            }
            
            if (!gameState.hasPickaxe || gameState.pickaxeUses === 0) {
                alert('Voc√™ precisa de uma picareta para minerar!');
                return;
            }
            
            const rock = gameState.rocks[index];
            if (rock.resting) {
                alert('Esta rocha est√° descansando!');
                return;
            }
            
            gameState.pickaxeUses--;
            rock.hits++;
            
            // Random gem drop
            const gems = ['esmeralda', 'rubi', 'safira', 'coal'];
            const randomGem = gems[Math.floor(Math.random() * gems.length)];
            
            if (!gameState.barn[randomGem]) {
                gameState.barn[randomGem] = 0;
            }
            gameState.barn[randomGem]++;
            updateBarnDisplay();
            
            // Check if rock needs rest
            if (rock.hits >= 3) {
                rock.resting = true;
                rock.restTime = Date.now();
                rock.hits = 0;
            }
            
            // Use key after 9 total hits across all rocks
            const totalHits = gameState.rocks.reduce((sum, r) => sum + r.hits, 0);
            if (totalHits === 0 && gameState.rocks.every(r => r.resting)) {
                gameState.barn.keys--;
                updateBarnDisplay();
            }
            
            updatePickaxeStatus();
            updateRocksDisplay();
        }

        function checkGrassRegrowth() {
            for (let i = 0; i < gameState.grass.length; i++) {
                if (!gameState.grass[i]) {
                    gameState.grass[i] = true;
                }
            }
            if (gameState.hasGrassField) updateGrassDisplay();
        }

        function checkTreeRegrowth() {
            ['apple', 'orange', 'banana'].forEach(type => {
                if (gameState.trees[type].fruits < 4) {
                    gameState.trees[type].fruits = 4;
                }
            });
            if (gameState.hasForest) updateTreesDisplay();
        }

        function checkFishRespawn() {
            for (let i = 0; i < gameState.fish.length; i++) {
                if (!gameState.fish[i]) {
                    gameState.fish[i] = true;
                }
            }
            updateFishDisplay();
        }

        function checkRockRest() {
            gameState.rocks.forEach(rock => {
                if (rock.resting && Date.now() - rock.restTime >= 180000) { // 3 minutes
                    rock.resting = false;
                    rock.restTime = 0;
                }
            });
            updateRocksDisplay();
        }

        function checkHorseSickness() {
            if (!gameState.hasHorseStable || !gameState.horseSystem) return;
            
            const now = Date.now();
            
            // Check if horse should get sick (30% chance if 30 minutes without apple)
            if (gameState.horseSystem.state !== 'sick' && now >= gameState.horseSystem.sickCheckTime) {
                if (Math.random() < 0.3) { // 30% chance
                    gameState.horseSystem.state = 'sick';
                    gameState.horseSystem.sickStartTime = now;
                    
                    // Show sickness notification
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #ff4444;
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        z-index: 3000;
                        font-weight: bold;
                        font-size: 18px;
                        text-align: center;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    `;
                    alertDiv.textContent = 'ü§í Duque ficou doente! Ele n√£o trabalhar√° por 30 minutos. D√™ ma√ß√£s regularmente para prevenir!';
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => {
                        document.body.removeChild(alertDiv);
                    }, 5000);
                    
                    // Recover after 30 minutes
                    setTimeout(() => {
                        if (gameState.horseSystem.state === 'sick') {
                            gameState.horseSystem.state = 'waiting';
                            gameState.horseSystem.sickCheckTime = now + 1800000; // Reset sick check
                            updateHorseSystemDisplay();
                            
                            // Show recovery notification
                            const recoveryDiv = document.createElement('div');
                            recoveryDiv.style.cssText = `
                                position: fixed;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                background: #4CAF50;
                                color: white;
                                padding: 20px 30px;
                                border-radius: 15px;
                                z-index: 3000;
                                font-weight: bold;
                                font-size: 18px;
                                text-align: center;
                                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                            `;
                            recoveryDiv.textContent = 'üêé Duque se recuperou e est√° pronto para trabalhar novamente!';
                            document.body.appendChild(recoveryDiv);
                            
                            setTimeout(() => {
                                document.body.removeChild(recoveryDiv);
                            }, 4000);
                        }
                    }, 1800000); // 30 minutes
                } else {
                    // Reset sick check for another 30 minutes
                    gameState.horseSystem.sickCheckTime = now + 1800000;
                }
            }
        }

        function loadGame() {
            const saved = localStorage.getItem('realFarmSave');
            if (saved) {
                gameState = {...gameState, ...JSON.parse(saved)};
                
                // Update UI elements based on loaded state
                if (gameState.hasWell) {
                    document.getElementById('wellContainer').style.display = 'block';
                    document.getElementById('wellShop').style.display = 'none';
                }
                
                if (gameState.hasDogHouse) {
                    document.getElementById('dogHouse').style.display = 'block';
                    document.getElementById('dogHouseShop').style.display = 'none';
                    
                    // Initialize dog system if not present
                    if (!gameState.dogSystem) {
                        gameState.dogSystem = {
                            state: 'waiting',
                            foodInSlot: false,
                            huntingStartTime: 0,
                            restingStartTime: 0,
                            treasureChest: []
                        };
                    }
                    
                    updateDogSystemDisplay();
                }
                
                if (gameState.hasHorseStable) {
                    document.getElementById('horseStable').style.display = 'block';
                    document.getElementById('horseStableShop').style.display = 'none';
                    
                    // Initialize horse system if not present
                    if (!gameState.horseSystem) {
                        gameState.horseSystem = {
                            state: 'waiting',
                            hayInSlot: false,
                            appleInSlot: false,
                            workingStartTime: 0,
                            sickStartTime: 0,
                            lastAppleTime: Date.now(),
                            sickCheckTime: Date.now() + 1800000
                        };
                    }
                    
                    updateHorseSystemDisplay();
                }
                
                if (gameState.hasChickenCoop) {
                    document.getElementById('chickenCoop').style.display = 'block';
                    document.getElementById('chickenShop').style.display = 'block';
                    document.getElementById('chickenCoopShop').style.display = 'none';
                }
                
                if (gameState.hasPigPen) {
                    document.getElementById('pigPen').style.display = 'block';
                    document.getElementById('pigShop').style.display = 'block';
                    document.getElementById('pigPenShop').style.display = 'none';
                }
                
                if (gameState.hasSheepPen) {
                    document.getElementById('sheepPen').style.display = 'block';
                    document.getElementById('sheepShop').style.display = 'block';
                    if (!gameState.hasShears) {
                        document.getElementById('shearsShop').style.display = 'block';
                    } else {
                        document.getElementById('shearsShop').style.display = 'none';
                    }
                    document.getElementById('sheepPenShop').style.display = 'none';
                }
                
                if (gameState.hasCowPasture) {
                    document.getElementById('cowPasture').style.display = 'block';
                    document.getElementById('cowShop').style.display = 'block';
                    document.getElementById('cowPastureShop').style.display = 'none';
                }
                
                if (gameState.hasGrassField) {
                    document.getElementById('grassField').style.display = 'block';
                    document.getElementById('grassFieldShop').style.display = 'none';
                }
                
                if (gameState.hasForest) {
                    document.getElementById('forest').style.display = 'block';
                    document.getElementById('forestShop').style.display = 'none';
                }
                
                if (gameState.hasBeehive) {
                    document.getElementById('beehive').style.display = 'block';
                    document.getElementById('beehiveShop').style.display = 'none';
                    document.getElementById('tulipSeedShop').style.display = 'block';
                    document.getElementById('lilySeedShop').style.display = 'block';
                    document.getElementById('sakuraSeedShop').style.display = 'block';
                    
                    // Initialize beehive flower system if not present
                    if (!gameState.beehive.flowerSlots) {
                        gameState.beehive.flowerSlots = [null, null, null];
                        gameState.beehive.flowerGrowthTimes = [0, 0, 0];
                        gameState.beehive.flowerExpireTimes = [0, 0, 0];
                        gameState.beehive.honeyTimer = 600; // Update to 10 minutes
                    }
                }
                
                if (gameState.hasTelephone) {
                    document.getElementById('telephone').style.display = 'block';
                    document.getElementById('telephoneShop').style.display = 'none';
                }
                
                if (gameState.hasTruck) {
                    document.getElementById('truckArea').style.display = 'block';
                    document.getElementById('truckShop').style.display = 'none';
                    document.getElementById('ethanolShop').style.display = 'block';
                    document.getElementById('truckOrdersPanel').style.display = 'block';
                    updateTruckDisplay();
                    updateTruckOrdersDisplay();
                }
                

                
                if (gameState.hasAxe) {
                    document.getElementById('axeStatus').style.display = 'block';
                    document.getElementById('axeAndWoodCutterShop').style.display = 'none';
                }
                
                if (gameState.machines && gameState.machines.hasWoodCutting) {
                    document.getElementById('woodCutting').style.display = 'block';
                    updateWoodCuttingDisplay();
                }
                
                if (gameState.hasFishingRod) {
                    document.getElementById('fishingRodStatus').style.display = 'block';
                }
                
                if (gameState.hasPickaxe) {
                    document.getElementById('pickaxeStatus').style.display = 'block';
                }
                
                if (gameState.hasBeehive) {
                    document.getElementById('beehive').style.display = 'block';
                }
                
                // Flower Field is always available now
                gameState.hasFlowerField = true;
                document.getElementById('flowerField').style.display = 'block';
                
                if (gameState.hasProducerFair) {
                    document.getElementById('producerFair').style.display = 'block';
                }
                
                if (gameState.horseFriendship >= 100) {
                    document.getElementById('ordersPanel').style.display = 'block';
                    generateOrders();
                }
                
                updateUI();
                updateInventoryDisplay();
                updateBarnDisplay();
                updatePetUI();
                updateOrdersDisplay();
                
                // Initialize quitanda if not present
                if (!gameState.quitanda) {
                    gameState.quitanda = {
                        slots: Array(20).fill(null)
                    };
                }
                updateQuitandaDisplay();
                updateChickensDisplay();
                updatePigsDisplay();
                updateSheepDisplay();
                updateCowsDisplay();
                updateFlowersDisplay();
                updateGrassDisplay();
                updateTreesDisplay();
                updateFishDisplay();
                updateRocksDisplay();
                
                if (gameState.hasProducerFair) {
                    updateProducerFairDisplay();
                }
                
                if (gameState.hasCraftTable) {
                    document.getElementById('craftTable').style.display = 'block';
                    updateCraftTableDisplay();
                }
                
                if (gameState.hasBonfire) {
                    document.getElementById('bonfire').style.display = 'block';
                    updateBonfireDisplay();
                }
                
                if (gameState.hasGreenhouse) {
                    document.getElementById('greenhouse').style.display = 'block';
                    document.getElementById('greenhouseShop').style.display = 'none';
                    createGreenhouseGrid();
                }
                updateAxeStatus();
                updateFishingRodStatus();
                updatePickaxeStatus();
                
                if (gameState.hasBeehive) {
                    updateBeehiveDisplay();
                }
                
                // Load machines
                if (gameState.machines) {
                    if (gameState.machines.hasComposter) {
                        document.getElementById('composter').style.display = 'block';
                        document.getElementById('composterShop').style.display = 'none';
                        
                        // Initialize composter slots if not present
                        if (!gameState.machineStorage.composter.flowerSlot) {
                            gameState.machineStorage.composter.flowerSlot = 0;
                        }
                        if (!gameState.machineStorage.composter.branchSlot) {
                            gameState.machineStorage.composter.branchSlot = 0;
                        }
                        if (!gameState.machineStorage.composter.manureSlot) {
                            gameState.machineStorage.composter.manureSlot = 0;
                        }
                        
                        setTimeout(() => updateComposterDisplay(), 100);
                    }
                    if (gameState.machines.hasMixer) {
                        document.getElementById('mixer').style.display = 'block';
                        document.getElementById('mixerShop').style.display = 'none';
                    }
                    if (gameState.machines.hasCoffeeRoaster) {
                        document.getElementById('coffeeRoaster').style.display = 'block';
                        document.getElementById('coffeeRoasterShop').style.display = 'none';
                        
                        // Initialize coffee roaster slots if not present
                        if (!gameState.machineStorage.coffeeRoaster.coffeeSlot) {
                            gameState.machineStorage.coffeeRoaster.coffeeSlot = 0;
                        }
                        if (!gameState.machineStorage.coffeeRoaster.woodSlot) {
                            gameState.machineStorage.coffeeRoaster.woodSlot = 0;
                        }
                        
                        setTimeout(() => updateCoffeeRoasterDisplay(), 100);
                    }
                    if (gameState.machines.hasJuiceMachine) {
                        document.getElementById('juiceMachine').style.display = 'block';
                        document.getElementById('juiceMachineShop').style.display = 'none';
                        
                        // Initialize juice machine slot if not present
                        if (!gameState.machineStorage.juiceMachine.grapeSlot) {
                            gameState.machineStorage.juiceMachine.grapeSlot = 0;
                        }
                        
                        setTimeout(() => updateJuiceMachineDisplay(), 100);
                    }
                    if (gameState.machines.hasMill) {
                        document.getElementById('mill').style.display = 'block';
                        document.getElementById('millShop').style.display = 'none';
                        
                        // Initialize mill slot if not present
                        if (!gameState.machineStorage.mill.wheatSlot) {
                            gameState.machineStorage.mill.wheatSlot = 0;
                        }
                        
                        setTimeout(() => updateMillDisplay(), 100);
                    }
                    if (gameState.machines.hasCheeseMaker) {
                        document.getElementById('cheeseMaker').style.display = 'block';
                        document.getElementById('cheeseMakerShop').style.display = 'none';
                        
                        // Initialize cheese maker slot if not present
                        if (!gameState.machineStorage.cheeseMaker.milkSlot) {
                            gameState.machineStorage.cheeseMaker.milkSlot = 0;
                        }
                        
                        setTimeout(() => updateCheeseMakerDisplay(), 100);
                    }
                    if (gameState.machines.hasSpinningMachine) {
                        document.getElementById('spinningMachine').style.display = 'block';
                        document.getElementById('spinningMachineShop').style.display = 'none';
                        
                        // Initialize spinning machine slot if not present
                        if (!gameState.machineStorage.spinningMachine.woolSlot) {
                            gameState.machineStorage.spinningMachine.woolSlot = 0;
                        }
                        
                        setTimeout(() => updateSpinningMachineDisplay(), 100);
                    }
                    if (gameState.machines.hasGrassDryer) {
                        document.getElementById('grassDryer').style.display = 'block';
                        document.getElementById('grassDryerShop').style.display = 'none';
                        updateGrassDryerDisplay();
                    }
                    if (gameState.machines.hasWoodCutter) {
                        document.getElementById('woodCutter').style.display = 'block';
                        document.getElementById('woodCutterShop').style.display = 'none';
                    }
                    if (gameState.machines.hasStove) {
                        document.getElementById('stove').style.display = 'block';
                        document.getElementById('stoveShop').style.display = 'none';
                        
                        // Initialize stove slots if not present
                        if (!gameState.machines.stove.ingredientSlots) {
                            gameState.machines.stove.ingredientSlots = [null, null, null, null];
                        }
                        if (!gameState.machines.stove.woodSlot) {
                            gameState.machines.stove.woodSlot = 0;
                        }
                        
                        setTimeout(() => updateStoveDisplay(), 100);
                    }
                    if (gameState.machines.hasMixer) {
                        document.getElementById('mixer').style.display = 'block';
                        document.getElementById('mixerShop').style.display = 'none';
                        
                        // Initialize mixer slots if not present
                        if (!gameState.machines.mixer.ingredientSlots) {
                            gameState.machines.mixer.ingredientSlots = [null, null, null, null];
                        }
                        
                        setTimeout(() => updateMixerDisplay(), 100);
                    }
                }
                
                updateAvatarUI();
                
                if (gameState.mailbox.hasNewMail) {
                    document.getElementById('mailAlert').style.display = 'flex';
                }
                
                // Initialize game start time if not set
                if (!gameState.gameStartTime) {
                    gameState.gameStartTime = Date.now();
                }
                
                // Initialize achievements if not set
                if (!gameState.achievements) {
                    gameState.achievements = {
                        bronze: false,
                        silver: false,
                        gold: false
                    };
                }
            }
        }

        // Initialize game when page loads
        window.onload = initGame;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c2b632d33300a9',t:'MTc1NDY5NDg4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
